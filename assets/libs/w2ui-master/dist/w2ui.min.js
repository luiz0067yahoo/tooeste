var w2ui=w2ui||{},w2obj=w2obj||{},w2utils=function(g){var e={};return{version:"1.5.RC1",settings:{locale:"en-us",dateFormat:"m/d/yyyy",timeFormat:"hh:mi pm",datetimeFormat:"m/d/yyyy|hh:mi pm",currencyPrefix:"$",currencySuffix:"",currencyPrecision:2,groupSymbol:",",decimalSymbol:".",shortmonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],fullmonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortdays:["M","T","W","T","F","S","S"],fulldays:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],weekStarts:"M",dataType:"HTTPJSON",phrases:{},dateStartYear:1950,dateEndYear:2020},isBin:function(e){return/^[0-1]+$/.test(e)},isInt:h,isFloat:function(e){"string"==typeof e&&(e=e.replace(/\s+/g,"").replace(w2utils.settings.groupSymbol,"").replace(w2utils.settings.decimalSymbol,"."));return("number"==typeof e||"string"==typeof e&&""!==e)&&!isNaN(Number(e))},isMoney:function(e){var t=w2utils.settings,i=new RegExp("^"+(t.currencyPrefix?"\\"+t.currencyPrefix+"?":"")+"[-+]?"+(t.currencyPrefix?"\\"+t.currencyPrefix+"?":"")+"[0-9]*[\\"+t.decimalSymbol+"]?[0-9]+"+(t.currencySuffix?"\\"+t.currencySuffix+"?":"")+"$","i");"string"==typeof e&&(e=e.replace(new RegExp(t.groupSymbol,"g"),""));return"object"!=typeof e&&""!==e&&i.test(e)},isHex:function(e){return/^[a-fA-F0-9]+$/.test(e)},isAlphaNumeric:function(e){return/^[a-zA-Z0-9_-]+$/.test(e)},isEmail:function(e){return/^[a-zA-Z0-9._%-+]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/.test(e)},isDate:function(e,t,i){if(!e)return!1;var s,n,r,a="Invalid Date";null==t&&(t=w2utils.settings.dateFormat);if("function"==typeof e.getUTCFullYear)r=e.getUTCFullYear(),s=e.getUTCMonth()+1,n=e.getUTCDate();else if(parseInt(e)==e&&0<parseInt(e))e=new Date(parseInt(e)),r=e.getUTCFullYear(),s=e.getUTCMonth()+1,n=e.getUTCDate();else{if(e=String(e),new RegExp("mon","ig").test(t)){t=t.replace(/month/gi,"m").replace(/mon/gi,"m").replace(/dd/gi,"d").replace(/[, ]/gi,"/").replace(/\/\//g,"/").toLowerCase(),e=e.replace(/[, ]/gi,"/").replace(/\/\//g,"/").toLowerCase();for(var o=0,l=w2utils.settings.fullmonths.length;o<l;o++){var d=w2utils.settings.fullmonths[o];e=e.replace(new RegExp(d,"ig"),parseInt(o)+1).replace(new RegExp(d.substr(0,3),"ig"),parseInt(o)+1)}}var u=e.replace(/-/g,"/").replace(/\./g,"/").toLowerCase().split("/"),c=t.replace(/-/g,"/").replace(/\./g,"/").toLowerCase();"mm/dd/yyyy"===c&&(s=u[0],n=u[1],r=u[2]),"m/d/yyyy"===c&&(s=u[0],n=u[1],r=u[2]),"dd/mm/yyyy"===c&&(s=u[1],n=u[0],r=u[2]),"d/m/yyyy"===c&&(s=u[1],n=u[0],r=u[2]),"yyyy/dd/mm"===c&&(s=u[2],n=u[1],r=u[0]),"yyyy/d/m"===c&&(s=u[2],n=u[1],r=u[0]),"yyyy/mm/dd"===c&&(s=u[1],n=u[2],r=u[0]),"yyyy/m/d"===c&&(s=u[1],n=u[2],r=u[0]),"mm/dd/yy"===c&&(s=u[0],n=u[1],r=u[2]),"m/d/yy"===c&&(s=u[0],n=u[1],r=parseInt(u[2])+1900),"dd/mm/yy"===c&&(s=u[1],n=u[0],r=parseInt(u[2])+1900),"d/m/yy"===c&&(s=u[1],n=u[0],r=parseInt(u[2])+1900),"yy/dd/mm"===c&&(s=u[2],n=u[1],r=parseInt(u[0])+1900),"yy/d/m"===c&&(s=u[2],n=u[1],r=parseInt(u[0])+1900),"yy/mm/dd"===c&&(s=u[1],n=u[2],r=parseInt(u[0])+1900),"yy/m/d"===c&&(s=u[1],n=u[2],r=parseInt(u[0])+1900)}if(!h(r))return!1;if(!h(s))return!1;if(!h(n))return!1;if(r=+r,s=+s,n=+n,a=new Date(r,s-1,n),null==s)return!1;if("Invalid Date"==String(a))return!1;if(a.getMonth()+1!==s||a.getDate()!==n||a.getFullYear()!==r)return!1;return!0!==i||a},isTime:function(e,t){if(null==e)return!1;var i,s,n;e=(e=String(e)).toUpperCase(),s=0<=e.indexOf("AM");var r=(n=0<=e.indexOf("PM"))||s;i=r?12:24;e=e.replace("AM","").replace("PM","");var a=(e=g.trim(e)).split(":"),o=parseInt(a[0]||0),l=parseInt(a[1]||0),d=parseInt(a[2]||0);if((!r||1!==a.length)&&2!==a.length&&3!==a.length)return!1;if(""===a[0]||o<0||i<o||!this.isInt(a[0])||2<a[0].length)return!1;if(1<a.length&&(""===a[1]||l<0||59<l||!this.isInt(a[1])||2!==a[1].length))return!1;if(2<a.length&&(""===a[2]||d<0||59<d||!this.isInt(a[2])||2!==a[2].length))return!1;if(!r&&i===o&&(0!==l||0!==d))return!1;if(r&&1===a.length&&0===o)return!1;if(!0===t)return n&&12!==o&&(o+=12),s&&12===o&&(o+=12),{hours:o,minutes:l,seconds:d};return!0},isDateTime:function(e,t,i){null==t&&(t=w2utils.settings.datetimeFormat);var s=t.split("|");{if("function"==typeof e.getUTCFullYear)return!0!==i||e;if(parseInt(e)==e&&0<parseInt(e))return e=new Date(parseInt(e)),!0!==i||e;var n=String(e).indexOf(" "),r=[e.substr(0,n),e.substr(n).trim()];s[0]=s[0].trim(),s[1]&&(s[1]=s[1].trim());var a=w2utils.isDate(r[0],s[0],!0),o=w2utils.isTime(r[1],!0);return!1!==a&&!1!==o&&(!0!==i||(a.setHours(o.hours),a.setMinutes(o.minutes),a.setSeconds(o.seconds),a))}},age:function(e){var t;if(""===e||null==e)return"";t="function"==typeof e.getUTCFullYear?e:parseInt(e)==e&&0<parseInt(e)?new Date(parseInt(e)):new Date(e);if("Invalid Date"==String(t))return"";var i=((new Date).getTime()-t.getTime())/1e3,s="",n="";i<0?(s=0,n="sec"):i<60?(s=Math.floor(i),n="sec",i<0&&(s=0,n="sec")):i<3600?(s=Math.floor(i/60),n="min"):i<86400?(s=Math.floor(i/60/60),n="hour"):i<2592e3?(s=Math.floor(i/24/60/60),n="day"):i<31536e3?(s=Math.floor(i/30/24/60/60*10)/10,n="month"):i<126144e3?(s=Math.floor(i/365/24/60/60*10)/10,n="year"):126144e3<=i&&(s=Math.floor(i/365.25/24/60/60*10)/10,n="year");return s+" "+n+(1<s?"s":"")},interval:function(e){var t="";t=e<1e3?"< 1 sec":e<6e4?Math.floor(e/1e3)+" secs":e<36e5?Math.floor(e/6e4)+" mins":e<864e5?Math.floor(e/36e5*10)/10+" hours":e<2628e6?Math.floor(e/864e5*10)/10+" days":e<31536e6?Math.floor(e/2628e6*10)/10+" months":Math.floor(e/31536e5)/10+" years";return t},date:function(e){if(""===e||null==e||"object"==typeof e&&!e.getMonth)return"";var t=new Date(e);w2utils.isInt(e)&&(t=new Date(Number(e)));if("Invalid Date"==String(t))return"";var i=w2utils.settings.shortmonths,s=new Date,n=new Date;n.setTime(n.getTime()-864e5);var r=i[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear(),a=i[s.getMonth()]+" "+s.getDate()+", "+s.getFullYear(),o=i[n.getMonth()]+" "+n.getDate()+", "+n.getFullYear(),l=t.getHours()-(12<t.getHours()?12:0)+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+" "+(12<=t.getHours()?"pm":"am"),d=t.getHours()-(12<t.getHours()?12:0)+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+":"+(t.getSeconds()<10?"0":"")+t.getSeconds()+" "+(12<=t.getHours()?"pm":"am"),u=r;r===a&&(u=l);r===o&&(u=w2utils.lang("Yesterday"));return'<span title="'+r+" "+d+'">'+u+"</span>"},formatSize:function(e){if(!w2utils.isFloat(e)||""===e)return"";if(0===(e=parseFloat(e)))return 0;var t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return(Math.floor(e/Math.pow(1024,t)*10)/10).toFixed(0===t?0:1)+" "+(["Bt","KB","MB","GB","TB","PB","EB","ZB"][t]||"??")},formatNumber:function(e,t,i){if(null==e||""===e||"object"==typeof e)return"";var s={minimumFractionDigits:t,maximumFractionDigits:t,useGrouping:i};(null==t||t<0)&&(s.minimumFractionDigits=0,s.maximumFractionDigits=20);return parseFloat(e).toLocaleString(w2utils.settings.locale,s)},formatDate:function(e,t){t||(t=this.settings.dateFormat);if(""===e||null==e||"object"==typeof e&&!e.getMonth)return"";var i=new Date(e);w2utils.isInt(e)&&(i=new Date(Number(e)));if("Invalid Date"==String(i))return"";var s=i.getFullYear(),n=i.getMonth(),r=i.getDate();return t.toLowerCase().replace("month",w2utils.settings.fullmonths[n]).replace("mon",w2utils.settings.shortmonths[n]).replace(/yyyy/g,s).replace(/yyy/g,s).replace(/yy/g,2e3<s?100+parseInt(String(s).substr(2)):String(s).substr(2)).replace(/(^|[^a-z$])y/g,"$1"+s).replace(/mm/g,(n+1<10?"0":"")+(n+1)).replace(/dd/g,(r<10?"0":"")+r).replace(/th/g,1==r?"st":"th").replace(/th/g,2==r?"nd":"th").replace(/th/g,3==r?"rd":"th").replace(/(^|[^a-z$])m/g,"$1"+(n+1)).replace(/(^|[^a-z$])d/g,"$1"+r)},formatTime:function(e,t){w2utils.settings.shortmonths,w2utils.settings.fullmonths;t||(t=this.settings.timeFormat);if(""===e||null==e||"object"==typeof e&&!e.getMonth)return"";var i=new Date(e);w2utils.isInt(e)&&(i=new Date(Number(e)));if(w2utils.isTime(e)){var s=w2utils.isTime(e,!0);(i=new Date).setHours(s.hours),i.setMinutes(s.minutes)}if("Invalid Date"==String(i))return"";var n="am",r=i.getHours(),a=i.getHours(),o=i.getMinutes(),l=i.getSeconds();o<10&&(o="0"+o);l<10&&(l="0"+l);-1===t.indexOf("am")&&-1===t.indexOf("pm")||(12<=r&&(n="pm"),12<r&&(r-=12));return t.toLowerCase().replace("am",n).replace("pm",n).replace("hhh",r<10?"0"+r:r).replace("hh24",a<10?"0"+a:a).replace("h24",a).replace("hh",r).replace("mm",o).replace("mi",o).replace("ss",l).replace(/(^|[^a-z$])h/g,"$1"+r).replace(/(^|[^a-z$])m/g,"$1"+o).replace(/(^|[^a-z$])s/g,"$1"+l)},formatDateTime:function(e,t){var i;if(""===e||null==e||"object"==typeof e&&!e.getMonth)return"";"string"!=typeof t?i=[this.settings.dateFormat,this.settings.timeFormat]:((i=t.split("|"))[0]=i[0].trim(),i[1]=i[1].trim());"h12"==i[1]&&(i[1]="h:m pm");"h24"==i[1]&&(i[1]="h24:m");return this.formatDate(e,i[0])+" "+this.formatTime(e,i[1])},stripTags:function(e){if(null==e)return e;switch(typeof e){case"number":break;case"string":e=String(e).replace(/(<([^>]+)>)/gi,"");break;case"object":if(Array.isArray(e)){e=g.extend(!0,[],e);for(var t=0;t<e.length;t++)e[t]=this.stripTags(e[t])}else for(var t in e=g.extend(!0,{},e))e[t]=this.stripTags(e[t])}return e},encodeTags:n,decodeTags:function(e){if(null==e)return e;switch(typeof e){case"number":break;case"string":e=String(e).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&").replace(/&quot;/g,'"');break;case"object":if(Array.isArray(e)){e=g.extend(!0,[],e);for(var t=0;t<e.length;t++)e[t]=this.decodeTags(e[t])}else for(var t in e=g.extend(!0,{},e))e[t]=this.decodeTags(e[t])}return e},escapeId:function(e){return""===e||null==e?"":String(e).replace(/([;&,\.\+\*\~'`:"\!\^#$%@\[\]\(\)=<>\|\/? {}\\])/g,"\\$1")},base64encode:function(e){var t,i,s,n,r,a,o,l="",d=0,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e=function(e){e=String(e).replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var s=e.charCodeAt(i);s<128?t+=String.fromCharCode(s):(127<s&&s<2048?t+=String.fromCharCode(s>>6|192):(t+=String.fromCharCode(s>>12|224),t+=String.fromCharCode(s>>6&63|128)),t+=String.fromCharCode(63&s|128))}return t}(e);for(;d<e.length;)t=e.charCodeAt(d++),i=e.charCodeAt(d++),s=e.charCodeAt(d++),n=t>>2,r=(3&t)<<4|i>>4,a=(15&i)<<2|s>>6,o=63&s,isNaN(i)?a=o=64:isNaN(s)&&(o=64),l=l+u.charAt(n)+u.charAt(r)+u.charAt(a)+u.charAt(o);return l},base64decode:function(e){var t,i,s,n,r,a,o,l="",d=0,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(;d<e.length;)n=u.indexOf(e.charAt(d++)),r=u.indexOf(e.charAt(d++)),a=u.indexOf(e.charAt(d++)),o=u.indexOf(e.charAt(d++)),t=n<<2|r>>4,i=(15&r)<<4|a>>2,s=(3&a)<<6|o,l+=String.fromCharCode(t),64!==a&&(l+=String.fromCharCode(i)),64!==o&&(l+=String.fromCharCode(s));return l=function(e){for(var t,i,s="",n=0,r=0;n<e.length;)(r=e.charCodeAt(n))<128?(s+=String.fromCharCode(r),n++):191<r&&r<224?(t=e.charCodeAt(n+1),s+=String.fromCharCode((31&r)<<6|63&t),n+=2):(t=e.charCodeAt(n+1),i=e.charCodeAt(n+2),s+=String.fromCharCode((15&r)<<12|(63&t)<<6|63&i),n+=3);return s}(l)},md5:function(e){var r=0;function t(e){return a(o(n(e),8*e.length))}function i(e){for(var t,i=r?"0123456789ABCDEF":"0123456789abcdef",s="",n=0;n<e.length;n++)t=e.charCodeAt(n),s+=i.charAt(t>>>4&15)+i.charAt(15&t);return s}function s(e){for(var t,i,s="",n=-1;++n<e.length;)t=e.charCodeAt(n),i=n+1<e.length?e.charCodeAt(n+1):0,55296<=t&&t<=56319&&56320<=i&&i<=57343&&(t=65536+((1023&t)<<10)+(1023&i),n++),t<=127?s+=String.fromCharCode(t):t<=2047?s+=String.fromCharCode(192|t>>>6&31,128|63&t):t<=65535?s+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):t<=2097151&&(s+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return s}function n(e){for(var t=Array(e.length>>2),i=0;i<t.length;i++)t[i]=0;for(var i=0;i<8*e.length;i+=8)t[i>>5]|=(255&e.charCodeAt(i/8))<<i%32;return t}function a(e){for(var t="",i=0;i<32*e.length;i+=8)t+=String.fromCharCode(e[i>>5]>>>i%32&255);return t}function o(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var i=1732584193,s=-271733879,n=-1732584194,r=271733878,a=0;a<e.length;a+=16){var o=i,l=s,d=n,u=r;i=c(i,s,n,r,e[a+0],7,-680876936),r=c(r,i,s,n,e[a+1],12,-389564586),n=c(n,r,i,s,e[a+2],17,606105819),s=c(s,n,r,i,e[a+3],22,-1044525330),i=c(i,s,n,r,e[a+4],7,-176418897),r=c(r,i,s,n,e[a+5],12,1200080426),n=c(n,r,i,s,e[a+6],17,-1473231341),s=c(s,n,r,i,e[a+7],22,-45705983),i=c(i,s,n,r,e[a+8],7,1770035416),r=c(r,i,s,n,e[a+9],12,-1958414417),n=c(n,r,i,s,e[a+10],17,-42063),s=c(s,n,r,i,e[a+11],22,-1990404162),i=c(i,s,n,r,e[a+12],7,1804603682),r=c(r,i,s,n,e[a+13],12,-40341101),n=c(n,r,i,s,e[a+14],17,-1502002290),s=c(s,n,r,i,e[a+15],22,1236535329),i=h(i,s,n,r,e[a+1],5,-165796510),r=h(r,i,s,n,e[a+6],9,-1069501632),n=h(n,r,i,s,e[a+11],14,643717713),s=h(s,n,r,i,e[a+0],20,-373897302),i=h(i,s,n,r,e[a+5],5,-701558691),r=h(r,i,s,n,e[a+10],9,38016083),n=h(n,r,i,s,e[a+15],14,-660478335),s=h(s,n,r,i,e[a+4],20,-405537848),i=h(i,s,n,r,e[a+9],5,568446438),r=h(r,i,s,n,e[a+14],9,-1019803690),n=h(n,r,i,s,e[a+3],14,-187363961),s=h(s,n,r,i,e[a+8],20,1163531501),i=h(i,s,n,r,e[a+13],5,-1444681467),r=h(r,i,s,n,e[a+2],9,-51403784),n=h(n,r,i,s,e[a+7],14,1735328473),s=h(s,n,r,i,e[a+12],20,-1926607734),i=p(i,s,n,r,e[a+5],4,-378558),r=p(r,i,s,n,e[a+8],11,-2022574463),n=p(n,r,i,s,e[a+11],16,1839030562),s=p(s,n,r,i,e[a+14],23,-35309556),i=p(i,s,n,r,e[a+1],4,-1530992060),r=p(r,i,s,n,e[a+4],11,1272893353),n=p(n,r,i,s,e[a+7],16,-155497632),s=p(s,n,r,i,e[a+10],23,-1094730640),i=p(i,s,n,r,e[a+13],4,681279174),r=p(r,i,s,n,e[a+0],11,-358537222),n=p(n,r,i,s,e[a+3],16,-722521979),s=p(s,n,r,i,e[a+6],23,76029189),i=p(i,s,n,r,e[a+9],4,-640364487),r=p(r,i,s,n,e[a+12],11,-421815835),n=p(n,r,i,s,e[a+15],16,530742520),s=p(s,n,r,i,e[a+2],23,-995338651),i=f(i,s,n,r,e[a+0],6,-198630844),r=f(r,i,s,n,e[a+7],10,1126891415),n=f(n,r,i,s,e[a+14],15,-1416354905),s=f(s,n,r,i,e[a+5],21,-57434055),i=f(i,s,n,r,e[a+12],6,1700485571),r=f(r,i,s,n,e[a+3],10,-1894986606),n=f(n,r,i,s,e[a+10],15,-1051523),s=f(s,n,r,i,e[a+1],21,-2054922799),i=f(i,s,n,r,e[a+8],6,1873313359),r=f(r,i,s,n,e[a+15],10,-30611744),n=f(n,r,i,s,e[a+6],15,-1560198380),s=f(s,n,r,i,e[a+13],21,1309151649),i=f(i,s,n,r,e[a+4],6,-145523070),r=f(r,i,s,n,e[a+11],10,-1120210379),n=f(n,r,i,s,e[a+2],15,718787259),s=f(s,n,r,i,e[a+9],21,-343485551),i=g(i,o),s=g(s,l),n=g(n,d),r=g(r,u)}return Array(i,s,n,r)}function l(e,t,i,s,n,r){return g((a=g(g(t,e),g(s,r)))<<(o=n)|a>>>32-o,i);var a,o}function c(e,t,i,s,n,r,a){return l(t&i|~t&s,e,t,n,r,a)}function h(e,t,i,s,n,r,a){return l(t&s|i&~s,e,t,n,r,a)}function p(e,t,i,s,n,r,a){return l(t^i^s,e,t,n,r,a)}function f(e,t,i,s,n,r,a){return l(i^(t|~s),e,t,n,r,a)}function g(e,t){var i=(65535&e)+(65535&t),s=(e>>16)+(t>>16)+(i>>16);return s<<16|65535&i}return d=e,i(t(s(d)));var d},transition:function(e,t,i,s){var n=g(e).width(),r=g(e).height();if(!e||!t)return void console.log("ERROR: Cannot do transition when one of the divs is null");switch(e.parentNode.style.cssText+="perspective: 900px; overflow: hidden;",e.style.cssText+="; position: absolute; z-index: 1019; backface-visibility: hidden",t.style.cssText+="; position: absolute; z-index: 1020; backface-visibility: hidden",i){case"slide-left":e.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",t.style.cssText+="overflow: hidden; transform: translate3d("+n+"px, 0, 0)",g(t).show(),window.setTimeout(function(){t.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)",e.style.cssText+="transition: 0.5s; transform: translate3d(-"+n+"px, 0, 0)"},1);break;case"slide-right":e.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",t.style.cssText+="overflow: hidden; transform: translate3d(-"+n+"px, 0, 0)",g(t).show(),window.setTimeout(function(){t.style.cssText+="transition: 0.5s; transform: translate3d(0px, 0, 0)",e.style.cssText+="transition: 0.5s; transform: translate3d("+n+"px, 0, 0)"},1);break;case"slide-down":e.style.cssText+="overflow: hidden; z-index: 1; transform: translate3d(0, 0, 0)",t.style.cssText+="overflow: hidden; z-index: 0; transform: translate3d(0, 0, 0)",g(t).show(),window.setTimeout(function(){t.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)",e.style.cssText+="transition: 0.5s; transform: translate3d(0, "+r+"px, 0)"},1);break;case"slide-up":e.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",t.style.cssText+="overflow: hidden; transform: translate3d(0, "+r+"px, 0)",g(t).show(),window.setTimeout(function(){t.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)",e.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)"},1);break;case"flip-left":e.style.cssText+="overflow: hidden; transform: rotateY(0deg)",t.style.cssText+="overflow: hidden; transform: rotateY(-180deg)",g(t).show(),window.setTimeout(function(){t.style.cssText+="transition: 0.5s; transform: rotateY(0deg)",e.style.cssText+="transition: 0.5s; transform: rotateY(180deg)"},1);break;case"flip-right":e.style.cssText+="overflow: hidden; transform: rotateY(0deg)",t.style.cssText+="overflow: hidden; transform: rotateY(180deg)",g(t).show(),window.setTimeout(function(){t.style.cssText+="transition: 0.5s; transform: rotateY(0deg)",e.style.cssText+="transition: 0.5s; transform: rotateY(-180deg)"},1);break;case"flip-down":e.style.cssText+="overflow: hidden; transform: rotateX(0deg)",t.style.cssText+="overflow: hidden; transform: rotateX(180deg)",g(t).show(),window.setTimeout(function(){t.style.cssText+="transition: 0.5s; transform: rotateX(0deg)",e.style.cssText+="transition: 0.5s; transform: rotateX(-180deg)"},1);break;case"flip-up":e.style.cssText+="overflow: hidden; transform: rotateX(0deg)",t.style.cssText+="overflow: hidden; transform: rotateX(-180deg)",g(t).show(),window.setTimeout(function(){t.style.cssText+="transition: 0.5s; transform: rotateX(0deg)",e.style.cssText+="transition: 0.5s; transform: rotateX(180deg)"},1);break;case"pop-in":e.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); transform: scale(.8); opacity: 0;",g(t).show(),window.setTimeout(function(){t.style.cssText+="transition: 0.5s; transform: scale(1); opacity: 1;",e.style.cssText+="transition: 0.5s;"},1);break;case"pop-out":e.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); transform: scale(1); opacity: 1;",t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); opacity: 0;",g(t).show(),window.setTimeout(function(){t.style.cssText+="transition: 0.5s; opacity: 1;",e.style.cssText+="transition: 0.5s; transform: scale(1.7); opacity: 0;"},1);break;default:e.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",t.style.cssText+="overflow: hidden; translate3d(0, 0, 0); opacity: 0;",g(t).show(),window.setTimeout(function(){t.style.cssText+="transition: 0.5s; opacity: 1;",e.style.cssText+="transition: 0.5s"},1)}setTimeout(function(){"slide-down"===i&&(g(e).css("z-index","1019"),g(t).css("z-index","1020")),t&&g(t).css({opacity:"1"}).css(w2utils.cssPrefix({transition:"",transform:""})),e&&g(e).css({opacity:"1"}).css(w2utils.cssPrefix({transition:"",transform:""})),"function"==typeof s&&s()},500)},lock:function(e,t,i){var s={};"object"==typeof t?s=t:(s.msg=t,s.spinner=i);s.msg||0===s.msg||(s.msg="");w2utils.unlock(e),g(e).prepend('<div class="w2ui-lock"></div><div class="w2ui-lock-msg"></div>');var n=g(e).find(".w2ui-lock"),r=g(e).find(".w2ui-lock-msg");s.msg||r.css({"background-color":"transparent",border:"0px"});!0===s.spinner&&(s.msg='<div class="w2ui-spinner" '+(s.msg?"":'style="width: 35px; height: 35px"')+"></div>"+s.msg);null!=s.opacity&&n.css("opacity",s.opacity);"function"==typeof n.fadeIn?(n.fadeIn(200),r.html(s.msg).fadeIn(200)):(n.show(),r.html(s.msg).show(0))},unlock:function(e,t){h(t)?(g(e).find(".w2ui-lock").fadeOut(t),setTimeout(function(){g(e).find(".w2ui-lock").remove(),g(e).find(".w2ui-lock-msg").remove()},t)):(g(e).find(".w2ui-lock").remove(),g(e).find(".w2ui-lock-msg").remove())},message:function(s,e){var t,n,r=this;g().w2tag(),e||(e={width:200,height:100});null==e.on&&g.extend(e,w2utils.event);null==e.width&&(e.width=200);null==e.height&&(e.height=100);var i=parseInt(g(s.box).width()),a=parseInt(g(s.box).height()),o=parseInt(g(s.box).find(s.title).css("height")||0);e.width>i&&(e.width=i-10);e.height>a-o&&(e.height=a-10-o);e.originalWidth=e.width,e.originalHeight=e.height,parseInt(e.width)<0&&(e.width=i+e.width);parseInt(e.width)<10&&(e.width=10);parseInt(e.height)<0&&(e.height=a+e.height-o);parseInt(e.height)<10&&(e.height=10);null==e.hideOnClick&&(e.hideOnClick=!1);var l=g(s.box).data("options")||{};(null==e.width||e.width>l.width-10)&&(e.width=l.width-10);(null==e.height||e.height>l.height-o-5)&&(e.height=l.height-o-5);e.originalHeight<0&&(e.height=a+e.originalHeight-o);e.originalWidth<0&&(e.width=i+2*e.originalWidth);var d=g(s.box).find(s.title),u=g(s.box).find(".w2ui-message.w2ui-closing");0<g(s.box).find(".w2ui-message.w2ui-closing").length&&(clearTimeout(t),f(u,u.data("options")||{}));var c=g(s.box).find(".w2ui-message").length;if(""===g.trim(e.html)&&""===g.trim(e.body)&&""===g.trim(e.buttons)){if(0===c)return;var h=g(s.box).find("#w2ui-message"+(c-1)),e=h.data("options")||{};if(!0===(n=e.trigger({phase:"before",type:"close",target:"self"})).isCancelled)return;h.css(w2utils.cssPrefix({transition:"0.15s",transform:"translateY(-"+e.height+"px)"})).addClass("w2ui-closing"),1==c?this.unlock&&(s.param?this.unlock(s.param,150):this.unlock(150)):g(s.box).find("#w2ui-message"+(c-2)).css("z-index",1500),t=setTimeout(function(){f(h,e)},150)}else{""===g.trim(e.body)&&""===g.trim(e.buttons)||(e.html='<div class="w2ui-message-body">'+(e.body||"")+'</div><div class="w2ui-message-buttons">'+(e.buttons||"")+"</div>"),g(s.box).find(".w2ui-message").css("z-index",1390),d.data("old-z-index",d.css("z-index")),d.css("z-index",1501),g(s.box).find(s.body).before('<div id="w2ui-message'+c+'" onmousedown="event.stopPropagation();"    class="w2ui-message" style="display: none; z-index: 1500; '+(0===d.length?"top: 0px;":"top: "+w2utils.getSize(d,"height")+"px;")+(null!=e.width?"width: "+e.width+"px; left: "+(i-e.width)/2+"px;":"left: 10px; right: 10px;")+(null!=e.height?"height: "+e.height+"px;":"bottom: 6px;")+w2utils.cssPrefix("transition",".3s",!0)+'"'+(!0===e.hideOnClick?s.param?'onclick="'+s.path+".message('"+s.param+"');\"":'onclick="'+s.path+'.message();"':"")+"></div>"),g(s.box).find("#w2ui-message"+c).data("options",e).data("prev_focus",g(":focus"));var p=g(s.box).find("#w2ui-message"+c).css("display");if(g(s.box).find("#w2ui-message"+c).css(w2utils.cssPrefix({transform:"none"==p?"translateY(-"+e.height+"px)":"translateY(0px)"})),"none"==p){if(g(s.box).find("#w2ui-message"+c).show().html(e.html),e.box=g(s.box).find("#w2ui-message"+c),!0===(n=e.trigger({phase:"before",type:"open",target:"self"})).isCancelled)return d.css("z-index",d.data("old-z-index")),void g(s.box).find("#w2ui-message"+c).remove();setTimeout(function(){g(s.box).find("#w2ui-message"+c).css(w2utils.cssPrefix({transform:"none"==p?"translateY(0px)":"translateY(-"+e.height+"px)"}))},1),0===c&&this.lock&&(s.param?this.lock(s.param):this.lock()),setTimeout(function(){g(s.box).find("#w2ui-message"+c).css(w2utils.cssPrefix({transition:"0s"})),e.trigger(g.extend(n,{phase:"after"}))},350)}}function f(e,t){if(null==n&&!0===(n=t.trigger({phase:"before",type:"open",target:"self"})).isCancelled)return d.css("z-index",d.data("old-z-index")),void g(s.box).find("#w2ui-message"+c).remove();var i=e.data("prev_focus");e.remove(),i&&0<i.length?i.focus():r&&r.focus&&r.focus(),d.css("z-index",d.data("old-z-index")),t.trigger(g.extend(n,{phase:"after"}))}},lang:function(e){var t=this.settings.phrases[e];return null==t?e:t},locale:function(s){s||(s="en-us");if("string"!=typeof s)return void(w2utils.settings=g.extend(!0,w2utils.settings,s));5===s.length&&(s="locale/"+s+".json");w2utils.settings.phrases={},g.ajax({url:s,type:"GET",dataType:"JSON",async:!1,success:function(e,t,i){w2utils.settings=g.extend(!0,w2utils.settings,e)},error:function(e,t,i){console.log("ERROR: Cannot load locale "+s)}})},getSize:function(e,t){var i=g(e),s={left:parseInt(i.css("border-left-width"))||0,right:parseInt(i.css("border-right-width"))||0,top:parseInt(i.css("border-top-width"))||0,bottom:parseInt(i.css("border-bottom-width"))||0},n={left:parseInt(i.css("margin-left"))||0,right:parseInt(i.css("margin-right"))||0,top:parseInt(i.css("margin-top"))||0,bottom:parseInt(i.css("margin-bottom"))||0},r={left:parseInt(i.css("padding-left"))||0,right:parseInt(i.css("padding-right"))||0,top:parseInt(i.css("padding-top"))||0,bottom:parseInt(i.css("padding-bottom"))||0};switch(t){case"top":return s.top+n.top+r.top;case"bottom":return s.bottom+n.bottom+r.bottom;case"left":return s.left+n.left+r.left;case"right":return s.right+n.right+r.right;case"width":return s.left+s.right+n.left+n.right+r.left+r.right+parseInt(i.width());case"height":return s.top+s.bottom+n.top+n.bottom+r.top+r.bottom+parseInt(i.height());case"+width":return s.left+s.right+n.left+n.right+r.left+r.right;case"+height":return s.top+s.bottom+n.top+n.bottom+r.top+r.bottom}return 0},getStrWidth:function(e,t){var i,s='<div id="_tmp_width" style="position: absolute; top: -900px;'+(t||"")+'">'+n(e)+"</div>";return g("body").append(s),i=g("#_tmp_width").width(),g("#_tmp_width").remove(),i},scrollBarSize:function(){if(e.scrollBarSize)return e.scrollBarSize;g("body").append('<div id="_scrollbar_width" style="position: absolute; top: -300px; width: 100px; height: 100px; overflow-y: scroll;">    <div style="height: 120px">1</div></div>'),e.scrollBarSize=100-g("#_scrollbar_width > div").width(),g("#_scrollbar_width").remove(),0<=String(navigator.userAgent).indexOf("MSIE")&&(e.scrollBarSize=e.scrollBarSize/2);return e.scrollBarSize},checkName:function(e,t){if(!e||null==e.name)return console.log('ERROR: The parameter "name" is required but not supplied in $().'+t+"()."),!1;if(null!=w2ui[e.name])return console.log('ERROR: The parameter "name" is not unique. There are other objects already created with the same name (obj: '+e.name+")."),!1;if(!w2utils.isAlphaNumeric(e.name))return console.log('ERROR: The parameter "name" has to be alpha-numeric (a-z, 0-9, dash and underscore). '),!1;return!0},checkUniqueId:function(e,t,i,s){g.isArray(t)||(t=[t]);for(var n=0;n<t.length;n++)if(t[n].id===e)return console.log('ERROR: The parameter "id='+e+'" is not unique within the current '+i+". (obj: "+s+")"),!1;return!0},parseRoute:function(e){var a=[],t=e.replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(e,t,i,s,n,r){return a.push({name:s,optional:!!r}),t=t||"",(r?"":t)+"(?:"+(r?t:"")+(i||"")+(n||(i?"([^/.]+?)":"([^/]+?)"))+")"+(r||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");return{path:new RegExp("^"+t+"$","i"),keys:a}},cssPrefix:function(e,t,i){var s={},n={},r="";g.isPlainObject(e)?(s=e,!0===t&&(i=!0)):s[e]=t;for(var a in s)n[a]=s[a],n["-webkit-"+a]=s[a],n["-moz-"+a]=s[a].replace("-webkit-","-moz-"),n["-ms-"+a]=s[a].replace("-webkit-","-ms-"),n["-o-"+a]=s[a].replace("-webkit-","-o-");if(!0===i)for(var a in n)r+=a+": "+n[a]+"; ";else r=n;return r},getCursorPosition:function(e){if(null==e)return null;var t,i=0,s=e.ownerDocument||e.document,n=s.defaultView||s.parentWindow;if(e.tagName&&"INPUT"==e.tagName.toUpperCase()&&e.selectionStart)i=e.selectionStart;else if(n.getSelection){if(0<(t=n.getSelection()).rangeCount){var r=t.getRangeAt(0),a=r.cloneRange();a.selectNodeContents(e),a.setEnd(r.endContainer,r.endOffset),i=a.toString().length}}else if((t=s.selection)&&"Control"!=t.type){var o=t.createRange(),l=s.body.createTextRange();l.moveToElementText(e),l.setEndPoint("EndToEnd",o),i=l.text.length}return i},setCursorPosition:function(e,t,i){var s,n=document.createRange(),r=window.getSelection();if(null==e)return;for(var a=0;a<e.childNodes.length;a++){var o=g(e.childNodes[a]).text();if(e.childNodes[a].tagName&&(o=(o=g(e.childNodes[a]).html()).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&nbsp;/g," ")),t<=o.length){(s=e.childNodes[a]).childNodes&&0<s.childNodes.length&&(s=s.childNodes[0]),s.childNodes&&0<s.childNodes.length&&(s=s.childNodes[0]);break}t-=o.length}if(null==s)return;t>s.length&&(t=s.length);n.setStart(s,t),i?n.setEnd(s,i):n.collapse(!0);r.removeAllRanges(),r.addRange(n)},testLocalStorage:t,hasLocalStorage:t(),isIOS:-1!=navigator.userAgent.toLowerCase().indexOf("iphone")||-1!=navigator.userAgent.toLowerCase().indexOf("ipod")||-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),isIE:-1!=navigator.userAgent.toLowerCase().indexOf("msie")||-1!=navigator.userAgent.toLowerCase().indexOf("trident")};function h(e){return/^[-+]?[0-9]+$/.test(e)}function n(e){if(null==e)return e;switch(typeof e){case"number":break;case"string":e=String(e).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;");break;case"object":if(Array.isArray(e)){e=g.extend(!0,[],e);for(var t=0;t<e.length;t++)e[t]=this.encodeTags(e[t])}else for(var t in e=g.extend(!0,{},e))e[t]=this.encodeTags(e[t])}return e}function t(){var e="w2ui_test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}}(jQuery);w2utils.formatters={number:function(e,t){return 20<parseInt(t)&&(t=20),parseInt(t)<0&&(t=0),null==e||""===e?"":w2utils.formatNumber(parseFloat(e),t,!0)},float:function(e,t){return w2utils.formatters.number(e,t)},int:function(e,t){return w2utils.formatters.number(e,0)},money:function(e,t){if(null==e||""===e)return"";var i=w2utils.formatNumber(Number(e),w2utils.settings.currencyPrecision||2);return(w2utils.settings.currencyPrefix||"")+i+(w2utils.settings.currencySuffix||"")},currency:function(e,t){return w2utils.formatters.money(e,t)},percent:function(e,t){return null==e||""===e?"":w2utils.formatNumber(e,t||1)+"%"},size:function(e,t){return null==e||""===e?"":w2utils.formatSize(parseInt(e))},date:function(e,t){if(""===t&&(t=w2utils.settings.dateFormat),null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,t,!0);return!1===i&&(i=w2utils.isDate(e,t,!0)),'<span title="'+i+'">'+w2utils.formatDate(i,t)+"</span>"},datetime:function(e,t){if(""===t&&(t=w2utils.settings.datetimeFormat),null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,t,!0);return!1===i&&(i=w2utils.isDate(e,t,!0)),'<span title="'+i+'">'+w2utils.formatDateTime(i,t)+"</span>"},time:function(e,t){if(""===t&&(t=w2utils.settings.timeFormat),"h12"===t&&(t="hh:mi pm"),"h24"===t&&(t="h24:mi"),null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,t,!0);return!1===i&&(i=w2utils.isDate(e,t,!0)),'<span title="'+i+'">'+w2utils.formatTime(e,t)+"</span>"},timestamp:function(e,t){if(""===t&&(t=w2utils.settings.datetimeFormat),null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,t,!0);return!1===i&&(i=w2utils.isDate(e,t,!0)),i.toString?i.toString():""},gmt:function(e,t){if(""===t&&(t=w2utils.settings.datetimeFormat),null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,t,!0);return!1===i&&(i=w2utils.isDate(e,t,!0)),i.toUTCString?i.toUTCString():""},age:function(e,t){if(null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,null,!0);return!1===i&&(i=w2utils.isDate(e,null,!0)),'<span title="'+i+'">'+w2utils.age(e)+(t?" "+t:"")+"</span>"},interval:function(e,t){return null==e||0===e||""===e?"":w2utils.interval(e)+(t?" "+t:"")},toggle:function(e,t){return e?"Yes":""},password:function(e,t){for(var i="",s=0;s<e.length;s++)i+="*";return i}},w2utils.event={on:function(e,t){var i,s=jQuery;"string"==typeof e&&-1!=e.indexOf(".")&&(e=(n=e.split("."))[0],i=n[1]);if("string"==typeof e&&-1!=e.indexOf(":")){var n=e.split(":");-1!=["complete","done"].indexOf(e[1])&&(e[1]="after"),e={type:n[0],execute:n[1]}}s.isPlainObject(e)||(e={type:e,scope:i}),(e=s.extend({type:null,execute:"before",target:null,onComplete:null},e)).type?t?(s.isArray(this.handlers)||(this.handlers=[]),console.log("add",e),this.handlers.push({edata:e,handler:t})):console.log("ERROR: You must specify event handler function when calling .on() method of "+this.name):console.log("ERROR: You must specify event type when calling .on() method of "+this.name)},off:function(e,t){var i,s=jQuery;"string"==typeof e&&-1!=e.indexOf(".")&&(e=(n=e.split("."))[0],i=n[1]);if("string"==typeof e&&-1!=e.indexOf(":")){var n=e.split(":");-1!=["complete","done"].indexOf(e[1])&&(e[1]="after"),e={type:n[0],execute:n[1]}}if(s.isPlainObject(e)||(e={type:e}),(e=s.extend({},{type:null,execute:"before",target:null,onComplete:null},e)).type||i){t||(t=null);for(var r=[],a=0,o=this.handlers.length;a<o;a++){var l=this.handlers[a];(l.edata.type!==e.type&&"*"!==e.type&&(null==l.edata.scope||""!=e.type)||l.edata.target!==e.target&&null!=e.target||l.edata.execute!==e.execute&&null!=e.execute||l.handler!==t&&null!=t&&(null==i||l.edata.scope!=i))&&r.push(l)}this.handlers=r}else console.log("ERROR: You must specify event type when calling .off() method of "+this.name)},trigger:function(e){var t,i,s,n=jQuery;"before"===(e=n.extend({type:null,phase:"before",target:null,doneHandlers:[]},e,{isStopped:!1,isCancelled:!1,done:function(e){this.doneHandlers.push(e)},preventDefault:function(){this.isCancelled=!0},stopPropagation:function(){this.isStopped=!0}})).phase&&(e.onComplete=null),null==e.target&&(e.target=null),n.isArray(this.handlers)||(this.handlers=[]);for(var r=this.handlers.length-1;0<=r;r--){var a=this.handlers[r];if(!(a.edata.type!==e.type&&"*"!==a.edata.type||a.edata.target!==e.target&&null!=a.edata.target||a.edata.execute!==e.phase&&"*"!==a.edata.execute&&"*"!==a.edata.phase)&&(e=n.extend({},a.edata,e),t=[],(s=new RegExp(/\((.*?)\)/).exec(a.handler))&&(t=s[1].split(/\s*,\s*/)),2===t.length?a.handler.call(this,e.target,e):a.handler.call(this,e),!0===e.isStopped||!0===e.stop))return e}var o="on"+e.type.substr(0,1).toUpperCase()+e.type.substr(1);if("before"===e.phase&&"function"==typeof this[o]&&(i=this[o],t=[],(s=new RegExp(/\((.*?)\)/).exec(i))&&(t=s[1].split(/\s*,\s*/)),2===t.length?i.call(this,e.target,e):i.call(this,e),!0===e.isStopped||!0===e.stop))return e;if(null!=e.object&&"before"===e.phase&&"function"==typeof e.object[o]&&(i=e.object[o],t=[],(s=new RegExp(/\((.*?)\)/).exec(i))&&(t=s[1].split(/\s*,\s*/)),2===t.length?i.call(this,e.target,e):i.call(this,e),!0===e.isStopped||!0===e.stop))return e;if("after"===e.phase){"function"==typeof e.onComplete&&e.onComplete.call(this,e);for(var l=0;l<e.doneHandlers.length;l++)"function"==typeof e.doneHandlers[l]&&e.doneHandlers[l].call(this,e)}return e}},function(x){x.fn.w2render=function(e){0<x(this).length&&("string"==typeof e&&w2ui[e]&&w2ui[e].render(x(this)[0]),"object"==typeof e&&e.render(x(this)[0]))},x.fn.w2destroy=function(e){!e&&0<this.length&&(e=this.attr("name")),"string"==typeof e&&w2ui[e]&&w2ui[e].destroy(),"object"==typeof e&&e.destroy()},x.fn.w2marker=function(){var a=Array.prototype.slice.call(arguments,0);return Array.isArray(a[0])&&(a=a[0]),0!==a.length&&a[0]?x(this).each(function(e,t){o(e,t);for(var i=0;i<a.length;i++){var s=a[i];"string"!=typeof s&&(s=String(s)),s=s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&").replace(/&/g,"&amp;").replace(/</g,"&gt;").replace(/>/g,"&lt;");var n=new RegExp(s+"(?!([^<]+)?>)","gi");t.innerHTML=t.innerHTML.replace(n,r)}function r(e){return'<span class="w2ui-marker">'+e+"</span>"}}):x(this).each(o);function o(e,t){for(;-1!=t.innerHTML.indexOf('<span class="w2ui-marker">');)t.innerHTML=t.innerHTML.replace(/\<span class=\"w2ui\-marker\"\>((.|\n|\r)*)\<\/span\>/gi,"$1")}},x.fn.w2tag=function(n,w){if(1==arguments.length&&"object"==typeof n&&null!=(w=n).html&&(n=w.html),null!=(w=x.extend({id:null,html:n,position:"right|top",align:"none",left:0,top:0,style:"",css:{},className:"",inputClass:"",onShow:null,onHide:null,hideOnKeyPress:!0,hideOnBlur:!1,hideOnClick:!1},w)).name&&null==w.id&&(w.id=w.name),""!==w.class&&""===w.inputClass&&(w.inputClass=w.class),0!==x(this).length)return x(this).each(function(e,p){var t=w.id?w.id:p.id,i=w2utils.escapeId(t),f=x("#w2ui-tag-"+i);if(""===n||null==n)return f.css("opacity",0),clearInterval(f.data("timer")),void f.remove();if(0!==f.length)w=x.extend(f.data("options"),w),f.data("options",w),f.find(".w2ui-tag-body").attr("style",w.style).addClass(w.className).html(w.html),m(!0);else{var s="";0<x(p).length&&(s=x(p)[0].style.cssText),x("body").append('<div onclick="event.stopPropagation()" style="display:none;" id="w2ui-tag-'+t+'"        class="w2ui-tag '+(0<x(p).parents(".w2ui-popup, .w2ui-overlay-popup, .w2ui-message").length?"w2ui-tag-popup":"")+'">   <div style="margin: -2px 0px 0px -2px; white-space: nowrap;">      <div class="w2ui-tag-body '+w.className+'" style="'+(w.style||"")+'">'+n+"</div>   </div></div>"),f=x("#w2ui-tag-"+i),x(p).data("w2tag",f.get(0)).data("checkIfMoved",m)}function g(){(f=x("#w2ui-tag-"+i)).length<=0||(clearInterval(f.data("timer")),f.remove(),x(document).off(".w2tag"),x(p).off(".w2tag",g).removeClass(w.inputClass).removeData("w2tag").removeData("checkIfMoved"),0<x(p).length&&(x(p)[0].style.cssText=s),"function"==typeof w.onHide&&w.onHide())}function m(e,t){var i=x(p).offset();if(0===x(p).length||0===i.left&&0===i.top||0===f.find(".w2ui-tag-body").length)return clearInterval(f.data("timer")),void g();t||setTimeout(m,100);var s="w2ui-tag-right",n=parseInt(i.left+p.offsetWidth+(w.left?w.left:0)),r=parseInt(i.top+(w.top?w.top:0)),a=f.find(".w2ui-tag-body"),o=a[0].offsetWidth,l=a[0].offsetHeight;if("string"==typeof w.position&&-1!=w.position.indexOf("|")&&(w.position=w.position.split("|")),"top"==w.position)s="w2ui-tag-top",n=parseInt(i.left+(w.left?w.left:0))-14,r=parseInt(i.top+(w.top?w.top:0))-l-10;else if("bottom"==w.position)s="w2ui-tag-bottom",n=parseInt(i.left+(w.left?w.left:0))-14,r=parseInt(i.top+p.offsetHeight+(w.top?w.top:0))+10;else if("left"==w.position)s="w2ui-tag-left",n=parseInt(i.left+(w.left?w.left:0))-o-20,r=parseInt(i.top+(w.top?w.top:0));else if(Array.isArray(w.position)){for(var d=window.innerWidth,u=window.innerHeight,c=0;c<w.position.length;c++){var h=w.position[c];if("right"==h){if(s="w2ui-tag-right",n=parseInt(i.left+p.offsetWidth+(w.left?w.left:0)),r=parseInt(i.top+(w.top?w.top:0)),n+o<=d)break}else if("left"==h){if(s="w2ui-tag-left",n=parseInt(i.left+(w.left?w.left:0))-o-20,r=parseInt(i.top+(w.top?w.top:0)),0<=n)break}else if("top"==h){if(s="w2ui-tag-top",n=parseInt(i.left+(w.left?w.left:0))-14,r=parseInt(i.top+(w.top?w.top:0))-l-10,n+o<=d&&0<=r)break}else if("bottom"==h&&(s="w2ui-tag-bottom",n=parseInt(i.left+(w.left?w.left:0))-14,r=parseInt(i.top+p.offsetHeight+(w.top?w.top:0))+10,n+o<=d&&r+l<=u))break}a.data("posClass")!==s&&a.removeClass("w2ui-tag-right w2ui-tag-left w2ui-tag-top w2ui-tag-bottom").addClass(s).data("posClass",s)}return f.data("position")!==n+"x"+r&&!0!==e&&f.css(w2utils.cssPrefix({transition:t?"0s":".2s"})).css({left:n+"px",top:r+"px"}).data("position",n+"x"+r),{left:n,top:r,posClass:s}}setTimeout(function(){if(f.css("display","block"),x(p).offset()){var e=m(!0);null!=e&&(f.css({opacity:"1",left:e.left+"px",top:e.top+"px"}).data("options",w).data("taged-el",p).data("position",e.left+"x"+e.top).data("timer",setTimeout(m,100)).find(".w2ui-tag-body").addClass(e.posClass),x(p).css(w.css).off(".w2tag").addClass(w.inputClass),w.hideOnKeyPress&&x(p).on("keypress.w2tag",g),w.hideOnBlur&&x(p).on("blur.w2tag",g),w.hideOnClick&&x(document).on("click.w2tag",g),"function"==typeof w.onShow&&w.onShow())}},1)});x(".w2ui-tag").each(function(e,t){var i=x(t).data("options");null==i&&(i={}),x(x(t).data("taged-el")).removeClass(i.inputClass).removeData("w2tag").removeData("checkIfMoved"),clearInterval(x(t).data("timer")),x(t).remove()})},x.fn.w2overlay=function(e,w){var t,v=this,y="";if(1==arguments.length&&(w="object"==typeof e?e:{html:e}),2==arguments.length&&(w.html=e),x.isPlainObject(w)||(w={}),(w=x.extend({},{name:null,html:"",align:"none",left:0,top:0,tipLeft:30,noTip:!1,selectable:!1,width:0,height:0,maxWidth:null,maxHeight:null,contextMenu:!1,pageX:null,pageY:null,originalEvent:null,style:"",class:"",overlayStyle:"",onShow:null,onHide:null,openAbove:!1,tmp:{}},w)).name&&(y="-"+w.name),0===this.length||""===w.html||null==w.html)return 0<x("#w2ui-overlay"+y).length?"function"==typeof(t=x("#w2ui-overlay"+y)[0].hide)&&t():x("#w2ui-overlay"+y).remove(),x(this);0<x("#w2ui-overlay"+y).length&&(t=x("#w2ui-overlay"+y)[0].hide,x(document).off(".w2overlayHide"),"function"==typeof t&&t()),0<v.length&&(null==v[0].tagName||"BODY"==v[0].tagName.toUpperCase())&&(w.contextMenu=!0),w.contextMenu&&w.originalEvent&&(w.pageX=w.originalEvent.pageX,w.pageY=w.originalEvent.pageY),!w.contextMenu||null!=w.pageX&&null!=w.pageY||console.log("ERROR: to display menu at mouse location, pass options.pageX and options.pageY."),x("body").append('<div id="w2ui-overlay'+y+'" style="display: none; left: 0px; top: 0px; '+w.overlayStyle+'"        class="w2ui-reset w2ui-overlay '+(0<x(this).parents(".w2ui-popup, .w2ui-overlay-popup, .w2ui-message").length?"w2ui-overlay-popup":"")+'">    <style></style>    <div style="min-width: 100%; '+w.style+'" class="'+w.class+'"></div></div>');var i=x("#w2ui-overlay"+y),s=i.find(" > div");s.html(w.html);var n=s.css("background-color");null!=n&&"rgba(0, 0, 0, 0)"!==n&&"transparent"!==n&&i.css({"background-color":n,"border-color":n});var r=x(v).offset()||{};return i.data("element",0<v.length?v[0]:null).data("options",w).data("position",r.left+"x"+r.top).fadeIn("fast").on("click",function(e){"LABEL"==e.target.tagName.toUpperCase()&&e.stopPropagation()}).on("mousedown",function(e){x("#w2ui-overlay"+y).data("keepOpen",!0),-1!=["INPUT","TEXTAREA","SELECT"].indexOf(e.target.tagName.toUpperCase())||w.selectable||e.preventDefault()}),i[0].hide=a,i[0].resize=b,setTimeout(function(){b(),x(document).off(".w2overlayHide").on("click.w2overlayHide",a),"function"==typeof w.onShow&&w.onShow()},10),function e(){var t=x("#w2ui-overlay"+y);if(t.data("element")!==v[0])return;if(0===t.length)return;var i=x(v).offset()||{};var s=i.left+"x"+i.top;t.data("position")!==s?a():setTimeout(e,250)}(),x(this);function a(e){if(!e||0===e.button){var t,i=x("#w2ui-overlay"+y);if(!0!==i.data("keepOpen"))"function"==typeof w.onHide&&(t=w.onHide()),!1!==t&&(i.remove(),x(document).off("click",a),clearInterval(i.data("timer")));else i.removeData("keepOpen")}}function b(){var e=x("#w2ui-overlay"+y),t=e.find(" > div"),i=x("#w2ui-overlay"+y+" div.menu");if(i.css("overflow-y","hidden"),0<e.length){t.height("auto").width("auto");var s=!1,n=t.height(),r=t.width();w.width&&w.width<r&&(r=w.width),r<30&&(r=30),w.tmp.contentHeight&&(n=parseInt(w.tmp.contentHeight),t.height(n),setTimeout(function(){var e=t.find("div.menu");n>e.height()&&t.find("div.menu").css("overflow-y","hidden")},1),setTimeout(function(){var e=t.find("div.menu");"auto"!=e.css("overflow-y")&&e.css("overflow-y","auto")},10)),w.tmp.contentWidth&&"both"!=w.align&&(r=parseInt(w.tmp.contentWidth),t.width(r),setTimeout(function(){r>t.find("div.menu > table").width()&&t.find("div.menu > table").css("overflow-x","hidden")},1),setTimeout(function(){t.find("div.menu > table").css("overflow-x","auto")},10));var a=w.left,o=w.width,l=w.tipLeft;switch(w.align){case"both":a=17,0===w.width&&(w.width=w2utils.getSize(x(v),"width")),w.maxWidth&&w.width>w.maxWidth&&(w.width=w.maxWidth);break;case"left":a=17;break;case"right":a=w2utils.getSize(x(v),"width")-r+10,l=r-40}o=30!==r||o?w.width?w.width:"auto":30;var d,u,c,h=(r-17)/2;if("auto"!=o&&(h=(o-17)/2),h<25&&(a=25-h,l=Math.floor(h)),w.contextMenu)d=w.pageX+8,u=w.pageY-0,c=w.pageY;else d=(25<(f=v.offset()||{}).left?f.left:25)+a,u=f.top+w2utils.getSize(v,"height")+w.top+7,c=f.top;e.css({left:d+"px",top:u+"px","min-width":o,"min-height":w.height?w.height:"auto"});var p,f=t.offset()||{},g=window.innerHeight+x(document).scrollTop()-f.top-7,m=window.innerWidth+x(document).scrollLeft()-f.left-7;if(w.contextMenu&&(g=window.innerHeight+x(document).scrollTop()-w.pageY-15,m=window.innerWidth+x(document).scrollLeft()-w.pageX),-50<g&&g<210||!0===w.openAbove)w.contextMenu?(g=w.pageY-7,p=5):(g=f.top-x(document).scrollTop()-7,p=24),w.maxHeight&&g>w.maxHeight&&(g=w.maxHeight),g<n&&(s=!0,t.height(g).width(r).css({"overflow-y":"auto"}),n=g),e.addClass("bottom-arrow"),e.css("top",c-n-p+w.top+"px"),e.find(">style").html("#w2ui-overlay"+y+":before { margin-left: "+parseInt(l)+"px; }#w2ui-overlay"+y+":after { margin-left: "+parseInt(l)+"px; }");else w.maxHeight&&g>w.maxHeight&&(g=w.maxHeight),g<n&&(s=!0,t.height(g).width(r).css({"overflow-y":"auto"})),e.addClass("top-arrow"),e.find(">style").html("#w2ui-overlay"+y+":before { margin-left: "+parseInt(l)+"px; }#w2ui-overlay"+y+":after { margin-left: "+parseInt(l)+"px; }");r=t.width(),m=window.innerWidth+x(document).scrollLeft()-f.left-7,w.maxWidth&&m>w.maxWidth&&(m=w.maxWidth),m<r&&"both"!==w.align&&(w.align="right",setTimeout(function(){b()},1)),(w.contextMenu||w.noTip)&&e.find(">style").html("#w2ui-overlay"+y+":before { display: none; }#w2ui-overlay"+y+":after { display: none; }"),s&&"both"!=w.align&&t.width(r+w2utils.scrollBarSize()+2)}i.css("overflow-y","auto")}},x.fn.w2menu=function(e,u){u&&"function"==typeof u.items&&(u.items=u.items());var l=this,d="";if("refresh"===e)if(0<x("#w2ui-overlay"+d).length){u=x.extend(x.fn.w2menuOptions,u);var t=x("#w2ui-overlay"+d+" div.menu").scrollTop();x("#w2ui-overlay"+d+" div.menu").html(f()),x("#w2ui-overlay"+d+" div.menu").scrollTop(t),h()}else x(this).w2menu(u);else{if("refresh-index"!==e){1===arguments.length?u=e:u.items=e,"object"!=typeof u&&(u={}),u=x.extend({},{type:"normal",index:null,items:[],render:null,msgNoItems:"No items",onSelect:null,tmp:{}},u),(x.fn.w2menuOptions=u).name&&(d="-"+u.name),"function"==typeof u.select&&"function"!=typeof u.onSelect&&(u.onSelect=u.select),"function"==typeof u.onRender&&"function"!=typeof u.render&&(u.render=u.onRender),x.fn.w2menuClick=function(e,t){var i=!1;-1!=["radio","check"].indexOf(u.type)&&(e.shiftKey||e.metaKey||e.ctrlKey)&&(i=!0),"function"==typeof u.onSelect&&setTimeout(function(){u.onSelect({index:t,item:u.items[t],keepOpen:i,originalEvent:e})},10);var s=x("#w2ui-overlay"+d);s.removeData("keepOpen"),"function"!=typeof s[0].hide||i||s[0].hide()},x.fn.w2menuDown=function(e,t){var i=x(e.target).parents("tr"),s=i.find(".w2ui-icon");if("check"==u.type||"radio"==u.type){var n=u.items[t];n.checked=!n.checked,n.checked?("radio"==u.type&&s.parents("table").find(".w2ui-icon").removeClass("w2ui-icon-check").addClass("w2ui-icon-empty"),s.removeClass("w2ui-icon-empty").addClass("w2ui-icon-check")):"check"==u.type&&s.removeClass("w2ui-icon-check").addClass("w2ui-icon-empty")}i.parent().find("tr").removeClass("w2ui-selected"),i.addClass("w2ui-selected")};var i="";if(u.search){i+='<div style="position: absolute; top: 0px; height: 40px; left: 0px; right: 0px; border-bottom: 1px solid silver; background-color: #ECECEC; padding: 8px 5px;">    <div class="w2ui-icon icon-search" style="position: absolute; margin-top: 4px; margin-left: 6px; width: 11px; background-position: left !important;"></div>    <input id="menu-search" type="text" style="width: 100%; outline: none; padding-left: 20px;" onclick="event.stopPropagation();"/></div>',u.style+=";background-color: #ECECEC";for(var s=u.index=0;s<u.items.length;s++)u.items[s].hidden=!1}i+='<div class="menu" style="position: absolute; top: '+(u.search?40:0)+'px; bottom: 0px; width: 100%;">'+f()+"</div>";var n=x(this).w2overlay(i,u);return setTimeout(function(){if(x("#w2ui-overlay"+d+" #menu-search").on("keyup",p).on("keydown",function(e){9===e.keyCode&&(e.stopPropagation(),e.preventDefault())}),u.search){if(-1!=["text","password"].indexOf(x(l)[0].type)||"TEXTAREA"==x(l)[0].tagName.toUpperCase())return;x("#w2ui-overlay"+d+" #menu-search").focus()}h()},200),h(),n}var r=x("#w2ui-overlay"+d+" div.menu"),a=r.find("tr[index="+u.index+"]");t=r.scrollTop();if(r.find("tr.w2ui-selected").removeClass("w2ui-selected"),a.addClass("w2ui-selected"),0<a.length){var o=a[0].offsetTop-5,c=r.height();r.scrollTop(t),(o<t||o+a.height()>t+c)&&r.animate({scrollTop:o-(c-2*a.height())/2},200,"linear")}h()}return;function h(){setTimeout(function(){x("#w2ui-overlay"+d+" tr.w2ui-selected").removeClass("w2ui-selected");var e=x("#w2ui-overlay"+d+" tr[index="+u.index+"]"),t=x("#w2ui-overlay"+d+" div.menu").scrollTop();if(e.addClass("w2ui-selected"),u.tmp&&(u.tmp.contentHeight=x("#w2ui-overlay"+d+" table").height()+(u.search?50:10)),u.tmp&&(u.tmp.contentWidth=x("#w2ui-overlay"+d+" table").width()),0<x("#w2ui-overlay"+d).length&&x("#w2ui-overlay"+d)[0].resize(),0<e.length){var i=e[0].offsetTop-5,s=x("#w2ui-overlay"+d+" div.menu").height();x("#w2ui-overlay"+d+" div.menu").scrollTop(t),(i<t||i+e.height()>t+s)&&x("#w2ui-overlay"+d+" div.menu").animate({scrollTop:i-(s-2*e.height())/2},200,"linear")}},1)}function p(e){var t=this.value,i=!1;switch(e.keyCode){case 13:x("#w2ui-overlay"+d).remove(),x.fn.w2menuClick(e,u.index);break;case 9:case 27:x("#w2ui-overlay"+d).remove(),x.fn.w2menuClick(e,-1);break;case 38:for(u.index=w2utils.isInt(u.index)?parseInt(u.index):0,u.index--;0<u.index&&u.items[u.index].hidden;)u.index--;if(0===u.index&&u.items[u.index].hidden)for(;u.items[u.index]&&u.items[u.index].hidden;)u.index++;u.index<0&&(u.index=0),i=!0;break;case 40:for(u.index=w2utils.isInt(u.index)?parseInt(u.index):0,u.index++;u.index<u.items.length-1&&u.items[u.index].hidden;)u.index++;if(u.index===u.items.length-1&&u.items[u.index].hidden)for(;u.items[u.index]&&u.items[u.index].hidden;)u.index--;u.index>=u.items.length&&(u.index=u.items.length-1),i=!0}if(!i){for(var s=0,n=0;n<u.items.length;n++){var r=u.items[n],a="",o="";-1!==["is","begins with"].indexOf(u.match)&&(a="^"),-1!==["is","ends with"].indexOf(u.match)&&(o="$");try{new RegExp(a+t+o,"i").test(r.text)||"..."===r.text?r.hidden=!1:r.hidden=!0}catch(e){}"enum"===l.type&&-1!==x.inArray(r.id,ids)&&(r.hidden=!0),!0!==r.hidden&&s++}for(u.index=0;u.index<u.items.length-1&&u.items[u.index].hidden;)u.index++;s<=0&&(u.index=-1)}x(l).w2menu("refresh",u),h()}function f(){if(u.spinner)return'<table class="w2ui-drop-menu"><tbody><tr><td style="padding: 5px 10px 10px 10px; text-align: center">    <div class="w2ui-spinner" style="width: 18px; height: 18px; position: relative; top: 5px;"></div>     <div style="display: inline-block; padding: 3px; color: #999;">'+w2utils.lang("Loading...")+"</div></td></tr></tbody></table>";for(var e=0,t='<table cellspacing="0" cellpadding="0" class="w2ui-drop-menu"><tbody>',i=null,s=null,n=0;n<u.items.length;n++){var r=u.items[n];if("string"==typeof r?r={id:r,text:r}:(null!=r.text&&null==r.id&&(r.id=r.text),null==r.text&&null!=r.id&&(r.text=r.id),null!=r.caption&&(r.text=r.caption),null==(i=r.img)&&(i=null),null==(s=r.icon)&&(s=null)),-1!=["radio","check"].indexOf(u.type)&&(s=!0===r.checked?"w2ui-icon-check":"w2ui-icon-empty"),!0!==r.hidden){var a="",o=r.text;if("function"==typeof u.render&&(o=u.render(r,u)),i&&(a='<td class="menu-icon"><div class="w2ui-tb-image w2ui-icon '+i+'"></div></td>'),s&&(a='<td class="menu-icon" align="center"><span class="w2ui-icon '+s+'"></span></td>'),null==o||""===o||/^-+$/.test(o))t+='<tr><td colspan="3" style="padding: 6px; pointer-events: none"><div style="border-top: 1px solid silver;"></div></td></tr>';else{var l=e%2==0?"w2ui-item-even":"w2ui-item-odd";!0!==u.altRows&&(l="");var d=1;""===a&&d++,null==r.count&&null==r.hotkey&&d++,null==r.tooltip&&null!=r.hint&&(r.tooltip=r.hint),t+='<tr index="'+n+'" style="'+(r.style?r.style:"")+'" '+(r.tooltip?'title="'+w2utils.lang(r.tooltip)+'"':"")+'        class="'+l+" "+(u.index===n?"w2ui-selected":"")+" "+(!0===r.disabled?"w2ui-disabled":"")+'"        onmousedown="if ('+(!0===r.disabled?"true":"false")+") return;               jQuery.fn.w2menuDown(event, '"+n+'\');"        onclick="event.stopPropagation();                if ('+(!0===r.disabled?"true":"false")+") return;               jQuery.fn.w2menuClick(event, '"+n+"');\">"+a+'   <td class="menu-text" colspan="'+d+'">'+w2utils.lang(o)+'</td>   <td class="menu-count">'+(null!=r.count?"<span>"+r.count+"</span>":"")+(null!=r.hotkey?'<span class="hotkey">'+r.hotkey+"</span>":"")+"</td></tr>",e++}}u.items[n]=r}return 0===e&&(t+='<tr><td style="padding: 13px; color: #999; text-align: center">'+u.msgNoItems+"</div></td></tr>"),t+="</tbody></table>"}},x.fn.w2color=function(i,s){var n=x(this)[0],r=[-1,-1];null==x.fn.w2colorPalette&&(x.fn.w2colorPalette=[["000000","555555","888888","BBBBBB","DDDDDD","EEEEEE","F7F7F7","FFFFFF"],["FF011B","FF9838","FFFD59","01FD55","00FFFE","006CE7","9B24F4","FF21F5"],["FFEAEA","FCEFE1","FCF5E1","EBF7E7","E9F3F5","ECF4FC","EAE6F4","F5E7ED"],["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D1E9","EAD1DC"],["EA9899","F9CB9C","FEE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD"],["E06666","F6B26B","FED966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BA0"],["CC0814","E69138","F1C232","6AA84F","45818E","3D85C6","674EA7","A54D79"],["99050C","B45F17","BF901F","37761D","124F5C","0A5394","351C75","741B47"],["F2F2F2","F2F2F2","F2F2F2","F2F2F2","F2F2F2"]]);var a=x.fn.w2colorPalette;function e(e){e.color;for(var t='<div class="w2ui-color" onmousedown="event.stopPropagation(); event.preventDefault()"><table cellspacing="5"><tbody>',i=0;i<a.length-1;i++){t+="<tr>";for(var s=0;s<a[i].length;s++)t+='<td>    <div class="color '+(""===a[i][s]?"no-color":"")+'" style="background-color: #'+a[i][s]+';"        name="'+a[i][s]+'" index="'+i+":"+s+'">'+(e.color==a[i][s]?"&#149;":"&#160;")+"    </div></td>",e.color==a[i][s]&&(r=[i,s]);t+="</tr>",i<2&&(t+='<tr><td style="height: 8px" colspan="8"></td></tr>')}var n=a[a.length-1];return t+='<tr><td style="height: 8px" colspan="8"></td></tr><tr>   <td colspan="4" style="text-align: left"><input placeholder="#FFF000" style="margin-left: 1px; width: 74px" maxlength="7"/></td>   <td><div class="color" style="background-color: #'+n[0]+';" name="'+n[0]+'" index="8:0">'+(e.color==n[0]?"&#149;":"&#160;")+'</div></td>   <td><div class="color" style="background-color: #'+n[1]+';" name="'+n[1]+'" index="8:0">'+(e.color==n[1]?"&#149;":"&#160;")+'</div></td>   <td><div class="color" style="background-color: #'+n[2]+';" name="'+n[2]+'" index="8:0">'+(e.color==n[2]?"&#149;":"&#160;")+'</div></td>   <td><div class="color" style="background-color: #'+n[3]+';" name="'+n[3]+'" index="8:0">'+(e.color==n[3]?"&#149;":"&#160;")+'</div></td></tr><tr><td style="height: 4px" colspan="8"></td></tr>',t+="</tbody></table></div>"}"string"==typeof i&&(i={color:i,transparent:!0}),i.transparent&&"555555"==a[0][1]&&(a[0].splice(1,1),a[0].push("")),i.transparent||"555555"==a[0][1]||(a[0].splice(1,0,"555555"),a[0].pop()),i.color&&(i.color=String(i.color).toUpperCase()),0===x("#w2ui-overlay").length?x(n).w2overlay(e(i),{onHide:function(){"function"==typeof s&&s(x(n).data("_color")),x(n).removeData("_color")}}):x("#w2ui-overlay .w2ui-color").parent().html(e(i)),x("#w2ui-overlay .color").off(".w2color").on("mousedown.w2color",function(e){var t=x(e.originalEvent.target).attr("name");r=x(e.originalEvent.target).attr("index").split(":"),x(n).data("_color",t)}).on("mouseup.w2color",function(){setTimeout(function(){0<x("#w2ui-overlay").length&&x("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)}),x("#w2ui-overlay input").off(".w2color").on("mousedown.w2color",function(e){x("#w2ui-overlay").data("keepOpen",!0),setTimeout(function(){x("#w2ui-overlay").data("keepOpen",!0)},10),e.stopPropagation()}).on("keyup.w2color",function(e){""!==this.value&&"#"!==this.value[0]&&(this.value="#"+this.value)}).on("change.w2color",function(e){var t=this.value;"#"==t.substr(0,1)&&(t=t.substr(1)),6==t.length?(x.fn.w2colorPalette[a.length-1].unshift(t.toUpperCase()),x(n).w2color(i,s),setTimeout(function(){x("#w2ui-overlay input")[0].focus()},100)):x(this).w2tag("Invalid color.")}).w2field("hex"),n.nav=function(e){switch(e){case"up":r[0]--;break;case"down":r[0]++;break;case"right":r[1]++;break;case"left":r[1]--}return r[0]<0&&(r[0]=0),r[0]>a.length-2&&(r[0]=a.length-2),r[1]<0&&(r[1]=0),r[1]>a[0].length-1&&(r[1]=a[0].length-1),color=a[r[0]][r[1]],x(n).data("_color",color),color}}}(jQuery),function($){var w2grid=function(e){this.name=null,this.box=null,this.header="",this.url="",this.routeData={},this.columns=[],this.columnGroups=[],this.records=[],this.summary=[],this.searches=[],this.searchData=[],this.sortData=[],this.postData={},this.httpHeaders={},this.toolbar={},this.stateId=null,this.show={header:!1,toolbar:!1,footer:!1,columnHeaders:!0,lineNumbers:!1,expandColumn:!1,selectColumn:!1,emptyRecords:!0,toolbarReload:!0,toolbarColumns:!0,toolbarSearch:!0,toolbarInput:!0,toolbarAdd:!1,toolbarEdit:!1,toolbarDelete:!1,toolbarSave:!1,searchAll:!0,statusRange:!0,statusBuffered:!1,statusRecordID:!0,statusSelection:!0,statusResponse:!0,statusSort:!1,statusSearch:!1,recordTitles:!0,selectionBorder:!0,skipRecords:!0,saveRestoreState:!0},this.hasFocus=!1,this.autoLoad=!0,this.fixedBody=!0,this.recordHeight=24,this.lineNumberWidth=null,this.vs_start=150,this.vs_extra=15,this.keyboard=!0,this.selectType="row",this.multiSearch=!0,this.multiSelect=!0,this.multiSort=!0,this.reorderColumns=!1,this.reorderRows=!1,this.markSearch=!0,this.columnTooltip="normal",this.disableCVS=!1,this.textSearch="begins",this.total=0,this.limit=100,this.offset=0,this.style="",this.ranges=[],this.menu=[],this.method=null,this.recid=null,this.parser=null,this.last={field:"",caption:"",logic:"OR",search:"",searchIds:[],selection:{indexes:[],columns:{}},multi:!1,scrollTop:0,scrollLeft:0,colStart:0,colEnd:0,sortData:null,sortCount:0,xhr:null,range_start:null,range_end:null,sel_ind:null,sel_col:null,sel_type:null,edit_col:null,isSafari:/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},$.extend(!0,this,w2obj.grid,e)};$.fn.w2grid=function(e){if($.isPlainObject(e)){if(!w2utils.checkName(e,"w2grid"))return;var t,i=e.columns,s=e.columnGroups,n=e.records,r=e.searches,a=e.searchData,o=e.sortData,l=e.postData,d=e.httpHeaders,u=e.toolbar,c=new w2grid(e);if($.extend(c,{postData:{},httpHeaders:{},records:[],columns:[],searches:[],toolbar:{},sortData:[],searchData:[],handlers:[]}),null!=c.onExpand&&(c.show.expandColumn=!0),$.extend(!0,c.toolbar,u),i)for(t=0;t<i.length;t++)c.columns[t]=$.extend(!0,{},i[t]);if(s)for(t=0;t<s.length;t++)c.columnGroups[t]=$.extend(!0,{},s[t]);if(r)for(t=0;t<r.length;t++)c.searches[t]=$.extend(!0,{},r[t]);if(a)for(t=0;t<a.length;t++)c.searchData[t]=$.extend(!0,{},a[t]);if(o)for(t=0;t<o.length;t++)c.sortData[t]=$.extend(!0,{},o[t]);if(c.postData=$.extend(!0,{},l),c.httpHeaders=$.extend(!0,{},d),n)for(var h=0;h<n.length;h++){if(null==n[h].recid&&null==n[h][c.recid])return void console.log("ERROR: Cannot add records without recid. (obj: "+c.name+")");c.records[h]=$.extend(!0,{},n[h])}for(var p=0;p<c.columns.length;p++){var f=c.columns[p],g=f.searchable;if(null!=g&&!1!==g&&null==c.getSearch(f.field))if($.isPlainObject(g))c.addSearch($.extend({field:f.field,caption:f.caption,type:"text"},g));else{var m=f.searchable,w="";!0===f.searchable&&(m="text",w='size="20"'),c.addSearch({field:f.field,caption:f.caption,type:m,attr:w})}}return c.initToolbar(),0!==$(this).length&&c.render($(this)[0]),w2ui[c.name]=c}var v=w2ui[$(this).attr("name")];return v?0<arguments.length?(v[e]&&v[e].apply(v,Array.prototype.slice.call(arguments,1)),this):v:null},w2grid.prototype={msgDelete:"Are you sure you want to delete selected records?",msgNotJSON:"Returned data is not in valid JSON format.",msgAJAXerror:"AJAX error. See console for more details.",msgRefresh:"Refreshing...",msgNeedReload:"Your remote data source record count has changed, reloading from the first record.",msgEmpty:"",buttons:{reload:{type:"button",id:"w2ui-reload",icon:"w2ui-icon-reload",tooltip:"Reload data in the list"},columns:{type:"drop",id:"w2ui-column-on-off",icon:"w2ui-icon-columns",tooltip:"Show/hide columns",arrow:!1,html:""},search:{type:"html",id:"w2ui-search",html:"<div class=\"w2ui-icon icon-search-down w2ui-search-down\" onclick=\"var obj = w2ui[jQuery(this).parents('div.w2ui-grid').attr('name')]; obj.searchShowFields();\"></div>"},"search-go":{type:"drop",id:"w2ui-search-advanced",icon:"w2ui-icon-search",text:"Search",tooltip:"Open Search Fields"},add:{type:"button",id:"w2ui-add",text:"Add New",tooltip:"Add new record",icon:"w2ui-icon-plus"},edit:{type:"button",id:"w2ui-edit",text:"Edit",tooltip:"Edit selected record",icon:"w2ui-icon-pencil",disabled:!0},delete:{type:"button",id:"w2ui-delete",text:"Delete",tooltip:"Delete selected records",icon:"w2ui-icon-cross",disabled:!0},save:{type:"button",id:"w2ui-save",text:"Save",tooltip:"Save changed records",icon:"w2ui-icon-check"}},operators:{text:["is","begins","contains","ends"],number:["is","between",{oper:"less",text:"less than"},{oper:"more",text:"more than"}],date:["is","between",{oper:"less",text:"before"},{oper:"more",text:"after"}],list:["is"],hex:["is","between"],color:["is","begins","contains","ends"],enum:["in","not in"]},operatorsMap:{text:"text",int:"number",float:"number",money:"number",currency:"number",percent:"number",hex:"hex",alphanumeric:"text",color:"color",date:"date",time:"date",datetime:"date",list:"list",combo:"text",enum:"enum",file:"enum",select:"list",radio:"list",checkbox:"list",toggle:"list"},onAdd:null,onEdit:null,onRequest:null,onLoad:null,onDelete:null,onSave:null,onSelect:null,onUnselect:null,onClick:null,onDblClick:null,onContextMenu:null,onMenuClick:null,onColumnClick:null,onColumnDblClick:null,onColumnResize:null,onSort:null,onSearch:null,onSearchOpen:null,onChange:null,onRestore:null,onExpand:null,onCollapse:null,onError:null,onKeydown:null,onToolbar:null,onColumnOnOff:null,onCopy:null,onPaste:null,onSelectionExtend:null,onEditField:null,onRender:null,onRefresh:null,onReload:null,onResize:null,onDestroy:null,onStateSave:null,onStateRestore:null,onFocus:null,onBlur:null,onReorderRow:null,add:function(e,t){$.isArray(e)||(e=[e]);for(var i=0,s=0;s<e.length;s++){var n=e[s];null!=n.recid||null!=n[this.recid]?(n.w2ui&&!0===n.w2ui.summary?t?this.summary.unshift(n):this.summary.push(n):t?this.records.unshift(n):this.records.push(n),i++):console.log("ERROR: Cannot add record without recid. (obj: "+this.name+")")}return("object"!=typeof this.url?this.url:this.url.get)?this.refresh():(this.total=this.records.length,this.localSort(!1,!0),this.localSearch(),this.refreshBody(),this.resizeRecords()),i},find:function(e,t){null==e&&(e={});var i=[],s=!1;for(var n in e)-1!=String(n).indexOf(".")&&(s=!0);for(var r=0;r<this.records.length;r++){var a=!0;for(var n in e){var o=this.records[r][n];s&&-1!=String(n).indexOf(".")&&(o=this.parseField(this.records[r],n)),"not-null"==e[n]?null!=o&&""!==o||(a=!1):e[n]!=o&&(a=!1)}a&&!0!==t&&i.push(this.records[r].recid),a&&!0===t&&i.push(r)}return i},set:function(e,t,i){if("object"==typeof e&&(i=t,t=e,e=null),null==e){for(var s=0;s<this.records.length;s++)$.extend(!0,this.records[s],t);!0!==i&&this.refresh()}else{var n=this.get(e,!0);if(null==n)return!1;!this.records[n]||this.records[n].recid!=e?$.extend(!0,this.summary[n],t):$.extend(!0,this.records[n],t),!0!==i&&this.refreshRow(e,n)}return!0},get:function(e,t){if($.isArray(e)){for(var i=[],s=0;s<this.records.length;s++)-1!=$.inArray(this.records[s].recid,e)&&(!0===t?i.push(s):i.push(this.records[s]));for(s=0;s<this.summary.length;s++)-1!=$.inArray(this.summary[s].recid,e)&&(!0===t?i.push(s):i.push(this.summary[s]));return i}for(s=0;s<this.records.length;s++)if(this.records[s].recid==e)return!0===t?s:this.records[s];for(s=0;s<this.summary.length;s++)if(this.summary[s].recid==e)return!0===t?s:this.summary[s];return null},remove:function(){for(var e=0,t=0;t<arguments.length;t++){for(var i=this.records.length-1;0<=i;i--)this.records[i].recid==arguments[t]&&(this.records.splice(i,1),e++);for(i=this.summary.length-1;0<=i;i--)this.summary[i].recid==arguments[t]&&(this.summary.splice(i,1),e++)}return("object"!=typeof this.url?this.url:this.url.get)||(this.localSort(!1,!0),this.localSearch()),this.refresh(),e},addColumn:function(e,t){var i=0;1==arguments.length?(t=e,e=this.columns.length):("string"==typeof e&&(e=this.getColumn(e,!0)),null==e&&(e=this.columns.length)),$.isArray(t)||(t=[t]);for(var s=0;s<t.length;s++){if(this.columns.splice(e,0,t[s]),t[s].searchable){var n=t[s].searchable,r="";!0===t[s].searchable&&(n="text",r='size="20"'),this.addSearch({field:t[s].field,caption:t[s].caption,type:n,attr:r})}e++,i++}return this.refresh(),i},removeColumn:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.columns.length-1;0<=i;i--)this.columns[i].field==arguments[t]&&(this.columns[i].searchable&&this.removeSearch(arguments[t]),this.columns.splice(i,1),e++);return this.refresh(),e},getColumn:function(e,t){if(0===arguments.length){for(var i=[],s=0;s<this.columns.length;s++)i.push(this.columns[s].field);return i}for(s=0;s<this.columns.length;s++)if(this.columns[s].field==e)return!0===t?s:this.columns[s];return null},toggleColumn:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.columns.length-1;0<=i;i--){var s=this.columns[i];s.field==arguments[t]&&(s.hidden=!s.hidden,e++)}return this.refreshBody(),this.resizeRecords(),e},showColumn:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.columns.length-1;0<=i;i--){var s=this.columns[i];s.gridMinWidth&&delete s.gridMinWidth,s.field==arguments[t]&&!1!==s.hidden&&(s.hidden=!1,e++)}return this.refreshBody(),this.resizeRecords(),e},hideColumn:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.columns.length-1;0<=i;i--){var s=this.columns[i];s.field==arguments[t]&&!0!==s.hidden&&(s.hidden=!0,e++)}return this.refreshBody(),this.resizeRecords(),e},addSearch:function(e,t){var i=0;1==arguments.length?(t=e,e=this.searches.length):("string"==typeof e&&(e=this.getSearch(e,!0)),null==e&&(e=this.searches.length)),$.isArray(t)||(t=[t]);for(var s=0;s<t.length;s++)this.searches.splice(e,0,t[s]),e++,i++;return this.searchClose(),i},removeSearch:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.searches.length-1;0<=i;i--)this.searches[i].field==arguments[t]&&(this.searches.splice(i,1),e++);return this.searchClose(),e},getSearch:function(e,t){if(0===arguments.length){for(var i=[],s=0;s<this.searches.length;s++)i.push(this.searches[s].field);return i}for(s=0;s<this.searches.length;s++)if(this.searches[s].field==e)return!0===t?s:this.searches[s];return null},toggleSearch:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.searches.length-1;0<=i;i--)this.searches[i].field==arguments[t]&&(this.searches[i].hidden=!this.searches[i].hidden,e++);return this.searchClose(),e},showSearch:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.searches.length-1;0<=i;i--)this.searches[i].field==arguments[t]&&!1!==this.searches[i].hidden&&(this.searches[i].hidden=!1,e++);return this.searchClose(),e},hideSearch:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.searches.length-1;0<=i;i--)this.searches[i].field==arguments[t]&&!0!==this.searches[i].hidden&&(this.searches[i].hidden=!0,e++);return this.searchClose(),e},getSearchData:function(e){for(var t=0;t<this.searchData.length;t++)if(this.searchData[t].field==e)return this.searchData[t];return null},localSort:function(e,t){if("object"!=typeof this.url?this.url:this.url.get)console.log("ERROR: grid.localSort can only be used on local data source, grid.url should be empty.");else if(!$.isEmptyObject(this.sortData)){var i=(new Date).getTime(),l=this;l.selectionSave(),l.prepareData(),t||l.reset();for(var s=0;s<this.sortData.length;s++){var n=this.getColumn(this.sortData[s].field);if(!n)return;"string"==typeof n.render&&(-1!=["date","age"].indexOf(n.render.split(":")[0])&&(this.sortData[s].field_=n.field+"_"),-1!=["time"].indexOf(n.render.split(":")[0])&&(this.sortData[s].field_=n.field+"_"))}return function(){for(var e=0;e<l.records.length;e++){var t=l.records[e];t.w2ui&&null!=t.w2ui.parent_recid&&(t.w2ui._path=a(t))}}(),this.records.sort(function(e,t){return function(e,t){if(!(e.w2ui&&null!=e.w2ui.parent_recid||t.w2ui&&null!=t.w2ui.parent_recid))return o(e,t);for(var i=a(e),s=a(t),n=0;n<Math.min(i.length,s.length);n++){var r=o(i[n],s[n]);if(0!==r)return r}return i.length>s.length?1:i.length<s.length?-1:(console.log("ERROR: two paths should not be equal."),0)}(e,t)}),function(){for(var e=0;e<l.records.length;e++){var t=l.records[e];t.w2ui&&null!=t.w2ui.parent_recid&&(t.w2ui._path=null)}}(),l.selectionRestore(t),i=(new Date).getTime()-i,!0!==e&&l.show.statusSort&&setTimeout(function(){l.status(w2utils.lang("Sorting took")+" "+i/1e3+" "+w2utils.lang("sec"))},10),i}function a(e){if(!e.w2ui||null==e.w2ui.parent_recid)return[e];if(e.w2ui._path)return e.w2ui._path;var t=l.get(e.w2ui.parent_recid);return t?a(t).concat(e):(console.log("ERROR: no parent record: "+e.w2ui.parent_recid),[e])}function o(e,t){if(e===t)return 0;for(var i=0;i<l.sortData.length;i++){var s=l.sortData[i].field;l.sortData[i].field_&&(s=l.sortData[i].field_);var n=e[s],r=t[s];-1!=String(s).indexOf(".")&&(n=l.parseField(e,s),r=l.parseField(t,s));var a=l.getColumn(s);if(a&&null!=a.editable&&($.isPlainObject(n)&&n.text&&(n=n.text),$.isPlainObject(r)&&r.text&&(r=r.text)),0!==(o=d(n,r,i,l.sortData[i].direction)))return o}var o;return 0!==(o=d(e.recid,t.recid,-1,"asc"))?o:0}function d(e,t,i,s){if(e===t)return 0;if((null==e||""===e)&&null!=t&&""!==t)return 1;if(null!=e&&""!==e&&(null==t||""===t))return-1;var n="asc"==s?1:-1;if(typeof e!=typeof t)return typeof t<typeof e?n:-n;if(e.constructor.name!=t.constructor.name)return e.constructor.name>t.constructor.name?n:-n;e&&"object"==typeof e&&(e=e.valueOf()),t&&"object"==typeof t&&(t=t.valueOf());var r={}.toString;return e&&"object"==typeof e&&e.toString!=r&&(e=String(e)),t&&"object"==typeof t&&t.toString!=r&&(t=String(t)),"string"==typeof e&&(e=$.trim(e.toLowerCase())),"string"==typeof t&&(t=$.trim(t.toLowerCase())),t<e?n:e<t?-n:0}},localSearch:function(e){var t="object"!=typeof this.url?this.url:this.url.get;if(!t){var i=(new Date).getTime(),h=this,p={}.toString,s={};if(this.total=this.records.length,this.last.searchIds=[],this.prepareData(),0<this.searchData.length&&!t){for(var n=this.total=0;n<this.records.length;n++){var r=this.records[n];f(r)&&(r&&r.w2ui&&a(r.w2ui.parent_recid),this.last.searchIds.push(n))}this.total=this.last.searchIds.length}return i=(new Date).getTime()-i,!0!==e&&h.show.statusSearch&&setTimeout(function(){h.status(w2utils.lang("Search took")+" "+i/1e3+" "+w2utils.lang("sec"))},10),i}function f(e){for(var t=0,i=0;i<h.searchData.length;i++){var s=h.searchData[i],n=h.getSearch(s.field);if(null!=s){null==n&&(n={field:s.field,type:s.type});var r=h.parseField(e,n.field),a=null==r||"object"==typeof r&&r.toString==p?"":String(r).toLowerCase();if(null!=s.value)if($.isArray(s.value)){l=s.value[0];var o=s.value[1]}else var l=String(s.value).toLowerCase();switch(s.operator){case"is":if(h.parseField(e,n.field)==s.value)t++;else if("date"==n.type){var d=h.parseField(e,n.field+"_")instanceof Date?h.parseField(e,n.field+"_"):h.parseField(e,n.field);(a=w2utils.formatDate(d,"yyyy-mm-dd"))==(l=w2utils.formatDate(w2utils.isDate(l,w2utils.settings.dateFormat,!0),"yyyy-mm-dd"))&&t++}else if("time"==n.type){d=h.parseField(e,n.field+"_")instanceof Date?h.parseField(e,n.field+"_"):h.parseField(e,n.field);(a=w2utils.formatTime(d,"hh24:mi"))==(l=w2utils.formatTime(l,"hh24:mi"))&&t++}else if("datetime"==n.type){d=h.parseField(e,n.field+"_")instanceof Date?h.parseField(e,n.field+"_"):h.parseField(e,n.field);(a=w2utils.formatDateTime(d,"yyyy-mm-dd|hh24:mm:ss"))==(l=w2utils.formatDateTime(w2utils.isDateTime(l,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss"))&&t++}break;case"between":if(-1!=["int","float","money","currency","percent"].indexOf(n.type))parseFloat(h.parseField(e,n.field))>=parseFloat(l)&&parseFloat(h.parseField(e,n.field))<=parseFloat(o)&&t++;else if("date"==n.type){a=h.parseField(e,n.field+"_")instanceof Date?h.parseField(e,n.field+"_"):h.parseField(e,n.field),l=w2utils.isDate(l,w2utils.settings.dateFormat,!0);null!=(o=w2utils.isDate(o,w2utils.settings.dateFormat,!0))&&(o=new Date(o.getTime()+864e5)),l<=a&&a<o&&t++}else if("time"==n.type){a=h.parseField(e,n.field+"_")instanceof Date?h.parseField(e,n.field+"_"):h.parseField(e,n.field),l=w2utils.isTime(l,!0),o=w2utils.isTime(o,!0);l=(new Date).setHours(l.hours,l.minutes,l.seconds?l.seconds:0,0),o=(new Date).setHours(o.hours,o.minutes,o.seconds?o.seconds:0,0),l<=a&&a<o&&t++}else if("datetime"==n.type){a=h.parseField(e,n.field+"_")instanceof Date?h.parseField(e,n.field+"_"):h.parseField(e,n.field),l=w2utils.isDateTime(l,w2utils.settings.datetimeFormat,!0);(o=w2utils.isDateTime(o,w2utils.settings.datetimeFormat,!0))&&(o=new Date(o.getTime()+864e5)),l<=a&&a<o&&t++}break;case"less":if(-1!=["int","float","money","currency","percent"].indexOf(n.type))parseFloat(h.parseField(e,n.field))<=parseFloat(s.value)&&t++;else if("date"==n.type){d=h.parseField(e,n.field+"_")instanceof Date?h.parseField(e,n.field+"_"):h.parseField(e,n.field);(a=w2utils.formatDate(d,"yyyy-mm-dd"))<=(l=w2utils.formatDate(w2utils.isDate(l,w2utils.settings.dateFormat,!0),"yyyy-mm-dd"))&&t++}else if("time"==n.type){d=h.parseField(e,n.field+"_")instanceof Date?h.parseField(e,n.field+"_"):h.parseField(e,n.field);(a=w2utils.formatTime(d,"hh24:mi"))<=(l=w2utils.formatTime(l,"hh24:mi"))&&t++}else if("datetime"==n.type){d=h.parseField(e,n.field+"_")instanceof Date?h.parseField(e,n.field+"_"):h.parseField(e,n.field),a=w2utils.formatDateTime(d,"yyyy-mm-dd|hh24:mm:ss"),l=w2utils.formatDateTime(w2utils.isDateTime(l,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss");a.length==l.length&&a<=l&&t++}break;case"more":if(-1!=["int","float","money","currency","percent"].indexOf(n.type))parseFloat(h.parseField(e,n.field))>=parseFloat(s.value)&&t++;else if("date"==n.type){d=h.parseField(e,n.field+"_")instanceof Date?h.parseField(e,n.field+"_"):h.parseField(e,n.field),a=w2utils.formatDate(d,"yyyy-mm-dd");(l=w2utils.formatDate(w2utils.isDate(l,w2utils.settings.dateFormat,!0),"yyyy-mm-dd"))<=a&&t++}else if("time"==n.type){d=h.parseField(e,n.field+"_")instanceof Date?h.parseField(e,n.field+"_"):h.parseField(e,n.field),a=w2utils.formatTime(d,"hh24:mi");(l=w2utils.formatTime(l,"hh24:mi"))<=a&&t++}else if("datetime"==n.type){d=h.parseField(e,n.field+"_")instanceof Date?h.parseField(e,n.field+"_"):h.parseField(e,n.field),a=w2utils.formatDateTime(d,"yyyy-mm-dd|hh24:mm:ss"),l=w2utils.formatDateTime(w2utils.isDateTime(l,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss");a.length==l.length&&l<=a&&t++}break;case"in":d=s.value;s.svalue&&(d=s.svalue),-1!==d.indexOf(w2utils.isFloat(a)?parseFloat(a):a)&&t++,-1!==d.indexOf(w2utils.isFloat(r)?parseFloat(r):r)&&t++;break;case"not in":d=s.value;s.svalue&&(d=s.svalue),-1==d.indexOf(w2utils.isFloat(a)?parseFloat(a):a)&&t++,-1==d.indexOf(w2utils.isFloat(r)?parseFloat(r):r)&&t++;break;case"begins":case"begins with":0===a.indexOf(l)&&t++;break;case"contains":0<=a.indexOf(l)&&t++;break;case"null":null==h.parseField(e,n.field)&&t++;break;case"not null":null!=h.parseField(e,n.field)&&t++;break;case"ends":case"ends with":var u=a.lastIndexOf(l);-1!==u&&u==a.length-l.length&&t++}}}if("OR"==h.last.logic&&0!==t||"AND"==h.last.logic&&t==h.searchData.length)return!0;if(e.w2ui&&e.w2ui.children&&!0!==e.w2ui.expanded)for(var c=0;c<e.w2ui.children.length;c++){if(f(e.w2ui.children[c]))return!0}return!1}function a(e){if(void 0!==e&&!s[e]){s[e]=!0;var t=h.get(e,!0);if(null!=t&&-1==$.inArray(t,h.last.searchIds)){var i=h.records[t];i&&i.w2ui&&a(i.w2ui.parent_recid),h.last.searchIds.push(t)}}}console.log("ERROR: grid.localSearch can only be used on local data source, grid.url should be empty.")},getRangeData:function(e,t){var i=this.get(e[0].recid,!0),s=this.get(e[1].recid,!0),n=e[0].column,r=e[1].column,a=[];if(n==r)for(var o=i;o<=s;o++){var l=(d=this.records[o])[this.columns[n].field]||null;!0!==t?a.push(l):a.push({data:l,column:n,index:o,record:d})}else if(i==s)for(var d=this.records[i],u=n;u<=r;u++){l=d[this.columns[u].field]||null;!0!==t?a.push(l):a.push({data:l,column:u,index:i,record:d})}else for(o=i;o<=s;o++){d=this.records[o];a.push([]);for(u=n;u<=r;u++){l=d[this.columns[u].field];!0!==t?a[a.length-1].push(l):a[a.length-1].push({data:l,column:u,index:o,record:d})}}return a},addRange:function(e){var t=0;if("row"==this.selectType)return t;$.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++){if("object"!=typeof e[i]&&(e[i]={name:"selection"}),"selection"==e[i].name){if(!1===this.show.selectionBorder)continue;var s=this.getSelection();if(0===s.length){this.removeRange("selection");continue}var n=s[0],r=s[s.length-1]}else n=e[i].range[0],r=e[i].range[1];if(n){for(var a={name:e[i].name,range:[{recid:n.recid,column:n.column},{recid:r.recid,column:r.column}],style:e[i].style||""},o=!1,l=0;l<this.ranges.length;l++)if(this.ranges[l].name==e[i].name){o=l;break}!1!==o?this.ranges[o]=a:this.ranges.push(a),t++}}return this.refreshRanges(),t},removeRange:function(){for(var e=0,t=0;t<arguments.length;t++){var i=arguments[t];$("#grid_"+this.name+"_"+i).remove(),$("#grid_"+this.name+"_f"+i).remove();for(var s=this.ranges.length-1;0<=s;s--)this.ranges[s].name==i&&(this.ranges.splice(s,1),e++)}return e},refreshRanges:function(){if(0!==this.ranges.length){for(var a=this,e=(new Date).getTime(),t=$("#grid_"+this.name+"_frecords"),i=$("#grid_"+this.name+"_records"),s=0;s<this.ranges.length;s++){var n=this.ranges[s],r=n.range[0],o=n.range[1];null==r.index&&(r.index=this.get(r.recid,!0)),null==o.index&&(o.index=this.get(o.recid,!0));var l=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(r.recid)+' td[col="'+r.column+'"]'),d=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(o.recid)+' td[col="'+o.column+'"]'),u=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(r.recid)+' td[col="'+r.column+'"]'),c=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(o.recid)+' td[col="'+o.column+'"]'),h=o.column;r.column<this.last.colStart&&o.column>this.last.colStart&&(l=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(r.recid)+' td[col="start"]')),r.column<this.last.colEnd&&o.column>this.last.colEnd&&(h='"end"',d=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(o.recid)+' td[col="end"]'));var p=parseInt($("#grid_"+this.name+"_rec_top").next().attr("index")),f=parseInt($("#grid_"+this.name+"_rec_bottom").prev().attr("index")),g=parseInt($("#grid_"+this.name+"_frec_top").next().attr("index")),m=parseInt($("#grid_"+this.name+"_frec_bottom").prev().attr("index"));0===l.length&&r.index<p&&o.index>p&&(l=$("#grid_"+this.name+"_rec_top").next().find("td[col="+r.column+"]")),0===d.length&&o.index>f&&r.index<f&&(d=$("#grid_"+this.name+"_rec_bottom").prev().find("td[col="+h+"]")),0===u.length&&r.index<g&&o.index>g&&(u=$("#grid_"+this.name+"_frec_top").next().find("td[col="+r.column+"]")),0===c.length&&o.index>m&&r.index<m&&(c=$("#grid_"+this.name+"_frec_bottom").prev().find("td[col="+o.column+"]"));var w=$(this.box).find("#grid_"+this.name+"_editable").find(".w2ui-input"),v=w.attr("recid"),y=w.attr("column");if("selection"!=n.name||n.range[0].recid!=v||n.range[0].column!=y){var b=$("#grid_"+this.name+"_f"+n.name);if(0<u.length||0<c.length)if(0===b.length?(t.append('<div id="grid_'+this.name+"_f"+n.name+'" class="w2ui-selection" style="'+n.style+'">'+("selection"==n.name?'<div id="grid_'+this.name+'_resizer" class="w2ui-selection-resizer"></div>':"")+"</div>"),b=$("#grid_"+this.name+"_f"+n.name)):(b.attr("style",n.style),b.find(".w2ui-selection-resizer").show()),0===c.length&&(0===(c=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(o.recid)+" td:last-child")).length&&(c=$("#grid_"+this.name+"_frec_bottom td:first-child")),b.css("border-right","0px"),b.find(".w2ui-selection-resizer").hide()),null!=r.recid&&null!=o.recid&&0<u.length&&0<c.length){var x=u.position().left-1+t.scrollLeft(),_=u.position().top-1+t.scrollTop();b.show().css({left:(0<x?x:0)+"px",top:(0<_?_:0)+"px",width:c.position().left-u.position().left+c.width()+3+"px",height:c.position().top-u.position().top+c.height()+3+"px"})}else b.hide();else b.hide();b=$("#grid_"+this.name+"_"+n.name);if(0<l.length||0<d.length)if(0===b.length?(i.append('<div id="grid_'+this.name+"_"+n.name+'" class="w2ui-selection" style="'+n.style+'">'+("selection"==n.name?'<div id="grid_'+this.name+'_resizer" class="w2ui-selection-resizer"></div>':"")+"</div>"),b=$("#grid_"+this.name+"_"+n.name)):b.attr("style",n.style),0===l.length&&0===(l=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(r.recid)+" td:first-child")).length&&(l=$("#grid_"+this.name+"_rec_top td:first-child")),0!==c.length&&b.css("border-left","0px"),null!=r.recid&&null!=o.recid&&0<l.length&&0<d.length){x=l.position().left-1+i.scrollLeft(),_=l.position().top-1+i.scrollTop();b.show().css({left:(0<x?x:0)+"px",top:(0<_?_:0)+"px",width:d.position().left-l.position().left+d.width()+3+"px",height:d.position().top-l.position().top+d.height()+3+"px"})}else b.hide();else b.hide()}}$(this.box).find(".w2ui-selection-resizer").off("mousedown").on("mousedown",function(e){var t=a.getSelection();a.last.move={type:"expand",x:e.screenX,y:e.screenY,divX:0,divY:0,recid:t[0].recid,column:t[0].column,originalRange:[{recid:t[0].recid,column:t[0].column},{recid:t[t.length-1].recid,column:t[t.length-1].column}],newRange:[{recid:t[0].recid,column:t[0].column},{recid:t[t.length-1].recid,column:t[t.length-1].column}]},$(document).off("mousemove",C).on("mousemove",C),$(document).off("mouseup",T).on("mouseup",T),e.preventDefault()}).off("dblclick").on("dblclick",function(e){var t=a.trigger({phase:"before",type:"resizerDblClick",target:a.name,originalEvent:e});!0!==t.isCancelled&&a.trigger($.extend(t,{phase:"after"}))});var k={phase:"before",type:"selectionExtend",target:a.name,originalRange:null,newRange:null};return(new Date).getTime()-e}function C(e){var t=a.last.move;if(t&&"expand"==t.type){var i,s;t.divX=e.screenX-t.x,t.divY=e.screenY-t.y;var n=e.originalEvent.target;if("TD"!=n.tagName.toUpperCase()&&(n=$(n).parents("td")[0]),null!=$(n).attr("col")&&(s=parseInt($(n).attr("col"))),n=$(n).parents("tr")[0],i=$(n).attr("recid"),t.newRange[1].recid!=i||t.newRange[1].column!=s){var r=$.extend({},t.newRange);if(t.newRange=[{recid:t.recid,column:t.column},{recid:i,column:s}],!0===(k=a.trigger($.extend(k,{originalRange:t.originalRange,newRange:t.newRange}))).isCancelled)return t.newRange=r,void(k.newRange=r);a.removeRange("grid-selection-expand"),a.addRange({name:"grid-selection-expand",range:k.newRange,style:"background-color: rgba(100,100,100,0.1); border: 2px dotted rgba(100,100,100,0.5);"})}}}function T(e){a.removeRange("grid-selection-expand"),delete a.last.move,$(document).off("mousemove",C),$(document).off("mouseup",T),a.trigger($.extend(k,{phase:"after"}))}},select:function(){if(0===arguments.length)return 0;(new Date).getTime();var e=0,t=this.last.selection;this.multiSelect||this.selectNone();var i={phase:"before",type:"select",target:this.name};1==arguments.length?(i.multiple=!1,$.isPlainObject(arguments[0])?(i.recid=arguments[0].recid,i.column=arguments[0].column):i.recid=arguments[0]):(i.multiple=!0,i.recids=Array.prototype.slice.call(arguments,0));var s=this.trigger(i);if(!0===s.isCancelled)return 0;if("row"==this.selectType)for(var n=0;n<arguments.length;n++){var r="object"==typeof arguments[n]?arguments[n].recid:arguments[n];if(null!=(h=this.get(r,!0))){var a=null,o=null;if((0!==this.searchData.length||h+1>=this.last.range_start&&h+1<=this.last.range_end)&&(a=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(r)),o=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(r))),"row"==this.selectType){if(-1!=t.indexes.indexOf(h))continue;t.indexes.push(h),a&&o&&(a.addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),o.addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),a.find(".w2ui-grid-select-check").prop("checked",!0)),e++}}}else{var l={};for(n=0;n<arguments.length;n++){r="object"==typeof arguments[n]?arguments[n].recid:arguments[n];var d="object"==typeof arguments[n]?arguments[n].column:null;if(l[r]=l[r]||[],$.isArray(d))l[r]=d;else if(w2utils.isInt(d))l[r].push(d);else for(var u=0;u<this.columns.length;u++)this.columns[u].hidden||l[r].push(parseInt(u))}var c=[];for(var r in l){var h;if(null!=(h=this.get(r,!0))){a=null,o=null;h+1>=this.last.range_start&&h+1<=this.last.range_end&&(a=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(r)),o=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(r)));var p=t.columns[h]||[];-1==t.indexes.indexOf(h)&&t.indexes.push(h);for(var f=0;f<l[r].length;f++)-1==p.indexOf(l[r][f])&&p.push(l[r][f]);p.sort(function(e,t){return e-t});for(f=0;f<l[r].length;f++){var g=l[r][f];-1==c.indexOf(g)&&c.push(g),a&&(a.find("#grid_"+this.name+"_data_"+h+"_"+g).addClass("w2ui-selected"),a.find(".w2ui-col-number").addClass("w2ui-row-selected"),a.data("selected","yes"),a.find(".w2ui-grid-select-check").prop("checked",!0)),o&&(o.find("#grid_"+this.name+"_data_"+h+"_"+g).addClass("w2ui-selected"),o.find(".w2ui-col-number").addClass("w2ui-row-selected"),o.data("selected","yes"),o.find(".w2ui-grid-select-check").prop("checked",!0)),e++}t.columns[h]=p}}for(var m=0;m<c.length;m++)$(this.box).find("#grid_"+this.name+"_column_"+c[m]+" .w2ui-col-header").addClass("w2ui-col-selected")}t.indexes.sort(function(e,t){return e-t});var w=0<this.records.length&&t.indexes.length==this.records.length,v=0<t.indexes.length&&0!==this.searchData.length&&t.indexes.length==this.last.searchIds.length;return w||v?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.addRange("selection"),this.trigger($.extend(s,{phase:"after"})),e},unselect:function(){for(var e=0,t=this.last.selection,i=0;i<arguments.length;i++){var s="object"==typeof arguments[i]?arguments[i].recid:arguments[i],n=this.get(s);if(null!=n){var r=this.get(n.recid,!0),a=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(s)),o=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(s));if("row"==this.selectType){if(-1==t.indexes.indexOf(r))continue;if(!0===(c=this.trigger({phase:"before",type:"unselect",target:this.name,recid:s,index:r})).isCancelled)continue;t.indexes.splice(t.indexes.indexOf(r),1),a.removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),o.removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),0!=a.length&&(a[0].style.cssText="height: "+this.recordHeight+"px; "+a.attr("custom_style"),o[0].style.cssText="height: "+this.recordHeight+"px; "+o.attr("custom_style")),a.find(".w2ui-grid-select-check").prop("checked",!1),e++}else{var l=arguments[i].column;if(!w2utils.isInt(l)){for(var d=[],u=0;u<this.columns.length;u++)this.columns[u].hidden||d.push({recid:s,column:u});return this.unselect.apply(this,d)}var c,h=t.columns[r];if(!$.isArray(h)||-1==h.indexOf(l))continue;if(!0===(c=this.trigger({phase:"before",type:"unselect",target:this.name,recid:s,column:l})).isCancelled)continue;h.splice(h.indexOf(l),1),$("#grid_"+this.name+"_rec_"+w2utils.escapeId(s)).find(" > td[col="+l+"]").removeClass("w2ui-selected w2ui-inactive"),$("#grid_"+this.name+"_frec_"+w2utils.escapeId(s)).find(" > td[col="+l+"]").removeClass("w2ui-selected w2ui-inactive");var p=!1,f=!1,g=this.getSelection();for(u=0;u<g.length;u++)g[u].column==l&&(p=!0),g[u].recid==s&&(f=!0);p||$(this.box).find(".w2ui-grid-columns td[col="+l+"] .w2ui-col-header, .w2ui-grid-fcolumns td[col="+l+"] .w2ui-col-header").removeClass("w2ui-col-selected"),f||$("#grid_"+this.name+"_frec_"+w2utils.escapeId(s)).find(".w2ui-col-number").removeClass("w2ui-row-selected"),e++,0===h.length&&(delete t.columns[r],t.indexes.splice(t.indexes.indexOf(r),1),a.removeData("selected"),a.find(".w2ui-grid-select-check").prop("checked",!1),o.removeData("selected"))}this.trigger($.extend(c,{phase:"after"}))}}var m=0<this.records.length&&t.indexes.length==this.records.length,w=0<t.indexes.length&&0!==this.searchData.length&&t.indexes.length==this.last.searchIds.length;return m||w?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.addRange("selection"),e},selectAll:function(){var e=(new Date).getTime();if(!1!==this.multiSelect){var t=this.trigger({phase:"before",type:"select",target:this.name,all:!0});if(!0!==t.isCancelled){for(var i="object"!=typeof this.url?this.url:this.url.get,s=this.last.selection,n=[],r=0;r<this.columns.length;r++)n.push(r);if(s.indexes=[],i||0===this.searchData.length){var a=this.records.length;0==this.searchData.length||i||(a=this.last.searchIds.length);for(r=0;r<a;r++)s.indexes.push(r),"row"!=this.selectType&&(s.columns[r]=n.slice())}else for(var r=0;r<this.last.searchIds.length;r++)s.indexes.push(this.last.searchIds[r]),"row"!=this.selectType&&(s.columns[this.last.searchIds[r]]=n.slice());return"row"==this.selectType?($(this.box).find(".w2ui-grid-records tr").not(".w2ui-empty-record").addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr").not(".w2ui-empty-record").addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected")):($(this.box).find(".w2ui-grid-columns td .w2ui-col-header, .w2ui-grid-fcolumns td .w2ui-col-header").addClass("w2ui-col-selected"),$(this.box).find(".w2ui-grid-records tr .w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-records tr").not(".w2ui-empty-record").find(".w2ui-grid-data").not(".w2ui-col-select").addClass("w2ui-selected").data("selected","yes"),$(this.box).find(".w2ui-grid-frecords tr .w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr").not(".w2ui-empty-record").find(".w2ui-grid-data").not(".w2ui-col-select").addClass("w2ui-selected").data("selected","yes")),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!0),1==(s=this.getSelection()).length?this.toolbar.enable("w2ui-edit"):this.toolbar.disable("w2ui-edit"),1<=s.length?this.toolbar.enable("w2ui-delete"):this.toolbar.disable("w2ui-delete"),this.addRange("selection"),$("#grid_"+this.name+"_check_all").prop("checked",!0),this.trigger($.extend(t,{phase:"after"})),(new Date).getTime()-e}}},selectNone:function(){var e=(new Date).getTime(),t=this.trigger({phase:"before",type:"unselect",target:this.name,all:!0});if(!0!==t.isCancelled){var i=this.last.selection;return"row"==this.selectType?($(this.box).find(".w2ui-grid-records tr.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected")):($(this.box).find(".w2ui-grid-columns td .w2ui-col-header, .w2ui-grid-fcolumns td .w2ui-col-header").removeClass("w2ui-col-selected"),$(this.box).find(".w2ui-grid-records tr .w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr .w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-data.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected")),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!1),i.indexes=[],i.columns={},this.toolbar.disable("w2ui-edit","w2ui-delete"),this.removeRange("selection"),$("#grid_"+this.name+"_check_all").prop("checked",!1),this.trigger($.extend(t,{phase:"after"})),(new Date).getTime()-e}},getSelection:function(e){var t=[],i=this.last.selection;if("row"==this.selectType){for(var s=0;s<i.indexes.length;s++)this.records[i.indexes[s]]&&(!0===e?t.push(i.indexes[s]):t.push(this.records[i.indexes[s]].recid));return t}for(s=0;s<i.indexes.length;s++){var n=i.columns[i.indexes[s]];if(this.records[i.indexes[s]])for(var r=0;r<n.length;r++)t.push({recid:this.records[i.indexes[s]].recid,index:parseInt(i.indexes[s]),column:n[r]})}return t},search:function(e,t){for(var i="object"!=typeof this.url?this.url:this.url.get,s=[],n=this.last.multi,r=this.last.logic,a=this.last.field,o=this.last.search,l=!1,d=0;d<this.searches.length;d++)this.searches[d].hidden&&(s.push({field:this.searches[d].field,operator:this.searches[d].operator||"is",type:this.searches[d].type,value:this.searches[d].value||""}),l=!0);if(0===arguments.length){o="";for(d=0;d<this.searches.length;d++){var u=this.searches[d],c=$("#grid_"+this.name+"_operator_"+d).val(),h=$("#grid_"+this.name+"_field_"+d),p=$("#grid_"+this.name+"_field2_"+d),f=h.val(),g=p.val(),m=null,w=null;if(-1!=["int","float","money","currency","percent"].indexOf(u.type)){var v=h.data("w2field"),y=p.data("w2field");v&&(f=v.clean(f)),y&&(g=y.clean(g))}if(-1!=["list","enum"].indexOf(u.type))if(f=h.data("selected")||{},$.isArray(f)){m=[];for(var b=0;b<f.length;b++)m.push(w2utils.isFloat(f[b].id)?parseFloat(f[b].id):String(f[b].id).toLowerCase()),delete f[b].hidden;$.isEmptyObject(f)&&(f="")}else w=f.text||"",f=f.id||"";if(""!==f&&null!=f||null!=g&&""!==g){var x={field:u.field,type:u.type,operator:c};"between"==c?$.extend(x,{value:[f,g]}):"in"==c&&"string"==typeof f?$.extend(x,{value:f.split(",")}):"not in"==c&&"string"==typeof f?$.extend(x,{value:f.split(",")}):$.extend(x,{value:f}),m&&$.extend(x,{svalue:m}),w&&$.extend(x,{text:w});try{"date"==u.type&&"between"==c&&(x.value[0]=f,x.value[1]=g),"date"==u.type&&"is"==c&&(x.value=f)}catch(e){}s.push(x)}}n=!0,r="AND"}if("string"==typeof e&&(1==arguments.length&&(t=e,e="all"),a=e,n=!1,r=l?"AND":"OR",null!=(o=t)))if("all"==e.toLowerCase())if(0<this.searches.length)for(d=0;d<this.searches.length;d++){if("text"==(u=this.searches[d]).type||"alphanumeric"==u.type&&w2utils.isAlphaNumeric(t)||"int"==u.type&&w2utils.isInt(t)||"float"==u.type&&w2utils.isFloat(t)||"percent"==u.type&&w2utils.isFloat(t)||("hex"==u.type||"color"==u.type)&&w2utils.isHex(t)||"currency"==u.type&&w2utils.isMoney(t)||"money"==u.type&&w2utils.isMoney(t)||"date"==u.type&&w2utils.isDate(t)||"time"==u.type&&w2utils.isTime(t)||"datetime"==u.type&&w2utils.isDateTime(t)||"enum"==u.type&&w2utils.isAlphaNumeric(t)||"list"==u.type&&w2utils.isAlphaNumeric(t)){x={field:u.field,type:u.type,operator:null!=u.operator?u.operator:"text"==u.type?this.textSearch:"is",value:t};""!=$.trim(t)&&s.push(x)}if(-1!=["int","float","money","currency","percent"].indexOf(u.type)&&2==$.trim(String(t)).split("-").length){var _=$.trim(String(t)).split("-");x={field:u.field,type:u.type,operator:null!=u.operator?u.operator:"between",value:[_[0],_[1]]};s.push(x)}if(-1!=["list","enum"].indexOf(u.type)){var k=[];for(b=0;b<u.options.items;b++){x=u.options.items[b];try{var C=new RegExp(t,"i");C.test(x)&&k.push(b),x.text&&C.test(x.text)&&k.push(x.id)}catch(e){}}if(0<k.length){x={field:u.field,type:u.type,operator:null!=u.operator?u.operator:"in",value:k};s.push(x)}}}else for(d=0;d<this.columns.length;d++){x={field:this.columns[d].field,type:"text",operator:this.textSearch,value:t};s.push(x)}else{var T=$("#grid_"+this.name+"_search_all");if(null==(u=this.getSearch(e))&&(u={field:e,type:"text"}),u.field==e&&(this.last.caption=u.caption),""!==t){var z=this.textSearch,S=t;if(-1!=["date","time","datetime"].indexOf(u.type)&&(z="is"),-1!=["list","enum"].indexOf(u.type))z="is",S=(x=T.data("selected"))&&!$.isEmptyObject(x)?x.id:"";if("int"==u.type&&""!==t){if(z="is",-1!=String(t).indexOf("-"))2==(x=t.split("-")).length&&(z="between",S=[parseInt(x[0]),parseInt(x[1])]);if(-1!=String(t).indexOf(",")){x=t.split(",");z="in",S=[];for(d=0;d<x.length;d++)S.push(x[d])}}null!=u.operator&&(z=u.operator);x={field:u.field,type:u.type,operator:z,value:S};s.push(x)}}if($.isArray(e)){var D="AND";"string"==typeof t&&"OR"!=(D=t.toUpperCase())&&"AND"!=D&&(D="AND"),n=!(o=""),r=D;for(d=0;d<e.length;d++){var O=e[d];if(null==(u=this.getSearch(O.field))&&(u={type:"text",operator:"begins"}),$.isArray(O.value))for(b=0;b<O.value.length;b++)"string"==typeof O.value[b]&&(O.value[b]=O.value[b].toLowerCase());s.push($.extend(!0,{},u,O))}}var I=this.trigger({phase:"before",type:"search",multi:0===arguments.length,target:this.name,searchData:s,searchField:e||"multi",searchValue:e?t:"multi"});!0!==I.isCancelled&&(this.searchData=I.searchData,this.last.field=a,this.last.search=o,this.last.multi=n,this.last.logic=r,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),i?(this.last.xhr_offset=0,this.reload()):(this.localSearch(),this.refresh()),this.trigger($.extend(I,{phase:"after"})))},searchOpen:function(){if(this.box&&0!==this.searches.length){var t=this,i=this.trigger({phase:"before",type:"searchOpen",target:this.name});!0!==i.isCancelled?$("#tb_"+this.name+"_toolbar_item_w2ui-search-advanced").w2overlay({html:this.getSearchesHTML(),name:this.name+"-searchOverlay",left:-10,class:"w2ui-grid-searches",onShow:function(){t.initSearches(),$("#w2ui-overlay-"+t.name+"-searchOverlay .w2ui-grid-searches").data("grid-name",t.name);var e=$("#w2ui-overlay-"+this.name+"-searchOverlay .w2ui-grid-searches *[rel=search]");0<e.length&&e[0].focus(),t.trigger($.extend(i,{phase:"after"}))}}):setTimeout(function(){t.toolbar.uncheck("w2ui-search-advanced")},1)}},searchClose:function(){this.box&&0!==this.searches.length&&(this.toolbar&&this.toolbar.uncheck("w2ui-search-advanced"),$().w2overlay({name:this.name+"-searchOverlay"}),$().w2overlay({name:this.name+"-searchOverlay"}))},searchReset:function(e){for(var t=[],i=!1,s=0;s<this.searches.length;s++)this.searches[s].hidden&&(t.push({field:this.searches[s].field,operator:this.searches[s].operator||"is",type:this.searches[s].type,value:this.searches[s].value||""}),i=!0);var n=this.trigger({phase:"before",type:"search",reset:!0,target:this.name,searchData:t});if(!0!==n.isCancelled){if(this.searchData=n.searchData,this.last.search="",this.last.logic=i?"AND":"OR",0<this.searches.length)if(this.multiSearch&&this.show.searchAll)this.last.field="all",this.last.caption=w2utils.lang("All Fields");else{for(var r=0;r<this.searches.length&&(this.searches[r].hidden||!1===this.searches[r].simple);)r++;r>=this.searches.length?(this.last.field="",this.last.caption=""):(this.last.field=this.searches[r].field,this.last.caption=this.searches[r].caption)}this.last.multi=!1,this.last.xhr_offset=0,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),$("#grid_"+this.name+"_search_all").val("").removeData("selected"),e||this.reload(),this.trigger($.extend(n,{phase:"after"}))}},searchShowFields:function(){for(var e=this,t=$("#grid_"+this.name+"_search_all"),i='<div class="w2ui-select-field"><table><tbody>',s=-1;s<this.searches.length;s++){var n=this.searches[s];if(-1==s){if(!this.multiSearch||!this.show.searchAll)continue;n={field:"all",caption:w2utils.lang("All Fields")}}else if(!0===this.searches[s].hidden||!1===this.searches[s].simple)continue;i+="<tr "+(w2utils.isIOS?"onTouchStart":"onClick")+"=\"w2ui['"+this.name+"'].initAllField('"+n.field+"');      event.stopPropagation(); jQuery('#grid_"+this.name+"_search_all').w2overlay({ name: '"+this.name+'-searchFields\' });">   <td>       <span class="w2ui-column-check w2ui-icon-'+(n.field==this.last.field?"check":"empty")+'"></span>   </td>   <td>'+n.caption+"</td></tr>"}i+="</tbody></table></div>",setTimeout(function(){$(t).w2overlay({html:i,name:e.name+"-searchFields",left:-10})},1)},initAllField:function(e,t){var i=$("#grid_"+this.name+"_search_all");if("all"==e){var s={field:"all",caption:w2utils.lang("All Fields")};i.w2field("clear"),i.change()}else{if(null==(s=this.getSearch(e)))return;var n=s.type;-1!=["enum","select"].indexOf(n)&&(n="list"),i.w2field(n,$.extend({},s.options,{suffix:"",autoFormat:!1,selected:t})),-1!=["list","enum","date","time","datetime"].indexOf(s.type)&&(this.last.search="",this.last.item="",i.val(""))}""!=this.last.search?(this.last.caption=s.caption,this.search(s.field,this.last.search)):(this.last.field=s.field,this.last.caption=s.caption),i.attr("placeholder",w2utils.lang(s.caption)),$().w2overlay({name:this.name+"-searchFields"})},clear:function(e){this.total=0,this.records=[],this.summary=[],this.last.xhr_offset=0,this.reset(!0),e||this.refresh()},reset:function(e){this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection={indexes:[],columns:{}},this.last.range_start=null,this.last.range_end=null,$("#grid_"+this.name+"_records").prop("scrollTop",0),e||this.refresh()},skip:function(e,t){("object"!=typeof this.url?this.url:this.url.get)?(this.offset=parseInt(e),this.offset>this.total&&(this.offset=this.total-this.limit),(this.offset<0||!w2utils.isInt(this.offset))&&(this.offset=0),this.clear(!0),this.reload(t)):console.log("ERROR: grid.skip() can only be called when you have remote data source.")},load:function(e,t){null!=e?(this.clear(!0),this.request("get",{},e,t)):console.log('ERROR: You need to provide url argument when calling .load() method of "'+this.name+'" object.')},reload:function(e){var t=this,i="object"!=typeof this.url?this.url:this.url.get;t.selectionSave(),i?this.load(i,function(){t.selectionRestore(),"function"==typeof e&&e()}):(this.reset(!0),this.localSearch(),this.selectionRestore(),"function"==typeof e&&e({status:"success"}))},request:function(a,e,t,o){if(null==e&&(e={}),""!=t&&null!=t||(t=this.url),""!=t&&null!=t){var i={};if(w2utils.isInt(this.offset)||(this.offset=0),w2utils.isInt(this.last.xhr_offset)||(this.last.xhr_offset=0),i.cmd=a,i.selected=this.getSelection(),i.limit=this.limit,i.offset=parseInt(this.offset)+parseInt(this.last.xhr_offset),i.search=this.searchData,i.searchLogic=this.last.logic,i.sort=this.sortData,0===this.searchData.length&&(delete i.search,delete i.searchLogic),0===this.sortData.length&&delete i.sort,$.extend(i,this.postData),$.extend(i,e),"get"==a){if(!0===(s=this.trigger({phase:"before",type:"request",target:this.name,url:t,postData:i,httpHeaders:this.httpHeaders})).isCancelled)return void("function"==typeof o&&o({status:"error",message:"Request aborted."}))}else var s={url:t,postData:i,httpHeaders:this.httpHeaders};var l=this;if(0===this.last.xhr_offset)l.lock(w2utils.lang(l.msgRefresh),!0);else{var n=$("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more");!0===this.autoLoad?n.show().find("td").html('<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>'):n.find("td").html("<div>"+w2utils.lang("Load")+" "+l.limit+" "+w2utils.lang("More")+"...</div>")}if(this.last.xhr)try{this.last.xhr.abort()}catch(e){}if(t="object"!=typeof s.url?s.url:s.url.get,"save"==i.cmd&&"object"==typeof s.url&&(t=s.url.save),"delete"==i.cmd&&"object"==typeof s.url&&(t=s.url.remove),!$.isEmptyObject(l.routeData)){var r=w2utils.parseRoute(t);if(0<r.keys.length)for(var d=0;d<r.keys.length;d++)null!=l.routeData[r.keys[d].name]&&(t=t.replace(new RegExp(":"+r.keys[d].name,"g"),l.routeData[r.keys[d].name]))}var u={type:"POST",url:t,data:s.postData,headers:s.httpHeaders,dataType:"text"};"HTTP"==w2utils.settings.dataType&&(u.data="object"==typeof u.data?String($.param(u.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"):u.data),"HTTPJSON"==w2utils.settings.dataType&&(u.data={request:JSON.stringify(u.data)}),"RESTFULL"==w2utils.settings.dataType&&(u.type="GET","save"==i.cmd&&(u.type="PUT"),"delete"==i.cmd&&(u.type="DELETE"),u.data="object"==typeof u.data?String($.param(u.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"):u.data),"RESTFULLJSON"==w2utils.settings.dataType&&(u.type="GET","save"==i.cmd&&(u.type="PUT"),"delete"==i.cmd&&(u.type="DELETE"),u.data=JSON.stringify(u.data),u.contentType="application/json"),"JSON"==w2utils.settings.dataType&&(u.type="POST",u.data=JSON.stringify(u.data),u.contentType="application/json"),this.method&&(u.type=this.method),this.last.xhr_cmd=i.cmd,this.last.xhr_start=(new Date).getTime(),this.last.xhr=$.ajax(u).done(function(e,t,i){l.requestComplete(t,a,o)}).fail(function(e,t,i){var s={status:t,error:i,rawResponseText:e.responseText},n=l.trigger({phase:"before",type:"error",error:s,xhr:e});if(!0!==n.isCancelled){if("abort"!=t){var r;try{r=$.parseJSON(e.responseText)}catch(e){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",total:5,records:[{recid:1,field:"value"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof r?r:e.responseText),l.requestComplete("error",a,o)}l.trigger($.extend(n,{phase:"after"}))}}),"get"==a&&this.trigger($.extend(s,{phase:"after"}))}},requestComplete:function(status,cmd,callBack){var obj=this;this.unlock(),setTimeout(function(){obj.show.statusResponse&&obj.status(w2utils.lang("Server Response")+" "+((new Date).getTime()-obj.last.xhr_start)/1e3+" "+w2utils.lang("sec"))},10),this.last.pull_more=!1,this.last.pull_refresh=!0;var event_name="load";"save"==this.last.xhr_cmd&&(event_name="save"),"delete"==this.last.xhr_cmd&&(event_name="delete");var edata=this.trigger({phase:"before",target:this.name,type:event_name,xhr:this.last.xhr,status:status});if(!0!==edata.isCancelled){var data,responseText=this.last.xhr.responseText;if("error"!=status){if(null!=responseText&&""!=responseText){if("object"==typeof responseText)data=responseText;else if("function"==typeof obj.parser)data=obj.parser(responseText),"object"!=typeof data&&console.log("ERROR: Your parser did not return proper object");else try{eval("data = "+responseText)}catch(e){}if(null==data?data={status:"error",message:w2utils.lang(this.msgNotJSON),responseText:responseText}:Array.isArray(data)&&(data={status:"success",records:data}),obj.recid&&data.records)for(var i=0;i<data.records.length;i++)data.records[i].recid=data.records[i][obj.recid];if("error"==data.status)obj.error(data.message);else{if("get"==cmd){if(null==data.total&&(data.total=-1),data.records.length==this.limit?this.last.xhr_hasMore=!0:(this.last.xhr_hasMore=!1,this.total=this.last.xhr_offset+data.records.length),0===this.last.xhr_offset)this.records=[],this.summary=[],w2utils.isInt(data.total)&&(this.total=parseInt(data.total));else if(-1!=data.total&&parseInt(data.total)!=parseInt(this.total))return void this.message(w2utils.lang(this.msgNeedReload),function(){delete this.last.xhr_offset,this.reload()}.bind(this));if(data.records)for(var r=0;r<data.records.length;r++)this.records.push(data.records[r]);if(data.summary){this.summary=[];for(var r=0;r<data.summary.length;r++)this.summary.push(data.summary[r])}}if("delete"==cmd)return this.reset(),void this.reload()}}}else data={status:"error",message:w2utils.lang(this.msgAJAXerror),responseText:responseText},obj.error(w2utils.lang(this.msgAJAXerror));var url="object"!=typeof this.url?this.url:this.url.get;url||(this.localSort(),this.localSearch()),this.total=parseInt(this.total),0===this.last.xhr_offset?this.refresh():(this.scroll(),this.resize()),"function"==typeof callBack&&callBack(data),this.trigger($.extend(edata,{phase:"after"}))}else"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."})},error:function(e){var t=this.trigger({target:this.name,type:"error",message:e,xhr:this.last.xhr});!0!==t.isCancelled?(this.message(e),this.trigger($.extend(t,{phase:"after"}))):"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."})},getChanges:function(){for(var e=[],t=0;t<this.records.length;t++){var i=this.records[t];i.w2ui&&null!=i.w2ui.changes&&e.push($.extend(!0,{recid:i.recid},i.w2ui.changes))}return e},mergeChanges:function(){for(var changes=this.getChanges(),c=0;c<changes.length;c++){var record=this.get(changes[c].recid);for(var s in changes[c])if("recid"!=s){"object"==typeof changes[c][s]&&(changes[c][s]=changes[c][s].text);try{-1!=s.indexOf(".")?eval("record['"+s.replace(/\./g,"']['")+"'] = changes[c][s]"):record[s]=changes[c][s]}catch(e){console.log("ERROR: Cannot merge. ",e.message||"",e)}record.w2ui&&delete record.w2ui.changes}}this.refresh()},save:function(){var t=this,e=this.getChanges(),i=this.trigger({phase:"before",target:this.name,type:"save",changes:e});!0!==i.isCancelled&&(("object"!=typeof this.url?this.url:this.url.save)?this.request("save",{changes:i.changes},null,function(e){"error"!==e.status&&t.mergeChanges(),t.trigger($.extend(i,{phase:"after"}))}):(this.mergeChanges(),this.trigger($.extend(i,{phase:"after"}))))},editField:function(d,u,e,t){var c=this,h=c.get(d,!0),i=c.getCellEditable(h,u);if(i){var p=c.records[h],f=c.columns[u],s=!0===f.frozen?"_f":"_";if(-1==["enum","file"].indexOf(i.type)){var n=c.trigger({phase:"before",type:"editField",target:c.name,recid:d,column:u,value:e,index:h,originalEvent:t});if(!0!==n.isCancelled&&(e=n.value,this.selectNone(),this.select({recid:d,column:u}),this.last.edit_col=u,-1==["checkbox","check"].indexOf(i.type))){var r=$("#grid_"+c.name+s+"rec_"+w2utils.escapeId(d)),a=r.find("[col="+u+"] > div");$(this.box).find("div.w2ui-edit-box").remove(),"row"!=this.selectType&&($("#grid_"+this.name+s+"selection").attr("id","grid_"+this.name+"_editable").removeClass("w2ui-selection").addClass("w2ui-edit-box").prepend('<div style="position: absolute; top: 0px; bottom: 0px; left: 0px; right: 0px;"></div>').find(".w2ui-selection-resizer").remove(),a=$("#grid_"+this.name+"_editable >div:first-child")),null==i.inTag&&(i.inTag=""),null==i.outTag&&(i.outTag=""),null==i.style&&(i.style=""),null==i.items&&(i.items=[]);var o=p.w2ui&&p.w2ui.changes&&null!=p.w2ui.changes[f.field]?w2utils.stripTags(p.w2ui.changes[f.field]):w2utils.stripTags(p[f.field]);null==o&&(o="");var l="object"!=typeof o?o:"";null!=n.old_value&&(l=n.old_value),null!=e&&(o=e);var g=null!=f.style?f.style+";":"";switch("string"==typeof f.render&&-1!=["number","int","float","money","percent","size"].indexOf(f.render.split(":")[0])&&(g+="text-align: right;"),0<i.items.length&&!$.isPlainObject(i.items[0])&&(i.items=w2obj.field.prototype.normMenu(i.items)),i.type){case"select":for(var m="",w=0;w<i.items.length;w++)m+='<option value="'+i.items[w].id+'"'+(i.items[w].id==o?' selected="selected"':"")+">"+i.items[w].text+"</option>";a.addClass("w2ui-editable").html('<select id="grid_'+c.name+"_edit_"+d+"_"+u+'" column="'+u+'" class="w2ui-input"    style="width: 100%; pointer-events: auto; padding: 0 0 0 3px; margin: 0px; border-left: 0; border-right: 0; border-radius: 0px;            outline: none; font-family: inherit;'+g+i.style+'"     field="'+f.field+'" recid="'+d+'"     '+i.inTag+">"+m+"</select>"+i.outTag),setTimeout(function(){a.find("select").on("change",function(e){delete c.last.move}).on("blur",function(e){1!=$(this).data("keep-open")&&c.editChange.call(c,this,h,u,e)})},10);break;case"div":var v="font-family: "+(b=r.find("[col="+u+"] > div")).css("font-family")+"; font-size: "+b.css("font-size")+";";a.addClass("w2ui-editable").html('<div id="grid_'+c.name+"_edit_"+d+"_"+u+'" class="w2ui-input"    contenteditable style="'+v+g+i.style+'" autocorrect="off" autocomplete="off" spellcheck="false"     field="'+f.field+'" recid="'+d+'" column="'+u+'" '+i.inTag+"></div>"+i.outTag),null==e&&a.find("div.w2ui-input").text("object"!=typeof o?o:"");var y=a.find("div.w2ui-input").get(0);setTimeout(function(){var t=y;$(t).on("blur",function(e){1!=$(this).data("keep-open")&&c.editChange.call(c,t,h,u,e)})},10),null!=e&&$(y).text("object"!=typeof o?o:"");break;default:var b;v="font-family: "+(b=r.find("[col="+u+"] > div")).css("font-family")+"; font-size: "+b.css("font-size");a.addClass("w2ui-editable").html('<input id="grid_'+c.name+"_edit_"+d+"_"+u+'" autocorrect="off" autocomplete="off" spellcheck="false" type="text"     style="'+v+"; width: 100%; height: 100%; padding: 3px; border-color: transparent; outline: none; border-radius: 0;        pointer-events: auto; "+g+i.style+'"     field="'+f.field+'" recid="'+d+'" column="'+u+'" class="w2ui-input"'+i.inTag+"/>"+i.outTag),"number"==i.type&&(o=w2utils.formatNumber(o)),"date"==i.type&&(o=w2utils.formatDate(w2utils.isDate(o,i.format,!0),i.format)),null==e&&a.find("input").val("object"!=typeof o?o:"");y=a.find("input").get(0);$(y).w2field(i.type,$.extend(i,{selected:o})),setTimeout(function(){var e=y;"list"==i.type&&(e=$($(y).data("w2field").helpers.focus).find("input"),"object"!=typeof o&&""!=o&&e.val(o).css({opacity:1}).prev().css({opacity:1}),a.find("input").on("change",function(e){c.editChange.call(c,y,h,u,e)})),$(e).on("blur",function(e){1!=$(this).data("keep-open")&&c.editChange.call(c,y,h,u,e)})},10),null!=e&&$(y).val("object"!=typeof o?o:"")}return void setTimeout(function(){a.find("input, select, div.w2ui-input").data("old_value",l).on("mousedown",function(e){e.stopPropagation()}).on("click",function(e){"div"==i.type?x.call(a.find("div.w2ui-input")[0],null):x.call(a.find("input, select")[0],null)}).on("paste",function(e){var t=e.originalEvent;e.preventDefault();var i=t.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,i)}).on("keydown",function(o){var l=this,e="DIV"==l.tagName.toUpperCase()?$(l).text():$(l).val();switch(o.keyCode){case 8:"list"!=i.type||$(y).data("w2field")||o.preventDefault();break;case 9:case 13:o.preventDefault();break;case 37:0===w2utils.getCursorPosition(l)&&o.preventDefault();break;case 39:w2utils.getCursorPosition(l)==e.length&&(w2utils.setCursorPosition(l,e.length),o.preventDefault())}setTimeout(function(){switch(o.keyCode){case 9:var e=d,t=o.shiftKey?c.prevCell(h,u,!0):c.nextCell(h,u,!0);if(null==t){var i=o.shiftKey?c.prevRow(h,u):c.nextRow(h,u);if(null!=i&&i!=h){e=c.records[i].recid;for(var s=0;s<c.columns.length;s++){var n=c.getCellEditable(h,s);if(null!=n&&-1==["checkbox","check"].indexOf(n.type)&&(t=parseInt(s),!o.shiftKey))break}}}!1===e&&(e=d),null==t&&(t=u),l.blur(),setTimeout(function(){"row"!=c.selectType?(c.selectNone(),c.select({recid:e,column:t})):c.editField(e,t,null,o)},1),o.preventDefault&&o.preventDefault();break;case 13:l.blur();var r=o.shiftKey?c.prevRow(h,u):c.nextRow(h,u);null!=r&&r!=h&&setTimeout(function(){"row"!=c.selectType?(c.selectNone(),c.select({recid:c.records[r].recid,column:u})):c.editField(c.records[r].recid,u,null,o)},1),"DIV"==l.tagName.toUpperCase()&&o.preventDefault();break;case 27:var a=c.parseField(p,f.field);p.w2ui&&p.w2ui.changes&&null!=p.w2ui.changes[f.field]&&(a=p.w2ui.changes[f.field]),null!=$(l).data("old_value")&&(a=$(l).data("old_value")),"DIV"==l.tagName.toUpperCase()?$(l).text(null!=a?a:""):l.value=null!=a?a:"",l.blur(),setTimeout(function(){c.select({recid:d,column:u})},1)}x.call(l,o)},1)}).on("keyup",function(e){x.call(this,e)}),setTimeout(function(){var e=a.find(".w2ui-input"),t=$(e).val().length;"div"==i.type&&(t=$(e).text().length),0<e.length&&(e.focus(),clearTimeout(c.last.kbd_timer),"SELECT"!=e[0].tagName&&w2utils.setCursorPosition(e[0],t),(e[0].resize=x).call(e[0],null))},50),c.trigger($.extend(n,{phase:"after",input:a.find("input, select, div.w2ui-input")}))},5)}}else console.log('ERROR: input types "enum" and "file" are not supported in inline editing.')}function x(e){try{var t="DIV"==this.tagName.toUpperCase()?$(this).text():this.value,i=$("#grid_"+c.name+"_editable"),s="font-family: "+$(this).css("font-family")+"; font-size: "+$(this).css("font-size")+"; white-space: pre;",n=w2utils.getStrWidth(t,s);n+20>i.width()&&i.width(n+20)}catch(e){}}},editChange:function(e,t,i,s){var n=this;setTimeout(function(){var e=$(n.box).find("#grid_"+n.name+"_focus");e.is(":focus")||e.focus()},10);var r=t<0;t=t<0?-t-1:t;var a=(r?this.summary:this.records)[t],o=this.columns[i],l=$("#grid_"+this.name+(!0===o.frozen?"_frec_":"_rec_")+w2utils.escapeId(a.recid)),d=e.tagName&&"DIV"==e.tagName.toUpperCase()?$(e).text():e.value,u=this.parseField(a,o.field),c=$(e).data("w2field");c&&("list"==c.type&&(d=$(e).data("selected")),($.isEmptyObject(d)||null==d)&&(d=""),$.isPlainObject(d)||(d=c.clean(d))),"checkbox"==e.type&&(a.w2ui&&!1===a.w2ui.editable&&(e.checked=!e.checked),d=e.checked);var h={phase:"before",type:"change",target:this.name,input_id:e.id,recid:a.recid,index:t,column:i,originalEvent:s.originalEvent?s.originalEvent:s,value_new:d,value_previous:a.w2ui&&a.w2ui.changes&&a.w2ui.changes.hasOwnProperty(o.field)?a.w2ui.changes[o.field]:u,value_original:u};for(null!=$(s.target).data("old_value")&&(h.value_previous=$(s.target).data("old_value"));;){if("object"!=typeof(d=h.value_new)&&String(u)!=String(d)||"object"==typeof d&&d.id!=u&&("object"!=typeof u||null==u||d.id!=u.id)){if(!0!==(h=this.trigger($.extend(h,{type:"change",phase:"before"}))).isCancelled){if(d!==h.value_new)continue;a.w2ui=a.w2ui||{},a.w2ui.changes=a.w2ui.changes||{},a.w2ui.changes[o.field]=h.value_new,this.trigger($.extend(h,{phase:"after"}))}}else if(!0!==(h=this.trigger($.extend(h,{type:"restore",phase:"before"}))).isCancelled){if(d!==h.value_new)continue;a.w2ui&&a.w2ui.changes&&delete a.w2ui.changes[o.field],a.w2ui&&$.isEmptyObject(a.w2ui.changes)&&delete a.w2ui.changes,this.trigger($.extend(h,{phase:"after"}))}break}var p=$(l).find("[col="+i+"]");r||(a.w2ui&&a.w2ui.changes&&null!=a.w2ui.changes[o.field]?p.addClass("w2ui-changed"):p.removeClass("w2ui-changed"),p.replaceWith(this.getCellHTML(t,i,r))),$(this.box).find("div.w2ui-edit-box").remove(),this.show.toolbarSave&&(0<this.getChanges().length?this.toolbar.enable("w2ui-save"):this.toolbar.disable("w2ui-save"))},delete:function(e){(new Date).getTime();var i=this,t=this.trigger({phase:"before",target:this.name,type:"delete",force:e});if(!0!==t.isCancelled){e=t.force,setTimeout(function(){$().w2tag()},20);var s=this.getSelection();if(0!==s.length)if(""==this.msgDelete||e){if(this.message(),"object"!=typeof this.url?this.url:this.url.remove)this.request("delete");else if("object"!=typeof s[0])this.selectNone(),this.remove.apply(this,s);else{for(var n=0;n<s.length;n++){var r=this.columns[s[n].column].field,a=this.get(s[n].recid,!0),o=this.records[a];null!=a&&"recid"!=r&&(this.records[a][r]="",o.w2ui&&o.w2ui.changes&&delete o.w2ui.changes[r])}this.update()}this.trigger($.extend(t,{phase:"after"}))}else this.message({width:350,height:170,body:'<div class="w2ui-centered">'+w2utils.lang(i.msgDelete)+"</div>",buttons:'<button class="w2ui-btn w2ui-btn-red" onclick="w2ui[\''+this.name+"'].delete(true)\">"+w2utils.lang("Yes")+'</button><button class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message()\">"+w2utils.lang("No")+"</button>",onOpen:function(e){var t=$(this.box).find("input, textarea, select, button");t.off(".message").on("blur.message",function(e){t.index(e.target)+1===t.length&&(t.get(0).focus(),e.preventDefault())}).on("keydown.message",function(e){27==e.keyCode&&i.message()}),setTimeout(function(){$(this.box).find(".w2ui-btn:last-child").focus(),clearTimeout(i.last.kbd_timer)},25)}})}},click:function(e,t){var i=(new Date).getTime(),s=null;if(!(1==this.last.cancelClick||t&&t.altKey))if("object"==typeof e&&(s=e.column,e=e.recid),null==t&&(t={}),i-parseInt(this.last.click_time)<350&&this.last.click_recid==e&&"click"==t.type)this.dblClick(e,t);else{this.last.bubbleEl&&($(this.last.bubbleEl).w2tag(),this.last.bubbleEl=null),this.last.click_time=i;var n=this.last.click_recid;if(this.last.click_recid=e,null==s&&t.target)"TD"!=(m=t.target).tagName.toUpperCase()&&(m=$(m).parents("td")[0]),null!=$(m).attr("col")&&(s=parseInt($(m).attr("col")));var r=this.trigger({phase:"before",target:this.name,type:"click",recid:e,column:s,originalEvent:t});if(!0!==r.isCancelled){var a=this,o=this.getSelection();$("#grid_"+this.name+"_check_all").prop("checked",!1);var l=this.get(e,!0),d=(this.records[l],[]);if(a.last.sel_ind=l,a.last.sel_col=s,a.last.sel_recid=e,a.last.sel_type="click",t.shiftKey&&0<o.length&&a.multiSelect){if(o[0].recid){var u=this.get(o[0].recid,!0),c=this.get(e,!0);if(s>o[0].column)var h=o[0].column,p=s;else h=s,p=o[0].column;for(var f=h;f<=p;f++)d.push(f)}else u=this.get(n,!0),c=this.get(e,!0);var g=[];if(c<u){var m=u;u=c,c=m}for(var w="object"!=typeof this.url?this.url:this.url.get,v=u;v<=c;v++)if(!(0<this.searchData.length)||w||-1!=$.inArray(v,this.last.searchIds))if("row"==this.selectType)g.push(this.records[v].recid);else for(var y=0;y<d.length;y++)g.push({recid:this.records[v].recid,column:d[y]});this.select.apply(this,g)}else{var b=this.last.selection,x=-1!=b.indexes.indexOf(l),_=!1;$(t.target).parents("td").hasClass("w2ui-col-select")&&(_=!0),(t.ctrlKey||t.shiftKey||t.metaKey||_)&&this.multiSelect||this.showSelectColumn?("row"!=this.selectType&&-1==$.inArray(s,b.columns[l])&&(x=!1),!0===x?this.unselect({recid:e,column:s}):this.select({recid:e,column:s})):("row"!=this.selectType&&-1==$.inArray(s,b.columns[l])&&(x=!1),300<o.length?this.selectNone():this.unselect.apply(this,o),!0===x&&1==o.length?this.unselect({recid:e,column:s}):this.select({recid:e,column:s}))}this.status(),a.initResize(),this.trigger($.extend(r,{phase:"after"}))}}},columnClick:function(e,t){if(!0!==(i=this.trigger({phase:"before",type:"columnClick",target:this.name,field:e,originalEvent:t})).isCancelled){if("row"==this.selectType)(n=this.getColumn(e))&&n.sortable&&this.sort(e,null,!(!t||!t.ctrlKey&&!t.metaKey)),"line-number"==i.field&&(this.getSelection().length>=this.records.length?this.selectNone():this.selectAll());else if("line-number"==i.field)this.getSelection().length>=this.records.length?this.selectNone():this.selectAll();else{t.shiftKey||t.metaKey||t.ctrlKey||this.selectNone();var i,s=this.getSelection(),n=this.getColumn(i.field,!0),r=[],a=[];if(0!=s.length&&t.shiftKey){var o=n,l=s[0].column;l<o&&(o=s[0].column,l=n);for(var d=o;d<=l;d++)a.push(d)}else a.push(n);if(!0!==(i=this.trigger({phase:"before",type:"columnSelect",target:this.name,columns:a})).isCancelled){for(d=0;d<this.records.length;d++)r.push({recid:this.records[d].recid,column:a});this.select.apply(this,r)}this.trigger($.extend(i,{phase:"after"}))}this.trigger($.extend(i,{phase:"after"}))}},columnDblClick:function(e,t){var i=this.trigger({phase:"before",type:"columnDblClick",target:this.name,field:e,originalEvent:t});!0!==i.isCancelled&&this.trigger($.extend(i,{phase:"after"}))},focus:function(e){var t=this,i=this.trigger({phase:"before",type:"focus",target:this.name,originalEvent:e});if(!0===i.isCancelled)return!1;this.hasFocus=!0,$(this.box).find(".w2ui-inactive").removeClass("w2ui-inactive"),setTimeout(function(){var e=$(t.box).find("#grid_"+t.name+"_focus");e.is(":focus")||e.focus()},10),this.trigger($.extend(i,{phase:"after"}))},blur:function(e){var t=this.trigger({phase:"before",type:"blur",target:this.name,originalEvent:e});if(!0===t.isCancelled)return!1;this.hasFocus=!1,$(this.box).find(".w2ui-selected").addClass("w2ui-inactive"),$(this.box).find(".w2ui-selection").addClass("w2ui-inactive"),this.trigger($.extend(t,{phase:"after"}))},keydown:function(i){var s=this,e="object"!=typeof this.url?this.url:this.url.get;if(!0===s.keyboard){var t=s.trigger({phase:"before",type:"keydown",target:s.name,originalEvent:i});if(!0!==t.isCancelled)if(0<$(this.box).find(">.w2ui-message").length)27==i.keyCode&&this.message();else{var n=!1,r=$("#grid_"+s.name+"_records"),a=s.getSelection();0===a.length&&(n=!0);var o=a[0]||null,l=[],d=a[a.length-1];if("object"==typeof o&&null!=o){o=a[0].recid,l=[];for(var u=0;a[u]&&a[u].recid==o;)l.push(a[u].column),u++;d=a[a.length-1].recid}var c=s.get(o,!0),h=s.get(d,!0),p=(s.get(o),$("#grid_"+s.name+"_rec_"+(null!=c?w2utils.escapeId(s.records[c].recid):"none"))),f=!1,g=i.keyCode,m=i.shiftKey;switch(g){case 8:case 46:(this.show.toolbarDelete||this.onDelete)&&s.delete(),f=!0,i.stopPropagation();break;case 27:s.selectNone(),f=!0;break;case 65:if(!i.metaKey&&!i.ctrlKey)break;s.selectAll(),f=!0;break;case 13:if("row"==this.selectType&&!0===s.show.expandColumn){if(p.length<=0)break;s.toggle(o,i),f=!0}else{for(var w=0;w<this.columns.length;w++){if(this.getCellEditable(c,w)){l.push(parseInt(w));break}}"row"==this.selectType&&this.last.edit_col&&(l=[this.last.edit_col]),0<l.length&&(s.editField(o,l[0],null,i),f=!0)}break;case 37:if(n){T();break}if("row"==this.selectType){if(p.length<=0)break;!(y=this.records[c].w2ui||{})||null==y.parent_recid||Array.isArray(y.children)&&0!==y.children.length&&y.expanded?s.collapse(o,i):(s.unselect(o),s.collapse(y.parent_recid,i),s.select(y.parent_recid))}else{var v=s.prevCell(c,l[0]);if(m||null!=v||(this.selectNone(),v=0),null!=v)if(m&&s.multiSelect){if(z())return;var y=[],b=[],x=[];if(0===l.indexOf(this.last.sel_col)&&1<l.length){for(var _=0;_<a.length;_++)-1==y.indexOf(a[_].recid)&&y.push(a[_].recid),x.push({recid:a[_].recid,column:l[l.length-1]});s.unselect.apply(s,x),s.scrollIntoView(c,l[l.length-1],!0)}else{for(_=0;_<a.length;_++)-1==y.indexOf(a[_].recid)&&y.push(a[_].recid),b.push({recid:a[_].recid,column:v});s.select.apply(s,b),s.scrollIntoView(c,v,!0)}}else i.metaKey=!1,s.click({recid:o,column:v},i),s.scrollIntoView(c,v,!0);else if(!m)if(1<a.length)s.selectNone();else for(var k=1;k<a.length;k++)s.unselect(a[k])}f=!0;break;case 39:if(n){T();break}if("row"==this.selectType){if(p.length<=0)break;s.expand(o,i)}else{var C=s.nextCell(c,l[l.length-1]);if(m||null!=C||(this.selectNone(),C=this.columns.length-1),null!=C)if(m&&39==g&&s.multiSelect){if(z())return;y=[],b=[],x=[];if(l.indexOf(this.last.sel_col)==l.length-1&&1<l.length){for(_=0;_<a.length;_++)-1==y.indexOf(a[_].recid)&&y.push(a[_].recid),x.push({recid:a[_].recid,column:l[0]});s.unselect.apply(s,x),s.scrollIntoView(c,l[0],!0)}else{for(_=0;_<a.length;_++)-1==y.indexOf(a[_].recid)&&y.push(a[_].recid),b.push({recid:a[_].recid,column:C});s.select.apply(s,b),s.scrollIntoView(c,C,!0)}}else i.metaKey=!1,s.click({recid:o,column:C},i),s.scrollIntoView(c,C,!0);else if(!m)if(1<a.length)s.selectNone();else for(k=0;k<a.length-1;k++)s.unselect(a[k])}f=!0;break;case 38:if(n&&T(),p.length<=0)break;v=s.prevRow(c,l[0]);if(m||null!=v||(v=0==this.searchData.length||e?0:this.last.searchIds[0]),null!=v){if(m&&s.multiSelect){if(z())return;if("row"==s.selectType)s.last.sel_ind>v&&s.last.sel_ind!=h?s.unselect(s.records[h].recid):s.select(s.records[v].recid);else if(s.last.sel_ind>v&&s.last.sel_ind!=h){v=h;for(y=[],w=0;w<l.length;w++)y.push({recid:s.records[v].recid,column:l[w]});s.unselect.apply(s,y)}else{for(y=[],w=0;w<l.length;w++)y.push({recid:s.records[v].recid,column:l[w]});s.select.apply(s,y)}}else 300<a.length?this.selectNone():this.unselect.apply(this,a),s.click({recid:s.records[v].recid,column:l[0]},i);s.scrollIntoView(v),i.preventDefault&&i.preventDefault()}else if(!m)if(1<a.length)s.selectNone();else for(k=1;k<a.length;k++)s.unselect(a[k]);break;case 40:if(n&&T(),p.length<=0)break;C=s.nextRow(h,l[0]);if(m||null!=C||(C=0==this.searchData.length||e?this.records.length-1:this.last.searchIds[this.last.searchIds.length-1]),null!=C){if(m&&s.multiSelect){if(z())return;if("row"==s.selectType)this.last.sel_ind<C&&this.last.sel_ind!=c?s.unselect(s.records[c].recid):s.select(s.records[C].recid);else if(this.last.sel_ind<C&&this.last.sel_ind!=c){C=c;for(y=[],w=0;w<l.length;w++)y.push({recid:s.records[C].recid,column:l[w]});s.unselect.apply(s,y)}else{for(y=[],w=0;w<l.length;w++)y.push({recid:s.records[C].recid,column:l[w]});s.select.apply(s,y)}}else 300<a.length?this.selectNone():this.unselect.apply(this,a),s.click({recid:s.records[C].recid,column:l[0]},i);s.scrollIntoView(C),f=!0}else if(!m)if(1<a.length)s.selectNone();else for(k=0;k<a.length-1;k++)s.unselect(a[k]);break;case 17:case 91:if(n)break;s.last.isSafari&&(s.last.copy_event=s.copy(!1,i),$("#grid_"+s.name+"_focus").val(s.last.copy_event.text).select());break;case 67:(i.metaKey||i.ctrlKey)&&(s.last.isSafari||(s.last.copy_event=s.copy(!1,i),$("#grid_"+s.name+"_focus").val(s.last.copy_event.text).select()),s.copy(s.last.copy_event,i));break;case 88:if(n)break;(i.ctrlKey||i.metaKey)&&(s.last.isSafari||(s.last.copy_event=s.copy(!1,i),$("#grid_"+s.name+"_focus").val(s.last.copy_event.text).select()),s.copy(s.last.copy_event,i),setTimeout(function(){s.delete(!0)},100))}for(y=[32,187,189,192,219,220,221,186,222,188,190,191],_=48;_<=111;_++)y.push(_);-1==y.indexOf(g)||i.ctrlKey||i.metaKey||f||(0===l.length&&l.push(0),f=!1,setTimeout(function(){var e=$("#grid_"+s.name+"_focus"),t=e.val();e.val(""),s.editField(o,l[0],t,i)},1)),f&&i.preventDefault&&i.preventDefault(),s.trigger($.extend(t,{phase:"after"}))}}function T(){var e=Math.floor(r[0].scrollTop/s.recordHeight)+1;(!s.records[e]||e<2)&&(e=0),s.select({recid:s.records[e].recid,column:0})}function z(){if("click"!=s.last.sel_type)return!1;if("row"!=s.selectType){if(s.last.sel_type="key",1<a.length){for(var e=0;e<a.length;e++)if(a[e].recid==s.last.sel_recid&&a[e].column==s.last.sel_col){a.splice(e,1);break}return s.unselect.apply(s,a),!0}return!1}return s.last.sel_type="key",1<a.length&&(a.splice(a.indexOf(s.records[s.last.sel_ind].recid),1),s.unselect.apply(s,a),!0)}},scrollIntoView:function(e,t,i){var s=this.records.length;if(0==this.searchData.length||this.url||(s=this.last.searchIds.length),0!==s){if(null==e){var n=this.getSelection();if(0===n.length)return;$.isPlainObject(n[0])?(e=n[0].index,t=n[0].column):e=this.get(n[0],!0)}var r=$("#grid_"+this.name+"_records"),a=this.last.searchIds.length;if(0<a&&(e=this.last.searchIds.indexOf(e)),r.height()<this.recordHeight*(0<a?a:s)&&0<r.length){var o=Math.floor(r[0].scrollTop/this.recordHeight),l=o+Math.floor(r.height()/this.recordHeight);e==o&&(!0===i?r.prop({scrollTop:r.scrollTop()-r.height()/1.3}):(r.stop(),r.animate({scrollTop:r.scrollTop()-r.height()/1.3},250,"linear"))),e==l&&(!0===i?r.prop({scrollTop:r.scrollTop()+r.height()/1.3}):(r.stop(),r.animate({scrollTop:r.scrollTop()+r.height()/1.3},250,"linear"))),(e<o||l<e)&&(!0===i?r.prop({scrollTop:(e-1)*this.recordHeight}):(r.stop(),r.animate({scrollTop:(e-1)*this.recordHeight},250,"linear")))}if(null!=t){for(var d=0,u=0,c=w2utils.scrollBarSize(),h=0;h<=t;h++){var p=this.columns[h];p.frozen||p.hidden||(d=u,u+=parseInt(p.sizeCalculated))}r.width()<u-r.scrollLeft()?!0===i?r.prop({scrollLeft:d-c}):r.animate({scrollLeft:d-c},250,"linear"):d<r.scrollLeft()&&(!0===i?r.prop({scrollLeft:u-r.width()+2*c}):r.animate({scrollLeft:u-r.width()+2*c},250,"linear"))}}},dblClick:function(e,t){var i=null;if("object"==typeof e&&(i=e.column,e=e.recid),null==t&&(t={}),null==i&&t.target){var s=t.target;"TD"!=s.tagName.toUpperCase()&&(s=$(s).parents("td")[0]),i=parseInt($(s).attr("col"))}var n=this.get(e,!0),r=this.records[n],a=this.trigger({phase:"before",target:this.name,type:"dblClick",recid:e,column:i,originalEvent:t});!0!==a.isCancelled&&(this.selectNone(),this.getCellEditable(n,i)?this.editField(e,i,null,t):(this.select({recid:e,column:i}),(this.show.expandColumn||r.w2ui&&Array.isArray(r.w2ui.children))&&this.toggle(e)),this.trigger($.extend(a,{phase:"after"})))},contextMenu:function(t,e,i){var s=this;if("text"!=s.last.userSelect){null==i&&(i={offsetX:0,offsetY:0,target:$("#grid_"+s.name+"_rec_"+t)[0]}),null==i.offsetX&&(i.offsetX=i.layerX-i.target.offsetLeft,i.offsetY=i.layerY-i.target.offsetTop),w2utils.isFloat(t)&&(t=parseFloat(t));var n=this.getSelection();if("row"==this.selectType)-1==n.indexOf(t)&&s.click(t);else{var r=$(i.target);"TD"!=r[0].tagName.toUpperCase()&&(r=$(i.target).parents("td"));var a=!1;e=r.attr("col");for(var o=0;o<n.length;o++)n[o].recid!=t&&n[o].column!=e||(a=!0);a||null==t||s.click({recid:t,column:e}),a||null==e||s.columnClick(this.columns[e].field,i)}var l=s.trigger({phase:"before",type:"contextMenu",target:s.name,originalEvent:i,recid:t,column:e});!0!==l.isCancelled&&(0<s.menu.length&&$(s.box).find(i.target).w2menu(s.menu,{originalEvent:i,contextMenu:!0,onSelect:function(e){s.menuClick(t,parseInt(e.index),e.originalEvent)}}),i.preventDefault&&i.preventDefault(),s.trigger($.extend(l,{phase:"after"})))}},menuClick:function(e,t,i){var s=this.trigger({phase:"before",type:"menuClick",target:this.name,originalEvent:i,recid:e,menuIndex:t,menuItem:this.menu[t]});!0!==s.isCancelled&&this.trigger($.extend(s,{phase:"after"}))},toggle:function(e){var t=this.get(e);return t.w2ui=t.w2ui||{},!0===t.w2ui.expanded?this.collapse(e):this.expand(e)},expand:function(e){var t=this.get(e,!0),i=this.records[t];i.w2ui=i.w2ui||{};var s=w2utils.escapeId(e),n=i.w2ui.children;if(Array.isArray(n)){if(!0===i.w2ui.expanded||0===n.length)return!1;if(!0===(r=this.trigger({phase:"before",type:"expand",target:this.name,recid:e})).isCancelled)return!1;i.w2ui.expanded=!0,n.forEach(function(e){e.w2ui=e.w2ui||{},e.w2ui.parent_recid=i.recid,null==e.w2ui.children&&(e.w2ui.children=[])}),this.records.splice.apply(this.records,[t+1,0].concat(n)),this.total+=n.length,("object"!=typeof this.url?this.url:this.url.get)||(this.localSort(!0,!0),0<this.searchData.length&&this.localSearch(!0)),this.refresh(),this.trigger($.extend(r,{phase:"after"}))}else{if(0<$("#grid_"+this.name+"_rec_"+s+"_expanded_row").length||!0!==this.show.expandColumn)return!1;if("none"==i.w2ui.expanded)return!1;var r;if($("#grid_"+this.name+"_rec_"+s).after('<tr id="grid_'+this.name+"_rec_"+e+'_expanded_row" class="w2ui-expanded-row">    <td colspan="100" class="w2ui-expanded2">        <div id="grid_'+this.name+"_rec_"+e+'_expanded"></div>    </td>    <td class="w2ui-grid-data-last"></td></tr>'),$("#grid_"+this.name+"_frec_"+s).after('<tr id="grid_'+this.name+"_frec_"+e+'_expanded_row" class="w2ui-expanded-row">'+(this.show.lineNumbers?'<td class="w2ui-col-number"></td>':"")+'    <td class="w2ui-grid-data w2ui-expanded1" colspan="100">       <div id="grid_'+this.name+"_frec_"+e+'_expanded"></div>   </td></tr>'),!0===(r=this.trigger({phase:"before",type:"expand",target:this.name,recid:e,box_id:"grid_"+this.name+"_rec_"+e+"_expanded",fbox_id:"grid_"+this.name+"_frec_"+s+"_expanded"})).isCancelled)return $("#grid_"+this.name+"_rec_"+s+"_expanded_row").remove(),$("#grid_"+this.name+"_frec_"+s+"_expanded_row").remove(),!1;var a=$(this.box).find("#grid_"+this.name+"_rec_"+e+"_expanded"),o=$(this.box).find("#grid_"+this.name+"_frec_"+e+"_expanded"),l=a.find("> div:first-child").height();a.height()<l&&a.css({height:l+"px"}),o.height()<l&&o.css({height:l+"px"}),$("#grid_"+this.name+"_rec_"+s).attr("expanded","yes").addClass("w2ui-expanded"),$("#grid_"+this.name+"_frec_"+s).attr("expanded","yes").addClass("w2ui-expanded"),$("#grid_"+this.name+"_cell_"+this.get(e,!0)+"_expand div").html("-"),i.w2ui.expanded=!0,this.trigger($.extend(r,{phase:"after"})),this.resizeRecords()}return!0},collapse:function(e){var t=this,i=this.get(e,!0),s=this.records[i];s.w2ui=s.w2ui||{};var n=w2utils.escapeId(e),r=s.w2ui.children;if(Array.isArray(r)){if(!0!==s.w2ui.expanded)return!1;if(!0===(u=this.trigger({phase:"before",type:"collapse",target:this.name,recid:e})).isCancelled)return!1;!function e(t){t.w2ui.expanded=!1;for(var i=0;i<t.w2ui.children.length;i++){var s=t.w2ui.children[i];s.w2ui.expanded&&e(s)}}(s);for(var a=[],o=s;null!=o;o=this.get(o.w2ui.parent_recid))a.push(o.w2ui.parent_recid);for(var l=i+1,d=l;!(this.records.length<=d+1||null==this.records[d+1].w2ui||0<=a.indexOf(this.records[d+1].w2ui.parent_recid));)d++;this.records.splice(l,d-l+1),this.total-=d-l+1,("object"!=typeof this.url?this.url:this.url.get)||0<this.searchData.length&&this.localSearch(!0),this.refresh(),t.trigger($.extend(u,{phase:"after"}))}else{if(0===$("#grid_"+this.name+"_rec_"+n+"_expanded_row").length||!0!==this.show.expandColumn)return!1;var u;if(!0===(u=this.trigger({phase:"before",type:"collapse",target:this.name,recid:e,box_id:"grid_"+this.name+"_rec_"+n+"_expanded",fbox_id:"grid_"+this.name+"_frec_"+n+"_expanded"})).isCancelled)return!1;$("#grid_"+this.name+"_rec_"+n).removeAttr("expanded").removeClass("w2ui-expanded"),$("#grid_"+this.name+"_frec_"+n).removeAttr("expanded").removeClass("w2ui-expanded"),$("#grid_"+this.name+"_cell_"+this.get(e,!0)+"_expand div").html("+"),$("#grid_"+t.name+"_rec_"+n+"_expanded").css("height","0px"),$("#grid_"+t.name+"_frec_"+n+"_expanded").css("height","0px"),setTimeout(function(){$("#grid_"+t.name+"_rec_"+n+"_expanded_row").remove(),$("#grid_"+t.name+"_frec_"+n+"_expanded_row").remove(),s.w2ui.expanded=!1,t.trigger($.extend(u,{phase:"after"})),t.resizeRecords()},300)}return!0},sort:function(e,t,i){var s=this.trigger({phase:"before",type:"sort",target:this.name,field:e,direction:t,multiField:i});if(!0!==s.isCancelled){if(null!=e){for(var n=this.sortData.length,r=0;r<this.sortData.length;r++)if(this.sortData[r].field==e){n=r;break}if(null==t)if(null==this.sortData[n])t="asc";else switch(String(this.sortData[n].direction)){case"asc":t="desc";break;case"desc":default:t="asc"}!1===this.multiSort&&(this.sortData=[],n=0),1!=i&&(this.sortData=[],n=0),null==this.sortData[n]&&(this.sortData[n]={}),this.sortData[n].field=e,this.sortData[n].direction=t}else this.sortData=[];("object"!=typeof this.url?this.url:this.url.get)?(this.trigger($.extend(s,{phase:"after"})),this.last.xhr_offset=0,this.reload()):(this.localSort(!0,!0),0<this.searchData.length&&this.localSearch(!0),this.last.scrollTop=0,$("#grid_"+this.name+"_records").prop("scrollTop",0),this.trigger($.extend(s,{phase:"after"})),this.refresh())}},copy:function(e,t){if($.isPlainObject(e))return this.trigger($.extend(e,{phase:"after"})),e.text;var i=this.getSelection();if(0===i.length)return"";var s,n="";if("object"==typeof i[0]){for(var r=i[0].column,a=i[0].column,o=[],l=0;l<i.length;l++)i[l].column<r&&(r=i[l].column),i[l].column>a&&(a=i[l].column),-1==o.indexOf(i[l].index)&&o.push(i[l].index);o.sort(function(e,t){return e-t});for(var d=0;d<o.length;d++){for(var u=o[d],c=r;c<=a;c++){!0!==(p=this.columns[c]).hidden&&(n+=w2utils.stripTags(this.getCellHTML(u,c))+"\t")}n=n.substr(0,n.length-1),n+="\n"}}else{for(c=0;c<this.columns.length;c++){if(!0!==(p=this.columns[c]).hidden){var h=p.caption?p.caption:p.field;p.caption&&p.caption.length<3&&p.tooltip&&(h=p.tooltip),n+='"'+w2utils.stripTags(h)+'"\t'}}n=n.substr(0,n.length-1),n+="\n";for(l=0;l<i.length;l++){for(u=this.get(i[l],!0),c=0;c<this.columns.length;c++){var p;!0!==(p=this.columns[c]).hidden&&(n+='"'+w2utils.stripTags(this.getCellHTML(u,c))+'"\t')}n=n.substr(0,n.length-1),n+="\n"}}return n=n.substr(0,n.length-1),null==e?!0===(s=this.trigger({phase:"before",type:"copy",target:this.name,text:n,originalEvent:t})).isCancelled?"":(n=s.text,this.trigger($.extend(s,{phase:"after"})),n):!1===e?!0===(s=this.trigger({phase:"before",type:"copy",target:this.name,text:n,originalEvent:t})).isCancelled?"":(n=s.text,s):void 0},paste:function(e){var t=this.getSelection(),i=this.get(t[0].recid,!0),s=t[0].column,n=this.trigger({phase:"before",type:"paste",target:this.name,text:e,index:i,column:s});if(!0!==n.isCancelled){if(e=n.text,"row"==this.selectType||0===t.length)return console.log("ERROR: You can paste only if grid.selectType = 'cell' and when at least one cell selected."),void this.trigger($.extend(n,{phase:"after"}));for(var r=[],a=(e=e.split("\n"),0);a<e.length;a++){var o=e[a].split("\t"),l=0,d=this.records[i],u=[];if(null!=d){for(var c=0;c<o.length;c++)if(this.columns[s+l]){var h=this.columns[s+l].field;d.w2ui=d.w2ui||{},d.w2ui.changes=d.w2ui.changes||{},d.w2ui.changes[h]=o[c],u.push(s+l),l++}for(var p=0;p<u.length;p++)r.push({recid:d.recid,column:u[p]});i++}}this.selectNone(),this.select.apply(this,r),this.refresh(),this.trigger($.extend(n,{phase:"after"}))}},resize:function(){var e=this,t=(new Date).getTime();if(this.box&&$(this.box).attr("name")==this.name){$(this.box).find("> div.w2ui-grid-box").css("width",$(this.box).width()).css("height",$(this.box).height());var i=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==i.isCancelled)return e.resizeBoxes(),e.resizeRecords(),e.toolbar&&e.toolbar.resize&&e.toolbar.resize(),this.trigger($.extend(i,{phase:"after"})),(new Date).getTime()-t}},update:function(e){var t=(new Date).getTime();if(null==this.box)return 0;if(null==e){for(var i=this.last.range_start-1;i<=this.last.range_end-1;i++)if(!(i<0)){(a=this.records[i]||{}).w2ui||(a.w2ui={});for(var s=0;s<this.columns.length;s++){var n=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(a.recid));(o=$(this.box).find("#grid_"+this.name+"_data_"+i+"_"+s)).replaceWith(this.getCellHTML(i,s,!1)),o=$(this.box).find("#grid_"+this.name+"_data_"+i+"_"+s),null==a.w2ui.style||$.isEmptyObject(a.w2ui.style)?o.attr("style",""):("string"==typeof a.w2ui.style&&n.attr("style",a.w2ui.style),$.isPlainObject(a.w2ui.style)&&"string"==typeof a.w2ui.style[s]&&o.attr("style",a.w2ui.style[s])),null==a.w2ui.class||$.isEmptyObject(a.w2ui.class)||("string"==typeof a.w2ui.class&&n.addClass(a.w2ui.class),$.isPlainObject(a.w2ui.class)&&"string"==typeof a.w2ui.class[s]&&o.addClass(a.w2ui.class[s]))}}}else for(var r=0;r<e.length;r++){i=e[r].index,s=e[r].column;if(!(i<0))if(null!=i&&null!=s){var a=this.records[i]||{},o=(n=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(a.recid)),$(this.box).find("#grid_"+this.name+"_data_"+i+"_"+s));a.w2ui||(a.w2ui={}),o.replaceWith(this.getCellHTML(i,s,!1)),o=$(this.box).find("#grid_"+this.name+"_data_"+i+"_"+s),null==a.w2ui.style||$.isEmptyObject(a.w2ui.style)?o.attr("style",""):("string"==typeof a.w2ui.style&&n.attr("style",a.w2ui.style),$.isPlainObject(a.w2ui.style)&&"string"==typeof a.w2ui.style[s]&&o.attr("style",a.w2ui.style[s])),null==a.w2ui.class||$.isEmptyObject(a.w2ui.class)||("string"==typeof a.w2ui.class&&n.addClass(a.w2ui.class),$.isPlainObject(a.w2ui.class)&&"string"==typeof a.w2ui.class[s]&&o.addClass(a.w2ui.class[s]))}else console.log("ERROR: Wrong argument for grid.update(cells), cells should be [{ index: X, column: Y }, ...]")}return(new Date).getTime()-t},refreshCell:function(e,t){var i=this.get(e,!0),s=!this.records[i]||this.records[i].recid!=e,n=this.getColumn(t,!0),r=s?this.summary[i]:this.records[i],a=this.columns[n],o=$(this.box).find("#grid_"+this.name+"_data_"+i+"_"+n);if(null==r)return!1;o.replaceWith(this.getCellHTML(i,n,s)),o=$(this.box).find("#grid_"+this.name+"_data_"+i+"_"+n),r.w2ui&&r.w2ui.changes&&null!=r.w2ui.changes[a.field]?o.addClass("w2ui-changed"):o.removeClass("w2ui-changed"),r.w2ui&&null!=r.w2ui.style&&!$.isEmptyObject(r.w2ui.style)?("string"==typeof r.w2ui.style&&$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(r.recid)).attr("style",r.w2ui.style),$.isPlainObject(r.w2ui.style)&&"string"==typeof r.w2ui.style[n]&&o.attr("style",r.w2ui.style[n])):o.attr("style",""),r.w2ui&&null!=r.w2ui.class&&!$.isEmptyObject(r.w2ui.class)&&("string"==typeof r.w2ui.class&&$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(r.recid)).addClass(r.w2ui.class),$.isPlainObject(r.w2ui.class)&&"string"==typeof r.w2ui.class[n]&&o.addClass(r.w2ui.class[n]))},refreshRow:function(e,t){var i=$(this.box).find("#grid_"+this.name+"_frec_"+w2utils.escapeId(e)),s=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(e));if(0<i.length){null==t&&(t=this.get(e,!0));var n=i.attr("line"),r=!this.records[t]||this.records[t].recid!=e,a="object"!=typeof this.url?this.url:this.url.get;if(0<this.searchData.length&&!a)for(var o=0;o<this.last.searchIds.length;o++)this.last.searchIds[o]==t&&(t=o);var l=this.getRecordHTML(t,n,r);$(i).replaceWith(l[0]),$(s).replaceWith(l[1]);var d=this.records[t].w2ui?this.records[t].w2ui.style:"";if("string"==typeof d){i=$(this.box).find("#grid_"+this.name+"_frec_"+w2utils.escapeId(e)),s=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(e));i.attr("custom_style",d),s.attr("custom_style",d),i.hasClass("w2ui-selected")&&(d=d.replace("background-color","none")),i[0].style.cssText="height: "+this.recordHeight+"px;"+d,s[0].style.cssText="height: "+this.recordHeight+"px;"+d}r&&this.resize()}},refresh:function(){var n=this,e=(new Date).getTime(),t="object"!=typeof this.url?this.url:this.url.get;if(this.total<=0&&!t&&0===this.searchData.length&&(this.total=this.records.length),this.toolbar.disable("w2ui-edit","w2ui-delete"),this.box){var i=this.trigger({phase:"before",target:this.name,type:"refresh"});if(!0!==i.isCancelled){if(this.show.header?$("#grid_"+this.name+"_header").html(this.header+"&#160;").show():$("#grid_"+this.name+"_header").hide(),this.show.toolbar){if(this.toolbar&&this.toolbar.get("w2ui-column-on-off")&&this.toolbar.get("w2ui-column-on-off").checked);else if($("#grid_"+this.name+"_toolbar").show(),"object"==typeof this.toolbar)for(var s=this.toolbar.items,r=0;r<s.length;r++)"w2ui-search"!=s[r].id&&"break"!=s[r].type&&this.toolbar.refresh(s[r].id)}else $("#grid_"+this.name+"_toolbar").hide();this.searchClose();var a=$("#grid_"+n.name+"_search_all");!this.multiSearch&&"all"==this.last.field&&0<this.searches.length&&(this.last.field=this.searches[0].field,this.last.caption=this.searches[0].caption);for(var o=0;o<this.searches.length;o++)this.searches[o].field==this.last.field&&(this.last.caption=this.searches[o].caption);if(this.last.multi?(a.attr("placeholder","["+w2utils.lang("Multiple Fields")+"]"),a.w2field("clear")):a.attr("placeholder",w2utils.lang(this.last.caption)),a.val()!=this.last.search){var l=this.last.search;(s=a.data("w2field"))&&(l=s.format(l)),a.val(l)}n.refreshBody(),this.show.footer?$("#grid_"+this.name+"_footer").html(this.getFooterHTML()).show():$("#grid_"+this.name+"_footer").hide();var d=$("#grid_"+this.name+"_searchClear");d.hide(),this.searchData.some(function(e){var t=n.getSearch(e.field);if(n.last.multi||t&&!t.hidden&&"list"!=t.type)return d.show(),!0});var u=this.last.selection,c=0<this.records.length&&u.indexes.length==this.records.length,h=0<u.indexes.length&&0!==this.searchData.length&&u.indexes.length==this.last.searchIds.length;c||h?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status();for(var p=n.find({"w2ui.expanded":!0},!0),f=0;f<p.length;f++){(s=n.records[p[f]].w2ui)&&!Array.isArray(s.children)&&(s.expanded=!1)}return n.markSearch&&setTimeout(function(){for(var e=[],t=0;t<n.searchData.length;t++){var i=n.searchData[t],s=n.getSearch(i.field);s&&!s.hidden&&(-1==e.indexOf(i.value)&&e.push(i.value))}0<e.length&&$(n.box).find(".w2ui-grid-data > div").w2marker(e)},50),this.show.toolbarSave&&(0<this.getChanges().length?this.toolbar.enable("w2ui-save"):this.toolbar.disable("w2ui-save")),this.trigger($.extend(i,{phase:"after"})),n.resize(),n.addRange("selection"),setTimeout(function(){n.resize(),n.scroll()},1),n.reorderColumns&&!n.last.columnDrag?n.last.columnDrag=n.initColumnDrag():!n.reorderColumns&&n.last.columnDrag&&n.last.columnDrag.remove(),(new Date).getTime()-e}}},refreshBody:function(){var e=this.find({"w2ui.summary":!0},!0);if(0<e.length){for(var t=0;t<e.length;t++)this.summary.push(this.records[e[t]]);for(t=e.length-1;0<=t;t--)this.records.splice(e[t],1)}this.scroll();var i=this.getRecordsHTML(),s=this.getColumnsHTML(),n='<div id="grid_'+this.name+'_frecords" class="w2ui-grid-frecords" style="margin-bottom: '+(w2utils.scrollBarSize()-1)+'px;">'+i[0]+'</div><div id="grid_'+this.name+'_records" class="w2ui-grid-records" onscroll="w2ui[\''+this.name+"'].scroll(event);\">"+i[1]+'</div><div id="grid_'+this.name+'_scroll1" class="w2ui-grid-scroll1" style="height: '+w2utils.scrollBarSize()+'px"></div><div id="grid_'+this.name+'_fcolumns" class="w2ui-grid-fcolumns">    <table><tbody>'+s[0]+'</tbody></table></div><div id="grid_'+this.name+'_columns" class="w2ui-grid-columns">    <table><tbody>'+s[1]+"</tbody></table></div>";if($("#grid_"+this.name+"_body").html(n),0===this.records.length&&this.msgEmpty?$("#grid_"+this.name+"_body").append('<div id="grid_'+this.name+'_empty_msg" class="w2ui-grid-empty-msg"><div>'+this.msgEmpty+"</div></div>"):0<$("#grid_"+this.name+"_empty_msg").length&&$("#grid_"+this.name+"_empty_msg").remove(),0<this.summary.length){var r=this.getSummaryHTML();$("#grid_"+this.name+"_fsummary").html(r[0]).show(),$("#grid_"+this.name+"_summary").html(r[1]).show()}else $("#grid_"+this.name+"_fsummary").hide(),$("#grid_"+this.name+"_summary").hide()},render:function(e){var k=this,t=(new Date).getTime();if(null!=e&&(0<$(this.box).find("#grid_"+this.name+"_body").length&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid").html(""),this.box=e),this.box){var i="object"!=typeof this.url?this.url:this.url.get,s=this.trigger({phase:"before",target:this.name,type:"render",box:e});if(!0!==s.isCancelled){if(this.reset(!0),!this.last.field)if(this.multiSearch&&this.show.searchAll)this.last.field="all",this.last.caption=w2utils.lang("All Fields");else{for(var n=0;n<this.searches.length&&(this.searches[n].hidden||!1===this.searches[n].simple);)n++;n>=this.searches.length?(this.last.field="",this.last.caption=""):(this.last.field=this.searches[n].field,this.last.caption=this.searches[n].caption)}if($(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-grid").html('<div class="w2ui-grid-box">    <div id="grid_'+this.name+'_header" class="w2ui-grid-header"></div>    <div id="grid_'+this.name+'_toolbar" class="w2ui-grid-toolbar"></div>    <div id="grid_'+this.name+'_body" class="w2ui-grid-body"></div>    <div id="grid_'+this.name+'_fsummary" class="w2ui-grid-body w2ui-grid-summary"></div>    <div id="grid_'+this.name+'_summary" class="w2ui-grid-body w2ui-grid-summary"></div>    <div id="grid_'+this.name+'_footer" class="w2ui-grid-footer"></div>    <textarea id="grid_'+this.name+'_focus" class="w2ui-grid-focus-input"></textarea></div>'),"row"!=this.selectType&&$(this.box).addClass("w2ui-ss"),0<$(this.box).length&&($(this.box)[0].style.cssText+=this.style),this.initToolbar(),null!=this.toolbar&&this.toolbar.render($("#grid_"+this.name+"_toolbar")[0]),this.last.field&&"all"!=this.last.field){var r=this.searchData;setTimeout(function(){k.initAllField(k.last.field,1==r.length?r[0].value:null)},1)}$("#grid_"+this.name+"_footer").html(this.getFooterHTML()),this.last.state||(this.last.state=this.stateSave(!0)),this.stateRestore(),i&&this.refresh();for(var C,a=!1,o=0;o<this.searches.length;o++)if(this.searches[o].hidden){a=!0;break}return a?(this.searchReset(!1),i||setTimeout(function(){k.searchReset()},1)):this.reload(),$(this.box).find("#grid_"+this.name+"_focus").on("focus",function(e){clearTimeout(k.last.kbd_timer),k.hasFocus||k.focus()}).on("blur",function(e){clearTimeout(k.last.kbd_timer),k.last.kbd_timer=setTimeout(function(){k.hasFocus&&k.blur()},100)}).on("paste",function(e){var t=this;setTimeout(function(){w2ui[k.name].paste(t.value),t.value=""},1)}).on("keydown",function(e){w2ui[k.name].keydown.call(w2ui[k.name],e)}),$(this.box).on("mousedown",function(e){if(1!=e.which)return;"text"==k.last.userSelect&&(delete k.last.userSelect,$(k.box).find(".w2ui-grid-body").css(w2utils.cssPrefix("user-select","none")));if("row"==k.selectType&&($(e.target).parents().hasClass("w2ui-head")||$(e.target).hasClass("w2ui-head")))return;if(k.last.move&&"expand"==k.last.move.type)return;if(e.altKey)$(k.box).find(".w2ui-grid-body").css(w2utils.cssPrefix("user-select","text")),k.selectNone(),k.last.move={type:"text-select"},k.last.userSelect="text";else if(k.multiSelect||k.reorderRows){for(var t=e.target,i={x:e.offsetX-10,y:e.offsetY-10},s=!1;t&&(!t.classList||!t.classList.contains("w2ui-grid"));)t.tagName&&"TD"==t.tagName.toUpperCase()&&(s=!0),t.tagName&&"TR"!=t.tagName.toUpperCase()&&1==s&&(i.x+=t.offsetLeft,i.y+=t.offsetTop),t=t.parentNode;k.last.move={x:e.screenX,y:e.screenY,divX:0,divY:0,focusX:i.x,focusY:i.y,recid:$(e.target).parents("tr").attr("recid"),column:parseInt("TD"==e.target.tagName.toUpperCase()?$(e.target).attr("col"):$(e.target).parents("td").attr("col")),type:"select",ghost:!1,start:!0},null==k.last.move.recid&&(k.last.move.type="select-column");var n=e.target,r=$(k.box).find("#grid_"+k.name+"_focus");if(k.last.move){var a=k.last.move.focusX,o=k.last.move.focusY,l=$(n).parents("table").parent();(l.hasClass("w2ui-grid-records")||l.hasClass("w2ui-grid-frecords")||l.hasClass("w2ui-grid-columns")||l.hasClass("w2ui-grid-fcolumns")||l.hasClass("w2ui-grid-summary"))&&(a=k.last.move.focusX-$(k.box).find("#grid_"+k.name+"_records").scrollLeft(),o=k.last.move.focusY-$(k.box).find("#grid_"+k.name+"_records").scrollTop()),($(n).hasClass("w2ui-grid-footer")||0<$(n).parents("div.w2ui-grid-footer").length)&&(o=$(k.box).find("#grid_"+k.name+"_footer").position().top),r.css({left:a-10,top:o})}setTimeout(function(){-1!=["INPUT","TEXTAREA","SELECT"].indexOf(n.tagName.toUpperCase())?$(n).focus():r.is(":focus")||r.focus()},50)}if(1==k.reorderRows){var d=e.target;if("TD"!=d.tagName.toUpperCase()&&(d=$(d).parents("td")[0]),$(d).hasClass("w2ui-col-number")){k.selectNone(),k.last.move.reorder=!0;var u=$(k.box).find(".w2ui-even.w2ui-empty-record").css("background-color"),c=$(k.box).find(".w2ui-odd.w2ui-empty-record").css("background-color");$(k.box).find(".w2ui-even td").not(".w2ui-col-number").css("background-color",u),$(k.box).find(".w2ui-odd td").not(".w2ui-col-number").css("background-color",c);var h=k.last.move;if(!h.ghost){var p=$("#grid_"+k.name+"_rec_"+h.recid),t=p.parents("table").find("tr:first-child").clone();h.offsetY=e.offsetY,h.from=h.recid,h.pos=p.position(),h.ghost=$(p).clone(!0),h.ghost.removeAttr("id"),p.find("td").remove(),p.append('<td colspan="1000" style="height: '+k.recordHeight+'px; background-color: #eee; border-bottom: 1px dashed #aaa; border-top: 1px dashed #aaa;"></td>');var f=$(k.box).find(".w2ui-grid-records");f.append('<table id="grid_'+k.name+'_ghost" style="position: absolute; z-index: 999999; opacity: 0.7; pointer-events: none;"></table>'),$("#grid_"+k.name+"_ghost").append(t).append(h.ghost)}var g=$("#grid_"+k.name+"_ghost"),f=$(k.box).find(".w2ui-grid-records");g.css({top:h.pos.top+f.scrollTop(),left:h.pos.left,"border-top":"1px solid #aaa","border-bottom":"1px solid #aaa"})}else k.last.move.reorder=!1}$(document).on("mousemove",m),$(document).on("mouseup",w),e.stopPropagation()}),this.trigger($.extend(s,{phase:"after"})),0===$(".w2ui-layout").length&&$(window).off("resize.w2ui-"+this.name).on("resize.w2ui-"+this.name,function(e){w2ui[k.name].resize()}),(new Date).getTime()-t}}function m(e){var t=k.last.move;if(t&&-1!=["select","select-column"].indexOf(t.type)&&(t.divX=e.screenX-t.x,t.divY=e.screenY-t.y,!(Math.abs(t.divX)<=1&&Math.abs(t.divY)<=1)))if(k.last.cancelClick=!0,1==k.reorderRows&&k.last.move.reorder){if((r=(u=$(e.target).parents("tr")).attr("recid"))!=t.from){$("#grid_"+k.name+"_rec_"+t.recid);var i=$("#grid_"+k.name+"_rec_"+r);$(k.box).find(".tmp-ghost").css("border-top","0px"),i.addClass("tmp-ghost").css("border-top","2px solid #769EFC"),t.lastY=e.screenY,t.to=r}var s=$("#grid_"+k.name+"_ghost"),n=$(k.box).find(".w2ui-grid-records");s.css({top:t.pos.top+t.divY+n.scrollTop(),left:t.pos.left})}else{t.start&&t.recid&&(k.selectNone(),t.start=!1);var r,a=[];if(null==(r="TR"==e.target.tagName.toUpperCase()?$(e.target).attr("recid"):$(e.target).parents("tr").attr("recid"))){if("row"==k.selectType)return;if(k.last.move&&"select"==k.last.move.type)return;var o=parseInt($(e.target).parents("td").attr("col"));if(isNaN(o))k.removeRange("column-selection"),$(k.box).find(".w2ui-grid-columns .w2ui-col-header, .w2ui-grid-fcolumns .w2ui-col-header").removeClass("w2ui-col-selected"),$(k.box).find(".w2ui-col-number").removeClass("w2ui-row-selected"),delete t.colRange;else{var l=o+"-"+o;t.column<o&&(l=t.column+"-"+o),t.column>o&&(l=o+"-"+t.column);for(var d=[],u=l.split("-"),c=parseInt(u[0]);c<=parseInt(u[1]);c++)d.push(c);if(t.colRange!=l&&!0!==(C=k.trigger({phase:"before",type:"columnSelect",target:k.name,columns:d,isCancelled:!1})).isCancelled){null==t.colRange&&k.selectNone();u=l.split("-");$(k.box).find(".w2ui-grid-columns .w2ui-col-header, .w2ui-grid-fcolumns .w2ui-col-header").removeClass("w2ui-col-selected");for(var h=parseInt(u[0]);h<=parseInt(u[1]);h++)$(k.box).find("#grid_"+k.name+"_column_"+h+" .w2ui-col-header").addClass("w2ui-col-selected");$(k.box).find(".w2ui-col-number").not(".w2ui-head").addClass("w2ui-row-selected"),t.colRange=l,k.removeRange("column-selection"),k.addRange({name:"column-selection",range:[{recid:k.records[0].recid,column:u[0]},{recid:k.records[k.records.length-1].recid,column:u[1]}],style:"background-color: rgba(90, 145, 234, 0.1)"})}}}else{var p=k.get(t.recid,!0);if(null==p||k.records[p]&&k.records[p].recid!=t.recid)return;var f=k.get(r,!0);if(null==f)return;var g=parseInt(t.column),m=parseInt("TD"==e.target.tagName.toUpperCase()?$(e.target).attr("col"):$(e.target).parents("td").attr("col"));if(isNaN(g)&&isNaN(m)&&(g=0,m=k.columns.length-1),f<p){u=p;p=f,f=u}u="ind1:"+p+",ind2;"+f+",col1:"+g+",col2:"+m;if(t.range==u)return;t.range=u;for(var w=p;w<=f;w++)if(!(0<k.last.searchIds.length&&-1==k.last.searchIds.indexOf(w)))if("row"!=k.selectType){if(m<g){u=g;g=m,m=u}u=[];for(var v=g;v<=m;v++)k.columns[v].hidden||a.push({recid:k.records[w].recid,column:parseInt(v)})}else a.push(k.records[w].recid);if("row"!=k.selectType){for(var y=k.getSelection(),b=(u=[],0);b<a.length;b++){for(var x=!1,_=0;_<y.length;_++)a[b].recid==y[_].recid&&a[b].column==y[_].column&&(x=!0);x||u.push({recid:a[b].recid,column:a[b].column})}k.select.apply(k,u);for(u=[],_=0;_<y.length;_++){for(x=!1,b=0;b<a.length;b++)a[b].recid==y[_].recid&&a[b].column==y[_].column&&(x=!0);x||u.push({recid:y[_].recid,column:y[_].column})}k.unselect.apply(k,u)}else if(k.multiSelect){for(y=k.getSelection(),b=0;b<a.length;b++)-1==y.indexOf(a[b])&&k.select(a[b]);for(_=0;_<y.length;_++)-1==a.indexOf(y[_])&&k.unselect(y[_])}}}}function w(e){var t=k.last.move;if(setTimeout(function(){delete k.last.cancelClick},1),!$(e.target).parents().hasClass(".w2ui-head")&&!$(e.target).hasClass(".w2ui-head")){if(t&&-1!=["select","select-column"].indexOf(t.type)){if(null!=t.colRange&&!0!==C.isCancelled){for(var i=t.colRange.split("-"),s=[],n=0;n<k.records.length;n++){for(var r=[],a=parseInt(i[0]);a<=parseInt(i[1]);a++)r.push(a);s.push({recid:k.records[n].recid,column:r})}k.removeRange("column-selection"),k.trigger($.extend(C,{phase:"after"})),k.select.apply(k,s)}if(1==k.reorderRows&&k.last.move.reorder){var o=k.trigger({phase:"before",target:k.name,type:"reorderRow",recid:t.from,moveAfter:t.to});if(!0===o.isCancelled)return $("#grid_"+k.name+"_ghost").remove(),void k.refresh();var l=k.get(t.from,!0),d=k.get(t.to,!0);i=k.records[l];null!=l&&null!=d&&(k.records.splice(l,1),d<l?k.records.splice(d,0,i):k.records.splice(d-1,0,i)),$("#grid_"+k.name+"_ghost").remove(),k.refresh(),k.trigger($.extend(o,{phase:"after"}))}}delete k.last.move,$(document).off("mousemove",m),$(document).off("mouseup",w)}}},destroy:function(){var e=this.trigger({phase:"before",target:this.name,type:"destroy"});!0!==e.isCancelled&&($(window).off("resize.w2ui-"+this.name),"object"==typeof this.toolbar&&this.toolbar.destroy&&this.toolbar.destroy(),0<$(this.box).find("#grid_"+this.name+"_body").length&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid").html(""),delete w2ui[this.name],this.trigger($.extend(e,{phase:"after"})))},initColumnOnOff:function(){if(this.show.toolbarColumns){for(var e=this,t='<div class="w2ui-col-on-off"><table><tbody><tr id="grid_'+this.name+'_column_ln_check" onclick="w2ui[\''+e.name+'\'].columnOnOff(event, \'line-numbers\'); event.stopPropagation();">   <td style="width: 30px; text-align: center; padding-right: 3px; color: #888;">      <span class="w2ui-column-check w2ui-icon-'+(e.show.lineNumbers?"check":"empty")+'"></span>   </td>   <td onclick="jQuery(\'.w2ui-overlay\')[0].hide();">      <label>'+w2utils.lang("Line #")+"</label>   </td></tr>",i=0;i<this.columns.length;i++){var s=this.columns[i],n=this.columns[i].caption;!1!==s.hideable&&(!n&&this.columns[i].tooltip&&(n=this.columns[i].tooltip),n||(n="- column "+(parseInt(i)+1)+" -"),t+='<tr id="grid_'+this.name+"_column_"+i+'_check"        onclick="w2ui[\''+e.name+"'].columnOnOff(event, '"+s.field+'\'); event.stopPropagation();">   <td style="width: 30px; text-align: center; padding-right: 3px; color: #888;">      <span class="w2ui-column-check w2ui-icon-'+(s.hidden?"empty":"check")+'"></span>   </td>   <td onclick="jQuery(\'.w2ui-overlay\')[0].hide();">       <label>'+w2utils.stripTags(n)+"</label>   </td></tr>")}var r="object"!=typeof this.url?this.url:this.url.get;(r&&e.show.skipRecords||e.show.saveRestoreState)&&(t+='<tr style="pointer-events: none"><td colspan="2"><div style="border-top: 1px solid #ddd;"></div></td></tr>'),r&&e.show.skipRecords&&(t+='<tr><td colspan="2" style="padding: 0px">    <div style="cursor: pointer; padding: 2px 8px; cursor: default">'+w2utils.lang("Skip")+'        <input type="text" style="width: 60px" value="'+this.offset+'"             onkeydown="if ([48,49,50,51,52,53,54,55,56,57,58,13,8,46,37,39].indexOf(event.keyCode) == -1) { event.preventDefault() }"            onkeypress="if (event.keyCode == 13) {                w2ui[\''+e.name+"'].skip(this.value);                jQuery('.w2ui-overlay')[0].hide();             }\"/> "+w2utils.lang("Records")+"    </div></td></tr>"),e.show.saveRestoreState&&(t+='<tr><td colspan="2" onclick="var obj = w2ui[\''+e.name+"']; obj.toolbar.uncheck('w2ui-column-on-off'); obj.stateSave();\">    <div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">"+w2utils.lang("Save Grid State")+'</div></td></tr><tr><td colspan="2" onclick="var obj = w2ui[\''+e.name+"']; obj.toolbar.uncheck('w2ui-column-on-off'); obj.stateReset();\">    <div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">"+w2utils.lang("Restore Default State")+"</div></td></tr>"),t+="</tbody></table></div>",this.toolbar.get("w2ui-column-on-off").html=t}},initColumnDrag:function(e){if(this.columnGroups&&this.columnGroups.length)throw"Draggable columns are not currently supported with column groups.";var u=this,c={};function t(){c.pressed=!1,clearTimeout(c.timeout)}function i(l){c.timeout&&clearTimeout(c.timeout);var d=this;c.pressed=!0,c.timeout=setTimeout(function(){if(c.pressed){var e,t,i,s,n,r=["w2ui-col-number","w2ui-col-expand","w2ui-col-select"].concat(["w2ui-head-last"]);if($(l.originalEvent.target).parents().hasClass("w2ui-head")){for(var a=0,o=r.length;a<o;a++)if($(l.originalEvent.target).parents().hasClass(r[a]))return;if(c.numberPreColumnsPresent=$(u.box).find(".w2ui-head.w2ui-col-number, .w2ui-head.w2ui-col-expand, .w2ui-head.w2ui-col-select").length,c.columnHead=s=$(l.originalEvent.target).parents(".w2ui-head"),n=parseInt(s.attr("col"),10),!0===(e=u.trigger({type:"columnDragStart",phase:"before",originalEvent:l,origColumnNumber:n,target:s[0]})).isCancelled)return!1;t=c.columns=$(u.box).find(".w2ui-head:not(.w2ui-head-last)"),$(document).on("mouseup",p),$(document).on("mousemove",h),c.originalPos=parseInt($(l.originalEvent.target).parent(".w2ui-head").attr("col"),10),c.ghost=$(d).clone(!0),$(c.ghost).find('[col]:not([col="'+c.originalPos+'"]), .w2ui-toolbar, .w2ui-grid-header').remove(),$(c.ghost).find(".w2ui-col-number, .w2ui-col-expand, .w2ui-col-select").remove(),$(c.ghost).find(".w2ui-grid-body").css({top:0}),i=$(c.ghost).find('[col="'+c.originalPos+'"]'),$(document.body).append(c.ghost),$(c.ghost).css({width:0,height:0,margin:0,position:"fixed",zIndex:999999,opacity:0}).addClass(".w2ui-grid-ghost").animate({width:i.width(),height:$(u.box).find(".w2ui-grid-body:first").height(),left:l.pageX,top:l.pageY,opacity:.8},0),c.offsets=[];for(a=0,o=t.length;a<o;a++)c.offsets.push($(t[a]).offset().left);u.trigger($.extend(e,{phase:"after"}))}}},150)}function h(e){if(c.pressed){var t,i,s=e.originalEvent.pageX,n=e.originalEvent.pageY,r=c.offsets,a=$(".w2ui-head:not(.w2ui-head-last)").width();c.targetInt=Math.max(c.numberPreColumnsPresent,function(e,t,i){{if(e<=t[0])return 0;if(e>=t[t.length-1]+i)return t.length;for(var s=0,n=t.length;s<n;s++){var r=t[s],a=t[s+1]||t[s]+i,o=(a-t[s])/2+t[s];if(r<e&&e<=o)return s;if(o<e&&e<=a)return s+1}return intersection}}(s,r,a)),function(e){c.marker||c.markerLeft||(c.marker=$('<div class="col-intersection-marker"><div class="top-marker"></div><div class="bottom-marker"></div></div>'),c.markerLeft=$('<div class="col-intersection-marker"><div class="top-marker"></div><div class="bottom-marker"></div></div>'));c.lastInt&&c.lastInt===e||(c.lastInt=e,c.marker.remove(),c.markerLeft.remove(),$(".w2ui-head").removeClass("w2ui-col-intersection"),e>=c.columns.length?($(c.columns[c.columns.length-1]).children("div:last").append(c.marker.addClass("right").removeClass("left")),$(c.columns[c.columns.length-1]).addClass("w2ui-col-intersection")):e<=c.numberPreColumnsPresent?($(c.columns[c.numberPreColumnsPresent]).prepend(c.marker.addClass("left").removeClass("right")).css({position:"relative"}),$(c.columns[c.numberPreColumnsPresent]).prev().addClass("w2ui-col-intersection")):($(c.columns[e]).children("div:last").prepend(c.marker.addClass("left").removeClass("right")),$(c.columns[e]).prev().children("div:last").append(c.markerLeft.addClass("right").removeClass("left")).css({position:"relative"}),$(c.columns[e-1]).addClass("w2ui-col-intersection")))}(c.targetInt),t=s,i=n,$(c.ghost).css({left:t-10,top:i-10})}}function p(e){c.pressed=!1;var t,i,s,n,r,a=$(".w2ui-grid-ghost");if(!0===(t=u.trigger({type:"columnDragEnd",phase:"before",originalEvent:e,target:c.columnHead[0]})).isCancelled)return!1;s=u.columns[c.originalPos],n=u.columns,r=$(c.columns[Math.min(c.lastInt,c.columns.length-1)]),(i=c.lastInt<c.columns.length?parseInt(r.attr("col")):n.length)!==c.originalPos+1&&i!==c.originalPos&&r&&r.length?($(c.ghost).animate({top:$(u.box).offset().top,left:r.offset().left,width:0,height:0,opacity:.2},300,function(){$(this).remove(),a.remove()}),n.splice(i,0,$.extend({},s)),n.splice(n.indexOf(s),1)):($(c.ghost).remove(),a.remove()),$(document).off("mouseup",p),$(document).off("mousemove",h),c.marker&&c.marker.remove(),c={},u.refresh(),u.trigger($.extend(t,{phase:"after",targetColumnNumber:i-1}))}return c.lastInt=null,c.pressed=!1,c.timeout=null,c.columnHead=null,$(u.box).on("mousedown",i),$(u.box).on("mouseup",t),{remove:function(){$(u.box).off("mousedown",i),$(u.box).off("mouseup",t),$(u.box).find(".w2ui-head").removeAttr("draggable"),u.last.columnDrag=!1}}},columnOnOff:function(e,t){var i=$(e.target).parents("tr").find(".w2ui-column-check"),s=this.trigger({phase:"before",target:this.name,type:"columnOnOff",field:t,originalEvent:e});if(!0!==s.isCancelled){for(var n=this,r=n.find({"w2ui.expanded":!0},!0),a=0;a<r.length;a++){var o=this.records[a].w2ui;o&&!Array.isArray(o.children)&&(this.records[a].w2ui.expanded=!1)}if("line-numbers"==t)this.show.lineNumbers=!this.show.lineNumbers,this.show.lineNumbers?i.addClass("w2ui-icon-check").removeClass("w2ui-icon-empty"):i.addClass("w2ui-icon-empty").removeClass("w2ui-icon-check"),this.refreshBody(),this.resizeRecords();else{var l=this.getColumn(t);l.hidden?(i.addClass("w2ui-icon-check").removeClass("w2ui-icon-empty"),this.showColumn(l.field)):(i.addClass("w2ui-icon-empty").removeClass("w2ui-icon-check"),this.hideColumn(l.field))}e.shiftKey||e.metaKey||e.ctrlKey||setTimeout(function(){$().w2overlay({name:n.name+"_toolbar"})},150),this.trigger($.extend(s,{phase:"after"}))}},scrollToColumn:function(e){if(null!=e){for(var t=0,i=!1,s=0;s<this.columns.length;s++){var n=this.columns[s];if(n.field==e){i=!0;break}if(!n.frozen&&!n.hidden)t+=parseInt(n.sizeCalculated?n.sizeCalculated:n.size)}i&&(this.last.scrollLeft=t+1,this.scroll())}},initToolbar:function(){var o=this;if(null==this.toolbar.render){var e=this.toolbar.items;if(this.toolbar.items=[],this.toolbar=$().w2toolbar($.extend(!0,{},this.toolbar,{name:this.name+"_toolbar",owner:this})),this.show.toolbarReload&&this.toolbar.items.push($.extend(!0,{},this.buttons.reload)),this.show.toolbarColumns&&this.toolbar.items.push($.extend(!0,{},this.buttons.columns)),(this.show.toolbarReload||this.show.toolbarColumns)&&this.toolbar.items.push({type:"break",id:"w2ui-break0"}),this.show.toolbarInput){var t='<div class="w2ui-toolbar-search"><table cellpadding="0" cellspacing="0"><tbody><tr>    <td>'+this.buttons.search.html+'</td>    <td>        <input type="text" id="grid_'+this.name+'_search_all" class="w2ui-search-all" tabindex="-1"             placeholder="'+w2utils.lang(this.last.caption)+'" value="'+this.last.search+'"            onfocus="clearTimeout(w2ui[\''+this.name+'\'].last.kbd_timer);"            onkeydown="if (event.keyCode == 13 &amp;&amp; w2utils.isIE) this.onchange();"            onchange="                var grid = w2ui[\''+this.name+"'];                 var val = this.value;                 var sel = jQuery(this).data('selected');                var fld = jQuery(this).data('w2field');                 if (fld) val = fld.clean(val);                if (fld &amp;&amp; fld.type == 'list' &amp;&amp; sel &amp;&amp; typeof sel.id == 'undefined') {                   grid.searchReset();                } else {                   grid.search(grid.last.field, val);                }            \"/>    </td>    <td>        <div class=\"w2ui-search-clear\" id=\"grid_"+this.name+'_searchClear"               onclick="var obj = w2ui[\''+this.name+'\']; obj.searchReset();" style="display: none"        >&#160;&#160;</div>    </td></tr></tbody></table></div>';this.toolbar.items.push({type:"html",id:"w2ui-search",html:t})}if(this.show.toolbarSearch&&this.multiSearch&&0<this.searches.length&&this.toolbar.items.push($.extend(!0,{},this.buttons["search-go"])),(this.show.toolbarSearch||this.show.toolbarInput)&&(this.show.toolbarAdd||this.show.toolbarEdit||this.show.toolbarDelete||this.show.toolbarSave)&&this.toolbar.items.push({type:"break",id:"w2ui-break1"}),this.show.toolbarAdd&&this.toolbar.items.push($.extend(!0,{},this.buttons.add)),this.show.toolbarEdit&&this.toolbar.items.push($.extend(!0,{},this.buttons.edit)),this.show.toolbarDelete&&this.toolbar.items.push($.extend(!0,{},this.buttons.delete)),this.show.toolbarSave&&((this.show.toolbarAdd||this.show.toolbarDelete||this.show.toolbarEdit)&&this.toolbar.items.push({type:"break",id:"w2ui-break2"}),this.toolbar.items.push($.extend(!0,{},this.buttons.save))),e)for(var i=0;i<e.length;i++)this.toolbar.items.push(e[i]);o=this;this.toolbar.on("click",function(e){if(!0!==(n=o.trigger({phase:"before",type:"toolbar",target:e.target,originalEvent:e})).isCancelled){var t=e.target;switch(t){case"w2ui-reload":var i=o.trigger({phase:"before",type:"reload",target:o.name});if(!0===i.isCancelled)return!1;o.reload(),o.trigger($.extend(i,{phase:"after"}));break;case"w2ui-column-on-off":o.initColumnOnOff(),o.initResize(),o.resize();break;case"w2ui-search-advanced":var s=this;if(this.get(t).checked)o.searchClose(),setTimeout(function(){s.uncheck(t)},1);else{o.searchOpen(),e.originalEvent.stopPropagation(),$(document).on("click","body",function e(){!0!==$("#w2ui-overlay-"+o.name+"-searchOverlay").data("keepOpen")&&(s.uncheck(t),$(document).off("click","body",e))})}break;case"w2ui-add":var n=o.trigger({phase:"before",target:o.name,type:"add",recid:null});o.trigger($.extend(n,{phase:"after"})),setTimeout(function(){$().w2tag()},20);break;case"w2ui-edit":var r=o.getSelection(),a=null;1==r.length&&(a=r[0]);n=o.trigger({phase:"before",target:o.name,type:"edit",recid:a});o.trigger($.extend(n,{phase:"after"})),setTimeout(function(){$().w2tag()},20);break;case"w2ui-delete":o.delete();break;case"w2ui-save":o.save()}o.trigger($.extend(n,{phase:"after"}))}})}},initResize:function(){var s=this;$(this.box).find(".w2ui-resizer").off("click").on("click",function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault&&e.preventDefault()}).off("mousedown").on("mousedown",function(e){e||(e=window.event),s.resizing=!0,s.last.tmp={x:e.screenX,y:e.screenY,gx:e.screenX,gy:e.screenY,col:parseInt($(this).attr("name"))},e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault&&e.preventDefault();for(var t=0;t<s.columns.length;t++)s.columns[t].hidden||(null==s.columns[t].sizeOriginal&&(s.columns[t].sizeOriginal=s.columns[t].size),s.columns[t].size=s.columns[t].sizeCalculated);var i={phase:"before",type:"columnResize",target:s.name,column:s.last.tmp.col,field:s.columns[s.last.tmp.col].field};i=s.trigger($.extend(i,{resizeBy:0,originalEvent:e}));$(document).on("mousemove","body",function(e){1==s.resizing&&(e||(e=window.event),!0!==(i=s.trigger($.extend(i,{resizeBy:e.screenX-s.last.tmp.gx,originalEvent:e}))).isCancelled?(s.last.tmp.x=e.screenX-s.last.tmp.x,s.last.tmp.y=e.screenY-s.last.tmp.y,s.columns[s.last.tmp.col].size=parseInt(s.columns[s.last.tmp.col].size)+s.last.tmp.x+"px",s.resizeRecords(),s.scroll(),s.last.tmp.x=e.screenX,s.last.tmp.y=e.screenY):i.isCancelled=!1)}),$(document).on("mouseup","body",function(e){delete s.resizing,$(document).off("mousemove","body"),$(document).off("mouseup","body"),s.resizeRecords(),s.scroll(),s.trigger($.extend(i,{phase:"after",originalEvent:e}))})}).each(function(e,t){var i=$(t).parent();$(t).css({height:"25px","margin-left":i.width()-3+"px"})})},resizeBoxes:function(){var e=$("#grid_"+this.name+"_header"),t=$("#grid_"+this.name+"_toolbar"),i=$("#grid_"+this.name+"_fsummary"),s=$("#grid_"+this.name+"_summary"),n=$("#grid_"+this.name+"_footer"),r=$("#grid_"+this.name+"_body");this.show.header&&e.css({top:"0px",left:"0px",right:"0px"}),this.show.toolbar&&t.css({top:0+(this.show.header?w2utils.getSize(e,"height"):0)+"px",left:"0px",right:"0px"}),0<this.summary.length&&(i.css({bottom:0+(this.show.footer?w2utils.getSize(n,"height"):0)+"px"}),s.css({bottom:0+(this.show.footer?w2utils.getSize(n,"height"):0)+"px",right:"0px"})),this.show.footer&&n.css({bottom:"0px",left:"0px",right:"0px"}),r.css({top:0+(this.show.header?w2utils.getSize(e,"height"):0)+(this.show.toolbar?w2utils.getSize(t,"height"):0)+"px",bottom:0+(this.show.footer?w2utils.getSize(n,"height"):0)+(0<this.summary.length?w2utils.getSize(s,"height"):0)+"px",left:"0px",right:"0px"})},resizeRecords:function(){var r=this;$(this.box).find(".w2ui-empty-record").remove();var e=$(this.box),t=$(this.box).find("> div.w2ui-grid-box"),i=$("#grid_"+this.name+"_header"),s=$("#grid_"+this.name+"_toolbar"),n=$("#grid_"+this.name+"_summary"),a=$("#grid_"+this.name+"_fsummary"),o=$("#grid_"+this.name+"_footer"),l=$("#grid_"+this.name+"_body"),d=$("#grid_"+this.name+"_columns"),u=$("#grid_"+this.name+"_fcolumns"),c=$("#grid_"+this.name+"_records"),h=$("#grid_"+this.name+"_frecords"),p=$("#grid_"+this.name+"_scroll1"),f=8*String(this.total).length+10;f<34&&(f=34),null!=this.lineNumberWidth&&(f=this.lineNumberWidth);for(var g=!1,m=!1,w=0,v=0;v<r.columns.length;v++){if(!r.columns[v].frozen&&!r.columns[v].hidden)w+=parseInt(r.columns[v].sizeCalculated?r.columns[v].sizeCalculated:r.columns[v].size)}if(c.width()<w&&(g=!0),l.height()-d.height()<$(c).find(">table").height()+(g?w2utils.scrollBarSize():0)&&(m=!0),this.fixedBody){y=t.height()-(this.show.header?w2utils.getSize(i,"height"):0)-(this.show.toolbar?w2utils.getSize(s,"height"):0)-("none"!=n.css("display")?w2utils.getSize(n,"height"):0)-(this.show.footer?w2utils.getSize(o,"height"):0);l.css("height",y)}else{var y=w2utils.getSize(d,"height")+w2utils.getSize($("#grid_"+r.name+"_records table"),"height")+(g?w2utils.scrollBarSize():0);r.height=y+w2utils.getSize(t,"+height")+(r.show.header?w2utils.getSize(i,"height"):0)+(r.show.toolbar?w2utils.getSize(s,"height"):0)+("none"!=n.css("display")?w2utils.getSize(n,"height"):0)+(r.show.footer?w2utils.getSize(o,"height"):0),t.css("height",r.height),l.css("height",y),e.css("height",w2utils.getSize(t,"height")+w2utils.getSize(e,"+height"))}var b=this.records.length,x="object"!=typeof this.url?this.url:this.url.get;if(0==this.searchData.length||x||(b=this.last.searchIds.length),this.fixedBody||(m=!1),g||m?(d.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show(),c.css({top:(0<this.columnGroups.length&&this.show.columns?1:0)+w2utils.getSize(d,"height")+"px","-webkit-overflow-scrolling":"touch","overflow-x":g?"auto":"hidden","overflow-y":m?"auto":"hidden"})):(d.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").hide(),c.css({top:(0<this.columnGroups.length&&this.show.columns?1:0)+w2utils.getSize(d,"height")+"px",overflow:"hidden"}),0<c.length&&(this.last.scrollTop=0,this.last.scrollLeft=0)),g?(h.css("margin-bottom",w2utils.scrollBarSize()),p.show()):(h.css("margin-bottom",0),p.hide()),h.css({overflow:"hidden",top:c.css("top")}),this.show.emptyRecords&&!m){var _=Math.floor(c.height()/this.recordHeight)-1,k=0;if(c[0]&&(k=c[0].scrollHeight-_*this.recordHeight),k>=this.recordHeight&&(k-=this.recordHeight,_++),this.fixedBody){for(var C=b;C<_;C++)T(C,this.recordHeight,this);T(_,k,this)}}function T(e,t,i){var s="",n="",r="";s+='<tr class="'+(e%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" style="height: '+t+'px">',n+='<tr class="'+(e%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" style="height: '+t+'px">',i.show.lineNumbers&&(s+='<td class="w2ui-col-number"></td>'),i.show.selectColumn&&(s+='<td class="w2ui-grid-data w2ui-col-select"></td>'),i.show.expandColumn&&(s+='<td class="w2ui-grid-data w2ui-col-expand"></td>'),n+='<td class="w2ui-grid-data-spacer" col="start" style="border-right: 0"></td>';for(var a=0;a<i.columns.length;a++){var o=i.columns[a];(o.hidden||a<i.last.colStart||a>i.last.colEnd)&&!o.frozen||(r='<td class="w2ui-grid-data" '+(null!=o.attr?o.attr:"")+' col="'+a+'"></td>',o.frozen?s+=r:n+=r)}s+='<td class="w2ui-grid-data-last"></td> </tr>',n+='<td class="w2ui-grid-data-last" col="end"></td> </tr>',$("#grid_"+i.name+"_frecords > table").append(s),$("#grid_"+i.name+"_records > table").append(n)}if(0<l.length){var z=parseInt(l.width())-(m?w2utils.scrollBarSize():0)-(this.show.lineNumbers?f:0)-(this.show.selectColumn?26:0)-(this.show.expandColumn?26:0)-1,S=z,D=0,O=!1;for(v=0;v<this.columns.length;v++){0<(R=this.columns[v]).gridMinWidth&&(R.gridMinWidth>S&&!0!==R.hidden&&(O=R.hidden=!0),R.gridMinWidth<S&&!0===R.hidden&&(O=!(R.hidden=!1)))}if(!0===O)return void this.refresh();for(v=0;v<this.columns.length;v++){(R=this.columns[v]).hidden||("px"==String(R.size).substr(String(R.size).length-2).toLowerCase()?(z-=parseFloat(R.size),this.columns[v].sizeCalculated=R.size,this.columns[v].sizeType="px"):(D+=parseFloat(R.size),this.columns[v].sizeType="%",delete R.sizeCorrected))}if(100!=D&&0<D)for(v=0;v<this.columns.length;v++){(R=this.columns[v]).hidden||"%"==R.sizeType&&(R.sizeCorrected=Math.round(100*parseFloat(R.size)*100/D)/100+"%")}for(v=0;v<this.columns.length;v++){(R=this.columns[v]).hidden||"%"==R.sizeType&&(null!=this.columns[v].sizeCorrected?this.columns[v].sizeCalculated=Math.floor(z*parseFloat(R.sizeCorrected)/100)-1+"px":this.columns[v].sizeCalculated=Math.floor(z*parseFloat(R.size)/100)-1+"px")}}var I=0;for(v=0;v<this.columns.length;v++){(R=this.columns[v]).hidden||(null==R.min&&(R.min=20),parseInt(R.sizeCalculated)<parseInt(R.min)&&(R.sizeCalculated=R.min+"px"),parseInt(R.sizeCalculated)>parseInt(R.max)&&(R.sizeCalculated=R.max+"px"),I+=parseInt(R.sizeCalculated))}var j=parseInt(S)-parseInt(I);if(0<j&&0<D)for(v=0;;){var R;if(null!=(R=this.columns[v]))if(R.hidden||"px"==R.sizeType)v++;else{if(R.sizeCalculated=parseInt(R.sizeCalculated)+1+"px",0===--j)break;v++}else v=0}else 0<j&&d.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show();var E=1;this.show.lineNumbers&&(E+=f),this.show.selectColumn&&(E+=26),this.show.expandColumn&&(E+=26);for(v=0;v<this.columns.length;v++)this.columns[v].hidden||this.columns[v].frozen&&(E+=parseInt(this.columns[v].sizeCalculated));u.css("width",E),h.css("width",E),a.css("width",E),p.css("width",E),d.css("left",E),c.css("left",E),n.css("left",E),d.find("> table > tbody > tr:nth-child(1) td").add(u.find("> table > tbody > tr:nth-child(1) td")).each(function(e,t){$(t).hasClass("w2ui-col-number")&&$(t).css("width",f);var i=$(t).attr("col");if(null!=i){if("start"==i){for(var s=0,n=0;n<r.last.colStart;n++)!r.columns[n]||r.columns[n].frozen||r.columns[n].hidden||(s+=parseInt(r.columns[n].sizeCalculated));$(t).css("width",s+"px")}r.columns[i]&&$(t).css("width",r.columns[i].sizeCalculated)}if($(t).hasClass("w2ui-head-last"))if(r.last.colEnd+1<r.columns.length){for(s=0,n=r.last.colEnd+1;n<r.columns.length;n++)!r.columns[n]||r.columns[n].frozen||r.columns[n].hidden||(s+=parseInt(r.columns[n].sizeCalculated));$(t).css("width",s+"px")}else $(t).css("width",w2utils.scrollBarSize()+(0<j&&0===D?j:0)+"px")}),3==d.find("> table > tbody > tr").length&&d.find("> table > tbody > tr:nth-child(1) td").add(u.find("> table > tbody > tr:nth-child(1) td")).html("").css({height:"0px",border:"0px",padding:"0px",margin:"0px"}),c.find("> table > tbody > tr:nth-child(1) td").add(h.find("> table > tbody > tr:nth-child(1) td")).each(function(e,t){$(t).hasClass("w2ui-col-number")&&$(t).css("width",f);var i=$(t).attr("col");if(null!=i){if("start"==i){for(var s=0,n=0;n<r.last.colStart;n++)!r.columns[n]||r.columns[n].frozen||r.columns[n].hidden||(s+=parseInt(r.columns[n].sizeCalculated));$(t).css("width",s+"px")}r.columns[i]&&$(t).css("width",r.columns[i].sizeCalculated)}if($(t).hasClass("w2ui-grid-data-last")&&0===$(t).parents(".w2ui-grid-frecords").length)if(r.last.colEnd+1<r.columns.length){for(s=0,n=r.last.colEnd+1;n<r.columns.length;n++)!r.columns[n]||r.columns[n].frozen||r.columns[n].hidden||(s+=parseInt(r.columns[n].sizeCalculated));$(t).css("width",s+"px")}else $(t).css("width",(0<j&&0===D?j:0)+"px")}),n.find("> table > tbody > tr:nth-child(1) td").add(a.find("> table > tbody > tr:nth-child(1) td")).each(function(e,t){$(t).hasClass("w2ui-col-number")&&$(t).css("width",f);var i=$(t).attr("col");if(null!=i){if("start"==i){for(var s=0,n=0;n<r.last.colStart;n++)!r.columns[n]||r.columns[n].frozen||r.columns[n].hidden||(s+=parseInt(r.columns[n].sizeCalculated));$(t).css("width",s+"px")}r.columns[i]&&$(t).css("width",r.columns[i].sizeCalculated)}$(t).hasClass("w2ui-grid-data-last")&&0===$(t).parents(".w2ui-grid-frecords").length&&$(t).css("width",w2utils.scrollBarSize()+(0<j&&0===D?j:0)+"px")}),this.initResize(),this.refreshRanges(),(this.last.scrollTop||this.last.scrollLeft)&&0<c.length&&(d.prop("scrollLeft",this.last.scrollLeft),c.prop("scrollTop",this.last.scrollTop),c.prop("scrollLeft",this.last.scrollLeft))},getSearchesHTML:function(){for(var o=this,e='<table cellspacing="0" onclick="event.stopPropagation()"><tbody>',t=!1,i=0;i<this.searches.length;i++){var s=this.searches[i];if(s.type=String(s.type).toLowerCase(),!s.hidden){var n="";0==t&&(n='<button class="w2ui-btn close-btn" onclick="obj = w2ui[\''+this.name+"']; if (obj) obj.searchClose()\">X</button>",t=!0),null==s.inTag&&(s.inTag=""),null==s.outTag&&(s.outTag=""),null==s.style&&(s.style=""),null==s.type&&(s.type="text");var r='<select id="grid_'+this.name+"_operator_"+i+'" class="w2ui-input" onclick="event.stopPropagation();"   onchange="w2ui[\''+this.name+"'].initOperator(this, "+i+')">'+l(s.type,s.operators)+"</select>";switch(e+='<tr>    <td class="close-btn">'+n+'</td>    <td class="caption">'+(s.caption||"")+'</td>    <td class="operator">'+r+'</td>    <td class="value">',s.type){case"text":case"alphanumeric":case"hex":case"color":case"list":case"combo":case"enum":var a="width: 250px;";-1!=["hex","color"].indexOf(s.type)&&(a="width: 90px;"),e+='<input rel="search" type="text" id="grid_'+this.name+"_field_"+i+'" name="'+s.field+'"    class="w2ui-input" style="'+a+s.style+'" '+s.inTag+"/>";break;case"int":case"float":case"money":case"currency":case"percent":case"date":case"time":case"datetime":a="width: 90px";"datetime"==s.type&&(a="width: 140px;"),e+='<input rel="search" type="text" class="w2ui-input" style="'+a+s.style+'" id="grid_'+this.name+"_field_"+i+'" name="'+s.field+'" '+s.inTag+'/><span id="grid_'+this.name+"_range_"+i+'" style="display: none">&#160;-&#160;&#160;<input rel="search" type="text" class="w2ui-input" style="'+a+s.style+'" id="grid_'+this.name+"_field2_"+i+'" name="'+s.field+'" '+s.inTag+"/></span>";break;case"select":e+='<select rel="search" class="w2ui-input" style="'+s.style+'" id="grid_'+this.name+"_field_"+i+'"  name="'+s.field+'" '+s.inTag+'  onclick="event.stopPropagation();"></select>'}e+=s.outTag+"    </td></tr>"}}return e+='<tr>    <td colspan="4" class="actions">        <div>        <button class="w2ui-btn" onclick="obj = w2ui[\''+this.name+"']; if (obj) { obj.searchReset(); }\">"+w2utils.lang("Reset")+'</button>        <button class="w2ui-btn w2ui-btn-blue" onclick="obj = w2ui[\''+this.name+"']; if (obj) { obj.search(); }\">"+w2utils.lang("Search")+"</button>        </div>    </td></tr></tbody></table>";function l(e,t){var i="",s=o.operators[o.operatorsMap[e]];null!=t&&(s=t);for(var n=0;n<s.length;n++){var r=s[n],a=r;Array.isArray(r)?(a=r[1],r=r[0],null==a&&(a=r)):$.isPlainObject(r)&&(a=r.text,r=r.oper),i+='<option value="'+r+'">'+w2utils.lang(a)+"</option>\n"}return i}},initOperator:function(e,t){var i=this.searches[t],s=$("#grid_"+this.name+"_range_"+t),n=$("#grid_"+this.name+"_field_"+t),r=n.parent().find("span input");switch(n.show(),s.hide(),$(e).val()){case"between":s.show(),r.w2field(i.type,i.options);break;case"not null":case"null":n.hide(),n.val("1"),n.change()}},initSearches:function(){for(var t=this,e=0;e<this.searches.length;e++){var i=this.searches[e],s=this.getSearchData(i.field);i.type=String(i.type).toLowerCase();var n=t.operators[t.operatorsMap[i.type]];i.operators&&(n=i.operators);var r=n[0];$.isPlainObject(r)&&(r=r.oper),"object"!=typeof i.options&&(i.options={}),"text"==i.type&&(r="begins");for(var a=0;a<n.length;a++){var o=n[a];if($.isPlainObject(o)&&(o=o.oper),i.operator==o){r=i.operator;break}}switch(i.type){case"text":case"alphanumeric":$("#grid_"+this.name+"_field_"+e).w2field(i.type,i.options);break;case"int":case"float":case"hex":case"color":case"money":case"currency":case"percent":case"date":case"time":case"datetime":$("#grid_"+this.name+"_field_"+e).w2field(i.type,i.options),$("#grid_"+this.name+"_field2_"+e).w2field(i.type,i.options),setTimeout(function(){$("#grid_"+t.name+"_field_"+e).keydown(),$("#grid_"+t.name+"_field2_"+e).keydown()},1);break;case"list":case"combo":case"enum":var l=i.options;"list"==i.type&&(l.selected={}),"enum"==i.type&&(l.selected=[]),s&&(l.selected=s.value),$("#grid_"+this.name+"_field_"+e).w2field(i.type,$.extend({openOnFocus:!0},l)),s&&null!=s.text&&$("#grid_"+this.name+"_field_"+e).data("selected",{id:s.value,text:s.text});break;case"select":for(l='<option value="">--</option>',a=0;a<i.options.items.length;a++){var d=i.options.items[a];if($.isPlainObject(i.options.items[a])){var u=d.id,c=d.text;null==u&&null!=d.value&&(u=d.value),null==c&&null!=d.caption&&(c=d.caption),null==u&&(u=""),l+='<option value="'+u+'">'+c+"</option>"}else l+='<option value="'+d+'">'+d+"</option>"}$("#grid_"+this.name+"_field_"+e).html(l)}null!=s?("int"==s.type&&-1!=["in","not in"].indexOf(s.operator)&&$("#grid_"+this.name+"_field_"+e).w2field("clear").val(s.value),$("#grid_"+this.name+"_operator_"+e).val(s.operator).trigger("change"),$.isArray(s.value)?-1!=["in","not in"].indexOf(s.operator)?$("#grid_"+this.name+"_field_"+e).val(s.value).trigger("change"):($("#grid_"+this.name+"_field_"+e).val(s.value[0]).trigger("change"),$("#grid_"+this.name+"_field2_"+e).val(s.value[1]).trigger("change")):null!=s.value&&$("#grid_"+this.name+"_field_"+e).val(s.value).trigger("change")):$("#grid_"+this.name+"_operator_"+e).val(r).trigger("change")}$("#w2ui-overlay-"+this.name+"-searchOverlay .w2ui-grid-searches *[rel=search]").on("keypress",function(e){13==e.keyCode&&(t.search(),$().w2overlay({name:t.name+"-searchOverlay"}))})},getColumnsHTML:function(){var h=this,e="",t="";if(this.show.columnHeaders)if(0<this.columnGroups.length){var i=a(!0),s=function(){var e="<tr>",t="<tr>",i="";""!=h.columnGroups[h.columnGroups.length-1].caption&&h.columnGroups.push({caption:""});h.show.lineNumbers&&(e+='<td class="w2ui-head w2ui-col-number">    <div style="height: '+(h.recordHeight+1)+'px">&#160;</div></td>');h.show.selectColumn&&(e+='<td class="w2ui-head w2ui-col-select">    <div style="height: 25px">&#160;</div></td>');h.show.expandColumn&&(e+='<td class="w2ui-head w2ui-col-expand">    <div style="height: 25px">&#160;</div></td>');var s=0;t+='<td id="grid_'+h.name+'_column_start" class="w2ui-head" col="start" style="border-right: 0"></td>';for(var n=0;n<h.columnGroups.length;n++){var r=h.columnGroups[n],a=h.columns[s];null!=r.colspan&&(r.span=r.colspan),null!=r.span&&r.span==parseInt(r.span)||(r.span=1);for(var o=0,l=s;l<s+r.span;l++)h.columns[l]&&!h.columns[l].hidden&&o++;if(n==h.columnGroups.length-1&&o++,o<=0);else if(!0===r.master){for(var d="",u=0;u<h.sortData.length;u++)h.sortData[u].field==a.field&&(new RegExp("asc","i").test(h.sortData[u].direction)&&(d="w2ui-sort-up"),new RegExp("desc","i").test(h.sortData[u].direction)&&(d="w2ui-sort-down"));var c="";!1!==a.resizable&&(c='<div class="w2ui-resizer" name="'+s+'"></div>'),i='<td id="grid_'+h.name+"_column_"+s+'" class="w2ui-head '+d+'" col="'+s+'"     rowspan="2" colspan="'+o+'"     oncontextmenu = "w2ui[\''+h.name+"'].contextMenu(null, "+s+', event);"    onclick="w2ui[\''+h.name+"'].columnClick('"+a.field+"', event);\"    ondblclick=\"w2ui['"+h.name+"'].columnDblClick('"+a.field+"', event);\">"+c+'    <div class="w2ui-col-group w2ui-col-header '+(d?"w2ui-col-sorted":"")+'">        <div class="'+d+'"></div>'+(a.caption?a.caption:"&#160;")+"    </div></td>",a&&a.frozen?e+=i:t+=i}else i='<td id="grid_'+h.name+"_column_"+s+'" class="w2ui-head" col="'+s+'"         colspan="'+o+'">    <div class="w2ui-col-group">'+(r.caption?r.caption:"&#160;")+"    </div></td>",a&&a.frozen?e+=i:t+=i;s+=r.span}return e+="<td></td></tr>",t+='<td id="grid_'+h.name+'_column_end" class="w2ui-head" col="end"></td></tr>',[e,t]}(),n=a(!1);e=i[0]+s[0]+n[0],t=i[1]+s[1]+n[1]}else{var r=a(!0);e=r[0],t=r[1]}return[e,t];function a(e){var t="<tr>",i="<tr>";h.show.lineNumbers&&(t+='<td class="w2ui-head w2ui-col-number"        onclick="w2ui[\''+h.name+"'].columnClick('line-number', event);\"       ondblclick=\"w2ui['"+h.name+"'].columnDblClick('line-number', event);\">    <div>#</div></td>"),h.show.selectColumn&&(t+='<td class="w2ui-head w2ui-col-select"       onclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;">    <div>        <input type="checkbox" id="grid_'+h.name+'_check_all" tabindex="-1"            style="'+(0==h.multiSelect?"display: none;":"")+'"            onmousedown="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;"            onclick="var grid = w2ui[\''+h.name+"'];               if (this.checked) grid.selectAll(); else grid.selectNone();               if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;               clearTimeout(grid.last.kbd_timer); /* keep focus */            \"/>    </div></td>"),h.show.expandColumn&&(t+='<td class="w2ui-head w2ui-col-expand">    <div>&#160;</div></td>');var s,n=0,r=0;i+='<td id="grid_'+h.name+'_column_start" class="w2ui-head" col="start" style="border-right: 0"></td>';for(var a=0;a<h.columns.length;a++){var o=h.columns[a];if(a==r&&(r+=(s=h.columnGroups[n++]||{}).span),(!(a<h.last.colStart||a>h.last.colEnd)||o.frozen)&&!o.hidden&&(!0!==s.master||e)){var l=h.getColumnCellHTML(a);o&&o.frozen?t+=l:i+=l}}return t+='<td class="w2ui-head w2ui-head-last"><div>&#160;</div></td>',i+='<td class="w2ui-head w2ui-head-last" col="end"><div>&#160;</div></td>',[t+="</tr>",i+="</tr>"]}},getColumnCellHTML:function(e){var t=this.columns[e];if(null==t)return"";for(var i=!this.reorderColumns||this.columnGroups&&this.columnGroups.length?"":" w2ui-reorder-cols-head ",s="",n=0;n<this.sortData.length;n++)this.sortData[n].field==t.field&&(new RegExp("asc","i").test(this.sortData[n].direction)&&(s="w2ui-sort-up"),new RegExp("desc","i").test(this.sortData[n].direction)&&(s="w2ui-sort-down"));var r=this.last.selection.columns,a=!1;for(var o in r)for(n=0;n<r[o].length;n++)r[o][n]==e&&(a=!0);return'<td id="grid_'+this.name+"_column_"+e+'" col="'+e+'" class="w2ui-head '+s+i+'" '+("normal"==this.columnTooltip&&t.tooltip?'title="'+t.tooltip+'" ':"")+"    onmouseover = \"w2ui['"+this.name+"'].columnTooltipShow('"+e+"', event);\"    onmouseout  = \"w2ui['"+this.name+"'].columnTooltipHide('"+e+"', event);\"    oncontextmenu = \"w2ui['"+this.name+"'].contextMenu(null, "+e+', event);"    onclick="w2ui[\''+this.name+"'].columnClick('"+t.field+"', event);\"    ondblclick=\"w2ui['"+this.name+"'].columnDblClick('"+t.field+"', event);\">"+(!1!==t.resizable?'<div class="w2ui-resizer" name="'+e+'"></div>':"")+'    <div class="w2ui-col-header '+(s?"w2ui-col-sorted":"")+" "+(a?"w2ui-col-selected":"")+'">        <div class="'+s+'"></div>'+(t.caption?t.caption:"&#160;")+"    </div></td>"},columnTooltipShow:function(e){if("normal"!=this.columnTooltip){var t=$(this.box).find("#grid_"+this.name+"_column_"+e),i=this.columns[e],s=this.columnTooltip;t.prop("_mouse_over",!0),setTimeout(function(){!0===t.prop("_mouse_over")&&!0!==t.prop("_mouse_tooltip")&&(t.prop("_mouse_tooltip",!0),t.w2tag(i.tooltip,{position:s}))},1)}},columnTooltipHide:function(e){if("normal"!=this.columnTooltip){var t=$(this.box).find("#grid_"+this.name+"_column_"+e);this.columns[e];t.removeProp("_mouse_over"),setTimeout(function(){!0!==t.prop("_mouse_over")&&!0===t.prop("_mouse_tooltip")&&(t.removeProp("_mouse_tooltip"),t.w2tag())},1)}},getRecordsHTML:function(){var e=this.records.length,t="object"!=typeof this.url?this.url:this.url.get;0==this.searchData.length||t||(e=this.last.searchIds.length),e>this.vs_start?this.last.show_extra=this.vs_extra:this.last.show_extra=this.vs_start;var i=$("#grid_"+this.name+"_records"),s=Math.floor(i.height()/this.recordHeight)+this.last.show_extra+1;(!this.fixedBody||e<s)&&(s=e);var n=this.getRecordHTML(-1,0),r="<table><tbody>"+n[0],a="<table><tbody>"+n[1];r+='<tr id="grid_'+this.name+'_frec_top" line="top" style="height: 0px">    <td colspan="2000"></td></tr>',a+='<tr id="grid_'+this.name+'_rec_top" line="top" style="height: 0px">    <td colspan="2000"></td></tr>';for(var o=0;o<s;o++)r+=(n=this.getRecordHTML(o,o+1))[0],a+=n[1];return r+='<tr id="grid_'+this.name+'_frec_bottom" line="bottom" style="height: '+(e-s)*this.recordHeight+'px">    <td colspan="2000" style="border: 0"></td></tr><tr id="grid_'+this.name+'_frec_more" style="display: none; visibility: hidden">    <td colspan="2000" class="w2ui-load-more"></td></tr></tbody></table>',a+='<tr id="grid_'+this.name+'_rec_bottom" line="bottom" style="height: '+(e-s)*this.recordHeight+'px">    <td colspan="2000" style="border: 0"></td></tr><tr id="grid_'+this.name+'_rec_more" style="display: none">    <td colspan="2000" class="w2ui-load-more"></td></tr></tbody></table>',this.last.range_start=0,this.last.range_end=s,[r,a]},getSummaryHTML:function(){if(0!==this.summary.length){for(var e=this.getRecordHTML(-1,0),t="<table><tbody>"+e[0],i="<table><tbody>"+e[1],s=0;s<this.summary.length;s++)t+=(e=this.getRecordHTML(s,s+1,!0))[0],i+=e[1];return[t+="</tbody></table>",i+="</tbody></table>"]}},scroll:function(e){(new Date).getTime();var n=this,t="object"!=typeof this.url?this.url:this.url.get,i=$("#grid_"+this.name+"_records"),s=$("#grid_"+this.name+"_frecords");if(e){var r=e.target.scrollTop,a=e.target.scrollLeft;n.last.scrollTop=r,n.last.scrollLeft=a,$("#grid_"+n.name+"_columns")[0].scrollLeft=a,$("#grid_"+n.name+"_summary")[0].scrollLeft=a,s[0].scrollTop=r}this.last.bubbleEl&&($(this.last.bubbleEl).w2tag(),this.last.bubbleEl=null);var o=null,l=null;if(n.disableCVS||0<n.columnGroups.length)o=0,l=n.columns.length-1;else{for(var d=i.width(),u=0,c=0;c<n.columns.length;c++)if(!n.columns[c].frozen&&!n.columns[c].hidden){var h=parseInt(n.columns[c].sizeCalculated?n.columns[c].sizeCalculated:n.columns[c].size);u+h+30>n.last.scrollLeft&&null==o&&(o=c),u+h-30>n.last.scrollLeft+d&&null==l&&(l=c),u+=h}null==l&&(l=n.columns.length-1)}if(null!=o&&(o<0&&(o=0),l<0&&(l=0),o==l&&(0<o?o--:l++),o!=n.last.colStart||l!=n.last.colEnd)){var p=$(n.box),f=Math.abs(o-n.last.colStart),g=Math.abs(l-n.last.colEnd);if(f<5&&g<5){var m=p.find(".w2ui-grid-columns #grid_"+n.name+"_column_start"),w=p.find(".w2ui-grid-columns .w2ui-head-last"),v=p.find("#grid_"+n.name+"_records .w2ui-grid-data-spacer"),y=p.find("#grid_"+n.name+"_records .w2ui-grid-data-last"),b=p.find("#grid_"+n.name+"_summary .w2ui-grid-data-spacer"),x=p.find("#grid_"+n.name+"_summary .w2ui-grid-data-last");if(o>n.last.colStart)for(c=n.last.colStart;c<o;c++)p.find("#grid_"+n.name+"_columns #grid_"+n.name+"_column_"+c).remove(),p.find("#grid_"+n.name+'_records td[col="'+c+'"]').remove(),p.find("#grid_"+n.name+'_summary td[col="'+c+'"]').remove();if(l<n.last.colEnd)for(c=n.last.colEnd;l<c;c--)p.find("#grid_"+n.name+"_columns #grid_"+n.name+"_column_"+c).remove(),p.find("#grid_"+n.name+'_records td[col="'+c+'"]').remove(),p.find("#grid_"+n.name+'_summary td[col="'+c+'"]').remove();if(o<n.last.colStart)for(c=n.last.colStart-1;o<=c;c--)n.columns[c]&&(n.columns[c].frozen||n.columns[c].hidden)||(m.after(n.getColumnCellHTML(c)),v.each(function(e,t){var i=$(t).parent().attr("index"),s='<td class="w2ui-grid-data" col="'+c+'" style="height: 0px"></td>';null!=i&&(s=n.getCellHTML(parseInt(i),c,!1)),$(t).after(s)}),b.each(function(e,t){var i=$(t).parent().attr("index"),s='<td class="w2ui-grid-data" col="'+c+'" style="height: 0px"></td>';null!=i&&(s=n.getCellHTML(parseInt(i),c,!0)),$(t).after(s)}));if(l>n.last.colEnd)for(c=n.last.colEnd+1;c<=l;c++)n.columns[c]&&(n.columns[c].frozen||n.columns[c].hidden)||(w.before(n.getColumnCellHTML(c)),y.each(function(e,t){var i=$(t).parent().attr("index"),s='<td class="w2ui-grid-data" col="'+c+'" style="height: 0px"></td>';null!=i&&(s=n.getCellHTML(parseInt(i),c,!1)),$(t).before(s)}),x.each(function(e,t){var i=$(t).parent().attr("index"),s=n.getCellHTML(parseInt(i),c,!0);$(t).before(s)}));n.last.colStart=o,n.last.colEnd=l,n.resizeRecords()}else{n.last.colStart=o,n.last.colEnd=l;var _=this.getColumnsHTML(),k=this.getRecordsHTML(),C=this.getSummaryHTML(),T=p.find("#grid_"+this.name+"_columns"),z=p.find("#grid_"+this.name+"_records"),S=p.find("#grid_"+this.name+"_frecords"),D=p.find("#grid_"+this.name+"_summary");T.find("tbody").html(_[1]),S.html(k[0]),z.prepend(k[1]),null!=C&&D.html(C[1]),setTimeout(function(){z.find("> table").not("table:first-child").remove(),D[0]&&(D[0].scrollLeft=n.last.scrollLeft)},1),n.resizeRecords()}}var O=this.records.length;if(0==this.searchData.length||t||(O=this.last.searchIds.length),0!==O&&0!==i.length&&0!==i.height()&&(O>this.vs_start?this.last.show_extra=this.vs_extra:this.last.show_extra=this.vs_start,!(i.height()<O*this.recordHeight&&"hidden"==i.css("overflow-y")))){var I=Math.round(i[0].scrollTop/this.recordHeight+1),j=I+(Math.round(i.height()/this.recordHeight)-1);if(O<I&&(I=O),O-1<=j&&(j=O),$("#grid_"+this.name+"_footer .w2ui-footer-right").html((n.show.statusRange?w2utils.formatNumber(this.offset+I)+"-"+w2utils.formatNumber(this.offset+j)+(-1!=this.total?" "+w2utils.lang("of")+" "+w2utils.formatNumber(this.total):""):"")+(t&&n.show.statusBuffered?" ("+w2utils.lang("buffered")+" "+w2utils.formatNumber(O)+(0<this.offset?", skip "+w2utils.formatNumber(this.offset):"")+")":"")),t||this.fixedBody&&!(-1!=this.total&&this.total<=this.vs_start)){var R=Math.floor(i[0].scrollTop/this.recordHeight)-this.last.show_extra,E=R+Math.floor(i.height()/this.recordHeight)+2*this.last.show_extra+1;R<1&&(R=1),E>this.total&&-1!=this.total&&(E=this.total);var F=i.find("#grid_"+this.name+"_rec_top"),M=i.find("#grid_"+this.name+"_rec_bottom"),A=s.find("#grid_"+this.name+"_frec_top"),P=s.find("#grid_"+this.name+"_frec_bottom");-1!=String(F.next().prop("id")).indexOf("_expanded_row")&&(F.next().remove(),A.next().remove()),this.total>E&&-1!=String(M.prev().prop("id")).indexOf("_expanded_row")&&(M.prev().remove(),P.prev().remove());var N=parseInt(F.next().attr("line")),H=parseInt(M.prev().attr("line"));if(N<R||1==N||this.last.pull_refresh){if(E<=H+this.last.show_extra-2&&E!=this.total)return;for(this.last.pull_refresh=!1;;){var L=s.find("#grid_"+this.name+"_frec_top").next();if("bottom"==(K=i.find("#grid_"+this.name+"_rec_top").next()).attr("line"))break;if(!(parseInt(K.attr("line"))<R))break;L.remove(),K.remove()}"top"==(Y=i.find("#grid_"+this.name+"_rec_bottom").prev().attr("line"))&&(Y=R);for(c=parseInt(Y)+1;c<=E;c++)if(this.records[c-1]){(K=this.records[c-1].w2ui)&&!Array.isArray(K.children)&&(K.expanded=!1);var B=this.getRecordHTML(c-1,c);M.before(B[1]),P.before(B[0])}X(),setTimeout(function(){n.refreshRanges()},0)}else{if(R>=N-this.last.show_extra+2&&1<R)return;for(;;){L=s.find("#grid_"+this.name+"_frec_bottom").prev();if("top"==(K=i.find("#grid_"+this.name+"_rec_bottom").prev()).attr("line"))break;if(!(parseInt(K.attr("line"))>E))break;L.remove(),K.remove()}var Y;"bottom"==(Y=i.find("#grid_"+this.name+"_rec_top").next().attr("line"))&&(Y=E);for(c=parseInt(Y)-1;R<=c;c--)if(this.records[c-1]){var K;(K=this.records[c-1].w2ui)&&!Array.isArray(K.children)&&(K.expanded=!1);B=this.getRecordHTML(c-1,c);F.after(B[1]),A.after(B[0])}X(),setTimeout(function(){n.refreshRanges()},0)}var W=(R-1)*n.recordHeight,q=(O-E)*n.recordHeight;if(q<0&&(q=0),F.css("height",W+"px"),A.css("height",W+"px"),M.css("height",q+"px"),P.css("height",q+"px"),n.last.range_start=R,n.last.range_end=E,O<Math.floor(i[0].scrollTop/this.recordHeight)+Math.floor(i.height()/this.recordHeight)+10&&!0!==this.last.pull_more&&(O<this.total-this.offset||-1==this.total&&this.last.xhr_hasMore))if(!0===this.autoLoad)this.last.pull_more=!0,this.last.xhr_offset+=this.limit,this.request("get");else{var U=$("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more");"none"==U.css("display")&&U.show().on("click",function(){n.last.pull_more=!0,n.last.xhr_offset+=n.limit,n.request("get"),$(this).find("td").html('<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>')}),(0<U.find("td .w2ui-spinner").length||-1==U.find("td").text().indexOf("Load"))&&U.find("td").html("<div>"+w2utils.lang("Load")+" "+n.limit+" "+w2utils.lang("More")+"...</div>")}O>=this.total-this.offset&&-1!=this.total&&$("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more").hide()}}function X(){n.markSearch&&(clearTimeout(n.last.marker_timer),n.last.marker_timer=setTimeout(function(){for(var e=[],t=0;t<n.searchData.length;t++){var i=n.searchData[t],s=n.getSearch(i.field);s&&!s.hidden&&(-1==e.indexOf(i.value)&&e.push(i.value))}0<e.length&&$(n.box).find(".w2ui-grid-data > div").w2marker(e)},50))}},getRecordHTML:function(e,t,i){var s,n="",r="",a="",o=this.last.selection;if(-1==e){r+='<tr line="0">',a+='<tr line="0">',this.show.lineNumbers&&(r+='<td class="w2ui-col-number" style="height: 0px;"></td>'),this.show.selectColumn&&(r+='<td class="w2ui-col-select" style="height: 0px;"></td>'),this.show.expandColumn&&(r+='<td class="w2ui-col-expand" style="height: 0px;"></td>'),a+='<td class="w2ui-grid-data w2ui-grid-data-spacer" col="start" style="height: 0px; width: 0px;"></td>';for(var l=0;l<this.columns.length;l++){if(n='<td class="w2ui-grid-data" col="'+l+'" style="height: 0px;"></td>',(m=this.columns[l]).frozen&&!m.hidden)r+=n;else{if(m.hidden||l<this.last.colStart||l>this.last.colEnd)continue;a+=n}}return r+='<td class="w2ui-grid-data-last" style="height: 0px"></td>',a+='<td class="w2ui-grid-data-last" col="end" style="height: 0px"></td>',[r+="</tr>",a+="</tr>"]}var d="object"!=typeof this.url?this.url:this.url.get;if(!0!==i)if(0<this.searchData.length&&!d){if(e>=this.last.searchIds.length)return"";e=this.last.searchIds[e],s=this.records[e]}else{if(e>=this.records.length)return"";s=this.records[e]}else{if(e>=this.summary.length)return"";s=this.summary[e]}if(!s)return"";null==s.recid&&null!=this.recid&&null!=s[this.recid]&&(s.recid=s[this.recid]);w2utils.escapeId(s.recid);var u=!1;-1!=o.indexes.indexOf(e)&&(u=!0);var c=s.w2ui?s.w2ui.style:"";null!=c&&"string"==typeof c||(c="");var h=s.w2ui?s.w2ui.class:"";if(null!=h&&"string"==typeof h||(h=""),r+='<tr id="grid_'+this.name+"_frec_"+s.recid+'" recid="'+s.recid+'" line="'+t+'" index="'+e+'"  class="'+(t%2==0?"w2ui-even":"w2ui-odd")+" "+h+(u&&"row"==this.selectType?" w2ui-selected":"")+(s.w2ui&&!1===s.w2ui.editable?" w2ui-no-edit":"")+(s.w2ui&&!0===s.w2ui.expanded?" w2ui-expanded":"")+'" '+(!0!==i?w2utils.isIOS?"    onclick  = \"w2ui['"+this.name+"'].dblClick(jQuery(this).attr('recid'), event);\"":"    onclick  = \"w2ui['"+this.name+"'].click(jQuery(this).attr('recid'), event);\"    oncontextmenu = \"w2ui['"+this.name+"'].contextMenu(jQuery(this).attr('recid'), null, event);\"":"")+("row"==this.selectType?" onmouseover=\"jQuery('#grid_"+this.name+"_rec_'+ w2utils.escapeId(jQuery(this).attr('recid'))).addClass('w2ui-record-hover')\" onmouseout =\"jQuery('#grid_"+this.name+"_rec_'+ w2utils.escapeId(jQuery(this).attr('recid'))).removeClass('w2ui-record-hover')\"":"")+' style="height: '+this.recordHeight+"px; "+(u||""==c?c.replace("background-color","none"):c)+'" '+(""!=c?'custom_style="'+c+'"':"")+">",a+='<tr id="grid_'+this.name+"_rec_"+s.recid+'" recid="'+s.recid+'" line="'+t+'" index="'+e+'"  class="'+(t%2==0?"w2ui-even":"w2ui-odd")+" "+h+(u&&"row"==this.selectType?" w2ui-selected":"")+(s.w2ui&&!1===s.w2ui.editable?" w2ui-no-edit":"")+(s.w2ui&&!0===s.w2ui.expanded?" w2ui-expanded":"")+'" '+(!0!==i?w2utils.isIOS?"    onclick  = \"var obj = w2ui['"+this.name+"']; obj.dblClick(jQuery(this).attr('recid'), event);\"":"    onclick  = \"var obj = w2ui['"+this.name+"']; obj.click(jQuery(this).attr('recid'), event);\"    oncontextmenu = \"var obj = w2ui['"+this.name+"']; obj.contextMenu(jQuery(this).attr('recid'), null, event);\"":"")+("row"==this.selectType?" onmouseover=\"jQuery('#grid_"+this.name+"_frec_' + w2utils.escapeId(jQuery(this).attr('recid'))).addClass('w2ui-record-hover')\" onmouseout =\"jQuery('#grid_"+this.name+"_frec_' + w2utils.escapeId(jQuery(this).attr('recid'))).removeClass('w2ui-record-hover')\"":"")+' style="height: '+this.recordHeight+"px; "+(u||""==c?c.replace("background-color","none"):c)+'" '+(""!=c?'custom_style="'+c+'"':"")+">",this.show.lineNumbers&&(r+='<td id="grid_'+this.name+"_cell_"+e+"_number"+(i?"_s":"")+'"    class="w2ui-col-number '+(u?" w2ui-row-selected":"")+'"'+(this.reorderRows?' style="cursor: move"':"")+">"+(!0!==i?this.getLineHTML(t,s):"")+"</td>"),this.show.selectColumn&&(r+='<td id="grid_'+this.name+"_cell_"+e+"_select"+(i?"_s":"")+'" class="w2ui-grid-data w2ui-col-select">'+(!0!==i?'    <div>        <input class="w2ui-grid-select-check" type="checkbox" tabindex="-1" '+(u?'checked="checked"':"")+' style="pointer-events: none"/>    </div>':"")+"</td>"),this.show.expandColumn){var p="";p=s.w2ui&&!0===s.w2ui.expanded?"-":"+",s.w2ui&&"none"==s.w2ui.expanded&&(p=""),s.w2ui&&"spinner"==s.w2ui.expanded&&(p='<div class="w2ui-spinner" style="width: 16px; margin: -2px 2px;"></div>'),r+='<td id="grid_'+this.name+"_cell_"+e+"_expand"+(i?"_s":"")+'" class="w2ui-grid-data w2ui-col-expand">'+(!0!==i?'    <div ondblclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;"             onclick="w2ui[\''+this.name+"'].toggle(jQuery(this).parents('tr').attr('recid'));                 if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">        "+p+" </div>":"")+"</td>"}a+='<td class="w2ui-grid-data-spacer" col="start" style="border-right: 0"></td>';for(var f=0,g=0;;){var m,w=1;if(null==(m=this.columns[f]))break;if(m.hidden)f++,0<g&&g--;else if(0<g){if(f++,null==this.columns[f])break;s.w2ui.colspan[this.columns[f-1].field]=0,g--}else{if(s.w2ui){var v=s.w2ui.colspan,y=this.columns[f].field;v&&0===v[y]&&delete v[y]}if(!(f<this.last.colStart||f>this.last.colEnd)||m.frozen){if(s.w2ui&&"object"==typeof s.w2ui.colspan){var b=parseInt(s.w2ui.colspan[m.field])||null;if(1<b){var x=0;for(l=f;l<f+b&&!(l>=this.columns.length);l++)this.columns[l].hidden&&x++;w=b-x,g=b-1}}var _=this.getCellHTML(e,f,i,w);m.frozen?r+=_:a+=_,f++}else f++}}return r+='<td class="w2ui-grid-data-last"></td>',a+='<td class="w2ui-grid-data-last" col="end"></td>',[r+="</tr>",a+="</tr>"]},getLineHTML:function(e){return"<div>"+e+"</div>"},getCellHTML:function(e,t,i,s){var n=this.columns[t];if(null==n)return"";var r=!0!==i?this.records[e]:this.summary[e],a=this.getCellValue(e,t,i),o=this.getCellEditable(e,t),l="max-height: "+parseInt(this.recordHeight)+"px;",d=!i&&r&&r.w2ui&&r.w2ui.changes&&null!=r.w2ui.changes[n.field],u="",c="",h=this.last.selection,p=!1,f="";if(-1!=h.indexes.indexOf(e)&&(p=!0),null==s&&(s=r&&r.w2ui&&r.w2ui.colspan&&r.w2ui.colspan[n.field]?r.w2ui.colspan[n.field]:1),0===t&&r&&r.w2ui&&Array.isArray(r.w2ui.children)){for(var g=0,m=this.get(r.w2ui.parent_recid,!0);null!=m;){if(g++,null==(y=this.records[m].w2ui)||null==y.parent_recid)break;m=this.get(y.parent_recid,!0)}if(r.w2ui.parent_recid)for(var w=0;w<g;w++)f+='<span class="w2ui-show-children w2ui-icon-empty"></span>';f+='<span class="w2ui-show-children '+(0<r.w2ui.children.length?r.w2ui.expanded?"w2ui-icon-collapse":"w2ui-icon-expand":"w2ui-icon-empty")+'"  onclick="event.stopPropagation(); w2ui[\''+this.name+"'].toggle(jQuery(this).parents('tr').attr('recid'))\"></span>"}if(!0===n.info&&(n.info={}),null!=n.info&&(n.info.icon||(n.info.icon="w2ui-icon-info"),f+='<span class="w2ui-info '+n.info.icon+'" style="'+(n.info.style||"")+'"  onclick="event.stopPropagation(); w2ui[\''+this.name+"'].showBubble("+e+", "+t+')"></span>'),null!=n.render){if("function"==typeof n.render&&((a=$.trim(n.render.call(this,r,e,t,a))).length<4||"<div"!=a.substr(0,4).toLowerCase())&&(a='<div style="'+l+'">'+f+String(a)+"</div>"),"object"==typeof n.render&&(a='<div style="'+l+'">'+f+(n.render[a]||"")+"</div>"),"string"==typeof n.render){var v=n.render.toLowerCase().indexOf(":"),y=[];-1==v?(y[0]=n.render.toLowerCase(),y[1]=""):(y[0]=n.render.toLowerCase().substr(0,v),y[1]=n.render.toLowerCase().substr(v+1));var b=w2utils.formatters[y[0]];a='<div style="'+l+'">'+f+("function"==typeof b?b(a,y[1]):"")+"</div>"}}else{if(o&&-1!=["checkbox","check"].indexOf(o.type)){var x=i?-(e+1):e;l+="text-align: center;",a='<input tabindex="-1" type="checkbox" '+(a?'checked="checked"':"")+" onclick=\"    var obj = w2ui['"+this.name+"'];     obj.editChange.call(obj, this, "+x+", "+t+', event); "/>',f=""}if(this.show.recordTitles){var _=w2utils.stripTags(String(a).replace(/"/g,"''"));null!=n.title&&("function"==typeof n.title&&(_=n.title.call(this,r,e,t)),"string"==typeof n.title&&(_=n.title))}a='<div style="'+l+'" title="'+(_||"")+'">'+f+String(a)+"</div>"}if(null==a&&(a=""),"string"==typeof n.render){y=n.render.toLowerCase().split(":");-1!=["number","int","float","money","currency","percent","size"].indexOf(y[0])&&(u+="text-align: right;")}r&&r.w2ui&&("object"==typeof r.w2ui.style&&("string"==typeof r.w2ui.style[t]&&(u+=r.w2ui.style[t]+";"),"string"==typeof r.w2ui.style[n.field]&&(u+=r.w2ui.style[n.field]+";")),"object"==typeof r.w2ui.class&&("string"==typeof r.w2ui.class[t]&&(c+=r.w2ui.class[t]+" "),"string"==typeof r.w2ui.class[n.field]&&(c+=r.w2ui.class[n.field]+" ")));var k=!1;return p&&-1!=$.inArray(t,h.columns[e])&&(k=!0),a='<td class="w2ui-grid-data'+(k?" w2ui-selected":"")+" "+c+(d?" w2ui-changed":"")+'"    id="grid_'+this.name+"_data_"+e+"_"+t+'" col="'+t+'"    style="'+u+(null!=n.style?n.style:"")+'" '+(null!=n.attr?n.attr:"")+(1<s?'colspan="'+s+'"':"")+">"+a+"</td>"},showBubble:function(e,t){var i="",s=this.columns[t].info,n=this.records[e],r=$(this.box).find("#grid_"+this.name+"_data_"+e+"_"+t+" .w2ui-info");if(this.last.bubbleEl&&$(this.last.bubbleEl).w2tag(),this.last.bubbleEl=r,null==s.fields){s.fields=[];for(var a=0;a<this.columns.length;a++){var o=this.columns[a];s.fields.push(o.field+("string"==typeof o.render?":"+o.render:""))}}var l=s.fields;if("function"==typeof l&&(l=l(n,e,t)),"function"==typeof s.render)i=s.render(n,e,t);else if($.isArray(l)){i='<table cellpadding="0" cellspacing="0">';for(a=0;a<l.length;a++){if(""!=(h=String(l[a]).split(":"))[0]&&"-"!=h[0]&&"--"!=h[0]&&"---"!=h[0]){null==(o=this.getColumn(h[0]))&&(o={field:h[0],caption:h[0]});var d=o?this.parseField(n,o.field):"";1<h.length&&(w2utils.formatters[h[1]]?d=w2utils.formatters[h[1]](d,h[2]||null):console.log('ERROR: w2utils.formatters["'+h[1]+'"] does not exists.')),(!0===s.showEmpty||null!=d&&""!=d)&&(null!=s.maxLength&&"string"==typeof d&&d.length>s.maxLength&&(d=d.substr(0,s.maxLength)+"..."),i+="<tr><td>"+o.caption+"</td><td>"+((0===d?"0":d)||"")+"</td></tr>")}else i+='<tr><td colspan=2><div style="border-top: '+(""==h[0]?"0":"1")+'px solid #C1BEBE; margin: 6px 0px;"></div></td></tr>'}i+="</table>"}else if($.isPlainObject(l)){for(var u in i='<table cellpadding="0" cellspacing="0">',l){var c=l[u];if(""!=c&&"-"!=c&&"--"!=c&&"---"!=c){var h=String(c).split(":");null==(o=this.getColumn(h[0]))&&(o={field:h[0],caption:h[0]});d=o?this.parseField(n,o.field):"";1<h.length&&(w2utils.formatters[h[1]]?d=w2utils.formatters[h[1]](d,h[2]||null):console.log('ERROR: w2utils.formatters["'+h[1]+'"] does not exists.')),"function"==typeof c&&(d=c(n,e,t)),(!0===s.showEmpty||null!=d&&""!=d)&&(null!=s.maxLength&&"string"==typeof d&&d.length>s.maxLength&&(d=d.substr(0,s.maxLength)+"..."),i+="<tr><td>"+u+"</td><td>"+(d||"")+"</td></tr>")}else i+='<tr><td colspan=2><div style="border-top: '+(""==c?"0":"1")+'px solid #C1BEBE; margin: 6px 0px;"></div></td></tr>'}i+="</table>"}$(r).w2tag($.extend({html:i,left:-4,position:"bottom|top",className:"w2ui-info-bubble",style:"",hideOnClick:!0},s.options||{}))},getCellEditable:function(e,t){var i=this.columns[t],s=this.records[e];if(!s||!i)return null;var n=s.w2ui?s.w2ui.editable:null;if(!1===n)return null;if((null==n||!0===n)&&"function"==typeof(n=i?i.editable:null)){var r=this.getCellValue(e,t,!1);n=n.call(this,s,e,t,r)}return n},getCellValue:function(e,t,i){var s=this.columns[t],n=!0!==i?this.records[e]:this.summary[e],r=this.parseField(n,s.field);return n&&n.w2ui&&n.w2ui.changes&&null!=n.w2ui.changes[s.field]&&(r=n.w2ui.changes[s.field]),$.isPlainObject(r)&&s.editable&&(null!=r.text&&(r=r.text),null!=r.id&&(r=r.id)),null==r&&(r=""),r},getFooterHTML:function(){return'<div>    <div class="w2ui-footer-left"></div>    <div class="w2ui-footer-right"></div>    <div class="w2ui-footer-center"></div></div>'},status:function(e){if(null!=e)$("#grid_"+this.name+"_footer").find(".w2ui-footer-left").html(e);else{var t="",i=this.getSelection();if(0<i.length&&(this.show.statusSelection&&1<i.length&&(t=String(i.length).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+" "+w2utils.lang("selected")),this.show.statusRecordID&&1==i.length)){var s=i[0];"object"==typeof s&&(s=s.recid+", "+w2utils.lang("Column")+": "+s.column),t=w2utils.lang("Record ID")+": "+s+" "}$("#grid_"+this.name+"_footer .w2ui-footer-left").html(t),1==i.length?this.toolbar.enable("w2ui-edit"):this.toolbar.disable("w2ui-edit"),1<=i.length?this.toolbar.enable("w2ui-delete"):this.toolbar.disable("w2ui-delete")}},lock:function(e,t){var i=this,s=Array.prototype.slice.call(arguments,0);s.unshift(this.box),setTimeout(function(){$(i.box).find("#grid_"+i.name+"_empty_msg").remove(),w2utils.lock.apply(window,s)},10)},unlock:function(e){var t=this.box;setTimeout(function(){0<$(t).find(".w2ui-message").not(".w2ui-closing").length||w2utils.unlock(t,e)},25)},stateSave:function(e){if(!w2utils.hasLocalStorage)return null;for(var t={columns:[],show:$.extend({},this.show),last:{search:this.last.search,multi:this.last.multi,logic:this.last.logic,caption:this.last.caption,field:this.last.field,scrollTop:this.last.scrollTop,scrollLeft:this.last.scrollLeft},sortData:[],searchData:[]},i=0;i<this.columns.length;i++){var s=this.columns[i];t.columns.push({field:s.field,hidden:!!s.hidden,frozen:!!s.frozen,size:s.size?s.size:null,sizeCalculated:s.sizeCalculated?s.sizeCalculated:null,sizeOriginal:s.sizeOriginal?s.sizeOriginal:null,sizeType:s.sizeType?s.sizeType:null})}for(i=0;i<this.sortData.length;i++)t.sortData.push($.extend({},this.sortData[i]));for(i=0;i<this.searchData.length;i++)t.searchData.push($.extend({},this.searchData[i]));if(!0!==e){var n=this.trigger({phase:"before",type:"stateSave",target:this.name,state:t});if(!0===n.isCancelled)return void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}));try{var r=$.parseJSON(localStorage.w2ui||"{}");r||(r={}),r.states||(r.states={}),r.states[this.stateId||this.name]=t,localStorage.w2ui=JSON.stringify(r)}catch(e){return delete localStorage.w2ui,null}this.trigger($.extend(n,{phase:"after"}))}return t},stateRestore:function(e){var t=this,i="object"!=typeof this.url?this.url:this.url.get;if(!e)try{if(!w2utils.hasLocalStorage)return!1;(o=$.parseJSON(localStorage.w2ui||"{}"))||(o={}),o.states||(o.states={}),e=o.states[this.stateId||this.name]}catch(e){return delete localStorage.w2ui,null}var s=this.trigger({phase:"before",type:"stateRestore",target:this.name,state:e});if(!0!==s.isCancelled){if($.isPlainObject(e)){$.extend(this.show,e.show),$.extend(this.last,e.last);for(var n=this.last.scrollTop,r=this.last.scrollLeft,a=0;a<e.columns.length;a++){var o=e.columns[a],l=this.getColumn(o.field,!0);null!==l&&($.extend(this.columns[l],o),a!==l&&this.columns.splice(a,0,this.columns.splice(l,1)[0]))}this.sortData.splice(0,this.sortData.length);for(a=0;a<e.sortData.length;a++)this.sortData.push(e.sortData[a]);this.searchData.splice(0,this.searchData.length);for(a=0;a<e.searchData.length;a++)this.searchData.push(e.searchData[a]);setTimeout(function(){i||(0<t.sortData.length&&t.localSort(),0<t.searchData.length&&t.localSearch()),t.last.scrollTop=n,t.last.scrollLeft=r,t.refresh()},1)}return this.trigger($.extend(s,{phase:"after"})),!0}"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."})},stateReset:function(){if(this.stateRestore(this.last.state),w2utils.hasLocalStorage)try{var e=$.parseJSON(localStorage.w2ui||"{}");e.states&&e.states[this.stateId||this.name]&&delete e.states[this.stateId||this.name],localStorage.w2ui=JSON.stringify(e)}catch(e){return delete localStorage.w2ui,null}},parseField:function(e,t){var i="";try{i=e;for(var s=String(t).split("."),n=0;n<s.length;n++)i=i[s[n]]}catch(e){i=""}return i},prepareData:function(){for(var a=this,e=0;e<this.records.length;e++){o(this.records[e])}function o(e){for(var t=0;t<a.columns.length;t++){var i=a.columns[t];if(null!=e[i.field]&&"string"==typeof i.render){if(-1!=["number","int","float","money","currency","percent"].indexOf(i.render.split(":")[0])&&"number"!=typeof e[i.field]&&(e[i.field]=parseFloat(e[i.field])),-1!=["date","age"].indexOf(i.render.split(":")[0])&&!e[i.field+"_"]){var s=e[i.field];w2utils.isInt(s)&&(s=parseInt(s)),e[i.field+"_"]=new Date(s)}if(-1!=["time"].indexOf(i.render))if(w2utils.isTime(e[i.field])){var n=w2utils.isTime(e[i.field],!0);(s=new Date).setHours(n.hours,n.minutes,n.seconds?n.seconds:0,0),e[i.field+"_"]||(e[i.field+"_"]=s)}else{n=e[i.field];w2utils.isInt(n)&&(n=parseInt(n));n=null!=n?new Date(n):new Date;(s=new Date).setHours(n.getHours(),n.getMinutes(),n.getSeconds(),0),e[i.field+"_"]||(e[i.field+"_"]=s)}}}if(e.w2ui&&e.w2ui.children&&!0!==e.w2ui.expanded)for(var r=0;r<e.w2ui.children.length;r++){o(e.w2ui.children[r])}}},nextCell:function(e,t,i){var s=t+1;if(s>=this.columns.length)return null;var n=this.records[e].w2ui,r=(this.columns[t],this.columns[s]),a=n&&n.colspan&&!isNaN(n.colspan[r.field])?parseInt(n.colspan[r.field]):1;if(null==r)return null;if(r&&r.hidden||0===a)return this.nextCell(e,s,i);if(i){var o=this.getCellEditable(e,t);if(null==o||-1!=["checkbox","check"].indexOf(o.type))return this.nextCell(e,s,i)}return s},prevCell:function(e,t,i){var s=t-1;if(s<0)return null;var n=this.records[e].w2ui,r=this.columns[s],a=n&&n.colspan&&!isNaN(n.colspan[r.field])?parseInt(n.colspan[r.field]):1;if(null==r)return null;if(r&&r.hidden||0===a)return this.prevCell(e,s,i);if(i){var o=this.getCellEditable(e,t);if(null==o||-1!=["checkbox","check"].indexOf(o.type))return this.prevCell(e,s,i)}return s},nextRow:function(e,t){var i=this.last.searchIds,s=null;if(e+1<this.records.length&&0===i.length||0<i.length&&e<i[i.length-1]){if(e++,0<i.length)for(;!(-1!=$.inArray(e,i)||e>this.records.length);)e++;var n=this.records[e].w2ui,r=this.columns[t];s=0===(n&&n.colspan&&null!=r&&!isNaN(n.colspan[r.field])?parseInt(n.colspan[r.field]):1)?this.nextRow(e,t):e}return s},prevRow:function(e,t){var i=this.last.searchIds,s=null;if(0<e&&0===i.length||0<i.length&&e>i[0]){if(e--,0<i.length)for(;!(-1!=$.inArray(e,i)||e<0);)e--;var n=this.records[e].w2ui,r=this.columns[t];s=0===(n&&n.colspan&&null!=r&&!isNaN(n.colspan[r.field])?parseInt(n.colspan[r.field]):1)?this.prevRow(e,t):e}return s},selectionSave:function(){return this.last._selection=this.getSelection(),this.last._selection},selectionRestore:function(e){var t=(new Date).getTime();this.last.selection={indexes:[],columns:{}};for(var i=this.last.selection,s=this.last._selection,n=0;n<s.length;n++){var r;if($.isPlainObject(s[n]))null!=(r=this.get(s[n].recid,!0))&&(-1==i.indexes.indexOf(r)&&i.indexes.push(r),i.columns[r]||(i.columns[r]=[]),i.columns[r].push(s[n].column));else null!=(r=this.get(s[n],!0))&&i.indexes.push(r)}return delete this.last._selection,!0!==e&&this.refresh(),(new Date).getTime()-t},message:function(e,t){"string"==typeof e&&(e={width:e.length<300?350:550,height:e.length<300?170:250,body:'<div class="w2ui-centered">'+e+"</div>",buttons:'<button class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message()\">Ok</button>",onOpen:function(e){setTimeout(function(){$(this.box).find(".w2ui-btn").focus()},25)},onClose:function(e){"function"==typeof t&&t()}}),w2utils.message.call(this,{box:this.box,path:"w2ui."+this.name,title:".w2ui-grid-header:visible",body:".w2ui-grid-box"},e)}},$.extend(w2grid.prototype,w2utils.event),w2obj.grid=w2grid}(jQuery),function(D){var d=function(e){this.box=null,this.name=null,this.panels=[],this.tmp={},this.padding=1,this.resizer=4,this.style="",D.extend(!0,this,w2obj.layout,e)},O=["top","left","main","preview","right","bottom"];D.fn.w2layout=function(e){if(D.isPlainObject(e)){if(!w2utils.checkName(e,"w2layout"))return;var t=e.panels||[],i=new d(e);D.extend(i,{handlers:[],panels:[]});for(var s=0,n=t.length;s<n;s++)i.panels[s]=D.extend(!0,{},d.prototype.panel,t[s]),(D.isPlainObject(i.panels[s].tabs)||D.isArray(i.panels[s].tabs))&&o(i,t[s].type),(D.isPlainObject(i.panels[s].toolbar)||D.isArray(i.panels[s].toolbar))&&l(i,t[s].type);for(var r=0;r<O.length;r++)null==i.get(O[r])&&i.panels.push(D.extend(!0,{},d.prototype.panel,{type:O[r],hidden:"main"!==O[r],size:50}));return 0<D(this).length&&i.render(D(this)[0]),w2ui[i.name]=i}var a=w2ui[D(this).attr("name")];return a?0<arguments.length?(a[e]&&a[e].apply(a,Array.prototype.slice.call(arguments,1)),this):a:null;function o(e,t,i){var s=e.get(t);return null!=s&&null==i&&(i=s.tabs),null!=s&&null!=i&&(D.isArray(i)&&(i={tabs:i}),D().w2destroy(e.name+"_"+t+"_tabs"),s.tabs=D().w2tabs(D.extend({},i,{owner:e,name:e.name+"_"+t+"_tabs"})),s.show.tabs=!0)}function l(e,t,i){var s=e.get(t);return null!=s&&null==i&&(i=s.toolbar),null!=s&&null!=i&&(D.isArray(i)&&(i={items:i}),D().w2destroy(e.name+"_"+t+"_toolbar"),s.toolbar=D().w2toolbar(D.extend({},i,{owner:e,name:e.name+"_"+t+"_toolbar"})),s.show.toolbar=!0)}},d.prototype={onShow:null,onHide:null,onResizing:null,onResizerClick:null,onRender:null,onRefresh:null,onContent:null,onResize:null,onDestroy:null,panel:{type:null,title:"",size:100,minSize:20,maxSize:!1,hidden:!1,resizable:!1,overflow:"auto",style:"",content:"",tabs:null,toolbar:null,width:null,height:null,show:{toolbar:!1,tabs:!1},onRefresh:null,onShow:null,onHide:null},html:function(e,t,i){return this.content(e,t,i)},content:function(e,t,i){var s=this,n=this.get(e);if("css"==e)return D("#layout_"+s.name+"_panel_css").html("<style>"+t+"</style>"),!0;if(null==n)return!1;if(null==t)return n.content;var r=this.trigger({phase:"before",type:"content",target:e,object:n,content:t,transition:i});if(!0!==r.isCancelled){if(t instanceof jQuery)return console.log("ERROR: You can not pass jQuery object to w2layout.content() method"),!1;var a="#layout_"+this.name+"_panel_"+n.type,o=D(a+"> .w2ui-panel-content"),l=0;if(0<o.length&&(D(a).scrollTop(0),l=D(o).position().top),""===n.content)n.content=t,this.refresh(e);else{if(n.content=t,!n.hidden&&null!=i&&""!==i){var d=D(a+"> .w2ui-panel-content");d.after('<div class="w2ui-panel-content new-panel" style="'+d[0].style.cssText+'"></div>');var u=D(a+"> .w2ui-panel-content.new-panel");d.css("top",l),u.css("top",l),"object"==typeof t?(t.box=u[0],t.render()):u.html(t),w2utils.transition(d[0],u[0],i,function(){d.remove(),u.removeClass("new-panel"),u.css("overflow",n.overflow),s.resize(),-1!=window.navigator.userAgent.indexOf("MSIE")&&setTimeout(function(){s.resize()},100)})}this.refresh(e)}return s.trigger(D.extend(r,{phase:"after"})),s.resize(),-1!=window.navigator.userAgent.indexOf("MSIE")&&setTimeout(function(){s.resize()},100),!0}},message:function(e,t){var i=this;"string"==typeof t&&(t={width:t.length<300?350:550,height:t.length<300?170:250,body:'<div class="w2ui-centered">'+t+"</div>",buttons:'<button class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message('"+e+"')\">Ok</button>",onOpen:function(e){setTimeout(function(){D(this.box).find(".w2ui-btn").focus()},25)}});var s,n=this.get(e),r=D("#layout_"+this.name+"_panel_"+n.type).css("overflow");t&&(t.onClose&&(s=t.onClose),t.onClose=function(e){"function"==typeof s&&s(e),e.done(function(){D("#layout_"+i.name+"_panel_"+n.type).css("overflow",r)})}),D("#layout_"+this.name+"_panel_"+n.type).css("overflow","hidden"),w2utils.message.call(this,{box:D("#layout_"+this.name+"_panel_"+n.type),param:e,path:"w2ui."+this.name,title:".w2ui-panel-title:visible",body:".w2ui-panel-content"},t)},load:function(s,e,n,r){var a=this;return"css"==s?(D.get(e,function(e,t,i){a.content(s,i.responseText),r&&r()}),!0):null!=this.get(s)&&(D.get(e,function(e,t,i){a.content(s,i.responseText,n),r&&r(),a.resize(),-1!=window.navigator.userAgent.indexOf("MSIE")&&setTimeout(function(){a.resize()},100)}),!0)},sizeTo:function(e,t,i){var s=this;return null!=s.get(e)&&(D(s.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition",!0!==i?".2s":"0s")),setTimeout(function(){s.set(e,{size:t})},1),setTimeout(function(){D(s.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition","0s")),s.resize()},500),!0)},show:function(e,t){var i=this,s=this.trigger({phase:"before",type:"show",target:e,object:this.get(e),immediate:t});if(!0!==s.isCancelled){var n=i.get(e);return null!=n&&(!(n.hidden=!1)===t?(D("#layout_"+i.name+"_panel_"+e).css({opacity:"1"}),i.trigger(D.extend(s,{phase:"after"})),i.resize()):(D("#layout_"+i.name+"_panel_"+e).css({opacity:"0"}),D(i.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition",".2s")),setTimeout(function(){i.resize()},1),setTimeout(function(){D("#layout_"+i.name+"_panel_"+e).css({opacity:"1"})},250),setTimeout(function(){D(i.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition","0s")),i.trigger(D.extend(s,{phase:"after"})),i.resize()},500)),!0)}},hide:function(e,t){var i=this,s=this.trigger({phase:"before",type:"hide",target:e,object:this.get(e),immediate:t});if(!0!==s.isCancelled){var n=i.get(e);return null!=n&&((n.hidden=!0)===t?(D("#layout_"+i.name+"_panel_"+e).css({opacity:"0"}),i.trigger(D.extend(s,{phase:"after"})),i.resize()):(D(i.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition",".2s")),D("#layout_"+i.name+"_panel_"+e).css({opacity:"0"}),setTimeout(function(){i.resize()},1),setTimeout(function(){D(i.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition","0s")),i.trigger(D.extend(s,{phase:"after"})),i.resize()},500)),!0)}},toggle:function(e,t){var i=this.get(e);return null!=i&&(i.hidden?this.show(e,t):this.hide(e,t))},set:function(e,t){var i=this.get(e,!0);return null!=i&&(D.extend(this.panels[i],t),null==t.content&&null==t.resizable||this.refresh(e),this.resize(),!0)},get:function(e,t){for(var i=0;i<this.panels.length;i++)if(this.panels[i].type==e)return!0===t?i:this.panels[i];return null},el:function(e){var t=D("#layout_"+this.name+"_panel_"+e+"> .w2ui-panel-content");return 1!=t.length?null:t[0]},hideToolbar:function(e){var t=this.get(e);t&&(t.show.toolbar=!1,D("#layout_"+this.name+"_panel_"+e+"> .w2ui-panel-toolbar").hide(),this.resize())},showToolbar:function(e){var t=this.get(e);t&&(t.show.toolbar=!0,D("#layout_"+this.name+"_panel_"+e+"> .w2ui-panel-toolbar").show(),this.resize())},toggleToolbar:function(e){var t=this.get(e);t&&(t.show.toolbar?this.hideToolbar(e):this.showToolbar(e))},assignToolbar:function(e,t){"string"==typeof t&&null!=w2ui[t]&&(t=w2ui[t]);var i=this.get(e);i.toolbar=t;var s=D(this.box).find(e+"> .w2ui-panel-toolbar");null!=i.toolbar?(0===s.find("[name="+i.toolbar.name+"]").length?s.w2render(i.toolbar):null!=i.toolbar&&i.toolbar.refresh(),this.showToolbar(e),this.refresh("main")):(s.html(""),this.hideToolbar(e))},hideTabs:function(e){var t=this.get(e);t&&(t.show.tabs=!1,D("#layout_"+this.name+"_panel_"+e+"> .w2ui-panel-tabs").hide(),this.resize())},showTabs:function(e){var t=this.get(e);t&&(t.show.tabs=!0,D("#layout_"+this.name+"_panel_"+e+"> .w2ui-panel-tabs").show(),this.resize())},toggleTabs:function(e){var t=this.get(e);t&&(t.show.tabs?this.hideTabs(e):this.showTabs(e))},render:function(e){var c=this,t=(new Date).getTime(),i=c.trigger({phase:"before",type:"render",target:c.name,box:e});if(!0!==i.isCancelled){if(null!=e&&(0<D(c.box).find("#layout_"+c.name+"_panel_main").length&&D(c.box).removeAttr("name").removeClass("w2ui-layout").html(""),c.box=e),!c.box)return!1;D(c.box).attr("name",c.name).addClass("w2ui-layout").html("<div></div>"),0<D(c.box).length&&(D(c.box)[0].style.cssText+=c.style);for(var s=0;s<O.length;s++){c.get(O[s]);var n='<div id="layout_'+c.name+"_panel_"+O[s]+'" class="w2ui-panel">    <div class="w2ui-panel-title"></div>    <div class="w2ui-panel-tabs"></div>    <div class="w2ui-panel-toolbar"></div>    <div class="w2ui-panel-content"></div></div><div id="layout_'+c.name+"_resizer_"+O[s]+'" class="w2ui-resizer"></div>';D(c.box).find(" > div").append(n)}return D(c.box).find(" > div").append('<div id="layout_'+c.name+'_panel_css" style="position: absolute; top: 10000px;"></div>'),c.refresh(),c.trigger(D.extend(i,{phase:"after"})),setTimeout(function(){c.tmp.events={resize:function(e){w2ui[c.name].resize()},resizeStart:r,mouseMove:o,mouseUp:a},D(window).on("resize",c.tmp.events.resize),c.resize()},0),(new Date).getTime()-t}function r(e,t){if(c.box){t||(t=window.event),D(document).off("mousemove",c.tmp.events.mouseMove).on("mousemove",c.tmp.events.mouseMove),D(document).off("mouseup",c.tmp.events.mouseUp).on("mouseup",c.tmp.events.mouseUp),c.tmp.resize={type:e,x:t.screenX,y:t.screenY,diff_x:0,diff_y:0,value:0};for(var i=0;i<O.length;i++){var s=D(c.el(O[i])).parent().find(".w2ui-lock");0<s.length?s.attr("locked","previous"):c.lock(O[i],{opacity:0})}"left"!=e&&"right"!=e||(c.tmp.resize.value=parseInt(D("#layout_"+c.name+"_resizer_"+e)[0].style.left)),"top"!=e&&"preview"!=e&&"bottom"!=e||(c.tmp.resize.value=parseInt(D("#layout_"+c.name+"_resizer_"+e)[0].style.top))}}function a(e){if(c.box&&(e||(e=window.event),D(document).off("mousemove",c.tmp.events.mouseMove),D(document).off("mouseup",c.tmp.events.mouseUp),null!=c.tmp.resize)){for(var t=0;t<O.length;t++){var i=D(c.el(O[t])).parent().find(".w2ui-lock");"previous"==i.attr("locked")?i.removeAttr("locked"):c.unlock(O[t])}if(0!==c.tmp.diff_x||0!==c.tmp.resize.diff_y){var s,n,r=c.get("top"),a=c.get("bottom"),o=c.get(c.tmp.resize.type),l=parseInt(D(c.box).height()),d=parseInt(D(c.box).width()),u=String(o.size);switch(c.tmp.resize.type){case"top":s=parseInt(o.sizeCalculated)+c.tmp.resize.diff_y,n=0;break;case"bottom":s=parseInt(o.sizeCalculated)-c.tmp.resize.diff_y,n=0;break;case"preview":s=parseInt(o.sizeCalculated)-c.tmp.resize.diff_y,n=(r&&!r.hidden?r.sizeCalculated:0)+(a&&!a.hidden?a.sizeCalculated:0);break;case"left":s=parseInt(o.sizeCalculated)+c.tmp.resize.diff_x,n=0;break;case"right":s=parseInt(o.sizeCalculated)-c.tmp.resize.diff_x,n=0}"%"==u.substr(u.length-1)?o.size=Math.floor(100*s/("left"==o.type||"right"==o.type?d:l-n)*100)/100+"%":"-"==String(o.size).substr(0,1)?o.size=parseInt(o.size)-o.sizeCalculated+s:o.size=s,c.resize()}D("#layout_"+c.name+"_resizer_"+c.tmp.resize.type).removeClass("active"),delete c.tmp.resize}}function o(e){if(c.box&&(e||(e=window.event),null!=c.tmp.resize)){var t=c.get(c.tmp.resize.type),i=c.tmp.resize,s=c.trigger({phase:"before",type:"resizing",target:c.name,object:t,originalEvent:e,panel:i?i.type:"all",diff_x:i?i.diff_x:0,diff_y:i?i.diff_y:0});if(!0!==s.isCancelled){var n=D("#layout_"+c.name+"_resizer_"+i.type),r=e.screenX-i.x,a=e.screenY-i.y,o=c.get("main");switch(n.hasClass("active")||n.addClass("active"),i.type){case"left":t.minSize-r>t.width&&(r=t.minSize-t.width),t.maxSize&&t.width+r>t.maxSize&&(r=t.maxSize-t.width),o.minSize+r>o.width&&(r=o.width-o.minSize);break;case"right":t.minSize+r>t.width&&(r=t.width-t.minSize),t.maxSize&&t.width-r>t.maxSize&&(r=t.width-t.maxSize),o.minSize-r>o.width&&(r=o.minSize-o.width);break;case"top":t.minSize-a>t.height&&(a=t.minSize-t.height),t.maxSize&&t.height+a>t.maxSize&&(a=t.maxSize-t.height),o.minSize+a>o.height&&(a=o.height-o.minSize);break;case"preview":case"bottom":t.minSize+a>t.height&&(a=t.height-t.minSize),t.maxSize&&t.height-a>t.maxSize&&(a=t.height-t.maxSize),o.minSize-a>o.height&&(a=o.minSize-o.height)}switch(i.diff_x=r,i.diff_y=a,i.type){case"top":case"preview":case"bottom":(i.diff_x=0)<n.length&&(n[0].style.top=i.value+i.diff_y+"px");break;case"left":case"right":(i.diff_y=0)<n.length&&(n[0].style.left=i.value+i.diff_x+"px")}c.trigger(D.extend(s,{phase:"after"}))}}}},refresh:function(e){var t=this;null==e&&(e=null);var i=(new Date).getTime(),s=t.trigger({phase:"before",type:"refresh",target:null!=e?e:t.name,object:t.get(e)});if(!0!==s.isCancelled){if("string"==typeof e){var n=t.get(e);if(null==n)return;var r="#layout_"+t.name+"_panel_"+n.type,a="#layout_"+t.name+"_resizer_"+n.type;D(r).css({display:n.hidden?"none":"block"}),n.resizable?D(a).show():D(a).hide(),"object"==typeof n.content&&"function"==typeof n.content.render?(n.content.box=D(r+"> .w2ui-panel-content")[0],setTimeout(function(){0<D(r+"> .w2ui-panel-content").length&&(D(r+"> .w2ui-panel-content").removeClass().removeAttr("name").addClass("w2ui-panel-content").css("overflow",n.overflow)[0].style.cssText+=";"+n.style),n.content&&"function"==typeof n.content.render&&n.content.render()},1)):0<D(r+"> .w2ui-panel-content").length&&(D(r+"> .w2ui-panel-content").removeClass().removeAttr("name").addClass("w2ui-panel-content").html(n.content).css("overflow",n.overflow)[0].style.cssText+=";"+n.style);var o=D(t.box).find(r+"> .w2ui-panel-tabs");n.show.tabs?0===o.find("[name="+n.tabs.name+"]").length&&null!=n.tabs?o.w2render(n.tabs):n.tabs.refresh():o.html("").removeClass("w2ui-tabs").hide(),o=D(t.box).find(r+"> .w2ui-panel-toolbar"),n.show.toolbar?0===o.find("[name="+n.toolbar.name+"]").length&&null!=n.toolbar?o.w2render(n.toolbar):n.toolbar.refresh():o.html("").removeClass("w2ui-toolbar").hide(),o=D(t.box).find(r+"> .w2ui-panel-title"),n.title?o.html(n.title).show():o.html("").hide()}else{if(0===D("#layout_"+t.name+"_panel_main").length)return void t.render();t.resize();for(var l=0;l<this.panels.length;l++)t.refresh(this.panels[l].type)}return t.trigger(D.extend(s,{phase:"after"})),(new Date).getTime()-i}},resize:function(){if(!this.box)return!1;var e=(new Date).getTime(),t=this.tmp.resize,i=this.trigger({phase:"before",type:"resize",target:this.name,panel:t?t.type:"all",diff_x:t?t.diff_x:0,diff_y:t?t.diff_y:0});if(!0!==i.isCancelled){this.padding<0&&(this.padding=0);var s=parseInt(D(this.box).width()),n=parseInt(D(this.box).height());D(this.box).find(" > div").css({width:s+"px",height:n+"px"});for(var r,a,o,l,d,u=this,c=this.get("main"),h=this.get("preview"),p=this.get("left"),f=this.get("right"),g=this.get("top"),m=this.get("bottom"),w=null!=h&&!0!==h.hidden,v=null!=p&&!0!==p.hidden,y=null!=f&&!0!==f.hidden,b=null!=g&&!0!==g.hidden,x=null!=m&&!0!==m.hidden,_=0;_<O.length;_++)if("main"!==O[_]&&(t=this.get(O[_]))){var k=String(t.size||0);if("%"==k.substr(k.length-1)){var $=n;"preview"==t.type&&($=$-(g&&!g.hidden?g.sizeCalculated:0)-(m&&!m.hidden?m.sizeCalculated:0)),t.sizeCalculated=parseInt(("left"==t.type||"right"==t.type?s:$)*parseFloat(t.size)/100)}else t.sizeCalculated=parseInt(t.size);t.sizeCalculated=Math.max(t.sizeCalculated,parseInt(t.minSize))}"-"==String(f.size).substr(0,1)&&(v&&"-"==p.size.substr(0,1)?console.log("ERROR: you cannot have both left panel.size and right panel.size be negative."):f.sizeCalculated=s-(v?p.sizeCalculated:0)+parseInt(f.size)),"-"==String(p.size).substr(0,1)&&(y&&"-"==f.size.substr(0,1)?console.log("ERROR: you cannot have both left panel.size and right panel.size be negative."):p.sizeCalculated=s-(y?f.sizeCalculated:0)+parseInt(p.size)),null!=g&&!0!==g.hidden?(a=r=0,o=s,l=g.sizeCalculated,D("#layout_"+this.name+"_panel_top").css({display:"block",left:r+"px",top:a+"px",width:o+"px",height:l+"px"}).show(),g.width=o,g.height=l,g.resizable&&(a=g.sizeCalculated-(0===this.padding?this.resizer:0),l=this.resizer>this.padding?this.resizer:this.padding,D("#layout_"+this.name+"_resizer_top").show().css({display:"block",left:r+"px",top:a+"px",width:o+"px",height:l+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(e){var t=u.trigger({phase:"before",type:"resizerClick",target:"top",originalEvent:e});if(!0!==t.isCancelled)return w2ui[u.name].tmp.events.resizeStart("top",e),u.trigger(D.extend(t,{phase:"after"})),!1}))):(D("#layout_"+this.name+"_panel_top").hide(),D("#layout_"+this.name+"_resizer_top").hide()),null!=p&&!0!==p.hidden?(a=(r=0)+(b?g.sizeCalculated+this.padding:0),o=p.sizeCalculated,l=n-(b?g.sizeCalculated+this.padding:0)-(x?m.sizeCalculated+this.padding:0),d=D("#layout_"+this.name+"_panel_left"),-1!=window.navigator.userAgent.indexOf("MSIE")&&0<d.length&&d[0].clientHeight<d[0].scrollHeight&&(o+=17),d.css({display:"block",left:r+"px",top:a+"px",width:o+"px",height:l+"px"}).show(),p.width=o,p.height=l,p.resizable&&(r=p.sizeCalculated-(0===this.padding?this.resizer:0),o=this.resizer>this.padding?this.resizer:this.padding,D("#layout_"+this.name+"_resizer_left").show().css({display:"block",left:r+"px",top:a+"px",width:o+"px",height:l+"px",cursor:"ew-resize"}).off("mousedown").on("mousedown",function(e){var t=u.trigger({phase:"before",type:"resizerClick",target:"left",originalEvent:e});if(!0!==t.isCancelled)return w2ui[u.name].tmp.events.resizeStart("left",e),u.trigger(D.extend(t,{phase:"after"})),!1}))):(D("#layout_"+this.name+"_panel_left").hide(),D("#layout_"+this.name+"_resizer_left").hide()),null!=f&&!0!==f.hidden?(r=s-f.sizeCalculated,a=0+(b?g.sizeCalculated+this.padding:0),o=f.sizeCalculated,l=n-(b?g.sizeCalculated+this.padding:0)-(x?m.sizeCalculated+this.padding:0),D("#layout_"+this.name+"_panel_right").css({display:"block",left:r+"px",top:a+"px",width:o+"px",height:l+"px"}).show(),f.width=o,f.height=l,f.resizable&&(r-=this.padding,o=this.resizer>this.padding?this.resizer:this.padding,D("#layout_"+this.name+"_resizer_right").show().css({display:"block",left:r+"px",top:a+"px",width:o+"px",height:l+"px",cursor:"ew-resize"}).off("mousedown").on("mousedown",function(e){var t=u.trigger({phase:"before",type:"resizerClick",target:"right",originalEvent:e});if(!0!==t.isCancelled)return w2ui[u.name].tmp.events.resizeStart("right",e),u.trigger(D.extend(t,{phase:"after"})),!1}))):(D("#layout_"+this.name+"_panel_right").hide(),D("#layout_"+this.name+"_resizer_right").hide()),null!=m&&!0!==m.hidden?(r=0,a=n-m.sizeCalculated,o=s,l=m.sizeCalculated,D("#layout_"+this.name+"_panel_bottom").css({display:"block",left:r+"px",top:a+"px",width:o+"px",height:l+"px"}).show(),m.width=o,m.height=l,m.resizable&&(a-=0===this.padding?0:this.padding,l=this.resizer>this.padding?this.resizer:this.padding,D("#layout_"+this.name+"_resizer_bottom").show().css({display:"block",left:r+"px",top:a+"px",width:o+"px",height:l+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(e){var t=u.trigger({phase:"before",type:"resizerClick",target:"bottom",originalEvent:e});if(!0!==t.isCancelled)return w2ui[u.name].tmp.events.resizeStart("bottom",e),u.trigger(D.extend(t,{phase:"after"})),!1}))):(D("#layout_"+this.name+"_panel_bottom").hide(),D("#layout_"+this.name+"_resizer_bottom").hide()),r=0+(v?p.sizeCalculated+this.padding:0),a=0+(b?g.sizeCalculated+this.padding:0),o=s-(v?p.sizeCalculated+this.padding:0)-(y?f.sizeCalculated+this.padding:0),l=n-(b?g.sizeCalculated+this.padding:0)-(x?m.sizeCalculated+this.padding:0)-(w?h.sizeCalculated+this.padding:0),d=D("#layout_"+this.name+"_panel_main"),-1!=window.navigator.userAgent.indexOf("MSIE")&&0<d.length&&d[0].clientHeight<d[0].scrollHeight&&(o+=17),d.css({display:"block",left:r+"px",top:a+"px",width:o+"px",height:l+"px"}),c.width=o,c.height=l,null!=h&&!0!==h.hidden?(r=0+(v?p.sizeCalculated+this.padding:0),a=n-(x?m.sizeCalculated+this.padding:0)-h.sizeCalculated,o=s-(v?p.sizeCalculated+this.padding:0)-(y?f.sizeCalculated+this.padding:0),l=h.sizeCalculated,d=D("#layout_"+this.name+"_panel_preview"),-1!=window.navigator.userAgent.indexOf("MSIE")&&0<d.length&&d[0].clientHeight<d[0].scrollHeight&&(o+=17),d.css({display:"block",left:r+"px",top:a+"px",width:o+"px",height:l+"px"}).show(),h.width=o,h.height=l,h.resizable&&(a-=0===this.padding?0:this.padding,l=this.resizer>this.padding?this.resizer:this.padding,D("#layout_"+this.name+"_resizer_preview").show().css({display:"block",left:r+"px",top:a+"px",width:o+"px",height:l+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(e){var t=u.trigger({phase:"before",type:"resizerClick",target:"preview",originalEvent:e});if(!0!==t.isCancelled)return w2ui[u.name].tmp.events.resizeStart("preview",e),u.trigger(D.extend(t,{phase:"after"})),!1}))):(D("#layout_"+this.name+"_panel_preview").hide(),D("#layout_"+this.name+"_resizer_preview").hide());for(var C=0;C<O.length;C++){var T=this.get(O[C]),z="#layout_"+this.name+"_panel_"+O[C]+" > .w2ui-panel-",S=0;T&&(T.title&&(S+=w2utils.getSize(D(z+"title").css({top:S+"px",display:"block"}),"height")),T.show.tabs&&(null!=T.tabs&&w2ui[this.name+"_"+O[C]+"_tabs"]&&w2ui[this.name+"_"+O[C]+"_tabs"].resize(),S+=w2utils.getSize(D(z+"tabs").css({top:S+"px",display:"block"}),"height")),T.show.toolbar&&(null!=T.toolbar&&w2ui[this.name+"_"+O[C]+"_toolbar"]&&w2ui[this.name+"_"+O[C]+"_toolbar"].resize(),S+=w2utils.getSize(D(z+"toolbar").css({top:S+"px",display:"block"}),"height"))),D(z+"content").css({display:"block"}).css({top:S+"px"})}return clearTimeout(this._resize_timer),this._resize_timer=setTimeout(function(){for(var e in w2ui)if("function"==typeof w2ui[e].resize){null==w2ui[e].panels&&w2ui[e].resize();var t=D(w2ui[e].box).parents(".w2ui-layout");0<t.length&&t.attr("name")==u.name&&w2ui[e].resize()}},100),this.trigger(D.extend(i,{phase:"after"})),(new Date).getTime()-e}},destroy:function(){var e=this.trigger({phase:"before",type:"destroy",target:this.name});if(!0!==e.isCancelled)return null!=w2ui[this.name]&&(0<D(this.box).find("#layout_"+this.name+"_panel_main").length&&D(this.box).removeAttr("name").removeClass("w2ui-layout").html(""),delete w2ui[this.name],this.trigger(D.extend(e,{phase:"after"})),this.tmp.events&&this.tmp.events.resize&&D(window).off("resize",this.tmp.events.resize),!0)},lock:function(e,t,i){if(-1!=O.indexOf(e)){var s=Array.prototype.slice.call(arguments,0);s[0]="#layout_"+this.name+"_panel_"+e,w2utils.lock.apply(window,s)}else console.log("ERROR: First parameter needs to be the a valid panel name.")},unlock:function(e,t){if(-1!=O.indexOf(e)){var i="#layout_"+this.name+"_panel_"+e;w2utils.unlock(i,t)}else console.log("ERROR: First parameter needs to be the a valid panel name.")}},D.extend(d.prototype,w2utils.event),w2obj.layout=d}(jQuery);var w2popup={};!function($){$.fn.w2popup=function(e,t){null==e&&(t={},e="open"),$.isPlainObject(e)&&(t=e,e="open"),"load"===(e=e.toLowerCase())&&"string"==typeof t&&(t=$.extend({url:t},2<arguments.length?arguments[2]:{})),"open"===e&&null!=t.url&&(e="load"),t=t||{};var i={};return 0<$(this).length&&"open"==e&&(0<$(this).find("div[rel=title], div[rel=body], div[rel=buttons]").length?(w2popup._template=this,0<$(this).find("div[rel=title]").length&&(i.title=$(this).find("div[rel=title]")),0<$(this).find("div[rel=body]").length&&(i.body=$(this).find("div[rel=body]"),i.style=$(this).find("div[rel=body]")[0].style.cssText),0<$(this).find("div[rel=buttons]").length&&(i.buttons=$(this).find("div[rel=buttons]"))):(i.title="&#160;",i.body=$(this).html()),0!==parseInt($(this).css("width"))&&(i.width=parseInt($(this).css("width"))),0!==parseInt($(this).css("height"))&&(i.height=parseInt($(this).css("height")))),w2popup[e]($.extend({},i,t))},w2popup={defaults:{title:"",body:"",url:"",buttons:"",style:"",color:"#000",opacity:.4,speed:.3,modal:!1,maximized:!1,bottomFixed:!1,keyboard:!0,width:500,height:300,showClose:!0,showMax:!1,showMin:!1,onCallBack:null,transition:null},status:"closed",handlers:[],onOpen:null,onClose:null,onMax:null,onMin:null,onToggle:null,onKeydown:null,onCallBack:null,open:function(e){var t,i,s=this,n=null,r=null;(e=$.extend({},this.defaults,{title:"",body:"",buttons:""},e,{maximized:!1})).onOpen&&(w2popup.onOpen=e.onOpen),e.onClose&&(w2popup.onClose=e.onClose),e.onMax&&(w2popup.onMax=e.onMax),e.onMin&&(w2popup.onMin=e.onMin),e.onToggle&&(w2popup.onToggle=e.onToggle),e.onKeydown&&(w2popup.onKeydown=e.onKeydown),e.onKeydown&&(w2popup.onCallBack=e.onCallBack),e.width=parseInt(e.width),e.height=parseInt(e.height),null==window.innerHeight?(t=parseInt(document.documentElement.offsetWidth),i=parseInt(document.documentElement.offsetHeight),"IE7"===w2utils.engine&&(t+=21,i+=4)):(t=parseInt(window.innerWidth),i=parseInt(window.innerHeight)),t-10<e.width&&(e.width=t-10),i-10<e.height&&(e.height=i-10);for(var a=(i-e.height)/2*.6,o=(t-e.width)/2,l=this.trigger({phase:"before",type:"open",target:"popup",options:e,present:!1}),d="w2ui-popup"+Math.floor(1001*Math.random());$("#"+d).is(":empty");)d="w2ui-popup"+Math.floor(1001*Math.random());if(!0!==l.isCancelled){w2popup.status="opening",w2popup.lockScreen(e);var u,c="";e.showClose&&(c+='<div class="w2ui-popup-button w2ui-popup-close" onmousedown="event.stopPropagation()" onclick="w2popup.close(this)">Close</div>'),e.showMax&&(c+='<div class="w2ui-popup-button w2ui-popup-max" onmousedown="event.stopPropagation()" onclick="w2popup.toggle(this)">Max</div>'),e.showMin&&(c+='<div class="w2ui-popup-button w2ui-popup-min" onmousedown="event.stopPropagation()" onclick="w2popup.minimize(this)">Min</div>'),n='<div id="'+d+'" class="w2ui-popup" style="opacity: 0; left: '+o+"px; top: "+a+"px;     width: "+parseInt(e.width)+"px; height: "+parseInt(e.height)+"px;      min-width: "+parseInt(e.minwidth)+"px; min-height: "+parseInt(e.minheight)+"px; "+w2utils.cssPrefix("transform","scale(0.8)",!0)+' onClick=""></div>',0<(r=$(n)).find("div[rel=title], div[rel=body], div[rel=buttons]").length&&(0<(u=r.find("div[rel=title]")).length&&(e.title=u.html(),u.remove()),0<(u=r.find("div[rel=buttons]")).length&&(e.buttons=u.html(),u.remove()),0<(u=r.find("div[rel=body]")).length?e.body=u.html():e.body=r.html()),n='<div class="linhe_resize"><div class="resize_left_top"></div><div class="resize_top"></div><div class="resize_right_top"></div></div><div class="w2ui-popup-title" style="'+(e.title?"":"display: none")+'" onmousedown="event.stopPropagation()" ondblclick="w2popup.toggle(this)"><div class="resize_left"></div><img class="icon_32" src="'+e.icon+'"/><div class="title"></div><div class="resize_right"></div>'+c+'</div><div class="resize_linhe_container"><div class="resize_left"></div><div class="resize_center_container"><div class="w2ui-box" ><div class="w2ui-popup-body" '+(e.buttons?"":' style="height:calc(100% - 40px);'+e.style+'"')+'"></div></div><div class="line-button" style="'+(e.buttons?"":"display: none")+'"></div></div><div class="resize_right"></div></div><div class="linhe_resize"><div class="resize_left_bottom"></div><div class="resize_bottom"></div><div class="resize_right_bottom"></div></div><input class="w2ui-popup-hidden" style="position: absolute; top: -100px"/>',r.html(n),r.data("options",e),e.title&&r.find(".title").append(e.title),e.buttons&&r.find(".line-button").append(e.buttons),e.body&&r.find(".w2ui-popup-body").append(e.body),null!=e.url&&""!=e.url&&r.find(".w2ui-popup-body").append('<form onsubmit="return false;"><div class="line" style="height:30px;"><input type="text" name="url" style="width:calc(100% - 105px);" value="'+e.url+'" onKeypress="w2popup.pressEnterGo(this,event)"><input type="button" style="width:35px;" value="IR" onKeydown="this.click" onclick="w2popup.go(this)"><input type="button" style="width:35px;" value="<"  onKeydown="this.click" onclick="w2popup.back(this)"><input type="button" style="width:35px;" value=">"  onKeydown="this.click" onclick="w2popup.forward(this)"></div></form><iframe class="iframe" src="'+e.url+'" width=100% style="height:calc(100% - 35px);" frameborder=0 onload="w2popup.iframeAddCode(this)"></iframe>');try{$(parent.document.getElementsByTagName("body")[0]).append(r)}catch(e){$("body").append(r)}return setTimeout(function(){r.css("opacity","1").css(w2utils.cssPrefix({transition:e.speed+"s opacity, "+e.speed+"s -webkit-transform",transform:"scale(1)"})),s.focus()},1),setTimeout(function(){r.css(w2utils.cssPrefix("transform","")),w2popup.status="open",setTimeout(function(){s.trigger($.extend(l,{phase:"after"}))},100)},1e3*e.speed),e.modal&&this.lockScreen(e,r),w2popup.initialize(r),this.x_w2ui_popup=r,this}},initialize:function(tag){var x_w2ui_popup=$(tag).hasClass(".w2ui-popup")?$(tag):$(tag).closest(".w2ui-popup"),options=x_w2ui_popup.data("options");x_w2ui_popup.css("z-index",16e3);try{options._last_focus=$(":focus")}catch(e){options=$.extend({},this.defaults,{title:"",body:"",buttons:""},{maximized:!1}),x_w2ui_popup.data("options",options),options._last_focus=$(":focus")}try{1==options.keyboard&&$(document).on("keydown",this.keydown)}catch(e){}function mvStart(e){e.screenX,e.screenY;e||(e=window.event);var t=$(e.target).closest(".w2ui-popup");if(tmp.id=t.attr("id"),tmp.isLocked=1==t.find(".w2ui-lock").length,tmp.x=e.screenX,tmp.y=e.screenY,tmp.pos_x=t.position().left,tmp.pos_y=t.position().top,tmp.isLocked||w2popup.lock({opacity:0}),$(document).on("mousemove",tmp.mvMove),$(document).on("mouseup",tmp.mvStop),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,!e.preventDefault)return!1;e.preventDefault()}function resize_right_bottom(e){tmp.resizing=!0,tmp.type_resizing="right_bottom",w2popup.status="resizing",mvStart(e)}function resize_right_top(e){tmp.resizing=!0,tmp.type_resizing="right_top",w2popup.status="resizing",mvStart(e)}function resize_left_bottom(e){tmp.resizing=!0,tmp.type_resizing="left_bottom",w2popup.status="resizing",mvStart(e)}function resize_left_top(e){tmp.resizing=!0,tmp.type_resizing="left_top",w2popup.status="resizing",mvStart(e)}function resize_top(e){tmp.resizing=!0,tmp.type_resizing="top",w2popup.status="resizing",mvStart(e)}function resize_right(e){tmp.resizing=!0,tmp.type_resizing="right",w2popup.status="resizing",mvStart(e)}function resize_left(e){tmp.resizing=!0,tmp.type_resizing="left",w2popup.status="resizing",mvStart(e)}function resize_bottom(e){tmp.resizing=!0,w2popup.status="resizing",tmp.type_resizing="bottom",mvStart(e)}$(".w2ui-popup .w2ui-popup-title").on("mousedown",function(e){var t=$(e.target).closest(".w2ui-popup");w2popup.get(t).maximized||(tmp.moved=!0,w2popup.status="moving",mvStart(e))}),$(".w2ui-popup .resize_right_bottom").on("mousedown",function(e){var t=$(e.target).closest(".w2ui-popup");1==!w2popup.get(t).maximized&&resize_right_bottom(e)}),$(".w2ui-popup .resize_left_bottom").on("mousedown",function(e){var t=$(e.target).closest(".w2ui-popup");1==!w2popup.get(t).maximized&&resize_left_bottom(e)}),$(".w2ui-popup .resize_right_top").on("mousedown",function(e){var t=$(e.target).closest(".w2ui-popup");1==!w2popup.get(t).maximized&&resize_right_top(e)}),$(".w2ui-popup .resize_left_top").on("mousedown",function(e){var t=$(e.target).closest(".w2ui-popup");1==!w2popup.get(t).maximized&&resize_left_top(e)}),$(".w2ui-popup .resize_top").on("mousedown",function(e){var t=$(e.target).closest(".w2ui-popup");1==!w2popup.get(t).maximized&&resize_top(e)}),$(".w2ui-popup .resize_bottom").on("mousedown",function(e){var t=$(e.target).closest(".w2ui-popup");1==!w2popup.get(t).maximized&&resize_bottom(e)}),$(".w2ui-popup .resize_left").on("mousedown",function(e){var t=$(e.target).closest(".w2ui-popup");1==!w2popup.get(t).maximized&&resize_left(e)}),$(".w2ui-popup .resize_right").on("mousedown",function(e){var t=$(e.target).closest(".w2ui-popup");1==!w2popup.get(t).maximized&&resize_right(e)}),$(".w2ui-popup *").on("mousedown",function(e){var t=$(e.target).closest(".w2ui-popup");w2popup.activewindows(t)});var tmp={resizing:!1,type_resizing:"",move:!1,div_x:0,div_y:0,mvMove:function(evnt){if(tmp.moved){var x_w2ui_popup=$("#"+tmp.id),limit_left=$(window).width()-x_w2ui_popup.width(),left=tmp.pos_x+tmp.div_x;left=0<left?left:0,left=left<limit_left?left:limit_left;var limit_top=$(window).height()-x_w2ui_popup.height()-40,top=tmp.pos_y+tmp.div_y;top=0<top?top:0,top=top<limit_top?top:limit_top,evnt||(evnt=window.event),tmp.div_x=evnt.screenX-tmp.x,tmp.div_y=evnt.screenY-tmp.y,x_w2ui_popup.css({left:left+"px",top:top+"px"}).css(w2utils.cssPrefix({transition:"none",transform:"translate3d(0px, 0px, 0px)"}))}else{if(!tmp.resizing)return;evnt||(evnt=window.event),tmp.div_x=evnt.screenX-tmp.x,tmp.div_y=evnt.screenY-tmp.y,tmp.x=evnt.screenX,tmp.y=evnt.screenY;var x_w2ui_popup=$("#"+tmp.id),options=x_w2ui_popup.data("options");try{tmp.min_width=x_w2ui_popup.css("min-width"),tmp.min_width=tmp.min_width.substr(0,tmp.min_width.length-2),tmp.min_width=eval(tmp.min_width)}catch(e){tmp.min_width=0}var limit_left=x_w2ui_popup.position().left+tmp.div_x,left=x_w2ui_popup.position().left+tmp.div_x;left=0<left?left:0,left=left<limit_left?left:limit_left,tmp.width=x_w2ui_popup.width();try{tmp.min_height=x_w2ui_popup.css("min-height"),tmp.min_height=tmp.min_height.substr(0,tmp.min_height.length-2),tmp.min_height=eval(tmp.min_height)}catch(e){tmp.min_height=0}var limit_top=$(window).height()-x_w2ui_popup.height()-40,top=x_w2ui_popup.position().top+tmp.div_y;top=0<top?top:0,top=top<limit_top?top:limit_top,tmp.height=x_w2ui_popup.height(),-1!=tmp.type_resizing.indexOf("left")?(0<left&&(tmp.width=x_w2ui_popup.width()-tmp.div_x),tmp.width>tmp.min_width?x_w2ui_popup.css("left",left+"px"):tmp.mvStop(evnt)):-1!=tmp.type_resizing.indexOf("right")&&(tmp.width=x_w2ui_popup.width()+tmp.div_x),-1!=tmp.type_resizing.indexOf("top")?x_w2ui_popup.height()-tmp.div_y>=tmp.min_height?(0<top&&(tmp.height=x_w2ui_popup.height()-tmp.div_y),1!=options.bottomFixed&&x_w2ui_popup.css("top",top+"px")):tmp.mvStop(evnt):-1!=tmp.type_resizing.indexOf("bottom")&&(tmp.height=x_w2ui_popup.height()+tmp.div_y),x_w2ui_popup.width(tmp.width),x_w2ui_popup.height(tmp.height)}},mvStop:function(e){if(tmp.moved)e||(e=window.event),w2popup.status="open",tmp.div_x=e.screenX-tmp.x,tmp.div_y=e.screenY-tmp.y,tmp.moved=!1,$(document).off("mousemove",tmp.mvMove),$(document).off("mouseup",tmp.mvStop),tmp.isLocked||w2popup.unlock();else{if(!tmp.resizing)return;e||(e=window.event),w2popup.status="open",tmp.resizing=!1,$(document).off("mousemove",tmp.mvMove),$(document).off("mouseup",tmp.mvStop),tmp.isLocked||w2popup.unlock()}}}},keydown:function(e){var t=$(e.target).closest(".w2ui-popup").data("options");if(!t||t.keyboard){var i=w2popup.trigger({phase:"before",type:"keydown",target:"popup",options:t,originalEvent:e});!0!==i.isCancelled&&(e.keyCode,w2popup.trigger($.extend(i,{phase:"after"})))}},close:function(e){var t=$(e).hasClass(".w2ui-popup")?$(e):$(e).closest(".w2ui-popup"),i=t.data("options");try{t.unlockScreen(i,t)}catch(e){$("#w2ui-lock").remove()}try{i.onClose(t)}catch(e){}t.remove()},activewindows:function(e){var t=$(e).hasClass(".w2ui-popup")?$(e):$(e).closest(".w2ui-popup"),i=0;$(".w2ui-popup").each(function(){$(this).is(t)?($(this).css("z-index",16e3),w2popup.activetask()):$(this).is(":visible")&&(i++,$(this).css("z-index",i))}),$(".menu-container").css("z-index",19e3),$(".menu-container").css("display","none"),t.show()},disabledwindows:function(e){var t=$(e).hasClass(".w2ui-popup")?$(e):$(e).closest(".w2ui-popup"),i=0,s=0,n=$(".w2ui-popup");n.each(function(e){$(this).is(t)&&(s=i),i++,$(this).css("z-index",i)}),s=(s=0==s?1:s)==n.length-1?n.length-2:s,w2popup.activewindows($(n.get(s))),$(".menu-container").css("z-index",19e3),$(".menu-container").css("display","none")},activetask:function(){$(".task").each(function(){16e3<=$("#"+$(this).attr("w2popup_id")).css("z-index")?$(this).css("opacity","1"):$(this).css("opacity","0.8")})},iframeAddCode:function(e){var t=$(e).closest(".w2ui-popup"),i=t.attr("id"),s=t.data("options"),n=null;try{n=s.onCallBack}catch(e){}n=null==n?"":n,0==$(e).contents().find('meta[name="w2popup"]').length&&0==$(e).contents().find('meta[name="calback"]').length&&($(e).contents().find("head").append($("<meta></meta>",{name:"w2popup",content:i})),$(e).contents().find("head").append($("<meta></meta>",{name:"calback",content:n.toString()})),$(e).contents().find("*").on("mousedown",function(e){w2popup.activewindows(w2desktop.getPopup(i))})),setTimeout(function(){w2popup.iframeAddCode(e)},1e3)},go:function(tag){var x_w2ui_popup=$(tag).hasClass(".w2ui-popup")?$(tag):$(tag).closest(".w2ui-popup");try{var x=eval(x_w2ui_popup.find("iframe").attr("pos"));x++,x_w2ui_popup.find("iframe").attr("pos",""+x);var _history=x_w2ui_popup.find("iframe").attr("history").split(",");_history.push(x_w2ui_popup.find("iframe").attr("src")),x_w2ui_popup.find("iframe").attr("history",""+_history.toString())}catch(e){x_w2ui_popup.find("iframe").attr("pos","1"),x_w2ui_popup.find("iframe").attr("history",new Array(x_w2ui_popup.find("iframe").attr("src"),tag.form.elements.url.value).toString())}return x_w2ui_popup.find("iframe").attr("src",tag.form.elements.url.value),!1},pressEnterGo:function(e,t){t.keyCode?t.keyCode:t.which;13==event.which&&w2popup.go(e)},updateIframe:function(x_w2ui_popup,url){var _iframe=x_w2ui_popup.find("iframe"),id=x_w2ui_popup.attr("id"),options=x_w2ui_popup.data("options"),callback=options.onCallBack;callback=null==callback?"":callback,$(_iframe).contents().find("head").append($("<meta></meta>",{name:"w2popup",content:id})),$(_iframe).contents().find("head").append($("<meta></meta>",{name:"calback",content:callback.toString()}));try{var x=eval(_iframe.attr("pos"));x++,_iframe.attr("pos",""+x);var _history=_iframe.attr("history").split(",");_history.push(_iframe.attr("src")),_iframe.attr("history",""+_history.toString())}catch(e){_iframe.attr("pos","1"),_iframe.attr("history",new Array(_iframe.attr("src"),_iframe).toString())}return _iframe.attr("src",url),!1},back:function(tag){var x_w2ui_popup=$(tag).hasClass(".w2ui-popup")?$(tag):$(tag).closest(".w2ui-popup");try{var x=eval(x_w2ui_popup.find("iframe").attr("pos"));if(x<=0)return!1;x--,x_w2ui_popup.find("iframe").attr("pos",""+x);var _history=x_w2ui_popup.find("iframe").attr("history").split(",");x_w2ui_popup.find("iframe").attr("src",_history[x]),tag.form.elements.url.value=_history[x]}catch(e){}return!1},forward:function(tag){var x_w2ui_popup=$(tag).hasClass(".w2ui-popup")?$(tag):$(tag).closest(".w2ui-popup");try{var x=eval(x_w2ui_popup.find("iframe").attr("pos")),_history=x_w2ui_popup.find("iframe").attr("history").split(",");if(x>=_history.length-1)return!1;x++,x_w2ui_popup.find("iframe").attr("pos",""+x),x_w2ui_popup.find("iframe").attr("src",_history[x]),tag.form.elements.url.value=_history[x]}catch(e){}return!1},minimize:function(e){($(e).hasClass(".w2ui-popup")?$(e):$(e).closest(".w2ui-popup")).hide(),w2popup.disabledwindows(e)},toggle:function(e){var t=$(e).hasClass(".w2ui-popup")?$(e):$(e).closest(".w2ui-popup"),i=this,s=t.data("options"),n=this.trigger({phase:"before",type:"toggle",target:"popup",options:s});!0!==n.isCancelled&&(!0===s.maximized?w2popup.min(e):w2popup.max(e),setTimeout(function(){i.trigger($.extend(n,{phase:"after"}))},1e3*s.speed+50),t.find(".w2ui-popup-button").show())},max:function(e){var t=$(e).hasClass(".w2ui-popup")?$(e):$(e).closest(".w2ui-popup"),i=this,s=t.data("options");if(!0!==s.maximized){var n=this.trigger({phase:"before",type:"max",target:"popup",options:s});!0!==n.isCancelled&&(w2popup.status="resizing",s.prevSize=t.css("width")+":"+t.css("height"),w2popup.resize(1e4,1e4,function(){w2popup.status="open",s.maximized=!0,i.trigger($.extend(n,{phase:"after"})),t.find(".w2ui-grid, .w2ui-form, .w2ui-layout").each(function(){var e=$(this).attr("name");w2ui[e]&&w2ui[e].resize&&w2ui[e].resize()})},e))}},min:function(e){var t=$(e).hasClass(".w2ui-popup")?$(e):$(e).closest(".w2ui-popup"),i=this,s=t.data("options");if(!0===s.maximized){var n=s.prevSize.split(":"),r=this.trigger({phase:"before",type:"min",target:"popup",options:s});!0!==r.isCancelled&&(w2popup.status="resizing",w2popup.resize(parseInt(n[0]),parseInt(n[1]),function(){w2popup.status="open",s.maximized=!1,s.prevSize=null,i.trigger($.extend(r,{phase:"after"})),t.find(".w2ui-grid, .w2ui-form, .w2ui-layout").each(function(){var e=$(this).attr("name");w2ui[e]&&w2ui[e].resize&&w2ui[e].resize()})},e))}},get:function(e){return($(e).hasClass(".w2ui-popup")?$(e):$(e).closest(".w2ui-popup")).data("options")},set:function(e){w2popup.open(e)},clear:function(e){var t=$(e).hasClass(".w2ui-popup")?$(e):$(e).closest(".w2ui-popup");t.find(".w2ui-popup-title").html(""),t.find(".w2ui-popup-body").html(""),t.find(".w2ui-popup-buttons").html("")},reset:function(){w2popup.open(w2popup.defaults)},load:function(r,e){var t=$(e).hasClass(".w2ui-popup")?$(e):$(e).closest(".w2ui-popup");if(w2popup.status="loading",null!=r.url){var i=String(r.url).split("#"),s=i[0],n=i[1];null==r&&(r={});var a=t.data(s);if(null!=a)l(a,n);else{var o='<form onsubmit="return false;"><div class="line" style="height:30px;"><input type="text" name="url" style="width:calc(100% - 105px);" value="'+s+'" onKeypress="w2popup.pressEnterGo(this,event)"><input type="button" style="width:35px;" value="IR" onKeydown="this.click" onclick="w2popup.go(this)"><input type="button" style="width:35px;" value="<"  onKeydown="this.click" onclick="w2popup.back(this)"><input type="button" style="width:35px;" value=">"  onKeydown="this.click" onclick="w2popup.forward(this)"></div></form><iframe  src="'+s+'" width=100% style="height:calc(100% - 35px);" frameborder=0 ></iframe>';l(o,n),t.data(s,o)}}else console.log("ERROR: The url parameter is empty.");function l(e,t,i){var s=$(i).hasClass(".w2ui-popup")?$(i):$(i).closest(".w2ui-popup");if(delete r.url,$("body").append('<div id="w2ui-tmp" style="display: none">'+e+"</div>"),null!=t&&0<$("#w2ui-tmp #"+t).length?$("#w2ui-tmp #"+t).w2popup(r):$("#w2ui-tmp > div").w2popup(r),0<$("#w2ui-tmp > style").length){var n=$("<div>").append($("#w2ui-tmp > style").clone()).html();0===s.find("#div-style").length&&s.append('<div id="div-style" style="position: absolute; left: -100; width: 1px"></div>'),s.find("#div-style").html(n)}$("#w2ui-tmp").remove()}},message:function(t,i){var s=this,e=$(i).hasClass(".w2ui-popup")?$(i):$(i).closest(".w2ui-popup");$().w2tag(),t||(t={width:200,height:100});var n=parseInt(e.width()),r=parseInt(e.height());t.originalWidth=t.width,t.originalHeight=t.height,parseInt(t.width)<10&&(t.width=10),parseInt(t.height)<10&&(t.height=10),null==t.hideOnClick&&(t.hideOnClick=!1);var a=e.data("options")||{},o=parseInt(e.find(".w2ui-popup-title").css("height"));(null==t.width||t.width>a.width-10)&&(t.width=a.width-10),(null==t.height||t.height>a.height-o-5)&&(t.height=a.height-o-5),t.originalHeight<0&&(t.height=r+t.originalHeight-o),t.originalWidth<0&&(t.width=n+2*t.originalWidth);var l=e.find(".w2ui-popup-title"),d=e.find(".w2ui-message").length;if(""===$.trim(t.html)&&""===$.trim(t.body)&&""===$.trim(t.buttons)){var u=$x_w2ui_popup.find(" #w2ui-message"+(d-1));t=u.data("options")||{};u.css(w2utils.cssPrefix({transition:"0.15s",transform:"translateY(-"+t.height+"px)"})),1==d?w2popup.unlock(150):e.find("#w2ui-message"+(d-2)).css("z-index",1500),setTimeout(function(){var e=u.data("prev_focus");u.remove(),e&&0<e.length?e.focus():s.focus(),"function"==typeof t.onClose&&t.onClose(i)},150)}else{""===$.trim(t.body)&&""===$.trim(t.buttons)||(t.html='<div class="w2ui-message-body">'+t.body+'</div><div class="w2ui-message-buttons">'+t.buttons+"</div>"),$x_w2ui_popup.find(".w2ui-message").css("z-index",1390),l.css("z-index",1501),e.find(".w2ui-box").before('<div id="w2ui-message'+d+'" class="w2ui-message" style="display: none; z-index: 1500; '+(0===l.length?"top: 0px;":"top: "+w2utils.getSize(l,"height")+"px;")+(null!=t.width?"width: "+t.width+"px; left: "+(n-t.width)/2+"px;":"left: 10px; right: 10px;")+(null!=t.height?"height: "+t.height+"px;":"bottom: 6px;")+w2utils.cssPrefix("transition",".3s",!0)+'"'+(!0===t.hideOnClick?'onclick="w2popup.message();"':"")+"></div>"),e.find("#w2ui-message"+d).data("options",t).data("prev_focus",$(":focus"));var c=e.find("#w2ui-message"+d).css("display");$x_w2ui_popup.find("#w2ui-message"+d).css(w2utils.cssPrefix({transform:"none"==c?"translateY(-"+t.height+"px)":"translateY(0px)"})),"none"==c&&(e.find("#w2ui-message"+d).show().html(t.html),setTimeout(function(){e.find("#w2ui-message"+d).css(w2utils.cssPrefix({transform:"none"==c?"translateY(0px)":"translateY(-"+t.height+"px)"}))},1),0===d&&w2popup.lock(),setTimeout(function(){s.focus(),e.find("#w2ui-message"+d).css(w2utils.cssPrefix({transition:"0s"})),"function"==typeof t.onOpen&&t.onOpen()},350))}},focus:function(e){var t=$(e).hasClass(".w2ui-popup")?$(e):$(e).closest(".w2ui-popup"),i=null,s=t,n="input:visible, button:visible, select:visible, textarea:visible";$(s).find(n).off(".keep-focus");var r=t.find(".w2ui-message").length-1,a=t.find("#w2ui-message"+r);if(0<a.length)0<(o=$(a[a.length-1]).find("button")).length&&o[0].focus(),i=a;else if(0<s.length){var o;0<(o=s.find(".w2ui-popup-buttons button")).length&&o[0].focus(),i=s}$(i).find(n).on("blur.keep-focus",function(e){setTimeout(function(){var e=$(":focus");if(0<e.length&&!$(i).find(n).is(e)||e.hasClass("w2ui-popup-hidden")){var t=$(i).find(n);0<t.length&&t[0].focus()}},1)})},lock:function(e,t,i){if(!w2popup.islock(i)){var s=$(i).hasClass(".w2ui-popup")?$(i):$(i).closest(".w2ui-popup"),n=Array.prototype.slice.call(arguments,0);n.unshift(s),w2utils.lock.apply(window,n)}},unlock:function(e,t){var i=$(t).hasClass(".w2ui-popup")?$(t):$(t).closest(".w2ui-popup");w2utils.unlock(i,e)},islock:function(e){var t=$(e).hasClass(".w2ui-popup")?$(e):$(e).closest(".w2ui-popup");return 0<t.find(".w2ui-lock").length+t.find(".w2ui-lock-msg").length},lockScreen:function(e,t){var i=$(t).hasClass(".w2ui-popup")?$(t):$(t).closest(".w2ui-popup");return!(0<$("#w2ui-lock").length)&&(null==e&&(e=i.data("options")),null==e&&(e={}),e=$.extend({},w2popup.defaults,e),$("body").append('<div id="w2ui-lock"     style="position: '+("IE5"==w2utils.engine?"absolute":"fixed")+"; z-Index: 1199; left: 0px; top: 0px;            padding: 0px; margin: 0px; background-color: "+e.color+'; width: 100%; height: 100%; opacity: 0;"></div>'),setTimeout(function(){$("#w2ui-lock").css("opacity",e.opacity).css(w2utils.cssPrefix("transition",e.speed+"s opacity"))},1),1==e.modal?($("#w2ui-lock").on("mousedown",function(){$("#w2ui-lock").css("opacity","0.6").css(w2utils.cssPrefix("transition",".1s"))}),$("#w2ui-lock").on("mouseup",function(){setTimeout(function(){$("#w2ui-lock").css("opacity",e.opacity).css(w2utils.cssPrefix("transition",".1s"))},100)})):$("#w2ui-lock").remove(),!0)},unlockScreen:function(e,t){var i=$(t).hasClass(".w2ui-popup")?$(t):$(t).closest(".w2ui-popup");return 0!==$("#w2ui-lock").length&&(null==e&&(e=i.data("options")),null==e&&(e={}),e=$.extend({},w2popup.defaults,e),$("#w2ui-lock").css("opacity","0").css(w2utils.cssPrefix("transition",e.speed+"s opacity")),setTimeout(function(){$("#w2ui-lock").remove()},1e3*e.speed),!0)},resizeMessages:function(e){var r=$(e).hasClass(".w2ui-popup")?$(e):$(e).closest(".w2ui-popup");r.data("options");r.find(".w2ui-message").each(function(){var e=$(this).data("options"),t=r;parseInt(e.width)<10&&(e.width=10),parseInt(e.height)<10&&(e.height=10);var i=parseInt(t.find("> .w2ui-popup-title").css("height")),s=parseInt(t.width()),n=parseInt(t.height());e.width=e.originalWidth,e.width>s-10&&(e.width=s-10),e.height=e.originalHeight,e.height>n-i-5&&(e.height=n-i-5),e.originalHeight<0&&(e.height=n+e.originalHeight-i),e.originalWidth<0&&(e.width=s+2*e.originalWidth),$(this).css({left:(s-e.width)/2+"px",width:e.width+"px",height:e.height+"px"})})},resize:function(e,t,i,s){var n,r,a=$(s).hasClass(".w2ui-popup")?$(s):$(s).closest(".w2ui-popup"),o=this,l=a.data("options");e=parseInt(e),t=parseInt(t),null==window.innerHeight?(n=parseInt(document.documentElement.offsetWidth),r=parseInt(document.documentElement.offsetHeight),"IE7"===w2utils.engine&&(n+=21,r+=4)):(n=parseInt(window.innerWidth),r=parseInt(window.innerHeight)),n-10<e&&(e=n-10),r-10<t&&(t=r-10);var d=(r-t)/2*.6,u=(n-e)/2;a.css(w2utils.cssPrefix({transition:l.speed+"s width, "+l.speed+"s height, "+l.speed+"s left, "+l.speed+"s top"})).css({top:d,left:u,width:e,height:t});var c=setInterval(function(){o.resizeMessages()},10);setTimeout(function(){clearInterval(c),l.width=e,l.height=t,o.resizeMessages(),"function"==typeof i&&i()},1e3*l.speed+50)},restoreTemplate:function(e){var t=($(e).hasClass(".w2ui-popup")?$(e):$(e).closest(".w2ui-popup")).data("options");if(null!=t){var i=w2popup._template,s=t.title,n=t.body,r=t.buttons;if(w2popup._prev?(i=w2popup._prev.template,s=w2popup._prev.title,n=w2popup._prev.body,r=w2popup._prev.buttons,delete w2popup._prev):delete w2popup._template,null!=i){var a=$(i);if(0===a.length)return;"body"==$(n).attr("rel")?(s&&a.append(s),n&&a.append(n),r&&a.append(r)):a.append(n)}}}},$.extend(w2popup,w2utils.event)}(jQuery);var w2alert=function(e,t,i){jQuery;null==t&&(t=w2utils.lang("Notification"));var s=w2popup.open({width:450,height:220,showMin:!1,showMax:!1,showClose:!1,title:t,body:'<div class="w2ui-centered w2ui-alert-msg" style="font-size: 13px;">'+e+"</div>",buttons:'<button onclick="w2popup.close();" class="w2ui-popup-btn w2ui-btn">'+w2utils.lang("Ok")+"</button>",onClose:function(){"function"==typeof i&&i(s.x_w2ui_popup)}});return s.data("options").onOpen=function(e){setTimeout(function(){s.x_w2ui_popup.find(".w2ui-popup-btn").focus()},1)},s.data("options").onKeydown=function(e){setTimeout(function(){s.x_w2ui_popup.find(".w2ui-popup-btn").focus().addClass("clicked")},1)},{ok:function(e){return i=e,this},done:function(e){return i=e,this}}},w2confirm=function(e,t,i){var s=jQuery,n=null,r={},a={msg:"",title:w2utils.lang("Confirmation"),width:450,height:220,yes_text:"Yes",yes_class:"",yes_style:"",yes_callBack:null,no_text:"No",no_class:"",no_style:"",no_callBack:null,callBack:null};(n=1==arguments.length&&"object"==typeof e?s.extend(r,a,e):"function"==typeof t?s.extend(r,a,{msg:e,callBack:t}):s.extend(r,a,{msg:e,title:t,callBack:i}),"object"==typeof r.btn_yes&&(r.yes_text=r.btn_yes.text||r.yes_text,r.yes_class=r.btn_yes.class||r.yes_class,r.yes_style=r.btn_yes.style||r.yes_style,r.yes_callBack=r.btn_yes.callBack||r.yes_callBack),"object"==typeof r.btn_no&&(r.no_text=r.btn_no.text||r.no_text,r.no_class=r.btn_no.class||r.no_class,r.no_style=r.btn_no.style||r.no_style,r.no_callBack=r.btn_no.callBack||r.no_callBack),"closing"!=w2popup.status&&w2popup.get())?(r.width>w2popup.get().width&&(r.width=w2popup.get().width),r.height>w2popup.get().height-50&&(r.height=w2popup.get().height-50),(n=w2popup.message({width:r.width,height:r.height,body:'<div class="w2ui-centered w2ui-confirm-msg" style="font-size: 13px;">'+r.msg+"</div>",buttons:'<button id="Yes" class="w2ui-popup-btn w2ui-btn '+r.yes_class+'" style="'+r.yes_style+'">'+w2utils.lang(r.yes_text)+'</button><button id="No" class="w2ui-popup-btn w2ui-btn '+r.no_class+'" style="'+r.no_style+'">'+w2utils.lang(r.no_text)+"</button>"})).data("options").onOpen=function(){s("#"+n.x_w2ui_popup.attr("id")+" .w2ui-message .w2ui-btn").on("click.w2confirm",function(e){w2popup._confirm_btn=e.target.id,w2popup.message()})},n.data("options").onClose=function(){s("#"+n.x_w2ui_popup.attr("id")+" .w2ui-message .w2ui-btn").off("click.w2confirm"),setTimeout(function(){"function"==typeof r.callBack&&r.callBack(w2popup._confirm_btn),"Yes"==w2popup._confirm_btn&&"function"==typeof r.yes_callBack&&r.yes_callBack(),"No"==w2popup._confirm_btn&&"function"==typeof r.no_callBack&&r.no_callBack()},300)}):(w2utils.isInt(r.height)||(r.height=r.height+50),(n=w2popup.open({width:r.width,height:r.height,title:r.title,modal:!0,showClose:!1,body:'<div class="w2ui-centered w2ui-confirm-msg" style="font-size: 13px;">'+r.msg+"</div>",buttons:'<button id="Yes" class="w2ui-popup-btn w2ui-btn '+r.yes_class+'" style="'+r.yes_style+'">'+w2utils.lang(r.yes_text)+'</button><button id="No" class="w2ui-popup-btn w2ui-btn '+r.no_class+'" style="'+r.no_style+'">'+w2utils.lang(r.no_text)+"</button>"})).data("options").onOpen=function(e){setTimeout(function(){s("#"+n.x_w2ui_popup.attr("id")+" .w2ui-popup-btn").on("click",function(e){w2popup.close(),"function"==typeof r.callBack&&r.callBack(e.target.id),"Yes"==e.target.id&&"function"==typeof r.yes_callBack&&r.yes_callBack(),"No"==e.target.id&&"function"==typeof r.no_callBack&&r.no_callBack()}),s("#"+n.x_w2ui_popup.attr("id")+" .w2ui-popup-btn#Yes").focus()},1)},n.data("options").onKeydown=function(e){if(0===s("#"+n.x_w2ui_popup.attr("id")+" .w2ui-message").length)switch(e.originalEvent.keyCode){case 13:s("#"+n.x_w2ui_popup.attr("id")+" .w2ui-popup-btn#Yes").focus().addClass("clicked"),w2popup.close();break;case 27:s("#"+n.x_w2ui_popup.attr("id")+" .w2ui-popup-btn#No").focus().click(),w2popup.close()}});return{yes:function(e){return r.yes_callBack=e,this},no:function(e){return r.no_callBack=e,this}}},w2prompt=function(e,t,i){var s=jQuery,n={},r={label:"",value:"",attrs:"",title:w2utils.lang("Notification"),ok_text:w2utils.lang("Ok"),cancel_text:w2utils.lang("Cancel"),width:450,height:220,callBack:null};if(1==arguments.length&&"object"==typeof e?s.extend(n,r,e):"function"==typeof t?s.extend(n,r,{label:e,callBack:t}):s.extend(n,r,{label:e,title:t,callBack:i}),"closing"!=w2popup.status&&w2popup.get()){n.width>w2popup.get().width&&(n.width=w2popup.get().width),n.height>w2popup.get().height-50&&(n.height=w2popup.get().height-50);var a=w2popup.message({width:n.width,height:n.height,body:'<div class="w2ui-centered" style="font-size: 13px;">   <label style="margin-right: 10px;">'+n.label+':</label>   <input id="w2prompt" '+n.attrs+"></div>",buttons:'<button id="Ok" class="w2ui-popup-btn w2ui-btn">'+n.ok_text+'</button><button id="Cancel" class="w2ui-popup-btn w2ui-btn">'+n.cancel_text+"</button>"});a.data("options").onOpen=function(){s("#w2prompt").val(n.value),s("#"+a.x_w2ui_popup.attr("id")+" .w2ui-message .w2ui-btn#Ok").on("click.w2prompt",function(e){w2popup._prompt_value=s("#w2prompt").val(),w2popup.message()}),s("#"+a.x_w2ui_popup.attr("id")+" .w2ui-message .w2ui-btn#Cancel").on("click.w2prompt",function(e){w2popup._prompt_value=null,w2popup.message()}),setTimeout(function(){s("#w2prompt").focus()},100)},a.data("options").onClose=function(){s("#"+a.x_w2ui_popup.attr("id")+" .w2ui-message .w2ui-btn").off("click.w2prompt"),setTimeout(function(){"function"==typeof n.callBack&&null!=w2popup._prompt_value&&n.callBack(w2popup._prompt_value)},300)}}else w2utils.isInt(n.height)||(n.height=n.height+50),w2popup.open({width:n.width,height:n.height,title:n.title,modal:!0,showClose:!1,body:'<div class="w2ui-centered" style="font-size: 13px;"><label style="margin-right: 10px;">'+n.label+':</label><input id="w2prompt"></div>',buttons:'<button id="Ok" class="w2ui-popup-btn w2ui-btn">'+n.ok_text+'</button><button id="Cancel" class="w2ui-popup-btn w2ui-btn">'+n.cancel_text+"</button>"}),a.data("options").onOpen=function(e){setTimeout(function(){s("#"+a.x_w2ui_popup.attr("id")+" #w2prompt").val(n.value),s("#"+a.x_w2ui_popup.attr("id")+" #w2prompt").w2field("text"),s("#"+a.x_w2ui_popup.attr("id")+" .w2ui-popup-btn#Ok").on("click",function(e){w2popup._prompt_value=s("#w2prompt").val(),w2popup.close(),"function"==typeof n.callBack&&n.callBack(w2popup._prompt_value)}),s("#"+a.x_w2ui_popup.attr("id")+" .w2ui-popup-btn#Cancel").on("click",function(e){w2popup._prompt_value=null,w2popup.close()}),s("#"+a.x_w2ui_popup.attr("id")+" .w2ui-popup-btn#Ok"),setTimeout(function(){s("#w2prompt").focus()},100)},1)},a.data("options").onKeydown=function(e){if(0===s("#"+a.x_w2ui_popup.attr("id")+" .w2ui-message").length)switch(e.originalEvent.keyCode){case 13:s("#"+a.x_w2ui_popup.attr("id")+" .w2ui-popup-btn#Ok").focus().addClass("clicked"),w2popup.close();break;case 27:w2popup.close()}};return{change:function(e){return s("#w2prompt").on("keyup",e).keyup(),this},ok:function(e){return n.callBack=e,this}}};!function(c){var r=function(e){this.box=null,this.name=null,this.active=null,this.flow="down",this.tooltip="top|left",this.tabs=[],this.routeData={},this.right="",this.style="",c.extend(this,{handlers:[]}),c.extend(!0,this,w2obj.tabs,e)};c.fn.w2tabs=function(e){if(c.isPlainObject(e)){if(!w2utils.checkName(e,"w2tabs"))return;for(var t=e.tabs||[],i=new r(e),s=0;s<t.length;s++)i.tabs[s]=c.extend({},r.prototype.tab,t[s]);return 0!==c(this).length&&i.render(c(this)[0]),w2ui[i.name]=i}var n=w2ui[c(this).attr("name")];return n?0<arguments.length?(n[e]&&n[e].apply(n,Array.prototype.slice.call(arguments,1)),this):n:null},r.prototype={onClick:null,onClose:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,tab:{id:null,text:null,route:null,hidden:!1,disabled:!1,closable:!1,tooltip:null,style:"",onClick:null,onRefresh:null,onClose:null},add:function(e){return this.insert(null,e)},insert:function(e,t){c.isArray(t)||(t=[t]);for(var i=0;i<t.length;i++){if(null==t[i].id)return void console.log('ERROR: The parameter "id" is required but not supplied. (obj: '+this.name+")");if(!w2utils.checkUniqueId(t[i].id,this.tabs,"tabs",this.name))return;var s=c.extend({},r.prototype.tab,t[i]);if(null==e)this.tabs.push(s);else{var n=this.get(e,!0);this.tabs=this.tabs.slice(0,n).concat([s],this.tabs.slice(n))}this.refresh(t[i].id),this.resize()}},remove:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);if(!i)return!1;e++,this.tabs.splice(this.get(i.id,!0),1),c(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(i.id)).remove()}return this.resize(),e},select:function(e){return this.active!=e&&null!=this.get(e)&&(this.active=e,this.refresh(),!0)},set:function(e,t){var i=this.get(e,!0);return null!=i&&(c.extend(this.tabs[i],t),this.refresh(e),!0)},get:function(e,t){if(0===arguments.length){for(var i=[],s=0;s<this.tabs.length;s++)null!=this.tabs[s].id&&i.push(this.tabs[s].id);return i}for(var n=0;n<this.tabs.length;n++)if(this.tabs[n].id==e)return!0===t?n:this.tabs[n];return null},show:function(){for(var t=this,e=0,i=[],s=0;s<arguments.length;s++){var n=this.get(arguments[s]);n&&!1!==n.hidden&&(e++,n.hidden=!1,i.push(n.id))}return setTimeout(function(){for(var e=0;e<i.length;e++)t.refresh(i[e]);t.resize()},15),e},hide:function(){for(var t=this,e=0,i=[],s=0;s<arguments.length;s++){var n=this.get(arguments[s]);n&&!0!==n.hidden&&(e++,n.hidden=!0,i.push(n.id))}return setTimeout(function(){for(var e=0;e<i.length;e++)t.refresh(i[e]);t.resize()},15),e},enable:function(){for(var t=this,e=0,i=[],s=0;s<arguments.length;s++){var n=this.get(arguments[s]);n&&!1!==n.disabled&&(e++,n.disabled=!1,i.push(n.id))}return setTimeout(function(){for(var e=0;e<i.length;e++)t.refresh(i[e])},15),e},disable:function(){for(var t=this,e=0,i=[],s=0;s<arguments.length;s++){var n=this.get(arguments[s]);n&&!0!==n.disabled&&(e++,n.disabled=!0,i.push(n.id))}return setTimeout(function(){for(var e=0;e<i.length;e++)t.refresh(i[e])},15),e},tooltipShow:function(e,t,i){if(null!=this.tooltip){var s=c(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(e)),n=this.get(e),r=this.tooltip,a=n.tooltip;"function"==typeof a&&(a=a.call(this,n)),s.prop("_mouse_over",!0),setTimeout(function(){!0===s.prop("_mouse_over")&&!0!==s.prop("_mouse_tooltip")&&(s.prop("_mouse_tooltip",!0),s.w2tag(w2utils.lang(a),{position:r})),1==i&&s.w2tag(w2utils.lang(a),{position:r})},1)}},tooltipHide:function(e){if(null!=this.tooltip){var t=c(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(e));this.get(e);t.removeProp("_mouse_over"),setTimeout(function(){!0!==t.prop("_mouse_over")&&!0===t.prop("_mouse_tooltip")&&(t.removeProp("_mouse_tooltip"),t.w2tag())},1)}},refresh:function(e){var t=(new Date).getTime();"up"==this.flow?c(this.box).addClass("w2ui-tabs-up"):c(this.box).removeClass("w2ui-tabs-up");var i=this.trigger({phase:"before",type:"refresh",target:null!=e?e:this.name,object:this.get(e)});if(!0!==i.isCancelled){if(null==e)for(var s=0;s<this.tabs.length;s++)this.refresh(this.tabs[s].id);else{var n=this.get(e);if(null==n)return!1;null==n.text&&null!=n.caption&&(n.text=n.caption),null==n.tooltip&&null!=n.hint&&(n.tooltip=n.hint);var r=n.text;"function"==typeof r&&(r=r.call(this,n)),null==r&&(r="");var a=c(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(n.id)),o="";n.closable&&!n.disabled&&(o='<div class="w2ui-tab-close"     onmouseover = "w2ui[\''+this.name+"'].tooltipShow('"+n.id+"', event);\"    onmouseout  = \"w2ui['"+this.name+"'].tooltipHide('"+n.id+"', event);\"    onclick=\"w2ui['"+this.name+"'].animateClose('"+n.id+"', event);\"></div>");var l=o+'    <div class="w2ui-tab'+(this.active===n.id?" active":"")+(n.closable?" closable":"")+(n.class?" "+n.class:"")+'" style="'+n.style+'"         onmouseover = "'+(n.disabled?"":"w2ui['"+this.name+"'].tooltipShow('"+n.id+"', event);")+'"        onmouseout  = "'+(n.disabled?"":"w2ui['"+this.name+"'].tooltipHide('"+n.id+"', event);")+'"        onclick="w2ui[\''+this.name+"'].click('"+n.id+"', event);\">"+w2utils.lang(r)+"</div>";if(0===a.length){var d="";n.hidden&&(d+="display: none;"),n.disabled&&(d+="opacity: 0.2;");var u='<td id="tabs_'+this.name+"_tab_"+n.id+'" style="'+d+'" valign="middle">'+l+"</td>";this.get(e,!0)!==this.tabs.length-1&&0<c(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(e,!0))+1].id)).length?c(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(e,!0))+1].id)).before(u):c(this.box).find("#tabs_"+this.name+"_right").before(u)}else a.html(l),n.hidden?a.css("display","none"):a.css("display",""),n.disabled?a.css({opacity:"0.2"}):a.css({opacity:"1"})}return c("#tabs_"+this.name+"_right").html(this.right),this.trigger(c.extend(i,{phase:"after"})),(new Date).getTime()-t}},render:function(e){var t=(new Date).getTime(),i=this.trigger({phase:"before",type:"render",target:this.name,box:e});if(!0!==i.isCancelled){if(null!=e&&(0<c(this.box).find("> table #tabs_"+this.name+"_right").length&&c(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),this.box=e),!this.box)return!1;var s='<div class="w2ui-scroll-wrapper" onmousedown="var el=w2ui[\''+this.name+'\']; if (el) el.resize();"><table cellspacing="0" cellpadding="1" width="100%"><tbody>    <tr><td width="100%" id="tabs_'+this.name+'_right" align="right">'+this.right+'</td></tr></tbody></table></div><div class="w2ui-scroll-left" onclick="var el=w2ui[\''+this.name+"']; if (el) el.scroll('left');\"></div><div class=\"w2ui-scroll-right\" onclick=\"var el=w2ui['"+this.name+"']; if (el) el.scroll('right');\"></div>";return c(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-tabs").html(s),0<c(this.box).length&&(c(this.box)[0].style.cssText+=this.style),this.trigger(c.extend(i,{phase:"after"})),this.refresh(),this.resize(),(new Date).getTime()-t}},scroll:function(e){var t,i,s,n=c(this.box),r=this,a=n.find(".w2ui-scroll-wrapper"),o=a.scrollLeft();switch(e){case"left":t=a.outerWidth(),i=a.find(":first").outerWidth(),(s=o-t+50)<=0&&(s=0),a.animate({scrollLeft:s},300);break;case"right":t=a.outerWidth(),(i=a.find(":first").outerWidth())-t<=(s=o+t-50)&&(s=i-t),a.animate({scrollLeft:s},300)}setTimeout(function(){r.resize()},350)},resize:function(){var e=(new Date).getTime(),t=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==t.isCancelled){var i=c(this.box);i.find(".w2ui-scroll-left, .w2ui-scroll-right").hide();var s=i.find(".w2ui-scroll-wrapper");return s.find(":first").outerWidth()>s.outerWidth()&&(0<s.scrollLeft()&&i.find(".w2ui-scroll-left").show(),s.scrollLeft()<s.find(":first").outerWidth()-s.outerWidth()&&i.find(".w2ui-scroll-right").show()),this.trigger(c.extend(t,{phase:"after"})),(new Date).getTime()-e}},destroy:function(){var e=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==e.isCancelled&&(0<c(this.box).find("> table #tabs_"+this.name+"_right").length&&c(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),delete w2ui[this.name],this.trigger(c.extend(e,{phase:"after"})))},click:function(e,t){var i=this.get(e);if(null==i||i.disabled)return!1;var s=this.trigger({phase:"before",type:"click",target:e,tab:i,object:i,originalEvent:t});if(!0!==s.isCancelled){if(c(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.active)+" .w2ui-tab").removeClass("active"),this.active=i.id,"string"==typeof i.route){var n=""!==i.route?String("/"+i.route).replace(/\/{2,}/g,"/"):"",r=w2utils.parseRoute(n);if(0<r.keys.length)for(var a=0;a<r.keys.length;a++)null!=this.routeData[r.keys[a].name]&&(n=n.replace(new RegExp(":"+r.keys[a].name,"g"),this.routeData[r.keys[a].name]));setTimeout(function(){window.location.hash=n},1)}this.trigger(c.extend(s,{phase:"after"})),this.refresh(e)}},animateClose:function(e,t){var i=this.get(e);if(null==i||i.disabled)return!1;var s=this.trigger({phase:"before",type:"close",target:e,object:this.get(e),originalEvent:t});if(!0!==s.isCancelled){var n=this;c(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(i.id)).css(w2utils.cssPrefix("transition",".2s")).css("opacity","0"),setTimeout(function(){var e=c(n.box).find("#tabs_"+n.name+"_tab_"+w2utils.escapeId(i.id)).width();c(n.box).find("#tabs_"+n.name+"_tab_"+w2utils.escapeId(i.id)).html('<div style="width: '+e+"px; "+w2utils.cssPrefix("transition",".2s",!0)+'"></div>'),setTimeout(function(){c(n.box).find("#tabs_"+n.name+"_tab_"+w2utils.escapeId(i.id)).find(":first-child").css({width:"0px"})},50)},200),setTimeout(function(){n.remove(e)},450),this.trigger(c.extend(s,{phase:"after"})),this.refresh()}},animateInsert:function(e,t){if(null!=this.get(e)&&(c.isPlainObject(t)&&w2utils.checkUniqueId(t.id,this.tabs,"tabs",this.name)&&0===c(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(t.id)).length)){null==t.text&&null!=t.caption&&(t.text=t.caption);var i='<div id="_tmp_tabs" class="w2ui-reset w2ui-tabs" style="position: absolute; top: -1000px;"><table cellspacing="0" cellpadding="1" width="100%"><tbody><tr><td id="_tmp_simple_tab" style="" valign="middle">'+(t.closable?'<div class="w2ui-tab-close"></div>':"")+'    <div class="w2ui-tab '+(this.active===t.id?"active":"")+'">'+t.text+"</div></td></tr></tbody></table></div>";c("body").append(i);var s='<div style="width: 1px; '+w2utils.cssPrefix("transition",".2s",!0)+'">&#160;</div>',n="";t.hidden&&(n+="display: none;"),t.disabled&&(n+="opacity: 0.2;");var r='<td id="tabs_'+this.name+"_tab_"+t.id+'" style="'+n+'" valign="middle">'+s+"</td>";this.get(e,!0)!==this.tabs.length&&0<c(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(e,!0))].id)).length?c(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(e,!0))].id)).before(r):c(this.box).find("#tabs_"+this.name+"_right").before(r);var a=this;setTimeout(function(){var e=c("#_tmp_simple_tab").width();c("#_tmp_tabs").remove(),c("#tabs_"+a.name+"_tab_"+w2utils.escapeId(t.id)+" > div").css("width",e+"px")},1),setTimeout(function(){a.insert(e,t)},200)}}},c.extend(r.prototype,w2utils.event),w2obj.tabs=r}(jQuery),function(p){var l=function(e){this.box=null,this.name=null,this.routeData={},this.items=[],this.right="",this.tooltip="top|left",p.extend(!0,this,w2obj.toolbar,e)};p.fn.w2toolbar=function(e){if(p.isPlainObject(e)){if(!w2utils.checkName(e,"w2toolbar"))return;var t=e.items||[],i=new l(e);p.extend(i,{items:[],handlers:[]});for(var s=0;s<t.length;s++)if(i.items[s]=p.extend({},l.prototype.item,t[s]),"menu-check"==i.items[s].type){var n=i.items[s];if(Array.isArray(n.selected)||(n.selected=[]),Array.isArray(n.items))for(var r=0;r<n.items.length;r++){(a=n.items[r]).checked&&-1==n.selected.indexOf(a.id)&&n.selected.push(a.id),a.checked||-1==n.selected.indexOf(a.id)||(a.checked=!0),null==a.checked&&(a.checked=!1)}}else if("menu-radio"==i.items[s].type){n=i.items[s];if(Array.isArray(n.items))for(r=0;r<n.items.length;r++){var a;(a=n.items[r]).checked&&null==n.selected?n.selected=a.id:a.checked=!1,a.checked||n.selected!=a.id||(a.checked=!0),null==a.checked&&(a.checked=!1)}}return 0!==p(this).length&&i.render(p(this)[0]),w2ui[i.name]=i}var o=w2ui[p(this).attr("name")];return o?0<arguments.length?(o[e]&&o[e].apply(o,Array.prototype.slice.call(arguments,1)),this):o:null},l.prototype={onClick:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,item:{id:null,type:"button",text:null,html:"",tooltip:null,count:null,hidden:!1,disabled:!1,checked:!1,img:null,icon:null,route:null,arrow:!0,style:null,color:null,transparent:null,group:null,items:null,selected:null,overlay:{},onClick:null,onRefresh:null},add:function(e){this.insert(null,e)},insert:function(e,t){p.isArray(t)||(t=[t]);for(var i=0;i<t.length;i++){if(null==t[i].type)return void console.log('ERROR: The parameter "type" is required but not supplied in w2toolbar.add() method.');if(-1==p.inArray(String(t[i].type),["button","check","radio","drop","menu","menu-radio","menu-check","color","text-color","break","html","spacer"]))return void console.log('ERROR: The parameter "type" should be one of the following [button, check, radio, drop, menu, break, html, spacer] in w2toolbar.add() method.');if(null==t[i].id&&"break"!=t[i].type&&"spacer"!=t[i].type)return void console.log('ERROR: The parameter "id" is required but not supplied in w2toolbar.add() method.');if(!w2utils.checkUniqueId(t[i].id,this.items,"toolbar items",this.name))return;var s=p.extend({},l.prototype.item,t[i]);if(null==e)this.items.push(s);else{var n=this.get(e,!0);this.items=this.items.slice(0,n).concat([s],this.items.slice(n))}this.refresh(s.id),this.resize()}},remove:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);if(i&&-1==String(arguments[t]).indexOf(":")){e++,p(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(i.id)).remove();var s=this.get(i.id,!0);null!=s&&this.items.splice(s,1)}}return this.resize(),e},set:function(e,t){var i=this.get(e);return null!=i&&(p.extend(i,t),this.refresh(String(e).split(":")[0]),!0)},get:function(e,t){if(0===arguments.length){for(var i=[],s=0;s<this.items.length;s++)null!=this.items[s].id&&i.push(this.items[s].id);return i}for(var n=String(e).split(":"),r=0;r<this.items.length;r++){var a=this.items[r];if(-1!=["menu","menu-radio","menu-check"].indexOf(a.type)&&2==n.length&&a.id==n[0])for(var o=0;o<a.items.length;o++){var l=a.items[o];if(l.id==n[1]||null==l.id&&l.text==n[1])return 1==t?o:l}else if(a.id==n[0])return 1==t?r:a}return null},show:function(){for(var t=this,e=0,i=[],s=0;s<arguments.length;s++){var n=this.get(arguments[s]);n&&(e++,n.hidden=!1,i.push(String(arguments[s]).split(":")[0]))}return setTimeout(function(){for(var e=0;e<i.length;e++)t.refresh(i[e]);t.resize()},15),e},hide:function(){for(var t=this,e=0,i=[],s=0;s<arguments.length;s++){var n=this.get(arguments[s]);n&&(e++,n.hidden=!0,i.push(String(arguments[s]).split(":")[0]))}return setTimeout(function(){for(var e=0;e<i.length;e++)t.refresh(i[e]),t.tooltipHide(i[e]);t.resize()},15),e},enable:function(){for(var t=this,e=0,i=[],s=0;s<arguments.length;s++){var n=this.get(arguments[s]);n&&(e++,n.disabled=!1,i.push(String(arguments[s]).split(":")[0]))}return setTimeout(function(){for(var e=0;e<i.length;e++)t.refresh(i[e])},15),e},disable:function(){for(var t=this,e=0,i=[],s=0;s<arguments.length;s++){var n=this.get(arguments[s]);n&&(e++,n.disabled=!0,i.push(String(arguments[s]).split(":")[0]))}return setTimeout(function(){for(var e=0;e<i.length;e++)t.refresh(i[e]),t.tooltipHide(i[e])},15),e},check:function(){for(var t=this,e=0,i=[],s=0;s<arguments.length;s++){var n=this.get(arguments[s]);n&&-1==String(arguments[s]).indexOf(":")&&(e++,n.checked=!0,i.push(String(arguments[s]).split(":")[0]))}return setTimeout(function(){for(var e=0;e<i.length;e++)t.refresh(i[e])},15),e},uncheck:function(){for(var t=this,e=0,i=[],s=0;s<arguments.length;s++){var n=this.get(arguments[s]);n&&-1==String(arguments[s]).indexOf(":")&&(-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(n.type)&&n.checked&&setTimeout(function(){p("#tb_"+t.name+"_item_"+w2utils.escapeId(n.id)).w2overlay({name:t.name})},1),e++,n.checked=!1,i.push(String(arguments[s]).split(":")[0]))}return setTimeout(function(){for(var e=0;e<i.length;e++)t.refresh(i[e])},15),e},click:function(e,n){var r=this,t=String(e).split(":"),a=this.get(t[0]);if(1<t.length){var i=this.get(e);i&&!i.disabled&&r.menuClick({name:r.name,item:a,subItem:i,originalEvent:n})}else if(a&&!a.disabled){var s=this.trigger({phase:"before",type:"click",target:null!=e?e:this.name,item:a,object:a,originalEvent:n});if(!0===s.isCancelled)return;var o="#tb_"+this.name+"_item_"+w2utils.escapeId(a.id)+" table.w2ui-button";if(p(o).removeClass("down"),"radio"==a.type){for(var l=0;l<this.items.length;l++){var d=this.items[l];null!=d&&d.id!=a.id&&"radio"===d.type&&(d.group==a.group&&d.checked&&(d.checked=!1,this.refresh(d.id)))}a.checked=!0,p(o).addClass("checked")}if(-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(a.type)&&(r.tooltipHide(e),a.checked?setTimeout(function(){p("#tb_"+r.name+"_item_"+w2utils.escapeId(a.id)).w2overlay({name:r.name}),a.checked=!1,r.refresh(a.id)},1):setTimeout(function(){var e=p("#tb_"+r.name+"_item_"+w2utils.escapeId(a.id));p.isPlainObject(a.overlay)||(a.overlay={});var t=(e.width()-50)/2;if(19<t&&(t=19),"drop"==a.type&&e.w2overlay(a.html,p.extend({name:r.name,left:t,top:3},a.overlay,{onHide:function(e){s()}})),-1!=["menu","menu-radio","menu-check"].indexOf(a.type)){var i="normal";"menu-radio"==a.type&&(i="radio",a.items.forEach(function(e){a.selected==e.id?e.checked=!0:e.checked=!1})),"menu-check"==a.type&&(i="check",a.items.forEach(function(e){p.isArray(a.selected)&&-1!=a.selected.indexOf(e.id)?e.checked=!0:e.checked=!1})),e.w2menu(p.extend({name:r.name,items:a.items,left:t,top:3},a.overlay,{type:i,select:function(e){r.menuClick({name:r.name,item:a,subItem:e.item,originalEvent:e.originalEvent,keepOpen:e.keepOpen})},onHide:function(e){s()}}))}function s(e){a.checked=!1,p(o).removeClass("checked")}-1!=["color","text-color"].indexOf(a.type)&&(null==a.transparent&&(a.transparent=!0),p(e).w2color({color:a.color,transparent:a.transparent},function(e,t){null!=e&&r.colorClick({name:r.name,item:a,color:e,originalEvent:n.originalEvent}),s()}))},1)),-1!=["check","menu","menu-radio","menu-check","drop","color","text-color"].indexOf(a.type)&&(a.checked=!a.checked,a.checked?p(o).addClass("checked"):p(o).removeClass("checked")),a.route){var u=String("/"+a.route).replace(/\/{2,}/g,"/"),c=w2utils.parseRoute(u);if(0<c.keys.length)for(var h=0;h<c.keys.length;h++)u=u.replace(new RegExp(":"+c.keys[h].name,"g"),this.routeData[c.keys[h].name]);setTimeout(function(){window.location.hash=u},1)}n&&-1!=["button","check","radio"].indexOf(a.type)&&this.tooltipShow(e,n,!0),this.trigger(p.extend(s,{phase:"after"}))}},scroll:function(e){var t,i,s,n=p(this.box),r=this,a=n.find(".w2ui-scroll-wrapper"),o=a.scrollLeft();switch(e){case"left":t=a.outerWidth(),i=a.find(":first").outerWidth(),(s=o-t+50)<=0&&(s=0),a.animate({scrollLeft:s},300);break;case"right":t=a.outerWidth(),(i=a.find(":first").outerWidth())-t<=(s=o+t-50)&&(s=i-t),a.animate({scrollLeft:s},300)}setTimeout(function(){r.resize()},350)},render:function(e){var t=(new Date).getTime(),i=this.trigger({phase:"before",type:"render",target:this.name,box:e});if(!0!==i.isCancelled&&(null!=e&&(0<p(this.box).find("> table #tb_"+this.name+"_right").length&&p(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),this.box=e),this.box)){for(var s='<div class="w2ui-scroll-wrapper" onmousedown="var el=w2ui[\''+this.name+'\']; if (el) el.resize();"><table cellspacing="0" cellpadding="0" width="100%"><tbody><tr>',n=0;n<this.items.length;n++){var r=this.items[n];null!=r&&(null==r.id&&(r.id="item_"+n),"spacer"==r.type?s+='<td width="100%" id="tb_'+this.name+"_item_"+r.id+'" align="right"></td>':s+='<td id="tb_'+this.name+"_item_"+r.id+'" style="'+(r.hidden?"display: none":"")+'"     class="'+(r.disabled?"disabled":"")+'" valign="middle"></td>')}return s+='<td width="100%" id="tb_'+this.name+'_right" align="right">'+this.right+"</td>",s+='</tr></tbody></table></div><div class="w2ui-scroll-left" onclick="var el=w2ui[\''+this.name+"']; if (el) el.scroll('left');\"></div><div class=\"w2ui-scroll-right\" onclick=\"var el=w2ui['"+this.name+"']; if (el) el.scroll('right');\"></div>",p(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-toolbar").html(s),0<p(this.box).length&&(p(this.box)[0].style.cssText+=this.style),this.refresh(),this.resize(),this.trigger(p.extend(i,{phase:"after"})),(new Date).getTime()-t}},refresh:function(e){var t=(new Date).getTime(),i=this.trigger({phase:"before",type:"refresh",target:null!=e?e:this.name,item:this.get(e)});if(!0!==i.isCancelled){if(null!=e){var s=this.get(e);if(null==s)return!1;if("function"==typeof s.onRefresh){var n=this.trigger({phase:"before",type:"refresh",target:e,item:s,object:s});if(!0===n.isCancelled)return}var r=p(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(s.id)),a=this.getItemHTML(s);return 0===r.length?(a="spacer"==s.type?'<td width="100%" id="tb_'+this.name+"_item_"+s.id+'" align="right"></td>':'<td id="tb_'+this.name+"_item_"+s.id+'" style="'+(s.hidden?"display: none":"")+'"     class="'+(s.disabled?"disabled":"")+'" valign="middle">'+a+"</td>",this.get(e,!0)==this.items.length-1?p(this.box).find("#tb_"+this.name+"_right").before(a):p(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(this.items[parseInt(this.get(e,!0))+1].id)).before(a)):(-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(s.type)&&0==s.checked&&0<p("#w2ui-overlay-"+this.name).length&&p("#w2ui-overlay-"+this.name)[0].hide(),r.html(a),s.hidden?r.css("display","none"):r.css("display",""),s.disabled?r.addClass("disabled"):r.removeClass("disabled")),"function"==typeof s.onRefresh&&this.trigger(p.extend(n,{phase:"after"})),this.trigger(p.extend(i,{phase:"after"})),(new Date).getTime()-t}for(var o=0;o<this.items.length;o++){var l=this.items[o];null==l.id&&(l.id="item_"+o),this.refresh(l.id)}}},resize:function(){var e=(new Date).getTime(),t=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==t.isCancelled){var i=p(this.box);i.find(".w2ui-scroll-left, .w2ui-scroll-right").hide();var s=i.find(".w2ui-scroll-wrapper");return s.find(":first").outerWidth()>s.outerWidth()&&(0<s.scrollLeft()&&i.find(".w2ui-scroll-left").show(),s.scrollLeft()<s.find(":first").outerWidth()-s.outerWidth()&&i.find(".w2ui-scroll-right").show()),this.trigger(p.extend(t,{phase:"after"})),(new Date).getTime()-e}},destroy:function(){var e=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==e.isCancelled&&(0<p(this.box).find("> table #tb_"+this.name+"_right").length&&p(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),p(this.box).html(""),delete w2ui[this.name],this.trigger(p.extend(e,{phase:"after"})))},getItemHTML:function(e){var t="";null!=e.caption&&null==e.text&&(e.text=e.caption),null==e.text&&(e.text=""),null==e.tooltip&&null!=e.hint&&(e.tooltip=e.hint),null==e.tooltip&&(e.tooltip="");var i="<td>&#160;</td>",s=e.text;if("function"==typeof s&&(s=s.call(this,e)),e.img&&(i='<td><div class="w2ui-tb-image w2ui-icon '+e.img+'"></div></td>'),e.icon&&(i='<td><div class="w2ui-tb-image"><span class="'+e.icon+'"></span></div></td>'),""===t)switch(e.type){case"color":case"text-color":"string"==typeof e.color&&"#"==e.color.substr(0,1)&&(e.color=e.color.substr(1)),"color"==e.type&&(s='<div style="height: 12px; width: 12px; margin-top: 1px; border: 1px solid #8A8A8A; border-radius: 1px; box-shadow: 0px 0px 1px #fff;         background-color: #'+(null!=e.color?e.color:"fff")+'; float: left;"></div>'+(e.text?'<div style="margin-left: 17px;">'+w2utils.lang(e.text)+"</div>":"")),"text-color"==e.type&&(s='<div style="color: #'+(null!=e.color?e.color:"444")+';">'+(e.text?w2utils.lang(e.text):"<b>Aa</b>")+"</div>");case"menu":case"menu-check":case"menu-radio":case"button":case"check":case"radio":case"drop":t+='<table cellpadding="0" cellspacing="0"        class="w2ui-button '+(e.checked?"checked":"")+'"        onclick     = "var el=w2ui[\''+this.name+"']; if (el) el.click('"+e.id+'\', event);"        onmouseover = "'+(e.disabled?"":"jQuery(this).addClass('over'); w2ui['"+this.name+"'].tooltipShow('"+e.id+"', event);")+'"       onmouseout  = "'+(e.disabled?"":"jQuery(this).removeClass('over').removeClass('down'); w2ui['"+this.name+"'].tooltipHide('"+e.id+"', event);")+'"       onmousedown = "'+(e.disabled?"":"jQuery(this).addClass('down');")+'"       onmouseup   = "'+(e.disabled?"":"jQuery(this).removeClass('down');")+'"><tbody><tr><td>  <table cellpadding="1" cellspacing="0"><tbody>  <tr>'+i+(""!==s?'<td class="w2ui-tb-caption" nowrap="nowrap" style="'+(e.style?e.style:"")+'">'+w2utils.lang(s)+"</td>":"")+(null!=e.count?'<td class="w2ui-tb-count" nowrap="nowrap"><span>'+e.count+"</span></td>":"")+(-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(e.type)&&!1!==e.arrow?'<td class="w2ui-tb-down" nowrap="nowrap"><div></div></td>':"")+"  </tr></tbody></table></td></tr></tbody></table>";break;case"break":t+='<table cellpadding="0" cellspacing="0"><tbody><tr>    <td><div class="w2ui-break">&#160;</div></td></tr></tbody></table>';break;case"html":t+='<table cellpadding="0" cellspacing="0"><tbody><tr>    <td nowrap="nowrap">'+("function"==typeof e.html?e.html.call(this,e):e.html)+"</td></tr></tbody></table>"}return"<div>"+t+"</div>"},tooltipShow:function(e,t,i){if(null!=this.tooltip){var s=p(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(e)),n=this.get(e),r=this.tooltip,a=n.tooltip;"function"==typeof a&&(a=a.call(this,n)),s.prop("_mouse_over",!0),setTimeout(function(){if(!0===s.prop("_mouse_over")&&!0!==s.prop("_mouse_tooltip")){if(s.prop("_mouse_tooltip",!0),-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(n.type)&&1==n.checked)return;s.w2tag(w2utils.lang(a),{position:r})}1==i&&s.w2tag(w2utils.lang(a),{position:r})},1)}},tooltipHide:function(e,t){if(null!=this.tooltip){var i=p(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(e));this.get(e);i.removeProp("_mouse_over"),setTimeout(function(){!0!==i.prop("_mouse_over")&&!0===i.prop("_mouse_tooltip")&&(i.removeProp("_mouse_tooltip"),i.w2tag())},1)}},menuClick:function(e){if(e.item&&!e.item.disabled){var t=this.trigger({phase:"before",type:"click",target:e.item.id+":"+e.subItem.id,item:e.item,subItem:e.subItem,originalEvent:e.originalEvent});if(!0===t.isCancelled)return;var i=e.subItem,s=this.get(e.item.id);if("menu-radio"==s.type&&(s.selected=i.id,e.item.items.forEach(function(e){e.checked=!1}),i.checked=!0),"menu-check"==s.type){p.isArray(s.selected)||(s.selected=[]);var n=s.selected.indexOf(i.id);-1==n?(s.selected.push(i.id),i.checked=!0):(s.selected.splice(n,1),i.checked=!1)}if("string"==typeof i.route){var r=""!==i.route?String("/"+i.route).replace(/\/{2,}/g,"/"):"",a=w2utils.parseRoute(r);if(0<a.keys.length)for(var o=0;o<a.keys.length;o++)null!=this.routeData[a.keys[o].name]&&(r=r.replace(new RegExp(":"+a.keys[o].name,"g"),this.routeData[a.keys[o].name]));setTimeout(function(){window.location.hash=r},1)}this.refresh(e.item.id),this.trigger(p.extend(t,{phase:"after"}))}},colorClick:function(e){if(e.item&&!e.item.disabled){var t=this.trigger({phase:"before",type:"click",target:e.item.id,item:e.item,color:e.color,originalEvent:e.originalEvent});if(!0===t.isCancelled)return;e.item.color=e.color,this.refresh(e.item.id),this.trigger(p.extend(t,{phase:"after"}))}}},p.extend(l.prototype,w2utils.event),w2obj.toolbar=l}(jQuery),function(p){var d=function(e){this.name=null,this.box=null,this.sidebar=null,this.parent=null,this.nodes=[],this.menu=[],this.routeData={},this.selected=null,this.img=null,this.icon=null,this.style="",this.topHTML="",this.bottomHTML="",this.flatButton=!1,this.keyboard=!0,this.flat=!1,this.hasFocus=!1,p.extend(!0,this,w2obj.sidebar,e)};p.fn.w2sidebar=function(e){if(p.isPlainObject(e)){if(!w2utils.checkName(e,"w2sidebar"))return;var t=e.nodes,i=new d(e);return p.extend(i,{handlers:[],nodes:[]}),null!=t&&i.add(i,t),0!==p(this).length&&i.render(p(this)[0]),i.sidebar=i,w2ui[i.name]=i}var s=w2ui[p(this).attr("name")];return s?0<arguments.length?(s[e]&&s[e].apply(s,Array.prototype.slice.call(arguments,1)),this):s:null},d.prototype={onClick:null,onDblClick:null,onContextMenu:null,onMenuClick:null,onExpand:null,onCollapse:null,onKeydown:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,onFocus:null,onBlur:null,onFlat:null,node:{id:null,text:"",count:null,img:null,icon:null,nodes:[],style:"",route:null,selected:!1,expanded:!1,hidden:!1,disabled:!1,group:!1,groupShowHide:!0,collapsible:!0,plus:!1,onClick:null,onDblClick:null,onContextMenu:null,onExpand:null,onCollapse:null,parent:null,sidebar:null},add:function(e,t){return 1==arguments.length&&(t=e,e=this),"string"==typeof e&&(e=this.get(e)),this.insert(e,null,t)},insert:function(e,t,i){var s,n,r,a,o;if(2==arguments.length)if(i=t,null!=(t=e)){if(null==(n=this.get(t)))return p.isArray(i)||(i=[i]),s=null!=i[0].caption?i[0].caption:i[0].text,console.log('ERROR: Cannot insert node "'+s+'" because cannot find node "'+t+'" to insert before.'),null;e=this.get(t).parent}else e=this;"string"==typeof e&&(e=this.get(e)),p.isArray(i)||(i=[i]);for(var l=0;l<i.length;l++)if(null!=typeof(a=i[l]).id)if(null==this.get(this,a.id)){if((r=p.extend({},d.prototype.node,a)).sidebar=this,r.parent=e,o=r.nodes||[],r.nodes=[],null==t)e.nodes.push(r);else{if(null==(n=this.get(e,t,!0)))return s=null!=a.caption?a.caption:a.text,console.log('ERROR: Cannot insert node "'+s+'" because cannot find node "'+t+'" to insert before.'),null;e.nodes.splice(n,0,r)}0<o.length&&this.insert(r,null,o)}else s=null!=a.caption?a.caption:a.text,console.log("ERROR: Cannot insert node with id="+a.id+" (text: "+s+") because another node with the same id already exists.");else s=null!=a.caption?a.caption:a.text,console.log('ERROR: Cannot insert node "'+s+'" because it has no id.');return this.refresh(e.id),r},remove:function(){for(var e,t=0,i=0;i<arguments.length;i++)if(null!=(e=this.get(arguments[i]))){null!=this.selected&&this.selected===e.id&&(this.selected=null);var s=this.get(e.parent,arguments[i],!0);null!=s&&(e.parent.nodes[s].selected&&e.sidebar.unselect(e.id),e.parent.nodes.splice(s,1),t++)}return 0<t&&1==arguments.length?this.refresh(e.parent.id):this.refresh(),t},set:function(e,t,i){if(2==arguments.length&&(i=t,t=e,e=this),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return null;for(var s=0;s<e.nodes.length;s++){if(e.nodes[s].id===t){var n=i.nodes;return p.extend(e.nodes[s],i,{nodes:[]}),null!=n&&this.add(e.nodes[s],n),this.refresh(t),!0}if(this.set(e.nodes[s],t,i))return!0}return!1},get:function(e,t,i){if(0===arguments.length){for(var s=[],n=this.find({}),r=0;r<n.length;r++)null!=n[r].id&&s.push(n[r].id);return s}if((1==arguments.length||2==arguments.length&&!0===t)&&(i=t,t=e,e=this),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return null;for(var a=0;a<e.nodes.length;a++){if(e.nodes[a].id==t)return!0===i?a:e.nodes[a];var o=this.get(e.nodes[a],t,i);if(o||0===o)return o}return null},find:function(e,t,i){if(1==arguments.length&&(t=e,e=this),i||(i=[]),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return i;for(var s=0;s<e.nodes.length;s++){var n=!0;for(var r in t)e.nodes[s][r]!=t[r]&&(n=!1);n&&i.push(e.nodes[s]),0<e.nodes[s].nodes.length&&(i=this.find(e.nodes[s],t,i))}return i},hide:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);null!=i&&(i.hidden=!0,e++)}return 1==arguments.length?this.refresh(arguments[0]):this.refresh(),e},show:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);null!=i&&(i.hidden=!1,e++)}return 1==arguments.length?this.refresh(arguments[0]):this.refresh(),e},disable:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);null!=i&&(i.disabled=!0,i.selected&&this.unselect(i.id),e++)}return 1==arguments.length?this.refresh(arguments[0]):this.refresh(),e},enable:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);null!=i&&(i.disabled=!1,e++)}return 1==arguments.length?this.refresh(arguments[0]):this.refresh(),e},select:function(e){var t=this.get(e);return!!t&&((this.selected!=e||!t.selected)&&(this.unselect(this.selected),p(this.box).find("#node_"+w2utils.escapeId(e)).addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected"),t.selected=!0,this.selected=e,!0))},unselect:function(e){0===arguments.length&&(e=this.selected);var t=this.get(e);return!!t&&(t.selected=!1,p(this.box).find("#node_"+w2utils.escapeId(e)).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected"),this.selected==e&&(this.selected=null),!0)},toggle:function(e){var t=this.get(e);return null!=t&&(t.plus?(this.set(e,{plus:!1}),this.expand(e),void this.refresh(e)):0!==t.nodes.length&&(!!t.collapsible&&(this.get(e).expanded?this.collapse(e):this.expand(e))))},collapse:function(e){var t=this,i=this.get(e),s=this.trigger({phase:"before",type:"collapse",target:e,object:i});if(!0!==s.isCancelled)return p(this.box).find("#node_"+w2utils.escapeId(e)+"_sub").slideUp(200),p(this.box).find("#node_"+w2utils.escapeId(e)+" .w2ui-node-dots:first-child").html('<div class="w2ui-expand">+</div>'),i.expanded=!1,this.trigger(p.extend(s,{phase:"after"})),setTimeout(function(){t.refresh(e)},200),!0},collapseAll:function(e){if(null==e&&(e=this),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return!1;for(var t=0;t<e.nodes.length;t++)!0===e.nodes[t].expanded&&(e.nodes[t].expanded=!1),e.nodes[t].nodes&&0<e.nodes[t].nodes.length&&this.collapseAll(e.nodes[t]);return this.refresh(e.id),!0},expand:function(e){var t=this,i=this.get(e),s=this.trigger({phase:"before",type:"expand",target:e,object:i});if(!0!==s.isCancelled)return p(this.box).find("#node_"+w2utils.escapeId(e)+"_sub").slideDown(200),p(this.box).find("#node_"+w2utils.escapeId(e)+" .w2ui-node-dots:first-child").html('<div class="w2ui-expand">-</div>'),i.expanded=!0,this.trigger(p.extend(s,{phase:"after"})),setTimeout(function(){t.refresh(e)},200),!0},expandAll:function(e){if(null==e&&(e=this),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return!1;for(var t=0;t<e.nodes.length;t++)!1===e.nodes[t].expanded&&(e.nodes[t].expanded=!0),e.nodes[t].nodes&&0<e.nodes[t].nodes.length&&this.expandAll(e.nodes[t]);this.refresh(e.id)},expandParents:function(e){var t=this.get(e);return null!=t&&(t.parent&&(t.parent.expanded||(t.parent.expanded=!0,this.refresh(t.parent.id)),this.expandParents(t.parent.id)),!0)},click:function(n,r){var a=this,o=this.get(n);if(null!=o&&!o.disabled&&!o.group){p(a.box).find(".w2ui-node.w2ui-selected").each(function(e,t){var i=p(t).attr("id").replace("node_",""),s=a.get(i);null!=s&&(s.selected=!1),p(t).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected")});var l=p(a.box).find("#node_"+w2utils.escapeId(n)),d=p(a.box).find("#node_"+w2utils.escapeId(a.selected));l.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected"),setTimeout(function(){var e=a.trigger({phase:"before",type:"click",target:n,originalEvent:r,node:o,object:o});if(!0===e.isCancelled)return l.removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected"),void d.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected");if(null!=d&&(d.selected=!1),a.get(n).selected=!0,a.selected=n,"string"==typeof o.route){var t=""!==o.route?String("/"+o.route).replace(/\/{2,}/g,"/"):"",i=w2utils.parseRoute(t);if(0<i.keys.length)for(var s=0;s<i.keys.length;s++)null!=a.routeData[i.keys[s].name]&&(t=t.replace(new RegExp(":"+i.keys[s].name,"g"),a.routeData[i.keys[s].name]));setTimeout(function(){window.location.hash=t},1)}a.trigger(p.extend(e,{phase:"after"}))},1)}},focus:function(e){var t=this,i=this.trigger({phase:"before",type:"focus",target:this.name,originalEvent:e});if(!0===i.isCancelled)return!1;this.hasFocus=!0,p(this.box).find(".w2ui-selected").removeClass("w2ui-inactive"),setTimeout(function(){var e=p(t.box).find("#sidebar_"+t.name+"_focus");e.is(":focus")||e.focus()},10),this.trigger(p.extend(i,{phase:"after"}))},blur:function(e){var t=this.trigger({phase:"before",type:"blur",target:this.name,originalEvent:e});if(!0===t.isCancelled)return!1;this.hasFocus=!1,p(this.box).find(".w2ui-selected").addClass("w2ui-inactive"),this.trigger(p.extend(t,{phase:"after"}))},keydown:function(e){var o=this,t=o.get(o.selected);if(!0===o.keyboard){t||(t=o.nodes[0]);var i=o.trigger({phase:"before",type:"keydown",target:o.name,originalEvent:e});!0!==i.isCancelled&&(13!=e.keyCode&&32!=e.keyCode||0<t.nodes.length&&o.toggle(o.selected),37==e.keyCode&&(0<t.nodes.length&&t.expanded?o.collapse(o.selected):(s(t.parent),t.parent.group||o.collapse(t.parent.id))),39==e.keyCode&&(0<t.nodes.length||t.plus)&&!t.expanded&&o.expand(o.selected),38==e.keyCode&&s(n(t,r)),40==e.keyCode&&s(n(t,function e(t,i){if(null==t)return null;var s=t.parent;var n=o.get(t.id,!0);var r=null;if(t.expanded&&0<t.nodes.length&&!0!==i){var a=t.nodes[0];r=a.hidden||a.disabled||a.group?e(a):a}else r=s&&n+1<s.nodes.length?s.nodes[n+1]:e(s,!0);null!=r&&(r.hidden||r.disabled||r.group)&&(r=e(r));return r})),-1!=p.inArray(e.keyCode,[13,32,37,38,39,40])&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()),o.trigger(p.extend(i,{phase:"after"})))}function s(e,t){null==e||e.hidden||e.disabled||e.group||(o.click(e.id,t),setTimeout(function(){o.scrollIntoView()},50))}function n(e,t){for(e=t(e);null!=e&&(e.hidden||e.disabled)&&!e.group;)e=t(e);return e}function r(e){if(null==e)return null;var t=e.parent,i=o.get(e.id,!0),s=0<i?function e(t){if(t.expanded&&0<t.nodes.length){var i=t.nodes[t.nodes.length-1];return i.hidden||i.disabled||i.group?r(i):e(i)}return t}(t.nodes[i-1]):t;return null!=s&&(s.hidden||s.disabled||s.group)&&(s=r(s)),s}},scrollIntoView:function(e){if(null==e&&(e=this.selected),null!=this.get(e)){var t=p(this.box).find(".w2ui-sidebar-div"),i=p(this.box).find("#node_"+w2utils.escapeId(e)),s=i.offset().top-t.offset().top;(s+i.height()>t.height()||s<=0)&&t.animate({scrollTop:t.scrollTop()+s-t.height()/2+i.height()},250,"linear")}},dblClick:function(e,t){var i=this.get(e),s=this.trigger({phase:"before",type:"dblClick",target:e,originalEvent:t,object:i});!0!==s.isCancelled&&(this.toggle(e),this.trigger(p.extend(s,{phase:"after"})))},contextMenu:function(t,e){var i=this,s=i.get(t);t!=i.selected&&i.click(t);var n=i.trigger({phase:"before",type:"contextMenu",target:t,originalEvent:e,object:s,allowOnDisabled:!1});!0!==n.isCancelled&&(s.disabled&&!n.allowOnDisabled||(0<i.menu.length&&p(i.box).find("#node_"+w2utils.escapeId(t)).w2menu({items:i.menu,contextMenu:!0,originalEvent:e,onSelect:function(e){i.menuClick(t,parseInt(e.index),e.originalEvent)}}),e.preventDefault&&e.preventDefault(),i.trigger(p.extend(n,{phase:"after"}))))},menuClick:function(e,t,i){var s=this.trigger({phase:"before",type:"menuClick",target:e,originalEvent:i,menuIndex:t,menuItem:this.menu[t]});!0!==s.isCancelled&&this.trigger(p.extend(s,{phase:"after"}))},goFlat:function(){var e=this.trigger({phase:"before",type:"flat",goFlat:!this.flat});!0!==e.isCancelled&&(this.flat=!this.flat,this.refresh(),this.trigger(p.extend(e,{phase:"after"})))},render:function(e){var t=(new Date).getTime(),s=this,i=this.trigger({phase:"before",type:"render",target:this.name,box:e});if(!0!==i.isCancelled&&(null!=e&&(0<p(this.box).find("> div > div.w2ui-sidebar-div").length&&p(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-sidebar").html(""),this.box=e),this.box)){p(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-sidebar").html('<div><input id="sidebar_'+this.name+'_focus" style="position: absolute; top: 0; right: 0; width: 1px; z-index: -1; opacity: 0"/><div class="w2ui-sidebar-top"></div><div class="w2ui-sidebar-div"></div><div class="w2ui-sidebar-bottom"></div></div>'),p(this.box).find("> div").css({width:p(this.box).width()+"px",height:p(this.box).height()+"px"}),0<p(this.box).length&&(p(this.box)[0].style.cssText+=this.style);var n,r="";return 1==this.flatButton&&(r='<div class="w2ui-flat-'+(this.flat?"right":"left")+'" onclick="w2ui[\''+this.name+"'].goFlat()\"></div>"),""===this.topHTML&&""===r||(p(this.box).find(".w2ui-sidebar-top").html(this.topHTML+r),p(this.box).find(".w2ui-sidebar-div").css("top",p(this.box).find(".w2ui-sidebar-top").height()+"px")),""!==this.bottomHTML&&(p(this.box).find(".w2ui-sidebar-bottom").html(this.bottomHTML),p(this.box).find(".w2ui-sidebar-div").css("bottom",p(this.box).find(".w2ui-sidebar-bottom").height()+"px")),p(this.box).find("#sidebar_"+this.name+"_focus").on("focus",function(e){clearTimeout(n),s.hasFocus||s.focus(e)}).on("blur",function(e){n=setTimeout(function(){s.hasFocus&&s.blur(e)},100)}).on("keydown",function(e){9!=e.keyCode&&w2ui[s.name].keydown.call(w2ui[s.name],e)}),p(this.box).off("mousedown").on("mousedown",function(i){setTimeout(function(){if(-1==["INPUT","TEXTAREA","SELECT"].indexOf(i.target.tagName.toUpperCase())){var e=p(s.box).find("#sidebar_"+s.name+"_focus");if(!e.is(":focus")){if(p(i.target).hasClass("w2ui-node")){var t=p(i.target).position().top+p(s.box).find(".w2ui-sidebar-top").height()+i.offsetY;e.css({top:t+"px",left:"0px"})}e.focus()}}},1)}),this.trigger(p.extend(i,{phase:"after"})),this.refresh(),(new Date).getTime()-t}},refresh:function(e){var t=(new Date).getTime(),i=this.trigger({phase:"before",type:"refresh",target:null!=e?e:this.name,fullRefresh:null==e});if(!0!==i.isCancelled){var s="";1==this.flatButton&&(s='<div class="w2ui-flat-'+(this.flat?"right":"left")+'" onclick="w2ui[\''+this.name+"'].goFlat()\"></div>"),""===this.topHTML&&""===s||(p(this.box).find(".w2ui-sidebar-top").html(this.topHTML+s),p(this.box).find(".w2ui-sidebar-div").css("top",p(this.box).find(".w2ui-sidebar-top").height()+"px")),""!==this.bottomHTML&&(p(this.box).find(".w2ui-sidebar-bottom").html(this.bottomHTML),p(this.box).find(".w2ui-sidebar-div").css("bottom",p(this.box).find(".w2ui-sidebar-bottom").height()+"px")),p(this.box).find("> div").removeClass("w2ui-sidebar-flat").addClass(this.flat?"w2ui-sidebar-flat":"").css({width:p(this.box).width()+"px",height:p(this.box).height()+"px"});var n,r,a,o,l=this;if(null==e)n=this,a=".w2ui-sidebar-div";else{if(null==(n=this.get(e)))return;a="#node_"+w2utils.escapeId(n.id)+"_sub"}if(n!==this){var d="#node_"+w2utils.escapeId(n.id);o=h(n),p(this.box).find(d).before('<div id="sidebar_'+this.name+'_tmp"></div>'),p(this.box).find(d).remove(),p(this.box).find(a).remove(),p("#sidebar_"+this.name+"_tmp").before(o),p("#sidebar_"+this.name+"_tmp").remove()}p(this.box).find(a).html("");for(var u=0;u<n.nodes.length;u++)if(o=h(r=n.nodes[u]),p(this.box).find(a).append(o),0!==r.nodes.length)this.refresh(r.id);else{var c=this.trigger({phase:"before",type:"refresh",target:r.id});if(!0===c.isCancelled)return;this.trigger(p.extend(c,{phase:"after"}))}return this.trigger(p.extend(i,{phase:"after"})),(new Date).getTime()-t}function h(e){var t="",i=e.img;null==i&&(i=this.img);var s=e.icon;null==s&&(s=this.icon);for(var n=e.parent,r=0;n&&null!=n.parent;)n.group&&r--,n=n.parent,r++;if(null!=e.caption&&(e.text=e.caption),e.group)t='<div class="w2ui-node-group w2ui-level-'+r+'" id="node_'+e.id+'"   onclick="w2ui[\''+l.name+"'].toggle('"+e.id+"')\"   oncontextmenu=\"w2ui['"+l.name+"'].contextMenu('"+e.id+"', event);\"   onmouseout=\"jQuery(this).find('span:nth-child(1)').css('color', 'transparent')\"    onmouseover=\"jQuery(this).find('span:nth-child(1)').css('color', 'inherit')\">"+(e.groupShowHide&&e.collapsible?"<span>"+(!e.hidden&&e.expanded?w2utils.lang("Hide"):w2utils.lang("Show"))+"</span>":"<span></span>")+("function"==typeof e.text?e.text.call(l,e):"<span>"+e.text+"</span>")+'</div><div class="w2ui-node-sub" id="node_'+e.id+'_sub" style="'+e.style+";"+(!e.hidden&&e.expanded?"":"display: none;")+'"></div>',l.flat&&(t='<div class="w2ui-node-group" id="node_'+e.id+'"><span>&#160;</span></div><div id="node_'+e.id+'_sub" style="'+e.style+";"+(!e.hidden&&e.expanded?"":"display: none;")+'"></div>');else{e.selected&&!e.disabled&&(l.selected=e.id),n="",i&&(n='<div class="w2ui-node-image w2ui-icon '+i+(e.selected&&!e.disabled?" w2ui-icon-selected":"")+'"></div>'),s&&(n='<div class="w2ui-node-image"><span class="'+s+'"></span></div>');var a=e.text;"function"==typeof e.text&&(a=e.text.call(l,e)),t='<div class="w2ui-node w2ui-level-'+r+" "+(e.selected?"w2ui-selected":"")+" "+(e.disabled?"w2ui-disabled":"")+'" id="node_'+e.id+'" style="'+(e.hidden?"display: none;":"")+'"    ondblclick="w2ui[\''+l.name+"'].dblClick('"+e.id+"', event);\"    oncontextmenu=\"w2ui['"+l.name+"'].contextMenu('"+e.id+"', event);\"    onClick=\"w2ui['"+l.name+"'].click('"+e.id+'\', event); "><table cellpadding="0" cellspacing="0" style="margin-left:'+18*r+"px; padding-right:"+18*r+'px"><tbody><tr><td class="w2ui-node-dots" nowrap="nowrap" onclick="w2ui[\''+l.name+"'].toggle('"+e.id+'\');         if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;">    <div class="w2ui-expand">'+(0<e.nodes.length?e.expanded?"-":"+":e.plus?"+":"")+'</div></td><td class="w2ui-node-data" nowrap="nowrap">'+n+(e.count||0===e.count?'<div class="w2ui-node-count">'+e.count+"</div>":"")+'<div class="w2ui-node-caption">'+a+'</div></td></tr></tbody></table></div><div class="w2ui-node-sub" id="node_'+e.id+'_sub" style="'+e.style+";"+(!e.hidden&&e.expanded?"":"display: none;")+'"></div>',l.flat&&(t='<div class="w2ui-node w2ui-level-'+r+" "+(e.selected?"w2ui-selected":"")+" "+(e.disabled?"w2ui-disabled":"")+'" id="node_'+e.id+'" style="'+(e.hidden?"display: none;":"")+"\"    onmouseover=\"jQuery(this).find('.w2ui-node-data').w2tag(w2utils.base64decode('"+w2utils.base64encode(a+(e.count||0===e.count?' - <span class="w2ui-node-count">'+e.count+"</span>":""))+"'),                { id: '"+e.id+"', left: -5 })\"    onmouseout=\"jQuery(this).find('.w2ui-node-data').w2tag(null, { id: '"+e.id+"' })\"    ondblclick=\"w2ui['"+l.name+"'].dblClick('"+e.id+"', event);\"    oncontextmenu=\"w2ui['"+l.name+"'].contextMenu('"+e.id+"', event);\"    onClick=\"w2ui['"+l.name+"'].click('"+e.id+'\', event); "><div class="w2ui-node-data w2ui-node-flat">'+n+'</div></div><div class="w2ui-node-sub" id="node_'+e.id+'_sub" style="'+e.style+";"+(!e.hidden&&e.expanded?"":"display: none;")+'"></div>')}return t}},resize:function(){var e=(new Date).getTime(),t=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==t.isCancelled)return p(this.box).css("overflow","hidden"),p(this.box).find("> div").css({width:p(this.box).width()+"px",height:p(this.box).height()+"px"}),this.trigger(p.extend(t,{phase:"after"})),(new Date).getTime()-e},destroy:function(){var e=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==e.isCancelled&&(0<p(this.box).find("> div > div.w2ui-sidebar-div").length&&p(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-sidebar").html(""),delete w2ui[this.name],this.trigger(p.extend(e,{phase:"after"})))},lock:function(e,t){var i=Array.prototype.slice.call(arguments,0);i.unshift(this.box),w2utils.lock.apply(window,i)},unlock:function(e){w2utils.unlock(this.box,e)}},p.extend(d.prototype,w2utils.event),w2obj.sidebar=d}(jQuery),function(b){var n=function(e){this.el=null,this.helpers={},this.type=e.type||"text",this.options=b.extend(!0,{},e),this.onSearch=e.onSearch||null,this.onRequest=e.onRequest||null,this.onLoad=e.onLoad||null,this.onError=e.onError||null,this.onClick=e.onClick||null,this.onAdd=e.onAdd||null,this.onNew=e.onNew||null,this.onRemove=e.onRemove||null,this.onMouseOver=e.onMouseOver||null,this.onMouseOut=e.onMouseOut||null,this.onIconClick=e.onIconClick||null,this.onScroll=e.onScroll||null,this.tmp={},delete this.options.type,delete this.options.onSearch,delete this.options.onRequest,delete this.options.onLoad,delete this.options.onError,delete this.options.onClick,delete this.options.onMouseOver,delete this.options.onMouseOut,delete this.options.onIconClick,delete this.options.onScroll,b.extend(!0,this,w2obj.field)};b.fn.w2field=function(s,e){if(0!==this.length)return 0===arguments.length?b(this).data("w2field"):("string"==typeof s&&"object"==typeof e&&(s=b.extend(!0,{},e,{type:s})),"string"==typeof s&&null==e&&(s={type:s}),s.type=String(s.type).toLowerCase(),this.each(function(e,t){if(null==(i=b(t).data("w2field"))){var i=new n(s);return b.extend(i,{handlers:[]}),t&&(i.el=b(t)[0]),i.init(),b(t).data("w2field",i),i}if(i.clear(),"clear"!=s.type){i=new n(s);return b.extend(i,{handlers:[]}),t&&(i.el=b(t)[0]),i.init(),b(t).data("w2field",i),i}}));var t=n.prototype;return t[s]?t[s].apply(t,Array.prototype.slice.call(arguments,1)):void 0},n.prototype={custom:{},addType:function(e,t){return e=String(e).toLowerCase(),this.custom[e]=t,!0},removeType:function(e){return e=String(e).toLowerCase(),!!this.custom[e]&&(delete this.custom[e],!0)},init:function(){var e,t=this,i=this.options;if("function"!=typeof this.custom[this.type])if(-1!=["INPUT","TEXTAREA"].indexOf(this.el.tagName.toUpperCase())){switch(this.type){case"text":case"int":case"float":case"money":case"currency":case"percent":case"alphanumeric":case"bin":case"hex":e={min:null,max:null,step:1,autoFormat:!0,currencyPrefix:w2utils.settings.currencyPrefix,currencySuffix:w2utils.settings.currencySuffix,currencyPrecision:w2utils.settings.currencyPrecision,decimalSymbol:w2utils.settings.decimalSymbol,groupSymbol:w2utils.settings.groupSymbol,arrows:!1,keyboard:!0,precision:null,silent:!0,prefix:"",suffix:""},this.options=b.extend(!0,{},e,i),(i=this.options).numberRE=new RegExp("["+i.groupSymbol+"]","g"),i.moneyRE=new RegExp("["+i.currencyPrefix+i.currencySuffix+i.groupSymbol+"]","g"),i.percentRE=new RegExp("["+i.groupSymbol+"%]","g"),-1!=["text","alphanumeric","hex","bin"].indexOf(this.type)&&(i.arrows=!1,i.keyboard=!1),this.addPrefix(),this.addSuffix();break;case"color":e={prefix:"#",suffix:'<div style="width: '+(parseInt(b(this.el).css("font-size"))||12)+'px">&#160;</div>',arrows:!1,keyboard:!1,transparent:!0},b.extend(i,e),this.addPrefix(),this.addSuffix(),b(this.el).attr("maxlength",6),""!==b(this.el).val()&&setTimeout(function(){t.change()},1);break;case"date":e={format:w2utils.settings.dateFormat,keyboard:!0,silent:!0,start:"",end:"",blocked:{},colored:{},blockWeekDays:null},this.options=b.extend(!0,{},e,i),i=this.options,null==b(this.el).attr("placeholder")&&b(this.el).attr("placeholder",i.format);break;case"time":e={format:w2utils.settings.timeFormat,keyboard:!0,silent:!0,start:"",end:"",noMinutes:!1},this.options=b.extend(!0,{},e,i),i=this.options,null==b(this.el).attr("placeholder")&&b(this.el).attr("placeholder",i.format);break;case"datetime":e={format:w2utils.settings.dateFormat+" | "+w2utils.settings.timeFormat,keyboard:!0,silent:!0,start:"",end:"",blocked:[],colored:{},placeholder:null,btn_now:!0,noMinutes:!1},this.options=b.extend(!0,{},e,i),i=this.options,null==b(this.el).attr("placeholder")&&b(this.el).attr("placeholder",i.placeholder||i.format);break;case"list":case"combo":if(e={items:[],selected:{},url:null,recId:null,recText:null,method:null,interval:350,postData:{},minLength:1,cacheMax:250,maxDropHeight:350,maxDropWidth:null,match:"begins",silent:!0,icon:null,iconStyle:"",onSearch:null,onRequest:null,onLoad:null,onError:null,onIconClick:null,renderDrop:null,compare:null,filter:!0,prefix:"",suffix:"",openOnFocus:!1,markSearch:!1},i.items=this.normMenu(i.items),"list"==this.type){if(e.openOnFocus=!0,b(this.el).addClass("w2ui-select"),!b.isPlainObject(i.selected)&&i.items)for(var s=0;s<i.items.length;s++){var n=i.items[s];if(n&&n.id==i.selected){i.selected=b.extend(!0,{},n);break}}this.watchSize()}i=b.extend({},e,i,{align:"both",altRows:!0}),this.options=i,b.isPlainObject(i.selected)||(i.selected={}),b(this.el).data("selected",i.selected),i.url&&(i.items=[],this.request(0)),"list"==this.type&&this.addFocus(),this.addPrefix(),this.addSuffix(),setTimeout(function(){t.refresh()},10),b(this.el).attr("autocomplete","off"),null!=i.selected.text&&b(this.el).val(i.selected.text);break;case"enum":e={items:[],selected:[],max:0,url:null,recId:null,recText:null,interval:350,method:null,postData:{},minLength:1,cacheMax:250,maxWidth:250,maxHeight:350,maxDropHeight:350,maxDropWidth:null,match:"contains",silent:!0,openOnFocus:!1,markSearch:!0,renderDrop:null,renderItem:null,compare:null,filter:!0,style:"",onSearch:null,onRequest:null,onLoad:null,onError:null,onClick:null,onAdd:null,onNew:null,onRemove:null,onMouseOver:null,onMouseOut:null,onScroll:null},(i=b.extend({},e,i,{align:"both",suffix:"",altRows:!0})).items=this.normMenu(i.items),i.selected=this.normMenu(i.selected),this.options=i,b.isArray(i.selected)||(i.selected=[]),b(this.el).data("selected",i.selected),i.url&&(i.items=[],this.request(0)),this.addSuffix(),this.addMulti(),this.watchSize();break;case"file":e={selected:[],max:0,maxSize:0,maxFileSize:0,maxWidth:250,maxHeight:350,maxDropHeight:350,maxDropWidth:null,readContent:!0,silent:!0,renderItem:null,style:"",onClick:null,onAdd:null,onRemove:null,onMouseOver:null,onMouseOut:null},i=b.extend({},e,i,{align:"both",altRows:!0}),this.options=i,b.isArray(i.selected)||(i.selected=[]),b(this.el).data("selected",i.selected),null==b(this.el).attr("placeholder")&&b(this.el).attr("placeholder",w2utils.lang("Attach files by dragging and dropping or Click to Select")),this.addMulti(),this.watchSize()}this.tmp={onChange:function(e){t.change.call(t,e)},onClick:function(e){t.click.call(t,e)},onFocus:function(e){t.focus.call(t,e)},onBlur:function(e){t.blur.call(t,e)},onKeydown:function(e){t.keyDown.call(t,e)},onKeyup:function(e){t.keyUp.call(t,e)},onKeypress:function(e){t.keyPress.call(t,e)}},b(this.el).addClass("w2field w2ui-input").data("w2field",this).on("change.w2field",this.tmp.onChange).on("click.w2field",this.tmp.onClick).on("focus.w2field",this.tmp.onFocus).on("blur.w2field",this.tmp.onBlur).on("keydown.w2field",this.tmp.onKeydown).on("keyup.w2field",this.tmp.onKeyup).on("keypress.w2field",this.tmp.onKeypress).css(w2utils.cssPrefix("box-sizing","border-box")),this.change(b.Event("change"))}else console.log("ERROR: w2field could only be applied to INPUT or TEXTAREA.",this.el);else this.custom[this.type].call(this,i)},watchSize:function(){var e=this,t=b(e.el).data("tmp")||{};t.sizeTimer=setInterval(function(){0<b(e.el).parents("body").length?e.resize():clearInterval(t.sizeTimer)},200),b(e.el).data("tmp",t)},get:function(){return-1!=["list","enum","file"].indexOf(this.type)?b(this.el).data("selected"):b(this.el).val()},set:function(e,t){if(-1!=["list","enum","file"].indexOf(this.type)){if("list"!=this.type&&t)null==b(this.el).data("selected")&&b(this.el).data("selected",[]),b(this.el).data("selected").push(e),b(this.el).change();else{var i="enum"==this.type?[e]:e;b(this.el).data("selected",i).change()}this.refresh()}else b(this.el).val(e)},setIndex:function(e,t){if(-1!=["list","enum"].indexOf(this.type)){var i=this.options.items;if(i&&i[e]){if("list"!=this.type&&t)null==b(this.el).data("selected")&&b(this.el).data("selected",[]),b(this.el).data("selected").push(i[e]),b(this.el).change();else{var s="enum"==this.type?[i[e]]:i[e];b(this.el).data("selected",s).change()}return this.refresh(),!0}}return!1},clear:function(){var e=this.options;-1!=["money","currency"].indexOf(this.type)&&b(this.el).val(b(this.el).val().replace(e.moneyRE,"")),"percent"==this.type&&b(this.el).val(b(this.el).val().replace(/%/g,"")),"color"==this.type&&b(this.el).removeAttr("maxlength"),"list"==this.type&&b(this.el).removeClass("w2ui-select"),this.type="clear";var t=b(this.el).data("tmp");if(this.tmp){for(var i in null!=t&&(b(this.el).height("auto"),t&&t["old-padding-left"]&&b(this.el).css("padding-left",t["old-padding-left"]),t&&t["old-padding-right"]&&b(this.el).css("padding-right",t["old-padding-right"]),t&&t["old-background-color"]&&b(this.el).css("background-color",t["old-background-color"]),t&&t["old-border-color"]&&b(this.el).css("border-color",t["old-border-color"]),clearInterval(t.sizeTimer)),b(this.el).val(this.clean(b(this.el).val())).removeClass("w2field").removeData().off(".w2field"),this.helpers)b(this.helpers[i]).remove();this.helpers={}}},refresh:function(){var o=this,i=this.options,l=b(this.el).data("selected"),e=(new Date).getTime();if(-1!=["list"].indexOf(this.type)&&(b(o.el).parent().css("white-space","nowrap"),o.helpers.prefix&&o.helpers.prefix.hide(),setTimeout(function(){if(o.helpers.focus){!b.isEmptyObject(l)&&i.icon?i.prefix='<span class="w2ui-icon '+i.icon+'"style="cursor: pointer; font-size: 14px; display: inline-block; margin-top: -1px; color: #7F98AD;'+i.iconStyle+'"></span>':i.prefix="",o.addPrefix();var t=o.helpers.focus.find("input");""===b(t).val()?(b(t).css("text-indent","-9999em").prev().css("opacity",0),b(o.el).val(l&&null!=l.text?w2utils.lang(l.text):"")):(b(t).css("text-indent",0).prev().css("opacity",1),b(o.el).val(""),setTimeout(function(){o.helpers.prefix&&o.helpers.prefix.hide();var e="position: absolute; opacity: 0; margin: 4px 0px 0px 2px; background-position: left !important;";i.icon?(b(t).css("margin-left","17px"),b(o.helpers.focus).find(".icon-search").attr("style",e+"width: 11px !important; opacity: 1; display: block")):(b(t).css("margin-left","0px"),b(o.helpers.focus).find(".icon-search").attr("style",e+"width: 0px !important; opacity: 0; display: none"))},1)),b(o.el).prop("readonly")||b(o.el).prop("disabled")?setTimeout(function(){b(o.helpers.prefix).css("opacity","0.6"),b(o.helpers.suffix).css("opacity","0.6")},1):setTimeout(function(){b(o.helpers.prefix).css("opacity","1"),b(o.helpers.suffix).css("opacity","1")},1)}},1)),-1!=["enum","file"].indexOf(this.type)){var t="";if(l)for(var s=0;s<l.length;s++){var n=l[s],r="";r="function"==typeof i.renderItem?i.renderItem(n,s,'<div class="w2ui-list-remove" title="'+w2utils.lang("Remove")+'" index="'+s+'">&#160;&#160;</div>'):'<div class="w2ui-list-remove" title="'+w2utils.lang("Remove")+'" index="'+s+'">&#160;&#160;</div>'+("enum"==o.type?n.text:n.name+'<span class="file-size"> - '+w2utils.formatSize(n.size)+"</span>"),t+='<li index="'+s+'" style="max-width: '+parseInt(i.maxWidth)+"px; "+(n.style?n.style:"")+'">'+r+"</li>"}var a=o.helpers.multi,d=a.find("ul");if(a.attr("style",a.attr("style")+";"+i.style),b(o.el).css("z-index","-1"),b(o.el).prop("readonly")||b(o.el).prop("disabled")?setTimeout(function(){a[0].scrollTop=0,a.addClass("w2ui-readonly").find("li").css("opacity","0.9").parent().find("li.nomouse").hide().find("input").prop("readonly",!0).parents("ul").find(".w2ui-list-remove").hide()},1):setTimeout(function(){a.removeClass("w2ui-readonly").find("li").css("opacity","1").parent().find("li.nomouse").show().find("input").prop("readonly",!1).parents("ul").find(".w2ui-list-remove").show()},1),a.find(".w2ui-enum-placeholder").remove(),d.find("li").not("li.nomouse").remove(),""!==t)d.prepend(t);else if(null!=b(o.el).attr("placeholder")&&""===a.find("input").val()){var u="padding-top: "+b(this.el).css("padding-top")+";padding-left: "+b(this.el).css("padding-left")+"; box-sizing: "+b(this.el).css("box-sizing")+"; line-height: "+b(this.el).css("line-height")+"; font-size: "+b(this.el).css("font-size")+"; font-family: "+b(this.el).css("font-family")+"; ";a.prepend('<div class="w2ui-enum-placeholder" style="'+u+'">'+b(o.el).attr("placeholder")+"</div>")}a.off("scroll.w2field").on("scroll.w2field",function(e){var t=o.trigger({phase:"before",type:"scroll",target:o.el,originalEvent:e});!0!==t.isCancelled&&o.trigger(b.extend(t,{phase:"after"}))}).find("li").data("mouse","out").on("click",function(e){var t="LI"==e.target.tagName.toUpperCase()?e.target:b(e.target).parents("LI"),i=l[b(t).attr("index")];if(!b(t).hasClass("nomouse"))if(e.stopPropagation(),b(e.target).hasClass("w2ui-list-remove")){if(b(o.el).prop("readonly")||b(o.el).prop("disabled"))return;if(!0===(s=o.trigger({phase:"before",type:"remove",target:o.el,originalEvent:e.originalEvent,item:i})).isCancelled)return;b().w2overlay(),l.splice(b(e.target).attr("index"),1),b(o.el).trigger("change"),b(e.target).parent().fadeOut("fast"),setTimeout(function(){o.refresh(),o.trigger(b.extend(s,{phase:"after"}))},300)}else{var s;if(!0===(s=o.trigger({phase:"before",type:"click",target:o.el,originalEvent:e.originalEvent,item:i})).isCancelled)return;if("file"==o.type){var n="";/image/i.test(i.type)&&(n='<div style="padding: 3px;">    <img src="'+(i.content?"data:"+i.type+";base64,"+i.content:"")+'" style="max-width: 300px;"         onload="var w = jQuery(this).width(); var h = jQuery(this).height();             if (w < 300 & h < 300) return;             if (w >= h && w > 300) jQuery(this).width(300);            if (w < h && h > 300) jQuery(this).height(300);"        onerror="this.style.display = \'none\'"    ></div>');var r='style="padding: 3px; text-align: right; color: #777;"',a='style="padding: 3px"';n+='<div style="padding: 8px;">    <table cellpadding="2"><tbody>    <tr><td '+r+">"+w2utils.lang("Name")+":</td><td "+a+">"+i.name+"</td></tr>    <tr><td "+r+">"+w2utils.lang("Size")+":</td><td "+a+">"+w2utils.formatSize(i.size)+"</td></tr>    <tr><td "+r+">"+w2utils.lang("Type")+":</td><td "+a+'>        <span style="width: 200px; display: block-inline; overflow: hidden; text-overflow: ellipsis; white-space: nowrap="nowrap";">'+i.type+"</span>    </td></tr>    <tr><td "+r+">"+w2utils.lang("Modified")+":</td><td "+a+">"+w2utils.date(i.modified)+"</td></tr>    </tbody></table></div>",b("#w2ui-overlay").remove(),b(t).w2overlay(n)}o.trigger(b.extend(s,{phase:"after"}))}}).on("mouseover",function(e){var t="LI"==e.target.tagName.toUpperCase()?e.target:b(e.target).parents("LI");if(!b(t).hasClass("nomouse")){if("out"==b(t).data("mouse")){var i=l[b(e.target).attr("index")],s=o.trigger({phase:"before",type:"mouseOver",target:o.el,originalEvent:e.originalEvent,item:i});if(!0===s.isCancelled)return;o.trigger(b.extend(s,{phase:"after"}))}b(t).data("mouse","over")}}).on("mouseout",function(i){var s="LI"==i.target.tagName.toUpperCase()?i.target:b(i.target).parents("LI");b(s).hasClass("nomouse")||(b(s).data("mouse","leaving"),setTimeout(function(){if("leaving"==b(s).data("mouse")){b(s).data("mouse","out");var e=l[b(i.target).attr("index")],t=o.trigger({phase:"before",type:"mouseOut",target:o.el,originalEvent:i.originalEvent,item:e});if(!0===t.isCancelled)return;o.trigger(b.extend(t,{phase:"after"}))}},0))}),b(this.el).height("auto");var c=b(a).find("> div.w2ui-multi-items").height()+2*w2utils.getSize(a,"+height");c<26&&(c=26),c>i.maxHeight&&(c=i.maxHeight),0<a.length&&(a[0].scrollTop=1e3);var h=w2utils.getSize(b(this.el),"height")-2;if(c<h&&(c=h),b(a).css({height:c+"px",overflow:c==i.maxHeight?"auto":"hidden"}),c<i.maxHeight&&b(a).prop("scrollTop",0),b(this.el).css({height:c+2+"px"}),"enum"==o.type){var p=o.helpers.multi.find("input");p.width(8*(p.val().length+2)+"px")}}return(new Date).getTime()-e},reset:function(){var e=this.type;this.clear(),this.type=e,this.init()},resize:function(){var e=this,t=b(e.el).width(),i=b(e.el).height();if(!(e.tmp.current_width==t&&0<i)){var s=this.helpers.focus,n=this.helpers.multi,r=this.helpers.suffix,a=this.helpers.prefix;if(s&&s.width(b(e.el).width()),n){var o=w2utils.getSize(e.el,"width")-parseInt(b(e.el).css("margin-left"),10)-parseInt(b(e.el).css("margin-right"),10);b(n).width(o)}r&&(e.options.suffix='<div class="arrow-down" style="margin-top: '+(parseInt(b(e.el).height())-6)/2+'px;"></div>',e.addSuffix()),a&&e.addPrefix(),e.tmp.current_width=t}},clean:function(e){if("number"==typeof e)return e;var t=this.options;return e=String(e).trim(),-1!=["int","float","money","currency","percent"].indexOf(this.type)&&("string"==typeof e&&(t.autoFormat&&-1!=["money","currency"].indexOf(this.type)&&(e=String(e).replace(t.moneyRE,"")),t.autoFormat&&"percent"==this.type&&(e=String(e).replace(t.percentRE,"")),t.autoFormat&&-1!=["int","float"].indexOf(this.type)&&(e=String(e).replace(t.numberRE,"")),e=e.replace(/\s+/g,"").replace(w2utils.settings.groupSymbol,"").replace(w2utils.settings.decimalSymbol,".")),parseFloat(e)==e&&(null!=t.min&&e<t.min&&(e=t.min,b(this.el).val(t.min)),null!=t.max&&e>t.max&&(e=t.max,b(this.el).val(t.max))),e=""!==e&&w2utils.isFloat(e)?Number(e):""),e},format:function(e){var t=this.options;if(t.autoFormat&&""!==e)switch(this.type){case"money":case"currency":""!==(e=w2utils.formatNumber(e,t.currencyPrecision,t.groupSymbol))&&(e=t.currencyPrefix+e+t.currencySuffix);break;case"percent":""!==(e=w2utils.formatNumber(e,t.precision,t.groupSymbol))&&(e+="%");break;case"float":e=w2utils.formatNumber(e,t.precision,t.groupSymbol);break;case"int":e=w2utils.formatNumber(e,0,t.groupSymbol)}return e},change:function(e){var t=this,i=t.options;if(-1!=["int","float","money","currency","percent"].indexOf(this.type)){var s=b(this.el).val(),n=this.format(this.clean(b(this.el).val()));if(""!==s&&s!=n)return b(this.el).val(n).change(),e.stopPropagation(),e.preventDefault(),!1}if("color"==this.type){var r="#"+b(this.el).val();6!=b(this.el).val().length&&3!=b(this.el).val().length&&(r=""),b(this.el).next().find("div").css("background-color",r),b(t.el).is(":focus")&&this.updateOverlay()}if(-1!=["list","enum","file"].indexOf(this.type)&&(t.refresh(),setTimeout(function(){t.refresh()},5)),-1!=["date","time","datetime"].indexOf(this.type)){var a=parseInt(t.el.value);w2utils.isInt(t.el.value)&&3e3<a&&("time"==this.type&&b(t.el).val(w2utils.formatTime(new Date(a),i.format)).change(),"date"==this.type&&b(t.el).val(w2utils.formatDate(new Date(a),i.format)).change(),"datetime"==this.type&&b(t.el).val(w2utils.formatDateTime(new Date(a),i.format)).change())}},click:function(e){e.stopPropagation(),-1!=["list","combo","enum"].indexOf(this.type)&&(b(this.el).is(":focus")||this.focus(e)),-1!=["date","time","color","datetime"].indexOf(this.type)&&this.updateOverlay()},focus:function(e){var t=this;this.options;if(-1!==["color","date","time","datetime"].indexOf(t.type)){if(b(t.el).prop("readonly")||b(t.el).prop("disabled"))return;0<b("#w2ui-overlay").length&&b("#w2ui-overlay")[0].hide(),setTimeout(function(){t.updateOverlay()},150)}if(-1!=["list","combo","enum"].indexOf(t.type)){if(b(t.el).prop("readonly")||b(t.el).prop("disabled"))return;0<b("#w2ui-overlay").length&&b("#w2ui-overlay")[0].hide(),t.resize(),setTimeout(function(){"list"==t.type&&b(t.el).is(":focus")?b(t.helpers.focus).find("input").focus():(t.search(),setTimeout(function(){t.updateOverlay()},1))},1)}"file"==t.type&&b(t.helpers.multi).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"})},blur:function(e){var t=this,i=t.options,s=b(t.el).val().trim();-1!=["color","date","time","list","combo","enum","datetime"].indexOf(t.type)&&0<b("#w2ui-overlay").length&&b("#w2ui-overlay")[0].hide(),-1!=["int","float","money","currency","percent"].indexOf(t.type)&&(""===s||t.checkType(s)||(b(t.el).val("").change(),!1===i.silent&&(b(t.el).w2tag("Not a valid number"),setTimeout(function(){b(t.el).w2tag("")},3e3)))),-1!=["date","time","datetime"].indexOf(t.type)&&(""===s||t.inRange(t.el.value)?"date"!=t.type||""===s||w2utils.isDate(t.el.value,i.format)?"time"!=t.type||""===s||w2utils.isTime(t.el.value)?"datetime"!=t.type||""===s||w2utils.isDateTime(t.el.value,i.format)||(b(t.el).val("").removeData("selected").change(),!1===i.silent&&(b(t.el).w2tag("Not a valid date"),setTimeout(function(){b(t.el).w2tag("")},3e3))):(b(t.el).val("").removeData("selected").change(),!1===i.silent&&(b(t.el).w2tag("Not a valid time"),setTimeout(function(){b(t.el).w2tag("")},3e3))):(b(t.el).val("").removeData("selected").change(),!1===i.silent&&(b(t.el).w2tag("Not a valid date"),setTimeout(function(){b(t.el).w2tag("")},3e3))):(b(t.el).val("").removeData("selected").change(),!1===i.silent&&(b(t.el).w2tag("Not in range"),setTimeout(function(){b(t.el).w2tag("")},3e3)))),"enum"==t.type&&b(t.helpers.multi).find("input").val("").width(20),"file"==t.type&&b(t.helpers.multi).css({outline:"none"})},keyPress:function(e){var t=this;t.options;if(-1!=["int","float","money","currency","percent","hex","bin","color","alphanumeric"].indexOf(t.type)){if(e.metaKey||e.ctrlKey||e.altKey||e.charCode!=e.keyCode&&0<e.keyCode)return;var i=String.fromCharCode(e.charCode);if(!t.checkType(i,!0)&&13!=e.keyCode)return e.preventDefault(),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,!1}-1!=["date","time","datetime"].indexOf(t.type)&&9!==e.keyCode&&setTimeout(function(){t.updateOverlay()},1)},keyDown:function(e,t){var i=this,s=i.options,n=e.keyCode||t&&t.keyCode;if(-1!=["int","float","money","currency","percent"].indexOf(i.type)){if(!s.keyboard||b(i.el).prop("readonly")||b(i.el).prop("disabled"))return;var r=!1,a=parseFloat(b(i.el).val().replace(s.moneyRE,""))||0,o=s.step;switch((e.ctrlKey||e.metaKey)&&(o=10),n){case 38:if(e.shiftKey)break;b(i.el).val(a+o<=s.max||null==s.max?Number((a+o).toFixed(12)):s.max).change(),r=!0;break;case 40:if(e.shiftKey)break;b(i.el).val(a-o>=s.min||null==s.min?Number((a-o).toFixed(12)):s.min).change(),r=!0}r&&(e.preventDefault(),setTimeout(function(){i.el.setSelectionRange(i.el.value.length,i.el.value.length)},0))}if("date"==i.type){if(!s.keyboard||b(i.el).prop("readonly")||b(i.el).prop("disabled"))return;r=!1;var l=864e5;o=1;switch((e.ctrlKey||e.metaKey)&&(o=10),(c=w2utils.isDate(b(i.el).val(),s.format,!0))||(c=new Date,l=0),n){case 38:if(e.shiftKey)break;var d=w2utils.formatDate(c.getTime()+l,s.format);10==o&&(d=w2utils.formatDate(new Date(c.getFullYear(),c.getMonth()+1,c.getDate()),s.format)),b(i.el).val(d).change(),r=!0;break;case 40:if(e.shiftKey)break;d=w2utils.formatDate(c.getTime()-l,s.format);10==o&&(d=w2utils.formatDate(new Date(c.getFullYear(),c.getMonth()-1,c.getDate()),s.format)),b(i.el).val(d).change(),r=!0}r&&(e.preventDefault(),setTimeout(function(){i.el.setSelectionRange(i.el.value.length,i.el.value.length),i.updateOverlay()},0))}if("time"==i.type){if(!s.keyboard||b(i.el).prop("readonly")||b(i.el).prop("disabled"))return;r=!1,o=e.ctrlKey||e.metaKey?60:1,a=b(i.el).val();var u=i.toMin(a)||i.toMin((new Date).getHours()+":"+((new Date).getMinutes()-1));switch(n){case 38:if(e.shiftKey)break;u+=o,r=!0;break;case 40:if(e.shiftKey)break;u-=o,r=!0}r&&(b(i.el).val(i.fromMin(u)).change(),e.preventDefault(),setTimeout(function(){i.el.setSelectionRange(i.el.value.length,i.el.value.length)},0))}if("datetime"==i.type){if(!s.keyboard||b(i.el).prop("readonly")||b(i.el).prop("disabled"))return;r=!1,l=864e5,o=1;(e.ctrlKey||e.metaKey)&&(o=10);var c,h=b(i.el).val();switch((c=w2utils.isDateTime(h,this.options.format,!0))||(c=new Date,l=0),n){case 38:if(e.shiftKey)break;d=w2utils.formatDateTime(c.getTime()+l,s.format);10==o&&(d=w2utils.formatDateTime(new Date(c.getFullYear(),c.getMonth()+1,c.getDate()),s.format)),b(i.el).val(d).change(),r=!0;break;case 40:if(e.shiftKey)break;d=w2utils.formatDateTime(c.getTime()-l,s.format);10==o&&(d=w2utils.formatDateTime(new Date(c.getFullYear(),c.getMonth()-1,c.getDate()),s.format)),b(i.el).val(d).change(),r=!0}r&&(e.preventDefault(),setTimeout(function(){i.el.setSelectionRange(i.el.value.length,i.el.value.length),i.updateOverlay()},0))}if("color"==i.type){if(b(i.el).prop("readonly")||b(i.el).prop("disabled"))return;if(86==e.keyCode&&(e.ctrlKey||e.metaKey)&&(b(i.el).prop("maxlength",7),setTimeout(function(){var e=b(i).val();"#"==e.substr(0,1)&&(e=e.substr(1)),w2utils.isHex(e)||(e=""),b(i).val(e).prop("maxlength",6).change()},20)),(e.ctrlKey||e.metaKey)&&!e.shiftKey){var p=null,f=null;switch(n){case 38:p="up";break;case 40:p="down";break;case 39:p="right";break;case 37:p="left"}i.el.nav&&null!=p&&(f=i.el.nav(p),b(i.el).val(f).change(),e.preventDefault())}}if(-1!=["list","combo","enum"].indexOf(i.type)){if(b(i.el).prop("readonly")||b(i.el).prop("disabled"))return;var g=b(i.el).data("selected"),m=b(i.el),w=!1;switch(-1!=["list","enum"].indexOf(i.type)&&("list"==i.type&&(m=b(i.helpers.focus).find("input")),"enum"==i.type&&(m=b(i.helpers.multi).find("input")),-1==[37,38,39,40].indexOf(n)&&setTimeout(function(){i.refresh()},1),86==e.keyCode&&(e.ctrlKey||e.metaKey)&&setTimeout(function(){i.refresh(),i.search(),i.request()},50)),n){case 27:"list"==i.type&&(""!==m.val()&&m.val(""),e.stopPropagation());break;case 37:case 39:break;case 13:if(0===b("#w2ui-overlay").length)break;var v=s.items[s.index];if("enum"==i.type)if(null!=v){if(!0===(y=i.trigger({phase:"before",type:"add",target:i.el,originalEvent:e.originalEvent,item:v})).isCancelled)return;v=y.item,g.length>=s.max&&0<s.max&&g.pop(),delete v.hidden,delete i.tmp.force_open,g.push(v),b(i.el).change(),m.val("").width(20),i.refresh(),i.trigger(b.extend(y,{phase:"after"}))}else{if(v={id:m.val(),text:m.val()},!0===(y=i.trigger({phase:"before",type:"new",target:i.el,originalEvent:e.originalEvent,item:v})).isCancelled)return;v=y.item,"function"==typeof i.onNew&&(g.length>=s.max&&0<s.max&&g.pop(),delete i.tmp.force_open,g.push(v),b(i.el).change(),m.val("").width(20),i.refresh()),i.trigger(b.extend(y,{phase:"after"}))}else v&&b(i.el).data("selected",v).val(v.text).change(),""===b(i.el).val()&&b(i.el).data("selected")&&b(i.el).removeData("selected").val("").change(),"list"==i.type&&(m.val(""),i.refresh()),i.tmp.force_hide=!0;break;case 8:case 46:if("enum"==i.type&&8==n&&""===m.val()&&0<g.length){var y;v=g[g.length-1];if(!0===(y=i.trigger({phase:"before",type:"remove",target:i.el,originalEvent:e.originalEvent,item:v})).isCancelled)return;g.pop(),b(i.el).trigger("change"),i.refresh(),i.trigger(b.extend(y,{phase:"after"}))}"list"==i.type&&""===m.val()&&(b(i.el).data("selected",{}).change(),i.refresh());break;case 38:for(s.index=w2utils.isInt(s.index)?parseInt(s.index):0,s.index--;0<s.index&&s.items[s.index].hidden;)s.index--;if(0===s.index&&s.items[s.index].hidden)for(;s.items[s.index]&&s.items[s.index].hidden;)s.index++;w=!0;break;case 40:for(s.index=w2utils.isInt(s.index)?parseInt(s.index):-1,s.index++;s.index<s.items.length-1&&s.items[s.index].hidden;)s.index++;if(s.index==s.items.length-1&&s.items[s.index].hidden)for(;s.items[s.index]&&s.items[s.index].hidden;)s.index--;""===m.val()&&0===b("#w2ui-overlay").length?i.tmp.force_open=!0:w=!0}if(w)return s.index<0&&(s.index=0),s.index>=s.items.length&&(s.index=s.items.length-1),i.updateOverlay(w),e.preventDefault(),void setTimeout(function(){if("enum"==i.type)(e=m.get(0)).setSelectionRange(e.value.length,e.value.length);else if("list"==i.type){var e;(e=m.get(0)).setSelectionRange(e.value.length,e.value.length)}else i.el.setSelectionRange(i.el.value.length,i.el.value.length)},0);"enum"==i.type&&m.width(8*(m.val().length+2)+"px")}},keyUp:function(e){if("color"==this.type&&86==e.keyCode&&(e.ctrlKey||e.metaKey)&&b(this).prop("maxlength",6),-1!=["list","combo","enum"].indexOf(this.type)){if(b(this.el).prop("readonly")||b(this.el).prop("disabled"))return;if(-1==[16,17,18,20,37,39,91].indexOf(e.keyCode)){var t=b(this.helpers.focus).find("input");0===t.length&&(t=b(this.el));var i=this.trigger({phase:"before",type:"search",originalEvent:e,target:t,search:t.val()});if(!0===i.isCancelled)return;this.tmp.force_hide||this.request(),1==t.val().length&&this.refresh(),0!==b("#w2ui-overlay").length&&-1!=[38,40].indexOf(e.keyCode)||this.search(),this.trigger(b.extend(i,{phase:"after"}))}}},clearCache:function(){this.options.items=[],this.tmp.xhr_loading=!1,this.tmp.xhr_search="",this.tmp.xhr_total=-1},request:function(e){var a=this,r=this.options,o=b(a.el).val()||"";if(r.url){if("enum"==a.type){var t=b(a.helpers.multi).find("input");o=0===t.length?"":t.val()}if("list"==a.type){t=b(a.helpers.focus).find("input");o=0===t.length?"":t.val()}if(0!==r.minLength&&o.length<r.minLength)return r.items=[],void this.updateOverlay();null==e&&(e=r.interval),null==a.tmp.xhr_search&&(a.tmp.xhr_search=""),null==a.tmp.xhr_total&&(a.tmp.xhr_total=-1),r.url&&!0!==b(a.el).prop("readonly")&&!0!==b(a.el).prop("disabled")&&(0===r.items.length&&0!==a.tmp.xhr_total||a.tmp.xhr_total==r.cacheMax&&o.length>a.tmp.xhr_search.length||o.length>=a.tmp.xhr_search.length&&o.substr(0,a.tmp.xhr_search.length)!=a.tmp.xhr_search||o.length<a.tmp.xhr_search.length)&&(a.tmp.xhr&&a.tmp.xhr.abort(),a.tmp.xhr_loading=!0,a.search(),clearTimeout(a.tmp.timeout),a.tmp.timeout=setTimeout(function(){var e=r.url,n={search:o,max:r.cacheMax};b.extend(n,r.postData);var t=a.trigger({phase:"before",type:"request",search:o,target:a.el,url:e,postData:n});if(!0!==t.isCancelled){var i={type:"GET",url:e=t.url,data:n=t.postData,dataType:"JSON"};r.method&&(i.type=r.method),"JSON"==w2utils.settings.dataType&&(i.type="POST",i.data=JSON.stringify(i.data),i.contentType="application/json"),"HTTPJSON"==w2utils.settings.dataType&&(i.data={request:JSON.stringify(i.data)}),null!=r.method&&(i.type=r.method),a.tmp.xhr=b.ajax(i).done(function(e,t,i){var s=a.trigger({phase:"before",type:"load",target:a.el,search:n.search,data:e,xhr:i});!0!==s.isCancelled&&("string"==typeof(e=s.data)&&(e=JSON.parse(e)),null==e.records&&null!=e.items&&(e.records=e.items,delete e.items),"success"==e.status&&Array.isArray(e.records)?(e.records.length>r.cacheMax&&e.records.splice(r.cacheMax,1e5),null==r.recId&&null!=r.recid&&(r.recId=r.recid),(r.recId||r.recText)&&e.records.forEach(function(e){"string"==typeof r.recId&&(e.id=e[r.recId]),"function"==typeof r.recId&&(e.id=r.recId(e)),"string"==typeof r.recText&&(e.text=e[r.recText]),"function"==typeof r.recText&&(e.text=r.recText(e))}),a.tmp.xhr_loading=!1,a.tmp.xhr_search=o,a.tmp.xhr_total=e.records.length,r.items=a.normMenu(e.records),""===o&&0===e.records.length?a.tmp.emptySet=!0:a.tmp.emptySet=!1,a.search(),a.trigger(b.extend(s,{phase:"after"}))):console.log("ERROR: server did not return proper structure. It should return",{status:"success",records:[{id:1,text:"item"}]}))}).fail(function(e,t,i){var s={status:t,error:i,rawResponseText:e.responseText},n=a.trigger({phase:"before",type:"error",target:a.el,search:o,error:s,xhr:e});if(!0!==n.isCancelled){if("abort"!=t){var r;try{r=b.parseJSON(e.responseText)}catch(e){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",records:[{id:1,text:"item"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof r?r:e.responseText)}a.clearCache(),a.search(),a.trigger(b.extend(n,{phase:"after"}))}}),a.trigger(b.extend(t,{phase:"after"}))}},e))}},search:function(){var e=this,t=this.options,i=b(e.el).val(),s=e.el,n=[],r=b(e.el).data("selected");if("enum"==e.type)for(var a in s=b(e.helpers.multi).find("input"),i=s.val(),r)r[a]&&n.push(r[a].id);else if("list"==e.type)for(var a in s=b(e.helpers.focus).find("input"),i=s.val(),r)r[a]&&n.push(r[a].id);if(!0!==e.tmp.xhr_loading){for(var o=0,l=0;l<t.items.length;l++){var d=t.items[l];if(null!=t.compare)"function"==typeof t.compare&&(d.hidden=!1===t.compare.call(this,d,i));else{var u="",c="";-1!=["is","begins"].indexOf(t.match)&&(u="^"),-1!=["is","ends"].indexOf(t.match)&&(c="$");try{new RegExp(u+i+c,"i").test(d.text)||"..."==d.text?d.hidden=!1:d.hidden=!0}catch(e){}}!1===t.filter&&(d.hidden=!1),"enum"==e.type&&-1!=b.inArray(d.id,n)&&(d.hidden=!0),!0!==d.hidden&&(o++,delete d.hidden)}for(t.index=-1;t.items[t.index]&&t.items[t.index].hidden;)t.index++;o<=0&&(t.index=-1),t.spinner=!1,e.updateOverlay(),setTimeout(function(){var e=b("#w2ui-overlay").html()||"";t.markSearch&&-1!=e.indexOf("$.fn.w2menuHandler")&&b("#w2ui-overlay").w2marker(i)},1)}else t.items.splice(0,t.cacheMax),t.spinner=!0,e.updateOverlay()},updateOverlay:function(e){var s=this,n=this.options;if("color"==this.type){if(b(s.el).prop("readonly")||b(s.el).prop("disabled"))return;b(this.el).w2color({color:b(this.el).val(),transparent:n.transparent},function(e){null!=e&&b(s.el).val(e).change()})}if("date"==this.type){if(b(s.el).prop("readonly")||b(s.el).prop("disabled"))return;0===b("#w2ui-overlay").length&&b(s.el).w2overlay('<div class="w2ui-reset w2ui-calendar" onclick="event.stopPropagation();"></div>',{css:{"background-color":"#f5f5f5"}}),(a=w2utils.isDate(b(s.el).val(),s.options.format,!0))&&(t=a.getMonth()+1,r=a.getFullYear()),function i(e,t){b("#w2ui-overlay > div > div").html(s.getMonthHTML(e,t,b(s.el).val())),b("#w2ui-overlay .w2ui-calendar-title").on("mousedown",function(){var e,t;b(this).next().hasClass("w2ui-calendar-jump")?b(this).next().remove():(b(this).after('<div class="w2ui-calendar-jump" style=""></div>'),b(this).next().hide().html(s.getYearHTML()).fadeIn(200),setTimeout(function(){b("#w2ui-overlay .w2ui-calendar-jump").find(".w2ui-jump-month, .w2ui-jump-year").on("click",function(){b(this).hasClass("w2ui-jump-month")&&(b(this).parent().find(".w2ui-jump-month").removeClass("selected"),b(this).addClass("selected"),t=b(this).attr("name")),b(this).hasClass("w2ui-jump-year")&&(b(this).parent().find(".w2ui-jump-year").removeClass("selected"),b(this).addClass("selected"),e=b(this).attr("name")),null!=e&&null!=t&&(b("#w2ui-overlay .w2ui-calendar-jump").fadeOut(100),setTimeout(function(){i(parseInt(t)+1,e)},100))}),b("#w2ui-overlay .w2ui-calendar-jump >:last-child").prop("scrollTop",2e3)},1))}),b("#w2ui-overlay .w2ui-date").on("mousedown",function(){var e=b(this).attr("date");b(s.el).val(e).change(),b(this).css({"background-color":"#B6D5FB","border-color":"#aaa"})}).on("mouseup",function(){setTimeout(function(){0<b("#w2ui-overlay").length&&b("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)}),b("#w2ui-overlay .previous").on("mousedown",function(){var e=s.options.current.split("/");e[0]=parseInt(e[0])-1,i(e[0],e[1])}),b("#w2ui-overlay .next").on("mousedown",function(){var e=s.options.current.split("/");e[0]=parseInt(e[0])+1,i(e[0],e[1])})}(t,r)}if("time"==this.type){if(b(s.el).prop("readonly")||b(s.el).prop("disabled"))return;0===b("#w2ui-overlay").length&&b(s.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time" onclick="event.stopPropagation();"></div>',{css:{"background-color":"#fff"}});var i="h24"==this.options.format;b("#w2ui-overlay > div").html(s.getHourHTML()),b("#w2ui-overlay .w2ui-time").on("mousedown",function(e){b(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});var t=b(this).attr("hour");b(s.el).val((12<t&&!i?t-12:t)+":00"+(i?"":t<12?" am":" pm")).change()}),null==this.options.noMinutes||!1===this.options.noMinutes?b("#w2ui-overlay .w2ui-time").on("mouseup",function(){var t=b(this).attr("hour");0<b("#w2ui-overlay").length&&b("#w2ui-overlay")[0].hide(),b(s.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}}),b("#w2ui-overlay > div").html(s.getMinHTML(t)),b("#w2ui-overlay .w2ui-time").on("mousedown",function(){b(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});var e=b(this).attr("min");b(s.el).val((12<t&&!i?t-12:t)+":"+(e<10?0:"")+e+(i?"":t<12?" am":" pm")).change()}).on("mouseup",function(){setTimeout(function(){0<b("#w2ui-overlay").length&&b("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}):b("#w2ui-overlay .w2ui-time").on("mouseup",function(){setTimeout(function(){0<b("#w2ui-overlay").length&&b("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}if("datetime"==this.type){if(b(s.el).prop("readonly")||b(s.el).prop("disabled"))return;var t,r,a;0<b("#w2ui-overlay .w2ui-time").length&&b("#w2ui-overlay")[0].hide(),0===b("#w2ui-overlay").length&&b(s.el).w2overlay('<div class="w2ui-reset w2ui-calendar" onclick="event.stopPropagation();"></div>',{css:{"background-color":"#f5f5f5"}}),(a=w2utils.isDateTime(b(s.el).val(),s.options.format,!0))&&(t=a.getMonth()+1,r=a.getFullYear());var o=null;!function i(e,t){b("#w2ui-overlay > div > div").html(s.getMonthHTML(e,t,b(s.el).val())+(n.btn_now?'<div class="w2ui-calendar-now now">'+w2utils.lang("Current Date & Time")+"</div>":"")),b("#w2ui-overlay .w2ui-calendar-title").on("mousedown",function(){var e,t;b(this).next().hasClass("w2ui-calendar-jump")?b(this).next().remove():(b(this).after('<div class="w2ui-calendar-jump" style=""></div>'),b(this).next().hide().html(s.getYearHTML()).fadeIn(200),setTimeout(function(){b("#w2ui-overlay .w2ui-calendar-jump").find(".w2ui-jump-month, .w2ui-jump-year").on("click",function(){b(this).hasClass("w2ui-jump-month")&&(b(this).parent().find(".w2ui-jump-month").removeClass("selected"),b(this).addClass("selected"),t=b(this).attr("name")),b(this).hasClass("w2ui-jump-year")&&(b(this).parent().find(".w2ui-jump-year").removeClass("selected"),b(this).addClass("selected"),e=b(this).attr("name")),null!=e&&null!=t&&(b("#w2ui-overlay .w2ui-calendar-jump").fadeOut(100),setTimeout(function(){i(parseInt(t)+1,e)},100))}),b("#w2ui-overlay .w2ui-calendar-jump >:last-child").prop("scrollTop",2e3)},1))}),b("#w2ui-overlay .w2ui-date").on("mousedown",function(){var e=b(this).attr("date");b(s.el).val(e).change(),b(this).css({"background-color":"#B6D5FB","border-color":"#aaa"}),o=new Date(b(this).attr("data-date"))}).on("mouseup",function(){var i,t;0<b("#w2ui-overlay").length&&b("#w2ui-overlay")[0].hide(),b(s.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}});s.options.format;b("#w2ui-overlay > div").html(s.getHourHTML()),b("#w2ui-overlay .w2ui-time").on("mousedown",function(e){b(this).css({"background-color":"#B6D5FB","border-color":"#aaa"}),i=b(this).attr("hour"),o.setHours(i);var t=w2utils.formatDateTime(o,s.options.format);b(s.el).val(t).change()}),null==s.options.noMinutes||!1===s.options.noMinutes?b("#w2ui-overlay .w2ui-time").on("mouseup",function(){var e=b(this).attr("hour");0<b("#w2ui-overlay").length&&b("#w2ui-overlay")[0].hide(),b(s.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}}),b("#w2ui-overlay > div").html(s.getMinHTML(e)),b("#w2ui-overlay .w2ui-time").on("mousedown",function(){b(this).css({"background-color":"#B6D5FB","border-color":"#aaa"}),t=b(this).attr("min"),o.setHours(i,t);var e=w2utils.formatDateTime(o,s.options.format);b(s.el).val(e).change()}).on("mouseup",function(){setTimeout(function(){0<b("#w2ui-overlay").length&&b("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}):b("#w2ui-overlay .w2ui-time").on("mouseup",function(){setTimeout(function(){0<b("#w2ui-overlay").length&&b("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}),b("#w2ui-overlay .previous").on("mousedown",function(){var e=s.options.current.split("/");e[0]=parseInt(e[0])-1,i(e[0],e[1])}),b("#w2ui-overlay .next").on("mousedown",function(){var e=s.options.current.split("/");e[0]=parseInt(e[0])+1,i(e[0],e[1])}),b("#w2ui-overlay .now").on("mousedown",function(){var e=w2utils.formatDateTime(new Date,s.options.format);return b(s.el).val(e).change(),!1}).on("mouseup",function(){setTimeout(function(){0<b("#w2ui-overlay").length&&b("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}(t,r)}if(-1!=["list","combo","enum"].indexOf(this.type)){var l=this.el,d=this.el;if("enum"==this.type&&(l=b(this.helpers.multi),d=b(l).find("input")),"list"==this.type){var u=b(d).data("selected");b.isPlainObject(u)&&!b.isEmptyObject(u)&&-1==n.index&&n.items.forEach(function(e,t){e.id==u.id&&(n.index=t)}),d=b(this.helpers.focus).find("input")}if(b(d).is(":focus")){if(!1===n.openOnFocus&&""===b(d).val()&&!0!==s.tmp.force_open)return void b().w2overlay();if(s.tmp.force_hide)return b().w2overlay(),void setTimeout(function(){delete s.tmp.force_hide},1);""!==b(d).val()&&delete s.tmp.force_open;var c=w2utils.lang("No matches");null!=n.url&&b(d).val().length<n.minLength&&!0!==s.tmp.emptySet&&(c=n.minLength+" "+w2utils.lang("letters or more...")),null!=n.url&&""===b(d).val()&&!0!==s.tmp.emptySet&&(c=w2utils.lang("Type to search...")),null==n.url&&0===n.items.length&&(c=w2utils.lang("Empty list")),null!=n.msgNoItems&&(c=n.msgNoItems),"function"==c&&(c=c(n)),b(l).w2menu(e?"refresh-index":"refresh",b.extend(!0,{},n,{search:!1,render:n.renderDrop,maxHeight:n.maxDropHeight,maxWidth:n.maxDropWidth,msgNoItems:c,onSelect:function(e){if("enum"==s.type){var t=b(s.el).data("selected");if(e.item){var i=s.trigger({phase:"before",type:"add",target:s.el,originalEvent:e.originalEvent,item:e.item});if(!0===i.isCancelled)return;t.length>=n.max&&0<n.max&&t.pop(),delete e.item.hidden,t.push(e.item),b(s.el).data("selected",t).change(),b(s.helpers.multi).find("input").val("").width(20),s.refresh(),0<b("#w2ui-overlay").length&&b("#w2ui-overlay")[0].hide(),s.trigger(b.extend(i,{phase:"after"}))}}else b(s.el).data("selected",e.item).val(e.item.text).change(),s.helpers.focus&&s.helpers.focus.find("input").val("")}}))}}},inRange:function(e,t){var i=!1;if("date"==this.type){if(p=w2utils.isDate(e,this.options.format,!0)){if(this.options.start||this.options.end){var s="string"==typeof this.options.start?this.options.start:b(this.options.start).val(),n="string"==typeof this.options.end?this.options.end:b(this.options.end).val(),r=w2utils.isDate(s,this.options.format,!0),a=w2utils.isDate(n,this.options.format,!0),o=new Date(p);r||(r=o),a||(a=o),r<=o&&o<=a&&(i=!0)}else i=!0;if(this.options.blocked&&-1!=b.inArray(e,this.options.blocked)&&(i=!1),null!=this.options.blockWeekDays&&null!=this.options.blockWeekDays&&null!=this.options.blockWeekDays.length)for(var l=this.options.blockWeekDays.length,d=0;d<l;d++)p.getDay()==this.options.blockWeekDays[d]&&(i=!1)}}else if("time"==this.type)if(this.options.start||this.options.end){var u=this.toMin(e),c=this.toMin(this.options.start),h=this.toMin(this.options.end);c||(c=u),h||(h=u),c<=u&&u<=h&&(i=!0)}else i=!0;else if("datetime"==this.type){var p;if(p=w2utils.isDateTime(e,this.options.format,!0)){if(this.options.start||this.options.end){if("object"==typeof this.options.start&&this.options.start instanceof Date)r=this.options.start;else r=""!==(s="string"==typeof this.options.start?this.options.start:b(this.options.start).val()).trim()?w2utils.isDateTime(s,this.options.format,!0):"";if("object"==typeof this.options.end&&this.options.end instanceof Date)a=this.options.end;else a=""!==(n="string"==typeof this.options.end?this.options.end:b(this.options.end).val()).trim()?w2utils.isDateTime(n,this.options.format,!0):"";o=p;r||(r=o),a||(a=o),t&&r instanceof Date&&(r.setHours(0),r.setMinutes(0),r.setSeconds(0)),r<=o&&o<=a&&(i=!0)}else i=!0;if(i&&this.options.blocked)for(d=0;d<this.options.blocked.length;d++){var f=this.options.blocked[d];if("string"==typeof f&&(f=w2utils.isDateTime(f,this.options.format,!0)),"object"==typeof f&&f instanceof Date&&f.getFullYear()==p.getFullYear()&&f.getMonth()==p.getMonth()&&f.getDate()==p.getDate()){i=!1;break}}}}return i},checkType:function(e,t){var i=this;switch(i.type){case"int":return!(!t||-1==["-",i.options.groupSymbol].indexOf(e))||w2utils.isInt(e.replace(i.options.numberRE,""));case"percent":e=e.replace(/%/g,"");case"float":return!(!t||-1==["-",w2utils.settings.decimalSymbol,i.options.groupSymbol].indexOf(e))||w2utils.isFloat(e.replace(i.options.numberRE,""));case"money":case"currency":return!(!t||-1==["-",i.options.decimalSymbol,i.options.groupSymbol,i.options.currencyPrefix,i.options.currencySuffix].indexOf(e))||w2utils.isFloat(e.replace(i.options.moneyRE,""));case"bin":return w2utils.isBin(e);case"hex":case"color":return w2utils.isHex(e);case"alphanumeric":return w2utils.isAlphaNumeric(e)}return!0},addPrefix:function(){var i=this;setTimeout(function(){if("clear"!==i.type){var e,t=b(i.el).data("tmp")||{};t["old-padding-left"]&&b(i.el).css("padding-left",t["old-padding-left"]),t["old-padding-left"]=b(i.el).css("padding-left"),b(i.el).data("tmp",t),i.helpers.prefix&&b(i.helpers.prefix).remove(),""!==i.options.prefix&&(b(i.el).before('<div class="w2ui-field-helper">'+i.options.prefix+"</div>"),(e=b(i.el).prev()).css({color:b(i.el).css("color"),"font-family":b(i.el).css("font-family"),"font-size":b(i.el).css("font-size"),"padding-top":b(i.el).css("padding-top"),"padding-bottom":b(i.el).css("padding-bottom"),"padding-left":b(i.el).css("padding-left"),"padding-right":0,"margin-top":parseInt(b(i.el).css("margin-top"),10)+2+"px","margin-bottom":parseInt(b(i.el).css("margin-bottom"),10)+1+"px","margin-left":b(i.el).css("margin-left"),"margin-right":0}).on("click",function(e){if(i.options.icon&&"function"==typeof i.onIconClick){var t=i.trigger({phase:"before",type:"iconClick",target:i.el,el:b(this).find("span.w2ui-icon")[0]});if(!0===t.isCancelled)return;i.trigger(b.extend(t,{phase:"after"}))}else"list"==i.type?b(i.helpers.focus).find("input").focus():b(i.el).focus()}),b(i.el).css("padding-left",e.width()+parseInt(b(i.el).css("padding-left"),10)+"px"),i.helpers.prefix=e)}},1)},addSuffix:function(){var t,i,n=this;setTimeout(function(){if("clear"!==n.type){var e=b(n.el).data("tmp")||{};if(e["old-padding-right"]&&b(n.el).css("padding-right",e["old-padding-right"]),e["old-padding-right"]=b(n.el).css("padding-right"),b(n.el).data("tmp",e),i=parseInt(b(n.el).css("padding-right"),10),n.options.arrows){n.helpers.arrows&&b(n.helpers.arrows).remove(),b(n.el).after('<div class="w2ui-field-helper" style="border: 1px solid transparent">&#160;    <div class="w2ui-field-up" type="up">        <div class="arrow-up" type="up"></div>    </div>    <div class="w2ui-field-down" type="down">        <div class="arrow-down" type="down"></div>    </div></div>');w2utils.getSize(n.el,"height");(t=b(n.el).next()).css({color:b(n.el).css("color"),"font-family":b(n.el).css("font-family"),"font-size":b(n.el).css("font-size"),height:b(n.el).height()+parseInt(b(n.el).css("padding-top"),10)+parseInt(b(n.el).css("padding-bottom"),10)+"px",padding:0,"margin-top":parseInt(b(n.el).css("margin-top"),10)+1+"px","margin-bottom":0,"border-left":"1px solid silver"}).css("margin-left","-"+(t.width()+parseInt(b(n.el).css("margin-right"),10)+12)+"px").on("mousedown",function(t){var i=b("body");function s(e){b(n.el).focus(),n.keyDown(b.Event("keydown"),{keyCode:"up"==b(t.target).attr("type")?38:40}),!1!==e&&b("body").data("_field_update_timer",setTimeout(s,60))}i.on("mouseup",function e(){clearTimeout(i.data("_field_update_timer"));i.off("mouseup",e)}),i.data("_field_update_timer",setTimeout(s,700)),s(!1)}),i+=t.width()+12,b(n.el).css("padding-right",i+"px"),n.helpers.arrows=t}""!==n.options.suffix&&(n.helpers.suffix&&b(n.helpers.suffix).remove(),b(n.el).after('<div class="w2ui-field-helper">'+n.options.suffix+"</div>"),(t=b(n.el).next()).css({color:b(n.el).css("color"),"font-family":b(n.el).css("font-family"),"font-size":b(n.el).css("font-size"),"padding-top":b(n.el).css("padding-top"),"padding-bottom":b(n.el).css("padding-bottom"),"padding-left":"3px","padding-right":b(n.el).css("padding-right"),"margin-top":parseInt(b(n.el).css("margin-top"),10)+2+"px","margin-bottom":parseInt(b(n.el).css("margin-bottom"),10)+1+"px"}).on("click",function(e){"list"==n.type?b(n.helpers.focus).find("input").focus():b(n.el).focus()}),t.css("margin-left","-"+(w2utils.getSize(t,"width")+parseInt(b(n.el).css("margin-right"),10)+2)+"px"),i+=t.width()+3,b(n.el).css("padding-right",i+"px"),n.helpers.suffix=t)}},1)},addFocus:function(){var i,s=this;this.options;b(s.helpers.focus).remove();var e=b(s.el).attr("tabIndex");e&&-1!=e&&(s.el._tabIndex=e),s.el._tabIndex&&(e=s.el._tabIndex),null==e&&(e=-1);var t='<div class="w2ui-field-helper">    <div class="w2ui-icon icon-search" style="opacity: 0; display: none"></div>    <input type="text" autocomplete="off" tabIndex="'+e+'"/></div>';b(s.el).attr("tabindex",-1).before(t);var n=b(s.el).prev();(s.helpers.focus=n).css({width:b(s.el).width(),"margin-top":b(s.el).css("margin-top"),"margin-left":parseInt(b(s.el).css("margin-left"))+parseInt(b(s.el).css("padding-left"))+"px","margin-bottom":b(s.el).css("margin-bottom"),"margin-right":b(s.el).css("margin-right")}).find("input").css({cursor:"default",width:"100%",outline:"none",opacity:1,margin:0,border:"1px solid transparent",padding:b(s.el).css("padding-top"),"padding-left":0,"margin-left":0,"background-color":"transparent"}),n.find("input").on("click",function(e){0===b("#w2ui-overlay").length&&s.focus(e),e.stopPropagation()}).on("focus",function(e){i=b(s.el).attr("placeholder"),b(s.el).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"}),b(this).val(""),b(s.el).triggerHandler("focus"),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}).on("blur",function(e){b(s.el).css("outline","none"),b(this).val(""),s.refresh(),b(s.el).triggerHandler("blur"),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,null!=i&&b(s.el).attr("placeholder",i)}).on("keydown",function(e){var t=this;s.keyDown(e),setTimeout(function(){""===t.value?b(s.el).attr("placeholder",i):b(s.el).attr("placeholder","")},10)}).on("keyup",function(e){s.keyUp(e)}).on("keypress",function(e){s.keyPress(e)}),n.on("click",function(e){b(this).find("input").focus()}),s.refresh()},addMulti:function(){var n=this;this.options;b(n.helpers.multi).remove();var e="",t="margin-top     : 0px; margin-bottom  : 0px; margin-left    : "+b(n.el).css("margin-left")+"; margin-right   : "+b(n.el).css("margin-right")+"; width          : "+(w2utils.getSize(n.el,"width")-parseInt(b(n.el).css("margin-left"),10)-parseInt(b(n.el).css("margin-right"),10))+"px;";if("enum"==n.type){var i=b(n.el).attr("tabIndex");i&&-1!=i&&(n.el._tabIndex=i),n.el._tabIndex&&(i=n.el._tabIndex),null==i&&(i=-1),e='<div class="w2ui-field-helper w2ui-list" style="'+t+'; box-sizing: border-box">    <div style="padding: 0px; margin: 0px; display: inline-block" class="w2ui-multi-items">    <ul>        <li style="padding-left: 0px; padding-right: 0px" class="nomouse">            <input type="text" style="width: 20px; margin: -3px 0 0; padding: 2px 0; border-color: white" autocomplete="off"'+(b(n.el).prop("readonly")?' readonly="readonly"':"")+(b(n.el).prop("disabled")?' disabled="disabled"':"")+' tabindex="'+i+'"/>        </li>    </ul>    </div></div>'}"file"==n.type&&(e='<div class="w2ui-field-helper w2ui-list" style="'+t+'; box-sizing: border-box">   <div style="position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px;">       <input class="file-input" type="file" style="width: 100%; height: 100%; opacity: 0;" name="attachment" multiple tabindex="-1"'+(b(n.el).prop("readonly")?' readonly="readonly"':"")+(b(n.el).prop("disabled")?' disabled="disabled"':"")+(b(n.el).attr("accept")?' accept="'+b(n.el).attr("accept")+'"':"")+'/>   </div>    <div style="position: absolute; padding: 0px; margin: 0px; display: inline-block" class="w2ui-multi-items">        <ul><li style="padding-left: 0px; padding-right: 0px" class="nomouse"></li></ul>    </div></div>');var s=b(n.el).data("tmp")||{};s["old-background-color"]=b(n.el).css("background-color"),s["old-border-color"]=b(n.el).css("border-color"),b(n.el).data("tmp",s),b(n.el).before(e).css({"background-color":"transparent","border-color":"transparent"});var r=b(n.el).prev();n.helpers.multi=r,"enum"==n.type&&(b(n.el).attr("tabindex",-1),r.find("input").on("click",function(e){0===b("#w2ui-overlay").length&&n.focus(e),b(n.el).triggerHandler("click")}).on("focus",function(e){b(r).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"}),b(n.el).triggerHandler("focus"),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}).on("blur",function(e){b(r).css("outline","none"),b(n.el).triggerHandler("blur"),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}).on("keyup",function(e){n.keyUp(e)}).on("keydown",function(e){n.keyDown(e)}).on("keypress",function(e){n.keyPress(e)}),r.on("click",function(e){b(this).find("input").focus()})),"file"==n.type&&(b(n.el).css("outline","none"),r.on("click",function(e){b(n.el).focus(),b(n.el).prop("readonly")||b(n.el).prop("disabled")||(n.blur(e),n.resize(),setTimeout(function(){r.find("input").click()},10))}).on("dragenter",function(e){b(n.el).prop("readonly")||b(n.el).prop("disabled")||b(r).addClass("w2ui-file-dragover")}).on("dragleave",function(e){b(n.el).prop("readonly")||b(n.el).prop("disabled")||0===b(e.target).parents(".w2ui-field-helper").length&&b(r).removeClass("w2ui-file-dragover")}).on("drop",function(e){if(!b(n.el).prop("readonly")&&!b(n.el).prop("disabled")){b(r).removeClass("w2ui-file-dragover");for(var t=e.originalEvent.dataTransfer.files,i=0,s=t.length;i<s;i++)n.addFile.call(n,t[i]);e.preventDefault(),e.stopPropagation()}}).on("dragover",function(e){e.preventDefault(),e.stopPropagation()}),r.find("input").on("click",function(e){e.stopPropagation()}).on("change",function(){if(void 0!==this.files)for(var e=0,t=this.files.length;e<t;e++)n.addFile.call(n,this.files[e])})),n.refresh()},addFile:function(e){var t,s=this,i=this.options,n=b(s.el).data("selected"),r={name:e.name,type:e.type,modified:e.lastModifiedDate,size:e.size,content:null,file:e},a=0,o=0;if(n)for(var l=0;l<n.length;l++){if(n[l].name==e.name&&n[l].size==e.size)return;a+=n[l].size,o++}var d=s.trigger({phase:"before",type:"add",target:s.el,file:r,total:o,totalSize:a});if(!0!==d.isCancelled){if(0!==i.maxFileSize&&r.size>i.maxFileSize)return t="Maximum file size is "+w2utils.formatSize(i.maxFileSize),!1===i.silent&&b(s.el).w2tag(t),void console.log("ERROR: "+t);if(0!==i.maxSize&&a+r.size>i.maxSize)return t="Maximum total size is "+w2utils.formatSize(i.maxSize),!1===i.silent&&b(s.el).w2tag(t),void console.log("ERROR: "+t);if(0!==i.max&&o>=i.max)return t="Maximum number of files is "+i.max,!1===i.silent&&b(s.el).w2tag(t),void console.log("ERROR: "+t);if(n.push(r),"undefined"!=typeof FileReader&&!0===i.readContent){var u=new FileReader;u.onload=function(e){var t=e.target.result,i=t.indexOf(",");r.content=t.substr(i+1),s.refresh(),b(s.el).trigger("change"),s.trigger(b.extend(d,{phase:"after"}))},u.readAsDataURL(e)}else s.refresh(),b(s.el).trigger("change")}},normMenu:function(e){if(b.isArray(e)){for(var t=0;t<e.length;t++)"string"==typeof e[t]?e[t]={id:e[t],text:e[t]}:(null!=e[t].text&&null==e[t].id&&(e[t].id=e[t].text),null==e[t].text&&null!=e[t].id&&(e[t].text=e[t].id),null!=e[t].caption&&(e[t].text=e[t].caption));return e}if("function"==typeof e)return this.normMenu(e());if("object"==typeof e){var i=[];for(var t in e)i.push({id:t,text:e[t]});return i}},getMonthHTML:function(e,t,i){var s=new Date,n=w2utils.settings.fullmonths,r=["31","28","31","30","31","30","31","31","30","31","30","31"],a=s.getFullYear()+"/"+(Number(s.getMonth())+1)+"/"+s.getDate(),o=w2utils.settings.fulldays.slice(),l=w2utils.settings.shortdays.slice();"M"!=w2utils.settings.weekStarts&&(o.unshift(o.pop()),l.unshift(l.pop()));var d=this.options;null==d&&(d={}),t=w2utils.isInt(t)?parseInt(t):s.getFullYear(),12<(e=w2utils.isInt(e)?parseInt(e):s.getMonth()+1)&&(e-=12,t++),(e<1||0===e)&&(e+=12,t--),t/4==Math.floor(t/4)?r[1]="29":r[1]="28",d.current=e+"/"+t;for(var u=(s=new Date(t,e-1,1)).getDay(),c="",h=0;h<l.length;h++)c+='<td title="'+o[h]+'">'+l[h]+"</td>";var p='<div class="w2ui-calendar-title title">    <div class="w2ui-calendar-previous previous"> <div></div> </div>    <div class="w2ui-calendar-next next"> <div></div> </div> '+n[e-1]+", "+t+'</div><table class="w2ui-calendar-days" cellspacing="0"><tbody>    <tr class="w2ui-day-title">'+c+"</tr>    <tr>",f=1;if("M"!=w2utils.settings.weekStarts&&u++,"datetime"===this.type){var g=w2utils.isDateTime(i,d.format,!0);i=w2utils.formatDate(g,w2utils.settings.dateFormat)}for(var m=1;m<43;m++){if(0===u&&1==m){for(var w=0;w<6;w++)p+='<td class="w2ui-day-empty">&#160;</td>';m+=6}else if(m<u||f>r[e-1]){p+='<td class="w2ui-day-empty">&#160;</td>',m%7==0&&(p+="</tr><tr>");continue}var v=t+"/"+e+"/"+f,y=new Date(v),b="";6===y.getDay()&&(b=" w2ui-saturday"),0===y.getDay()&&(b=" w2ui-sunday"),v==a&&(b+=" w2ui-today");var x,_,k=f,$="",C="";if("datetime"===this.type?(x=w2utils.formatDateTime(v,d.format),_=w2utils.formatDate(v,w2utils.settings.dateFormat)):_=x=w2utils.formatDate(v,d.format),d.colored&&void 0!==d.colored[_]){var T=d.colored[_].split(":");C="background-color: "+T[0]+";",$="color: "+T[1]+";"}p+='<td class="'+(this.inRange(x,!0)?"w2ui-date "+(_==i?"w2ui-date-selected":""):"w2ui-blocked")+b+'"    style="'+$+C+'" date="'+x+'" data-date="'+y+'">'+k+"</td>",(m%7==0||0===u&&1==m)&&(p+="</tr><tr>"),f++}return p+="</tr></tbody></table>"},getYearHTML:function(){for(var e=w2utils.settings.shortmonths,t=w2utils.settings.dateStartYear,i=w2utils.settings.dateEndYear,s="",n="",r=0;r<e.length;r++)s+='<div class="w2ui-jump-month" name="'+r+'">'+e[r]+"</div>";for(var a=t;a<=i;a++)n+='<div class="w2ui-jump-year" name="'+a+'">'+a+"</div>";return"<div>"+s+"</div><div>"+n+"</div>"},getHourHTML:function(){var e=[],t=this.options;null==t&&(t={format:w2utils.settings.timeFormat});for(var i=-1<t.format.indexOf("h24"),s=0;s<24;s++){var n=(12<=s&&!i?s-12:s)+":00"+(i?"":s<12?" am":" pm");12!=s||i||(n="12:00 pm"),e[Math.floor(s/8)]||(e[Math.floor(s/8)]="");var r=this.fromMin(this.toMin(n)),a=this.fromMin(this.toMin(n)+59);if("datetime"===this.type){var o=w2utils.isDateTime(this.el.value,t.format,!0),l=t.format.split("|")[0].trim();r=w2utils.formatDate(o,l)+" "+r,a=w2utils.formatDate(o,l)+" "+a}e[Math.floor(s/8)]+='<div class="'+(this.inRange(r)||this.inRange(a)?"w2ui-time ":"w2ui-blocked")+'" hour="'+s+'">'+n+"</div>"}return'<div class="w2ui-calendar">   <div class="w2ui-calendar-title">'+w2utils.lang("Select Hour")+'</div>   <div class="w2ui-calendar-time"><table><tbody><tr>       <td>'+e[0]+"</td>       <td>"+e[1]+"</td>       <td>"+e[2]+"</td>   </tr></tbody></table></div></div>"},getMinHTML:function(e){null==e&&(e=0);var t=this.options;null==t&&(t={format:w2utils.settings.timeFormat});for(var i=-1<t.format.indexOf("h24"),s=[],n=0;n<60;n+=5){var r=(12<e&&!i?e-12:e)+":"+(n<10?0:"")+n+" "+(i?"":e<12?"am":"pm"),a=r,o=n<20?0:n<40?1:2;if(s[o]||(s[o]=""),"datetime"===this.type){var l=w2utils.isDateTime(this.el.value,t.format,!0),d=t.format.split("|")[0].trim();a=w2utils.formatDate(l,d)+" "+a}s[o]+='<div class="'+(this.inRange(a)?"w2ui-time ":"w2ui-blocked")+'" min="'+n+'">'+r+"</div>"}return'<div class="w2ui-calendar">   <div class="w2ui-calendar-title">'+w2utils.lang("Select Minute")+'</div>   <div class="w2ui-calendar-time"><table><tbody><tr>       <td>'+s[0]+"</td>       <td>"+s[1]+"</td>       <td>"+s[2]+"</td>   </tr></tbody></table></div></div>"},toMin:function(e){if("string"!=typeof e)return null;var t=e.split(":");return 2!==t.length?null:(t[0]=parseInt(t[0]),t[1]=parseInt(t[1]),-1!=e.indexOf("pm")&&12!=t[0]&&(t[0]+=12),60*t[0]+t[1])},fromMin:function(e){1440<=e&&(e%=1440),e<0&&(e=1440+e);var t=Math.floor(e/60),i=(e%60<10?"0":"")+e%60,s=this.options;return null==s&&(s={format:w2utils.settings.timeFormat}),-1!=s.format.indexOf("h24")?t+":"+i:(t<=12?t:t-12)+":"+i+" "+(12<=t?"pm":"am")}},b.extend(n.prototype,w2utils.event),w2obj.field=n}(jQuery),function($){var w2form=function(e){this.name=null,this.header="",this.box=null,this.url="",this.routeData={},this.formURL="",this.formHTML="",this.page=0,this.recid=0,this.fields=[],this.actions={},this.record={},this.original={},this.postData={},this.httpHeaders={},this.method=null,this.toolbar={},this.tabs={},this.style="",this.focus=0,this.isGenerated=!1,this.last={xhr:null},$.extend(!0,this,w2obj.form,e)};$.fn.w2form=function(e){if($.isPlainObject(e)){var t=this;if(!w2utils.checkName(e,"w2form"))return;var i=e.record,s=e.original,n=e.fields,r=e.toolbar,a=e.tabs,o=new w2form(e);if($.extend(o,{record:{},original:{},fields:[],tabs:{},toolbar:{},handlers:[]}),$.isArray(a)){$.extend(!0,o.tabs,{tabs:[]});for(var l=0;l<a.length;l++){var d=a[l];"object"==typeof d?(o.tabs.tabs.push(d),!0===d.active&&(o.tabs.active=d.id)):o.tabs.tabs.push({id:d,caption:d})}}else $.extend(!0,o.tabs,a);if($.extend(!0,o.toolbar,r),n)for(var u=0;u<n.length;u++){var c=$.extend(!0,{},n[u]);null==c.name&&null!=c.field&&(c.name=c.field),null==c.field&&null!=c.name&&(c.field=c.name),o.fields[u]=c}for(var u in i)$.isPlainObject(i[u])?o.record[u]=$.extend(!0,{},i[u]):o.record[u]=i[u];for(var u in s)$.isPlainObject(s[u])?o.original[u]=$.extend(!0,{},s[u]):o.original[u]=s[u];return 0<t.length&&(o.box=t[0]),""!==o.formURL?$.get(o.formURL,function(e){o.formHTML=e,o.isGenerated=!0,0===$(o.box).length&&0===e.length||($(o.box).html(e),o.render(o.box))}):""!==o.formHTML||(0!==$(this).length&&""!==$.trim($(this).html())?o.formHTML=$(this).html():o.formHTML=o.generateHTML()),""===(w2ui[o.name]=o).formURL&&(-1==String(o.formHTML).indexOf("w2ui-page")&&(o.formHTML='<div class="w2ui-page page-0">'+o.formHTML+"</div>"),$(o.box).html(o.formHTML),o.isGenerated=!0,o.render(o.box)),o}return(t=w2ui[$(this).attr("name")])?0<arguments.length?(t[e]&&t[e].apply(t,Array.prototype.slice.call(arguments,1)),this):t:null},w2form.prototype={onRequest:null,onLoad:null,onValidate:null,onSubmit:null,onProgress:null,onSave:null,onChange:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,onAction:null,onToolbar:null,onError:null,msgNotJSON:"Returned data is not in valid JSON format.",msgAJAXerror:"AJAX error. See console for more details.",msgRefresh:"Refreshing...",msgSaving:"Saving...",get:function(e,t){if(0===arguments.length){for(var i=[],s=0;s<this.fields.length;s++)null!=this.fields[s].name&&i.push(this.fields[s].name);return i}for(var n=0;n<this.fields.length;n++)if(this.fields[n].name==e)return!0===t?n:this.fields[n];return null},set:function(e,t){for(var i=0;i<this.fields.length;i++)if(this.fields[i].name==e)return $.extend(this.fields[i],t),this.refresh(),!0;return!1},show:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);i&&i.hidden&&(i.hidden=!1,e++)}return 0<e&&this.refresh(),e},hide:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);i&&!i.hidden&&(i.hidden=!0,e++)}return 0<e&&this.refresh(),e},enable:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);i&&i.disabled&&(i.disabled=!1,e++)}return 0<e&&this.refresh(),e},disable:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);i&&!i.disabled&&(i.disabled=!0,e++)}return 0<e&&this.refresh(),e},reload:function(e){("object"!=typeof this.url?this.url:this.url.get)&&0!==this.recid&&null!=this.recid?this.request(e):"function"==typeof e&&e()},clear:function(){this.recid=0,this.record={},$().w2tag(),this.refresh()},error:function(e){var t=this,i=this.trigger({target:this.name,type:"error",message:e,xhr:this.last.xhr});!0!==i.isCancelled?(setTimeout(function(){t.message(e)},1),this.trigger($.extend(i,{phase:"after"}))):"function"==typeof callBack&&callBack()},message:function(e){"string"==typeof e&&(e={width:e.length<300?350:550,height:e.length<300?170:250,body:'<div class="w2ui-centered">'+e+"</div>",buttons:'<button class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message()\">Ok</button>",onOpen:function(e){setTimeout(function(){$(e.box).find(".w2ui-btn").focus()},25)}}),w2utils.message.call(this,{box:this.box,path:"w2ui."+this.name,title:".w2ui-form-header:visible",body:".w2ui-form-box"},e)},validate:function(e){null==e&&(e=!0),$().w2tag();for(var t=[],i=0;i<this.fields.length;i++){var s=this.fields[i];switch(null==this.record[s.name]&&(this.record[s.name]=""),s.type){case"int":this.record[s.name]&&!w2utils.isInt(this.record[s.name])&&t.push({field:s,error:w2utils.lang("Not an integer")});break;case"float":this.record[s.name]&&!w2utils.isFloat(this.record[s.name])&&t.push({field:s,error:w2utils.lang("Not a float")});break;case"money":this.record[s.name]&&!w2utils.isMoney(this.record[s.name])&&t.push({field:s,error:w2utils.lang("Not in money format")});break;case"color":case"hex":this.record[s.name]&&!w2utils.isHex(this.record[s.name])&&t.push({field:s,error:w2utils.lang("Not a hex number")});break;case"email":this.record[s.name]&&!w2utils.isEmail(this.record[s.name])&&t.push({field:s,error:w2utils.lang("Not a valid email")});break;case"checkbox":1==this.record[s.name]?this.record[s.name]=1:this.record[s.name]=0;break;case"date":s.options.format||(s.options.format=w2utils.settings.dateFormat),this.record[s.name]&&!w2utils.isDate(this.record[s.name],s.options.format)&&t.push({field:s,error:w2utils.lang("Not a valid date")+": "+s.options.format})}var n=this.record[s.name];s.required&&(""===n||$.isArray(n)&&0===n.length||$.isPlainObject(n)&&$.isEmptyObject(n))&&t.push({field:s,error:w2utils.lang("Required field")}),s.equalto&&this.record[s.name]!=this.record[s.equalto]&&t.push({field:s,error:w2utils.lang("Field should be equal to ")+s.equalto})}var r=this.trigger({phase:"before",target:this.name,type:"validate",errors:t});if(!0!==r.isCancelled){if(e)for(var a=0;a<r.errors.length;a++){var o=r.errors[a];null!=o.field&&("radio"==o.field.type?$($(o.field.el).parents("div")[0]).w2tag(o.error,{class:"w2ui-error"}):-1!=["enum","file"].indexOf(o.field.type)?function(t){setTimeout(function(){var e=$(t.field.el).data("w2field").helpers.multi;$(t.field.el).w2tag(t.error),$(e).addClass("w2ui-error")},1)}(o):$(o.field.el).w2tag(o.error,{class:"w2ui-error"}),this.goto(t[0].field.page))}return this.trigger($.extend(r,{phase:"after"})),t}},getChanges:function(){var n=function(e,t,i){for(var s in e)"object"==typeof e[s]?(i[s]=n(e[s],t[s]||{},{}),i[s]&&!$.isEmptyObject(i[s])||delete i[s]):e[s]!=t[s]&&(i[s]=e[s]);return i};return n(this.record,this.original,{})},request:function(postData,callBack){var obj=this;if("function"==typeof postData&&(callBack=postData,postData=null),null==postData&&(postData={}),this.url&&("object"!=typeof this.url||this.url.get)){null==this.recid&&(this.recid=0);var params={cmd:"get"};params.recid=this.recid,params.name=this.name,$.extend(params,this.postData),$.extend(params,postData);var edata=this.trigger({phase:"before",type:"request",target:this.name,url:this.url,postData:params,httpHeaders:this.httpHeaders});if(!0!==edata.isCancelled){this.record={},this.original={},this.lock(w2utils.lang(this.msgRefresh));var url=edata.url;if("object"==typeof edata.url&&edata.url.get&&(url=edata.url.get),this.last.xhr)try{this.last.xhr.abort()}catch(e){}if(!$.isEmptyObject(obj.routeData)){var info=w2utils.parseRoute(url);if(0<info.keys.length)for(var k=0;k<info.keys.length;k++)null!=obj.routeData[info.keys[k].name]&&(url=url.replace(new RegExp(":"+info.keys[k].name,"g"),obj.routeData[info.keys[k].name]))}var ajaxOptions={type:"POST",url:url,data:edata.postData,headers:edata.httpHeaders,dataType:"text"};switch(w2utils.settings.dataType){case"HTTP":ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"HTTPJSON":ajaxOptions.data={request:JSON.stringify(ajaxOptions.data)};break;case"RESTFULL":ajaxOptions.type="GET",ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"RESTFULLJSON":ajaxOptions.type="GET",ajaxOptions.data=JSON.stringify(ajaxOptions.data),ajaxOptions.contentType="application/json";break;case"JSON":ajaxOptions.type="POST",ajaxOptions.data=JSON.stringify(ajaxOptions.data),ajaxOptions.contentType="application/json"}this.method&&(ajaxOptions.type=this.method),this.last.xhr=$.ajax(ajaxOptions).done(function(data,status,xhr){obj.unlock();var edata=obj.trigger({phase:"before",target:obj.name,type:"load",xhr:xhr});if(!0!==edata.isCancelled){var data,responseText=obj.last.xhr.responseText;if("error"!=status){if(null!=responseText&&""!==responseText){if("object"==typeof responseText)data=responseText;else try{eval("data = "+responseText)}catch(e){}null==data&&(data={status:"error",message:w2utils.lang(obj.msgNotJSON),responseText:responseText}),"error"==data.status?obj.error(w2utils.lang(data.message)):(obj.record=$.extend({},data.record),obj.original=$.extend({},data.record))}}else obj.error("AJAX Error "+xhr.status+": "+xhr.statusText),data={status:"error",message:w2utils.lang(obj.msgAJAXerror),responseText:responseText};obj.trigger($.extend(edata,{phase:"after"})),obj.refresh(),"function"==typeof callBack&&callBack(data)}else"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."})}).fail(function(e,t,i){var s={status:t,error:i,rawResponseText:e.responseText},n=obj.trigger({phase:"before",type:"error",error:s,xhr:e});if(!0!==n.isCancelled){if("abort"!=t){var r;try{r=$.parseJSON(e.responseText)}catch(e){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",items:[{id:1,text:"item"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof r?r:e.responseText)}obj.trigger($.extend(n,{phase:"after"}))}}),this.trigger($.extend(edata,{phase:"after"}))}else"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."})}},submit:function(e,t){return this.save(e,t)},save:function(postData,callBack){var obj=this;$(this.box).find(":focus").change(),"function"==typeof postData&&(callBack=postData,postData=null);var errors=obj.validate(!0);0===errors.length&&(null==postData&&(postData={}),obj.url&&("object"!=typeof obj.url||obj.url.save)?(obj.lock(w2utils.lang(obj.msgSaving)+' <span id="'+obj.name+'_progress"></span>'),setTimeout(function(){var params={cmd:"save"};params.recid=obj.recid,params.name=obj.name,$.extend(params,obj.postData),$.extend(params,postData),obj.fields.forEach(function(e){"file"==e.type&&Array.isArray(obj.record[e.field])&&obj.record[e.field].forEach(function(e){delete e.file})}),params.record=$.extend(!0,{},obj.record);var edata=obj.trigger({phase:"before",type:"submit",target:obj.name,url:obj.url,postData:params,httpHeaders:obj.httpHeaders});if(!0!==edata.isCancelled){var url=edata.url;if("object"==typeof edata.url&&edata.url.save&&(url=edata.url.save),obj.last.xhr)try{obj.last.xhr.abort()}catch(e){}if(!$.isEmptyObject(obj.routeData)){var info=w2utils.parseRoute(url);if(0<info.keys.length)for(var k=0;k<info.keys.length;k++)null!=obj.routeData[info.keys[k].name]&&(url=url.replace(new RegExp(":"+info.keys[k].name,"g"),obj.routeData[info.keys[k].name]))}var ajaxOptions={type:"POST",url:url,data:edata.postData,headers:edata.httpHeaders,dataType:"text",xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=obj.trigger({phase:"before",type:"progress",total:e.total,loaded:e.loaded,originalEvent:e});if(!0===t.isCancelled)return;var i=Math.round(e.loaded/e.total*100);$("#"+obj.name+"_progress").text(i+"%"),obj.trigger($.extend(t,{phase:"after"}))}},!1),e}};switch(w2utils.settings.dataType){case"HTTP":ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"HTTPJSON":ajaxOptions.data={request:JSON.stringify(ajaxOptions.data)};break;case"RESTFULL":0!==obj.recid&&null!=obj.recid&&(ajaxOptions.type="PUT"),ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"RESTFULLJSON":0!==obj.recid&&null!=obj.recid&&(ajaxOptions.type="PUT"),ajaxOptions.data=JSON.stringify(ajaxOptions.data),ajaxOptions.contentType="application/json";break;case"JSON":ajaxOptions.type="POST",ajaxOptions.data=JSON.stringify(ajaxOptions.data),ajaxOptions.contentType="application/json"}this.method&&(ajaxOptions.type=this.method),obj.last.xhr=$.ajax(ajaxOptions).done(function(data,status,xhr){obj.unlock();var edata=obj.trigger({phase:"before",target:obj.name,type:"save",xhr:xhr,status:status});if(!0!==edata.isCancelled){var data,responseText=xhr.responseText;if("error"!=status){if(null!=responseText&&""!==responseText){if("object"==typeof responseText)data=responseText;else try{eval("data = "+responseText)}catch(e){}null==data&&(data={status:"error",message:w2utils.lang(obj.msgNotJSON),responseText:responseText}),"error"==data.status?obj.error(w2utils.lang(data.message)):obj.original=$.extend({},obj.record)}}else obj.error("AJAX Error "+xhr.status+": "+xhr.statusText),data={status:"error",message:w2utils.lang(obj.msgAJAXerror),responseText:responseText};obj.trigger($.extend(edata,{phase:"after"})),obj.refresh(),"success"==data.status&&"function"==typeof callBack&&callBack(data)}}).fail(function(e,t,i){var s={status:t,error:i,rawResponseText:e.responseText},n=obj.trigger({phase:"before",type:"error",error:s,xhr:e});!0!==n.isCancelled&&(console.log("ERROR: server communication failed. The server should return",{status:"success"},"OR",{status:"error",message:"error message"},", instead the AJAX request produced this: ",s),obj.trigger($.extend(n,{phase:"after"})))}),obj.trigger($.extend(edata,{phase:"after"}))}},50)):console.log("ERROR: Form cannot be saved because no url is defined."))},lock:function(e,t){var i=Array.prototype.slice.call(arguments,0);i.unshift(this.box),setTimeout(function(){w2utils.lock.apply(window,i)},10)},unlock:function(e){var t=this.box;setTimeout(function(){w2utils.unlock(t,e)},25)},goto:function(e){this.page!==e&&(null!=e&&(this.page=e),!0===$(this.box).data("auto-size")&&$(this.box).height(0),this.refresh())},generateHTML:function(){for(var e,t,i,s=[],n="",r=0;r<this.fields.length;r++){i="";var a=this.fields[r];null==a.html&&(a.html={}),null==a.options&&(a.options={}),a.html=$.extend(!0,{caption:"",span:6,attr:"",text:"",style:"",page:0,column:0},a.html),null==e&&(e=a.html.page),null==t&&(t=a.html.column),""===a.html.caption&&(a.html.caption=a.name);var o='<input name="'+a.name+'" class="w2ui-input" type="text" '+a.html.attr+' tabindex="'+(r+1)+'"/>';switch(a.type){case"pass":case"password":o='<input name="'+a.name+'" class="w2ui-input" type = "password" '+a.html.attr+' tabindex="'+(r+1)+'"/>';break;case"checkbox":o='<input name="'+a.name+'" class="w2ui-input" type="checkbox" '+a.html.attr+' tabindex="'+(r+1)+'"/>';break;case"radio":o="";var l=a.options.items?a.options.items:a.html.items;$.isArray(l)||(l=[]),0<l.length&&(l=w2obj.field.prototype.normMenu(l));for(var d=0;d<l.length;d++)o+='<label><input name="'+a.name+'" class="w2ui-input" type = "radio" '+a.html.attr+' value="'+l[d].id+'"/>&#160;'+l[d].text+"</label><br/>";break;case"select":o='<select name="'+a.name+'" class="w2ui-input" '+a.html.attr+' tabindex="'+(r+1)+'">';l=a.options.items?a.options.items:a.html.items;$.isArray(l)||(l=[]),0<l.length&&(l=w2obj.field.prototype.normMenu(l));for(d=0;d<l.length;d++)o+='<option value="'+l[d].id+'">'+l[d].text+"</option>";o+="</select>";break;case"textarea":o='<textarea name="'+a.name+'" class="w2ui-input" '+a.html.attr+' tabindex="'+(r+1)+'"></textarea>';break;case"toggle":o='<input name="'+a.name+'" type="checkbox" '+a.html.attr+' class="w2ui-input w2ui-toggle" tabindex="'+(r+1)+'"/><div><div></div></div>';break;case"html":case"custom":case"empty":o=""}""!==n&&(e!=a.html.page||t!=a.html.column||a.html.group&&n!=a.html.group)&&(s[e][t]+="\n   </div>",n=""),a.html.group&&n!=a.html.group&&(i+='\n   <div class="w2ui-group-title">'+a.html.group+'</div>\n   <div class="w2ui-group">',n=a.html.group),i+='\n      <div class="w2ui-field '+(null!=a.html.span?"w2ui-span"+a.html.span:"")+'" style="'+a.html.style+'">\n         <label>'+w2utils.lang(a.html.caption)+"</label>\n         <div>"+o+w2utils.lang(a.html.text)+"</div>\n      </div>",null==s[a.html.page]&&(s[a.html.page]=[]),null==s[a.html.page][a.html.column]&&(s[a.html.page][a.html.column]=""),s[a.html.page][a.html.column]+=i,e=a.html.page,t=a.html.column}if(""!==n&&(s[e][t]+="\n   </div>"),this.tabs.tabs)for(d=0;d<this.tabs.tabs.length;d++)null==s[d]&&(s[d]=[]);var u="";if(!$.isEmptyObject(this.actions)){for(var c in u+='\n<div class="w2ui-buttons">',this.actions){var h=this.actions[c],p={caption:"",style:"",class:""};$.isPlainObject(h)?(h.caption&&(p.caption=h.caption),h.style&&(p.style=h.style),h.class&&(p.class=h.class)):(p.caption=c,-1!=["save","update","create"].indexOf(c.toLowerCase())?p.class="w2ui-btn-blue":p.class=""),u+='\n    <button name="'+c+'" class="w2ui-btn '+p.class+'" style="'+p.style+'">'+w2utils.lang(p.caption)+"</button>"}u+="\n</div>"}i="";for(var f=0;f<s.length;f++){i+='<div class="w2ui-page page-'+f+'" '+(0===f?"":'style="display: none;"')+'><div class="w2ui-column-container" style="display: flex;">';for(var g=0;g<s[f].length;g++)i+='<div class="w2ui-column col-'+g+'">'+(s[f][g]||"")+"\n</div>";i+="\n</div></div>"}return i+=u},action:function(e,t){var i=this.actions[e],s=i;$.isPlainObject(i)&&i.onClick&&(s=i.onClick);var n=this.trigger({phase:"before",target:e,type:"action",click:s,originalEvent:t});!0!==n.isCancelled&&("function"==typeof s&&s.call(this,t),this.trigger($.extend(n,{phase:"after"})))},resize:function(){var e=this,t=this.trigger({phase:"before",target:this.name,type:"resize"});if(!0!==t.isCancelled){var i=$(this.box).find("> div.w2ui-form-box"),s=$(this.box).find("> div .w2ui-form-header"),n=$(this.box).find("> div .w2ui-form-toolbar"),r=$(this.box).find("> div .w2ui-form-tabs"),a=$(this.box).find("> div .w2ui-page"),o=$(this.box).find("> div .w2ui-page.page-"+this.page),l=$(this.box).find("> div .w2ui-page.page-"+this.page+" > div"),d=$(this.box).find("> div .w2ui-buttons");u(),0!==parseInt($(this.box).height())&&!0!==$(this.box).data("auto-size")||($(this.box).height((0<s.length?w2utils.getSize(s,"height"):0)+("object"==typeof this.tabs&&$.isArray(this.tabs.tabs)&&0<this.tabs.tabs.length?w2utils.getSize(r,"height"):0)+("object"==typeof this.toolbar&&$.isArray(this.toolbar.items)&&0<this.toolbar.items.length?w2utils.getSize(n,"height"):0)+(0<a.length?w2utils.getSize(l,"height")+w2utils.getSize(o,"+height")+12:0)+(0<d.length?w2utils.getSize(d,"height"):0)),$(this.box).data("auto-size",!0)),u(),this.toolbar&&this.toolbar.resize&&this.toolbar.resize(),this.tabs&&this.tabs.resize&&this.tabs.resize(),e.trigger($.extend(t,{phase:"after"}))}function u(){i.width($(e.box).width()).height($(e.box).height()),n.css("top",""!==e.header?w2utils.getSize(s,"height"):0),r.css("top",(""!==e.header?w2utils.getSize(s,"height"):0)+("object"==typeof e.toolbar&&$.isArray(e.toolbar.items)&&0<e.toolbar.items.length?w2utils.getSize(n,"height"):0)),a.css("top",(""!==e.header?w2utils.getSize(s,"height"):0)+("object"==typeof e.toolbar&&$.isArray(e.toolbar.items)&&0<e.toolbar.items.length?w2utils.getSize(n,"height")+5:0)+("object"==typeof e.tabs&&$.isArray(e.tabs.tabs)&&0<e.tabs.tabs.length?w2utils.getSize(r,"height")+5:0)),a.css("bottom",0<d.length?w2utils.getSize(d,"height"):0)}},refresh:function(e){var t=(new Date).getTime(),d=this;if(this.box&&this.isGenerated&&null!=$(this.box).html()){var i=this.trigger({phase:"before",target:this.name,type:"refresh",page:this.page,field:e});if(!0!==i.isCancelled){if(null!=e)var s=(n=d.get(e,!0))+1;else{$(this.box).find("input, textarea, select").each(function(e,t){var i=null!=$(t).attr("name")?$(t).attr("name"):$(t).attr("id"),s=d.get(i);if(s){var n=$(t).parents(".w2ui-page");if(0<n.length)for(var r=0;r<100;r++)if(n.hasClass("page-"+r)){s.page=r;break}}}),$(this.box).find(".w2ui-page").hide(),$(this.box).find(".w2ui-page.page-"+this.page).show(),$(this.box).find(".w2ui-form-header").html(this.header),"object"==typeof this.tabs&&$.isArray(this.tabs.tabs)&&0<this.tabs.tabs.length?($("#form_"+this.name+"_tabs").show(),this.tabs.active=this.tabs.tabs[this.page].id,this.tabs.refresh()):$("#form_"+this.name+"_tabs").hide(),"object"==typeof this.toolbar&&$.isArray(this.toolbar.items)&&0<this.toolbar.items.length?($("#form_"+this.name+"_toolbar").show(),this.toolbar.refresh()):$("#form_"+this.name+"_toolbar").hide();var n=0;s=this.fields.length}for(var r=n;r<s;r++){null==(e=this.fields[r]).name&&null!=e.field&&(e.name=e.field),null==e.field&&null!=e.name&&(e.field=e.name),e.$el=$(this.box).find('[name="'+String(e.name).replace(/\\/g,"\\\\")+'"]'),e.el=e.$el[0],null==e.el&&console.log('ERROR: Cannot associate field "'+e.name+'" with html control. Make sure html control exists with the same name.'),e.el&&(e.el.id=e.name),(p=$(e).data("w2field"))&&p.clear(),$(e.$el).off("change").on("change",function(){var e=this.value,t=null!=d.record[this.name]?d.record[this.name]:"",i=d.get(this.name);if(-1!=["list","enum","file"].indexOf(i.type)&&$(this).data("selected")){var s=$(this).data("selected"),n=d.record[this.name];if($.isArray(s)){e=[];for(var r=0;r<s.length;r++)e[r]=$.extend(!0,{},s[r])}if($.isPlainObject(s)&&(e=$.extend(!0,{},s)),$.isArray(n)){t=[];for(r=0;r<n.length;r++)t[r]=$.extend(!0,{},n[r])}$.isPlainObject(n)&&(t=$.extend(!0,{},n))}if(-1!=["toggle","checkbox"].indexOf(i.type)&&(e=!!$(this).prop("checked")&&("on"==$(this).prop("value")||$(this).prop("value"))),-1!=["int","float","percent","money","currency"].indexOf(i.type)&&(e=$(this).data("w2field").clean(e)),e!==t){var a=d.trigger({phase:"before",target:this.name,type:"change",value_new:e,value_previous:t});if(!0!==a.isCancelled){var o=this.value;if("select"==this.type&&(o=this.value),"checkbox"==this.type&&(o=!!this.checked),"radio"==this.type&&i.$el.each(function(e,t){t.checked&&(o=t.value)}),-1!=["int","float","percent","money","currency","list","combo","enum","file","toggle"].indexOf(i.type)&&(o=e),-1!=["enum","file"].indexOf(i.type)&&0<o.length){var l=$(i.el).data("w2field").helpers.multi;$(l).removeClass("w2ui-error")}(""===o||null==o||$.isArray(o)&&0===o.length||$.isPlainObject(o)&&$.isEmptyObject(o))&&(o=null),d.record[this.name]=o,d.trigger($.extend(a,{phase:"after"}))}else $(this).val(d.record[this.name])}}),e.required?$(e.el).parent().parent().addClass("w2ui-required"):$(e.el).parent().parent().removeClass("w2ui-required"),null!=e.disabled&&(e.disabled?$(e.el).prop("readonly",!0):$(e.el).prop("readonly",!1)),e.hidden?$(e.el).parent().parent().hide():$(e.el).parent().parent().show()}$(this.box).find("button, input[type=button]").each(function(e,t){$(t).off("click").on("click",function(e){var t=this.value;this.id&&(t=this.id),this.name&&(t=this.name),d.action(t,e)})});for(r=n;r<s;r++){e=this.fields[r];var a=null!=this.record[e.name]?this.record[e.name]:"";if(e.el)switch($(e.el).hasClass("w2ui-input")||$(e.el).addClass("w2ui-input"),e.type=String(e.type).toLowerCase(),e.options||(e.options={}),e.type){case"text":case"textarea":case"email":case"pass":case"password":e.el.value=a;break;case"int":case"float":case"money":case"currency":case"percent":e.el.value=a,$(e.el).w2field($.extend({},e.options,{type:e.type}));break;case"hex":case"alphanumeric":case"color":case"date":case"time":e.el.value=a,$(e.el).w2field($.extend({},e.options,{type:e.type}));break;case"toggle":w2utils.isFloat(a)&&(a=parseFloat(a)),$(e.el).prop("checked",!!a),this.record[e.name]=a||!1;break;case"list":case"combo":if("list"==e.type){var o=$.isPlainObject(a)?a.id:$.isPlainObject(e.options.selected)?e.options.selected.id:a;e.options.items||(e.options.items=[]);var l=e.options.items;$.isArray(l)&&0<l.length&&!$.isPlainObject(l[0])&&(e.options.items=w2obj.field.prototype.normMenu(l));for(var u=0;u<e.options.items.length;u++){var c=e.options.items[u];if(c.id==o){a=$.extend(!0,{},c),d.record[e.name]=a;break}}}else"combo"!=e.type||$.isPlainObject(a)?$.isPlainObject(a)&&null!=a.text?e.el.value=a.text:e.el.value="":e.el.value=a;$.isPlainObject(a)||(a={}),$(e.el).w2field($.extend({},e.options,{type:e.type,selected:a}));break;case"enum":case"file":$.isArray(a)||(a=[]),$(e.el).w2field($.extend({},e.options,{type:e.type,selected:a}));break;case"select":if(null!=(l=e.options.items)&&0<l.length){l=w2obj.field.prototype.normMenu(l),$(e.el).html("");for(var h=0;h<l.length;h++)$(e.el).append('<option value="'+l[h].id+'">'+l[h].text+"</option")}$(e.el).val(a);break;case"radio":$(e.$el).prop("checked",!1).each(function(e,t){$(t).val()==a&&$(t).prop("checked",!0)});break;case"checkbox":$(e.el).prop("checked",!!a);break;case"html":case"custom":case"empty":break;default:$(e.el).val(a),$(e.el).w2field($.extend({},e.options,{type:e.type}))}}var p=$(this.box).find(".w2ui-page");for(u=0;u<p.length;u++)1<$(p[u]).find("> *").length&&$(p[u]).wrapInner("<div></div>");return this.trigger($.extend(i,{phase:"after"})),this.resize(),(new Date).getTime()-t}}},render:function(e){var t=(new Date).getTime(),i=this;if("object"==typeof e&&(0<$(this.box).find("#form_"+this.name+"_tabs").length&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-form").html(""),this.box=e),this.isGenerated&&this.box){var s=this.trigger({phase:"before",target:this.name,type:"render",box:null!=e?e:this.box});if(!0!==s.isCancelled){$.isEmptyObject(this.original)&&!$.isEmptyObject(this.record)&&(this.original=$.extend(!0,{},this.record));var n='<div class="w2ui-form-box">'+(""!==this.header?'<div class="w2ui-form-header">'+this.header+"</div>":"")+'    <div id="form_'+this.name+'_toolbar" class="w2ui-form-toolbar" style="display: none"></div>    <div id="form_'+this.name+'_tabs" class="w2ui-form-tabs" style="display: none"></div>'+this.formHTML+"</div>";return $(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-form").html(n),0<$(this.box).length&&($(this.box)[0].style.cssText+=this.style),"function"!=typeof this.toolbar.render&&(this.toolbar=$().w2toolbar($.extend({},this.toolbar,{name:this.name+"_toolbar",owner:this})),this.toolbar.on("click",function(e){var t=i.trigger({phase:"before",type:"toolbar",target:e.target,originalEvent:e});!0!==t.isCancelled&&i.trigger($.extend(t,{phase:"after"}))})),"object"==typeof this.toolbar&&"function"==typeof this.toolbar.render&&this.toolbar.render($("#form_"+this.name+"_toolbar")[0]),"function"!=typeof this.tabs.render&&(this.tabs=$().w2tabs($.extend({},this.tabs,{name:this.name+"_tabs",owner:this,active:this.tabs.active})),this.tabs.on("click",function(e){i.goto(this.get(e.target,!0))})),"object"==typeof this.tabs&&"function"==typeof this.tabs.render&&(this.tabs.render($("#form_"+this.name+"_tabs")[0]),this.tabs.active&&this.tabs.click(this.tabs.active)),this.trigger($.extend(s,{phase:"after"})),this.resize(),("object"!=typeof this.url?this.url:this.url.get)&&0!==this.recid&&null!=this.recid?this.request():this.refresh(),0===$(".w2ui-layout").length&&(this.tmp_resize=function(e){w2ui[i.name].resize()},$(window).off("resize","body").on("resize","body",this.tmp_resize)),0<=this.focus&&setTimeout(function(){0===$(i.box).find("input, select, textarea").length?setTimeout(r,500):r()},10),(new Date).getTime()-t}}function r(){var e=$(i.box).find("div:not(.w2ui-field-helper) > input, select, textarea, div > label:nth-child(1) > :radio").not(".file-input");e.length>i.focus&&e[i.focus].focus()}},destroy:function(){var e=this.trigger({phase:"before",target:this.name,type:"destroy"});!0!==e.isCancelled&&("object"==typeof this.toolbar&&this.toolbar.destroy&&this.toolbar.destroy(),"object"==typeof this.tabs&&this.tabs.destroy&&this.tabs.destroy(),0<$(this.box).find("#form_"+this.name+"_tabs").length&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-form").html(""),delete w2ui[this.name],this.trigger($.extend(e,{phase:"after"})),$(window).off("resize","body"))}},$.extend(w2form.prototype,w2utils.event),w2obj.form=w2form}(jQuery);var path_upload="",path_site=self.location.href;path_site=path_site.split("/");for(var i=1;i<=path_site.length;i++)if(""!=path_site[i]){acc=path_site[i],path_site=self.location.href.substring(0,self.location.href.indexOf(acc)+acc.length+1);break}var w2desktop=function(){};setTimeout(function(){var e=w2popup.defaults;e.bottomFixed=!0,w2popup.initialize($(".menu-container")),$(".w2desktop .menu-container").data(e),$(".menu-container").hide(),$.get(path_site+"w2ui/index?app=explorer&functions=server_basedir_upload",function(e){path_upload=w2utils.decodeTags(e)})},1),w2desktop.startTime=function(){$(".w2desktop .clock").html((new Date).toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")),0<$(".w2desktop .session").length&&$.get(path_site+"w2ui/index?app=session",function(e){$(".w2desktop .session").html(e)}),setTimeout(w2desktop.startTime,1e3)},setTimeout(w2desktop.startTime,1e3),w2desktop.startMenuClick=function(e){0==$("#w2ui-lock").length&&($(".w2desktop .menu-container").is(":visible")?$(".w2desktop .menu-container").hide():$(".w2desktop .menu-container").show())},w2desktop.clicktask=function(e){if(0==$("#w2ui-lock").length){w2popup.activetask(e);var t=$(e).attr("w2popup_id"),i=$("#"+t);i.is(":visible")&&16e3<=i.css("z-index")?i.hide():w2popup.activewindows(i)}},w2desktop.closepopup=function(e){var t=$(e).closest(".w2ui-popup");$(".task").each(function(){$(this).attr("w2popup_id")==t.attr("id")&&$(this).remove()})},w2desktop.initialize=function(){setTimeout("w2popup.unlock(1000,w2desktop.getPopup());",1e3)},w2desktop.popup=function(e,t){var i=$(e).find("a"),s=$(e).find(".icon_32"),n=$(i).attr("w2popup_id"),r=$("#"+n),a="";try{null!=i.attr("target")&&""!=i.attr("target")&&(a="function(){w2desktop.w2popupUpdateValueChildrenBySeletor('"+t+"','"+i.attr("target")+"',data);}")}catch(e){i.attr("callback","")}if(void 0===n||0==n||0==r.length){r=top.w2popup.open({icon:s.attr("src"),title:i.html(),body:"",url:path_site+i.attr("href"),buttons:"",width:void 0===i.attr("width")?$(window).width()-50:i.attr("width"),height:void 0===i.attr("height")?$(window).height()-70:i.attr("height"),minwidth:300,minheight:200,overflow:"hidden",color:"#333",speed:"0.3",opacity:"0.8",modal:"true"==i.attr("modal"),bottomFixed:!1,showClose:!0,showMax:!0,showMin:!0,onClose:function(e){w2desktop.closepopup(e)},onCallBack:a}),$(i).attr("w2popup_id",r.x_w2ui_popup.attr("id"));var o=$('<div onclick="w2desktop.clicktask(this)" class="task" w2popup_id="'+r.x_w2ui_popup.attr("id")+'"><img class="icon_32" src="'+s.attr("src")+'">'+$(i).html()+"</div>");$(".w2desktop .tasks").append(o),w2popup.activetask(o),w2popup.lock("Carregando Sistema",!0,$("#"+r.x_w2ui_popup.attr("id")))}else r.show();$(".w2desktop .menu-container").hide()},w2desktop.getPopup=function(e){e=null==e||""==e?w2desktop.getPopupID():e;var t=$(parent.document.getElementById(e));return 0==t.length&&(t=$("#"+e)),t},w2desktop.getPopupID=function(e){return null==e||""==e?$("head").find('meta[name="w2popup"]').attr("content"):$(e).closest("html").find('meta[name="w2popup"]').attr("content")},w2desktop.getCalback=function(){return $("head").find('meta[name="calback"]').attr("content")},w2desktop.$=function(e){return w2desktop.getPopup().find(".iframe").contents().find(e)},w2desktop.findIframebyPopupid=function(e){return w2desktop.getPopup(e).find(".iframe")},w2desktop.w2popupUpdateValueChildrenBySeletor=function(e,t,i){w2desktop.findIframebyPopupid(e).contents().find(t).val(i);try{w2desktop.findIframebyPopupid(e).contents().find(t).focus()}catch(e){}};var w2explorer=function(){};w2explorer.menuEnable=function(e){var t=$(e);t.addClass("hover"),t.find("ul:first").css("visibility","visible"),0==$(".itens_explorer_selected").length?($("a.delete_file_folder").css("color","#AAA"),$("a.properties_file_folder").css("color","#AAA")):($("a.delete_file_folder").css("color",""),$("a.properties_file_folder").css("color",""))},w2explorer.menuDisable=function(e){var t=$(e);t.removeClass("hover"),t.find("ul:first").css("visibility","hidden")},w2explorer.menuSendFile=function(){$("#file").click()},w2explorer.menuCreateFolder=function(e){var t=$(e).closest("body").find(".url").val(),i=$("<button></button>",{class:"w2ui-btn",html:"Criar",onclick:"w2explorer.AjaxMenuCreateFolder(this)"}),s=$("<button></button>",{class:"w2ui-btn",html:"Cancelar",onclick:"w2popup.close(this);"}),n=$("<input/>",{name:"folder",id:"folder",type:"text",value:"",style:"width:100%;height:30px;margin-top:20px;"}),r=$("<label></label>",{html:"Digite o novo Nome:",style:"color:#555;font-family:Verdana, Arial, sans-serif;font-size:16px;"}).append(n),a=$("<label></label>",{id:"my_msg",style:"color:red;font-family:Verdana, Arial, sans-serif;font-size:16px;"}),o=$("<input/>",{id:"my_url",type:"hidden",value:t}),l=$("<input/>",{id:"my_popup_parent",type:"hidden",value:w2desktop.getPopupID(e)}),d=$("<div></div>").append(r,o,a,l),u=$("<div></div>").append(i,s);InternalWindowPopup=top.w2popup.open({icon:"../assets/img/oxygen-icons-png-master/oxygen/48x48/actions/folder-new.png",title:"Criar Nova Pasta",body:d.html(),url:null,buttons:u.html(),width:300,height:200,minwidth:300,minheight:200,overflow:"hidden",color:"#333",speed:"0.3",opacity:"0.8",modal:!0,bottomFixed:!1,showClose:!0,showMax:!1,showMin:!1,onClose:function(e){w2desktop.closepopup(e)},onCallBack:null});var c=InternalWindowPopup.x_w2ui_popup.attr("id"),h=$('<div onclick="w2desktop.clicktask(this)" class="task" w2popup_id="'+InternalWindowPopup.x_w2ui_popup.attr("id")+'"><img class="icon_32" src="./assets/img/oxygen-icons-png-master/oxygen/48x48/mimetypes/inode-directory.png">Criar Nova Pasta</div>');return $(".w2desktop .tasks").append(h),top.w2popup.activetask(h),top.w2popup.activewindows($("#"+c)),!1},w2explorer.AjaxMenuCreateFolder=function(a){_url=$("#my_url").val(),"undefined"==typeof _url&&(_url=""),w2popup.lock("Criando pasta",!0,a),$("#my_msg").val(""),$.ajax({url:"../w2ui/index?app=explorer&functions=new_folder&url="+_url+"&folder="+$("#folder").val(),type:"POST",error:function(e){w2popup.unlock(200,a),$("#my_msg").html(e)},success:function(e,t,i){w2popup.unlock(200,a),$("#my_msg").html(e);var s=$("#my_popup_parent").val(),n=$("#"+s).find("iframe"),r=n.attr("src");n.attr("src",r),-1==e.indexOf("j existe")&&w2popup.close(a)}})},w2explorer.menuDeleteFileFolder=function(e){var t=$(e).closest("body").find(".itens_explorer_selected");if(0<t.length&&(file_folder=new Array,t.each(function(e){file_folder.push($(this).attr("fullname"))}),0<file_folder.length)){$(e).closest("body").find(".url").val();var i=$("<button></button>",{class:"w2ui-btn",html:"Sim",onclick:"w2explorer.AjaxMenuDeleteFolder(this)"}),s=$("<button></button>",{class:"w2ui-btn",html:"No",onclick:"w2popup.close(this);"}),n=$("<label></label>",{html:"Tem certeza que deseja Excluir :",style:"color:#555;font-family:Verdana, Arial, sans-serif;font-size:16px;"}),r=$("<p></p>",{id:"my_file_folder",html:file_folder.toString(),style:"color:#555;font-family:Verdana, Arial, sans-serif;font-size:16px;word-wrap: break-word;"}),a=$("<label></label>",{id:"my_msg",style:"color:red;font-family:Verdana, Arial, sans-serif;font-size:16px;"}),o=$("<input/>",{id:"my_popup_parent",type:"hidden",value:w2desktop.getPopupID(e)}),l=$("<div></div>").append(n,r,a,o),d=$("<div></div>");d.append(i,s),InternalWindowPopup=top.w2popup.open({icon:"./assets/img/oxygen-icons-png-master/oxygen/48x48/actions/edit-delete.png",title:"Excluir",body:l.html(),url:null,buttons:d.html(),width:400,height:200,minwidth:400,minheight:200,overflow:"hidden",color:"#333",speed:"0.3",opacity:"0.8",modal:!0,bottomFixed:!1,showClose:!0,showMax:!1,showMin:!1,onClose:function(e){w2desktop.closepopup(e)},onCallBack:null});var u=InternalWindowPopup.x_w2ui_popup.attr("id");top.w2popup.activewindows(top.$("#"+u));var c=$('<div onclick="w2desktop.clicktask(this)" class="task" w2popup_id="'+InternalWindowPopup.x_w2ui_popup.attr("id")+'"><img class="icon_32" src="./assets/img/oxygen-icons-png-master/oxygen/48x48/mimetypes/inode-directory.png">Criar Nova Pasta</div>');top.$(".w2desktop .tasks").append(c),top.w2popup.activetask(c)}return!1},w2explorer.AjaxMenuDeleteFolder=function(a){w2popup.lock("Excluindo",!0,a),$("#my_msg").val(""),$.ajax({url:"../w2ui/index?app=explorer&functions=delete&file_folder="+$("#my_file_folder").html(),type:"POST",contentType:"charset=utf-8",error:function(e){w2popup.unlock(200,a),$("#my_msg").html(e)},success:function(e,t,i){w2popup.unlock(200,a),$("#my_msg").html(e);var s=$("#my_popup_parent").val(),n=$("#"+s).find("iframe"),r=n.attr("src");n.attr("src",r),w2popup.close(a)}})},w2explorer.find=function(e){var t=_request.getParameter("url");t=null!=t&&0!=t.length?t:"",$("#explorer").html(""),$(".url").val(t),$.get("../w2ui/index?app=explorer&functions=find&url="+t+"&search="+e,function(e){w2explorer.createItem(e,"list")})},w2explorer.load=function(t){var e=_request.getParameter("url");e=null!=e&&0!=e.length?e:"",$("#explorer").html(""),$(".url").val(e),$.get("../w2ui/index?app=explorer&url="+e,function(e){w2explorer.createItem(e,t)}),$(document).ready(function(){self.File&&self.FileList&&self.FileReader&&w2explorer.upload.Init()})},w2explorer.createItem=function(_data,type){_data=w2utils.decodeTags(_data);try{_data=eval(_data)}catch(e){}for(var i=0;i<_data.length;i++){var fileName=_data[i].file_name,size=_data[i].file_size,isfolder=_data[i].directory,fullFileName=_data[i].full_file_name,dateModify=_data[i].date_modify,_width=null;try{_width=_data[i].width}catch(e){}var _height=null;try{_height=_data[i].height}catch(e){}var ext=fileName.split(".").pop().toLowerCase(),path="../assets/img/oxygen-icons-png-master/oxygen/48x48/mimetypes/",img="";if(isfolder?img=path+"inode-directory.png":"ada"==ext?img=path+"text-x-adasrc.png":"c"==ext?img=path+"text-x-objcsrc.png":"c#"==ext||"csharp"==ext?img=path+"text-x-csharp.png":"c++"==ext?img=path+"text-x-c++src.png":"css"==ext?img=path+"text-css.png":"csv"==ext?img=path+"text-csv.png":"dwg"==ext?img=path+"image-vnd.dwg.png":"doc"==ext||"docx"==ext?img=path+"application-msword.png":"java"==ext?img=path+"text-x-java.png":"js"==ext?img=path+"application-javascript.png":ext in{jpg:0,jpeg:0,png:0,gif:0,bmp:0,tif:0,svg:0}?img=path+"image-x-generic.png":"h"==ext?img=path+"text-x-objchdr.png":"h++"==ext?img=path+"text-x-c++hdr.png":"htm"==ext||"html"==ext?img=path+"text-html.png":"log"==ext?img=path+"text-x-log.png":ext in{mdb:0,mdbx:0}?img=path+"application-vnd.ms-access.png":ext in{mp3:0,ogg:0,aac:0}?img=path+"audio-x-generic.png":ext in{mp4:0,avi:0,"3gp":0,flv:0,mpeg:0}?img=path+"application-vnd.ms-access.png":"afm"==ext?img=path+"application-x-font-afm.png":"bdf"==ext?img=path+"application-x-font-bdf.png":"pcf"==ext?img=path+"application-x-font-pcf.png":"otf"==ext?img=path+"application-x-font-otf.png":"snf"==ext?img=path+"application-x-font-snf.png":"ttf"==ext?img=path+"application-x-font-ttf.png":"pas"==ext?img=path+"text-x-pascal.png":"pdf"==ext?img=path+"application-pdf.png":"php"==ext?img=path+"application-x-php.png":ext in{ppt:0,pptx:0}?img=path+"application-vnd.ms-powerpoint.png":"py"==ext?img=path+"text-x-python.png":"rtf"==ext?img=path+"application-rtf.png":ext in["rb","erb"]?img=path+"application-x-ruby.png":"svg"==ext?img=path+"image-vnd.dgn.png":"txt"==ext?img=path+"text-x-generic.png":ext in{xls:0,xlsx:0}?img=path+"application-vnd.ms-excel.png":"xml"==ext?img=path+"text-xml.png":ext in{wave:0,wav:0,wma:0}?img=path+"audio-x-wav.png":ext in{zip:0,xz:0,tar:0}?img=path+"application-zip.png":(img=path+"application-x-zerosize.png",img=path+"unknown.png"),type="list","icon"==type){var itens_explorer=$("<div></div>",{class:"itens_explorer block_icon",ondblclick:isfolder?'w2explorer.openFolder("'+fileName+'");':'w2explorer.openFile("'+fileName+'");',onClick:'w2explorer.selectItem(this,event,"'+fileName+'")'});itens_explorer.attr("fullname",fullFileName);var hint=$("<div></div>",{class:"hint"});hint.append($("<p></p>",{html:"Tamanho: "+size})),hint.append($("<p></p>",{html:"Caminho: "+fullFileName})),hint.append($("<p></p>",{html:"Data Modificao: "+dateModify})),null!=_width&&(hint=$("<p></p>",{html:_width+" X "+_height})),itens_explorer.append($("<div></div>",{class:"icon_itens",style:'background-image: url("'+img+'");'}).append(hint)),itens_explorer.append($("<div></div>",{class:"text_itens",html:fileName})),$("#explorer").append(itens_explorer)}else if("list"==type){if(0==$("#explorer").find("div").length){var itens_explorer=$("<div></div>",{class:"line_title_list"}),div_name=$("<div></div>",{class:"line_title_itens",style:"text-align:left;width:258px;",html:"Nome"}),div_size=$("<div></div>",{class:"line_title_itens",style:"text-align:right;width:100px;",html:"Tamanho"}),div_fullName=$("<div></div>",{class:"line_title_itens",style:"text-align:left;width:200px;",html:"Caminho Completo"}),div_dateModify=$("<div></div>",{class:"line_title_itens",style:"text-align:right;width:200px;",html:"Data Modificao"}),div_img_info=$("<div></div>",{class:"line_title_itens",style:"text-align:right;width:150px;",html:"Resoluo Imagem"});itens_explorer.append(div_name,div_size,div_fullName,div_dateModify,div_img_info),$("#explorer").append(itens_explorer)}var line_par="";$("#explorer").find(".itens_explorer").length%2==0&&(line_par="line_par");var itens_explorer=$("<div></div>",{class:"line_list itens_explorer "+line_par,ondblclick:isfolder?'w2explorer.openFolder("'+fileName+'");':'w2explorer.openFile("'+fileName+'");',onClick:'w2explorer.selectItem(this,event,"'+fileName+'")'});itens_explorer.attr("fullname",fullFileName);var div_icon_32=$("<div></div>",{class:"line_icon_itens",style:'background-image: url("'+img+'");'}),div_name=$("<div></div>",{class:"line_text_itens",style:"text-align:left;width:200px;",html:fileName}),div_size=$("<div></div>",{class:"line_text_itens",style:"text-align:right;width:100px;",html:size}),div_fullName=$("<div></div>",{class:"line_text_itens",style:"text-align:left;width:200px;",html:fullFileName}),div_dateModify=$("<div></div>",{class:"line_text_itens",style:"text-align:right;width:200px;",html:dateModify}),div_img_info=$("<div></div>",{class:"line_text_itens",style:"text-align:right;width:150px;"});null!=_width&&div_img_info.html(_width+" X "+_height),itens_explorer.append(div_icon_32,div_name,div_size,div_fullName,div_dateModify,div_img_info),$("#explorer").append(itens_explorer)}}};var _request=function(){};_request.getParameter=function(e){for(var t=self.location.href.split("#").pop().split("&"),i=new Array,s=0;s<t.length;s++){var n=t[s].split("=");if(i.push({name:n[0],value:n[1]}),i[s].name==e)return i[s].value}},w2explorer.goHome=function(){self.location.href="#"},w2explorer.goPressEnter=function(e,t){13==e.keyCode&&w2explorer.go($(t).val())},w2explorer.go=function(e){""!=(e=null!=e&&0!=e.length?e:"")&&w2popup.updateIframe(w2desktop.getPopup(),e)},w2explorer.goBack=function(tag){var x_w2ui_popup=w2desktop.getPopup();try{var x=eval(x_w2ui_popup.find("iframe").attr("pos"));if(x<=0)return!1;x--,x_w2ui_popup.find("iframe").attr("pos",""+x);var _history=x_w2ui_popup.find("iframe").attr("history").split(",");x_w2ui_popup.find("iframe").attr("src",_history[x]),tag.form.elements.url.value=_history[x]}catch(e){}return!1},w2explorer.goForward=function(tag){var x_w2ui_popup=w2desktop.getPopup();try{var x=eval(x_w2ui_popup.find("iframe").attr("pos")),_history=x_w2ui_popup.find("iframe").attr("history").split(",");if(x>=_history.length-1)return!1;x++,x_w2ui_popup.find("iframe").attr("pos",""+x),x_w2ui_popup.find("iframe").attr("src",_history[x]),tag.form.elements.url.value=_history[x]}catch(e){}return!1},w2explorer.goUP=function(){var e=_request.getParameter("url");e=null!=e&&0!=e.length?e:"";try{e=e.substr(0,e.length-2)}catch(e){}var t=e.lastIndexOf("/");e=e.substr(0,t),self.location.href="#url="+e},w2explorer.initialize=function(){0!=$("#explorer").length&&(w2popup.lock("Carregando Sistema",!0,w2desktop.getPopup()),$(window).on("hashchange",function(){w2explorer.load("icon");var x_w2ui_popup=w2desktop.getPopup();x_w2ui_popup.find('input[name="url"]').val(self.location.href);try{var x=eval(x_w2ui_popup.find("iframe").attr("pos"));x++,x_w2ui_popup.find("iframe").attr("pos",""+x);var _history=x_w2ui_popup.find("iframe").attr("history").split(",");_history.push(self.location.href),x_w2ui_popup.find("iframe").attr("history",""+_history.toString())}catch(e){x_w2ui_popup.find("iframe").attr("pos","1"),x_w2ui_popup.find("iframe").attr("history",new Array(self.location.href).toString())}}),w2explorer.load("icon"),w2popup.unlock(1e3,w2desktop.getPopup()))},w2explorer.load=function(t){var e=_request.getParameter("url");e=null!=e&&0!=e.length?e:"",$("#explorer").html(""),$(".url").val(e),w2popup.lock("Carregando Sistema",!0,w2desktop.getPopup()),$.get("../w2ui/index?app=explorer&url="+e,function(e){w2explorer.createItem(e,t),w2popup.unlock(1e3,w2desktop.getPopup())}),$(document).ready(function(){self.File&&self.FileList&&self.FileReader&&w2explorer.upload.Init()})},w2explorer.openFolder=function(e){var t=_request.getParameter("url");t=null!=t&&0!=t.length?t:"",e=null!=e&&0!=e.length?e:"",""!=t&&""==e?e=t:""!=t&&""!=e&&(e=t+"/"+e),""!=e&&(self.location.href="#url="+e)},w2explorer.openFile=function(url){var parameter_url=_request.getParameter("url");parameter_url=null!=parameter_url&&0!=parameter_url.length?parameter_url:"",url=null!=url&&0!=url.length?url:"",""!=parameter_url&&""==url?url=parameter_url:""!=parameter_url&&""!=url&&(url=parameter_url+"/"+url),url=path_upload+url;var x_w2ui_popup=w2desktop.getPopup(),CallBack=w2desktop.getCalback();acc_CallBack='var data="'+url+'";x=new '+CallBack;try{CallBack=eval(acc_CallBack),x_w2ui_popup.find(".w2ui-popup-close").click()}catch(e){}},w2explorer.selectItem=function(e,t,i){if(t.shiftKey){var s=$(e).index(),n=$($(".itens_explorer_selected")[$(".itens_explorer_selected").length-1]).index();-1!=n&&$(".itens_explorer").each(function(e){n<s&&n<=e&&e<=s||s<n&&s<=e&&e<=n||s==n&&s==e?$(this).addClass("itens_explorer_selected"):$(this).removeClass("itens_explorer_selected")})}else t.ctrlKey?$(e).hasClass("itens_explorer_selected")?$(e).removeClass("itens_explorer_selected"):$(e).addClass("itens_explorer_selected"):$(e).hasClass("itens_explorer_selected")?$(".itens_explorer").removeClass("itens_explorer_selected"):($(".itens_explorer").removeClass("itens_explorer_selected"),$(e).addClass("itens_explorer_selected"))},w2explorer.upload=function(){},w2explorer.upload.progressByFile=function(e,t){var i=$("div.upload"),s=null,n=null;if(i.find("div.caption").each(function(){0<$(this).html().indexOf(e)&&(s=$(this),n=s.closest("div.file"),0==s.find(".progess").length?s.append($("<strong></strong>",{class:"progess",html:t})):s.find(".progess").html(t))}),null!=n&&null!=s){var r=n.find("div.progress_containner").first();r.find(".progress_blue");r.width(t)}},w2explorer.upload.erroByFile=function(e,t){var i=$("div.upload"),s=null,n=null;(i.find("div.caption").each(function(){0<$(this).html().indexOf(e)&&(s=$(this),n=s.closest("div.file"),s.html("Erro ao enviar o arquivo: "),s.append($("<strong></strong>",{html:e})),s.append(" erro "),s.append($("<strong></strong>",{html:t})))}),null!=n&&null!=s)&&(n.find("div.progress_containner").first().find(".progress_blue").attr("class","progress_red"),setTimeout(function(){n.remove(),0==i.find("div.file").length&&i.css("display","none")},15e3))},w2explorer.upload.DoneByFile=function(e){var t=$("div.upload"),i=null,s=null;(t.find("div.caption").each(function(){0<$(this).html().indexOf(e)&&(i=$(this),s=i.closest("div.file"),i.html("O arquivo: "),i.append($("<strong></strong>",{html:e})),i.append(" foi enviado por sucesso!"))}),null!=s&&null!=i)&&(s.find("div.progress_containner").first().find(".progress_blue").attr("class","progress_green"),setTimeout(function(){s.remove(),0==t.find("div.file").length&&t.css("display","none"),w2explorer.load("icon")},3e3))},w2explorer.upload.addProgress=function(e){var t=$("div.upload"),i=$("<div></div>",{class:"file"});i.append($("<div></div>",{class:"caption",html:e}));var s=$("<div></div>",{class:"progress_containner"});s.append($("<span></span>",{class:"progress_blue"})),i.append(s),t.append(i)},w2explorer.upload.ParseFile=function(e){var t="Informaes do arquivo: <strong>"+e.name+"</strong> Tipo: <strong>"+e.type+"</strong>  Tamanho: <strong>"+e.size+"</strong> Bytes ";w2explorer.upload.addProgress(t)},w2explorer.upload.explorerHover=function(e){e.stopPropagation(),e.preventDefault(),e.target.className="dragover"==e.type?"hover":""},w2explorer.upload.FileSelectHandler=function(e){var t=e.originalEvent.target.files||e.originalEvent.dataTransfer.files;if(0<t.length){w2explorer.upload.explorerHover(e);for(var i,s=$("#file"),n=$(s.get(0).form),r=0;i=t[r];r++){var a=new FormData(s.get(0).form);a.append("files[]",i,i.name);var o=n.attr("action")+"&url="+$(".url").val();w2explorer.upload.send(o,a,i)}}},w2explorer.upload.FileSelectForm=function(e){var t=e.files,i=$(e.form);if(0<t.length)for(var s,n=i.attr("action")+"&url="+$(".url").val(),r=0;s=t[r];r++){var a=new FormData;a.append("files[]",s,s.name);n=i.attr("action")+"&url="+$(".url").val();w2explorer.upload.send(n,a,s)}},w2explorer.upload.send=function(_url,_data,file){var ext=file.name.split(".").pop().toLowerCase(),MB=1048576;$(".upload").css("display","block"),w2explorer.upload.ParseFile(file),ext in{jpg:0,jpeg:0,png:0,gif:0,bmp:0,tif:0,svg:0}?file.size<5*MB?$.ajax({url:_url,data:_data,cache:!1,contentType:!1,processData:!1,type:"POST",xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.onprogress=function(e){var t=parseInt(e.loaded/e.total*100)+"%";setTimeout("w2explorer.upload.progressByFile('"+file.name+"','"+t+"')",1)},e.upload.onload=function(){},e},error:function(error){w2explorer.upload.progressByFile(file.name,"100%"),w2explorer.upload.erroByFile(file.name,eval(error))},success:function(e,t,i){0<=e.indexOf("ERRO!")?(w2explorer.upload.progressByFile(file.name,"100%"),w2explorer.upload.erroByFile(file.name,e)):(w2explorer.upload.progressByFile(file.name,"100%"),w2explorer.upload.DoneByFile(file.name))}}):(w2explorer.upload.progressByFile(file.name,"100%"),w2explorer.upload.erroByFile(file.name,"ERRO! O tamanho do arquivo "+file.name+"  "+w2utils.formatSize(file.size)+" maior que o maximo permitido 5 MB")):(w2explorer.upload.progressByFile(file.name,"100%"),w2explorer.upload.erroByFile(file.name,"ERRO! A exteso do arquivo ."+ext+' no  um formato de imagem ".jpg",".jpeg",".png",".gif",".bmp",".tif",".svg" '))},w2explorer.upload.Init=function(){var e=$("#fileselect"),t=$("#explorer");$("#submitbutton");$(document).ready(function(){e.on("change",function(e){w2explorer.upload.FileSelectHandler(e)})}),(new XMLHttpRequest).upload&&$(document).ready(function(){t.on("dragover",function(e){w2explorer.upload.explorerHover(e)}),t.on("dragleave",function(e){w2explorer.upload.explorerHover(e)}),t.on("drop",function(e){w2explorer.upload.FileSelectHandler(e)})})};